<!DOCTYPE html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="Hexo Theme Keep"><meta name=description content="Hexo Theme Keep"><meta name=author content=carbofish><title>常见加密解密编码算法 | Carbo</title><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/logo.png><link rel=stylesheet href=/font/css/fontawesome.min.css><link rel=stylesheet href=/font/css/regular.min.css><link rel=stylesheet href=/font/css/solid.min.css><link rel=stylesheet href=/font/css/brands.min.css><script class=keep-theme-configurations>let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.json"},KEEP.theme_config={base_info:{primary_color:"#1abc9c",title:"Carbo",author:"carbofish",avatar:"/images/avatar.png",logo:"/images/logo.png",favicon:"/images/logo.png"},menu:{home:"/ || fa-solid fa-home",tags:"/tags || fa-solid fa-tags",links:"/links || fa-solid fa-link",about:"/about || fa-solid fa-user-graduate"},first_screen:{enable:!0,background_img:"https://s3.carbo.ink/img/wallpaper/115959359_p0_r.jpg",background_img_dark:"https://s3.carbo.ink/img/wallpaper/115959359_p0_r.jpg",description:"白雪却嫌春色晚，欲穿庭树作飞花。",hitokoto:!1},social_contact:{enable:!1,links:{github:null,weixin:null,qq:"https://github.com/XPoet",weibo:null,zhihu:null,twitter:null,x:null,facebook:null,email:null}},scroll:{progress_bar:!0,percent:!0,hide_header:!0},home:{announcement:null,category:!0,tag:!0,post_datetime:"updated"},post:{author_badge:{enable:!1,level_badge:!0,custom_badge:["One","Two","Three"]},word_count:{wordcount:!0,min2read:!0},datetime_format:"YYYY-MM-DD HH:mm:ss",copyright_info:!0,share:!1,reward:{enable:!1,img_link:null,text:null,icon:null}},code_block:{tools:{enable:!0,style:"default"},highlight_theme:"default"},toc:{enable:!0,number:!1,expand_all:!1,init_open:!0,layout:"right"},website_count:{busuanzi_count:{enable:!0,site_uv:!0,site_pv:!0,page_pv:!0}},local_search:{enable:!0,preload:!0},comment:{enable:!0,use:"waline",valine:{appid:null,appkey:null,server_urls:null,placeholder:null},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null,proxy:null},twikoo:{env_id:null,region:null,version:"1.6.36"},waline:{server_url:"https://comment.carbo.ink/",reaction:!0,version:"3.3.2",option:{dark:"auto"}},giscus:{repo:null,repo_id:null,category:"Announcements",category_id:null,reactions_enabled:!1},artalk:{server:null},disqus:{shortname:null}},rss:{enable:!1},lazyload:{enable:!0},cdn:{enable:!1,provider:"unpkg"},pjax:{enable:!0},footer:{since:2024,word_count:!0,site_deploy:{enable:!1,provider:"github",url:null},record:{enable:!1,list:[{code:null,link:null}]}},inject:{enable:!1,css:[null],js:[null]},root:"",source_data:{links:[{name:"5m10v3",link:"https://5m10v3.top",avatar:"https://5m10v3.top/images/1.jpg",description:"进击的二进制人"},{name:"PangBai",link:"https://pangbai.work/",avatar:"http://pangbai.work/images/avatar.jpg",description:"Bangbai | d180"},{name:"void2eye",link:"https://void2eye.fun/",avatar:"https://void2eye.fun/img/808.png",description:"政治家"},{name:"C3ngH",link:"https://c3ngh.top",avatar:"https://c3ngh-blog.oss-cn-hangzhou.aliyuncs.com/img/C3ngH.jpg",description:"包罗万象哥"},{name:"A1ic3",link:"https://a1ic3.cn/",avatar:"https://a1ic3.cn/images/avatar1.jpg",description:"小密码王"},{name:"enllus1on",link:"https://enllus1on.github.io/",description:"Pwn神",avatar:"https://enllus1on.github.io/images/kano.jpg"},{name:"AsaL1n",link:"https://asal1n.github.io/",avatar:"https://asal1n.github.io/img/head.jpg",description:"血怒哥"},{name:"Straw",link:"https://straw-233.github.io/",avatar:"https://straw-233.github.io/avatar/meinasi.png",description:"午门痴"},{name:"CHHHCHHOH",link:"http://www.chhhchhoh.cn/",avatar:"https://s2.loli.net/2024/10/20/9EXmLyYuU6b5tVh.png",description:"吃了乙酸的乙醇不会梦到乙酸乙酯"},{name:"Lunatic",link:"https://goodlunatic.github.io/",avatar:"https://www.nssctf.cn/files/2024/4/28/7f130a1387.png",description:"Mind and Hand :)"},{name:"Fup1p1",link:"https://www.fup1p1.cn/",avatar:"https://www.nssctf.cn/files/2024/4/29/524400904c.jpeg",description:"逆向寻真理"},{name:"X1ao",link:"https://www.x1aoblog.top/",avatar:"http://www.x1aoblog.top/upload/mmexport1681277516546.png",description:"大密码王"},{name:"Xux",link:"https://www.xuxblog.top",avatar:"https://avatars.githubusercontent.com/u/82816273?s=64&v=4",description:"神仙 Web 👴"},{name:"Woodwhale",avatar:"https://www.woodwhale.cn/woodwhale.png",link:"https://www.woodwhale.cn",description:"全栈神"},{name:"Xunflash",avatar:"https://www.xunflash.top/icon.png",link:"https://www.xunflash.top/",description:"澳爷"},{name:"bi0x",avatar:"https://blog.bi0x.com/img/avatar.png",link:"https://blog.bi0x.com/",description:"字节👴"},{name:"huanghunr",link:"https://blog.huanghunr.top",avatar:"https://pic.imgdb.cn/item/670b4202d29ded1a8c807e7e.jpg",description:"喵喵喵?!还没想好"},{name:"温婳霂",link:"https://somokel.github.io",avatar:"https://s2.loli.net/2024/10/21/GixfX61nsPMkN4r.jpg",description:"春祺夏安，秋绥冬宁。"}]},version:"4.2.2"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"},KEEP.language_copy_copyright={copy:"复制版权信息",copied:"已复制",title:"原文标题",author:"原文作者",link:"原文链接"}</script><meta name=generator content="Hexo 7.3.0"><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style></head><body><div class=progress-bar-container><span class=scroll-progress-bar></span> <span class=pjax-progress-bar></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container border-box"><div class="page-main-content border-box"><div class=page-main-content-top><header class=header-wrapper><div class="border-box header-content"><div class="left flex-start border-box"><a class="logo-image border-box" href=/ ><img src=/images/logo.png> </a><a class="site-name border-box" href=/ >Carbo</a></div><div class="right border-box"><div class="pc border-box"><ul class="menu-list border-box"><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/ ><i class="menu-text-color menu-icon fa-solid fa-home"></i> 首页</a></li><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/tags><i class="menu-text-color menu-icon fa-solid fa-tags"></i> 标签</a></li><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/links><i class="menu-text-color menu-icon fa-solid fa-link"></i> 友链</a></li><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/about><i class="menu-text-color menu-icon fa-solid fa-user-graduate"></i> 关于</a></li><li class="menu-item search search-popup-trigger"><i class="menu-text-color fas search fa-search"></i></li></ul></div><div class="mobile border-box flex-start"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class=menu-bar-middle></div></div></div></div></div><div class=header-drawer><ul class="drawer-menu-list border-box"><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/ ><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i> </span>首页</a></label></li><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/tags><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i> </span>标签</a></label></li><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/links><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-link"></i> </span>友链</a></label></li><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/about><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-user-graduate"></i> </span>关于</a></label></li></ul></div><div class=window-mask></div></header></div><div class="page-main-content-middle border-box"><div class="main-content border-box"><div class=fade-in-down-animation><div class="post-page-container border-box"><div class="post-content-container border-box"><div class="post-content-bottom border-box"><div class=post-title>常见加密解密编码算法</div><div class="post-header border-box"><div class="avatar-box border-box"><img src=/images/avatar.png></div><div class=info-box><div class="author border-box"><span class=name>carbofish</span></div><div class="meta-info border-box"><div class="post-meta-info-container border-box post"><div class="post-meta-info border-box"><span class="meta-info-item post-create-date"><i class="icon fa-solid fa-calendar-plus"></i>&nbsp; <span class=datetime>2024-10-06 15:12:45</span> </span><span class="meta-info-item post-update-date"><i class="icon fa-solid fa-file-pen"></i>&nbsp; <span class=datetime data-updated="Sat Nov 30 2024 13:04:24 GMT+0800">2024-11-30 13:04:24</span> </span><span class="post-tag meta-info-item border-box"><ul class=post-tag-ul><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/Reverse/ >Reverse</a></li><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/Encryption/ >Encryption</a></li></ul></span><span class="meta-info-item post-wordcount"><i class="icon fas fa-file-word"></i>&nbsp;<span>17.7k 字</span> </span><span class="meta-info-item post-min2read"><i class="icon fas fa-clock"></i>&nbsp;<span>105 分钟</span> </span><span class="meta-info-item post-pv"><i class="icon fas fa-eye"></i>&nbsp;<span id=vercount_value_page_pv></span></span></div></div></div></div></div><div class="post-content keep-markdown-body"><p>常见的加密解密算法实现汇总</p><span id=more></span><h2 id=HEX><a href=#HEX class=headerlink title=HEX></a>HEX</h2><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"stdio.h"</span> <span class=comment>// sprintf()函数声明所在的头文件</span></span></span><br><span class=line><span class=type>char</span> data[] = <span class=string>"Hello World!!\r\n"</span>;</span><br><span class=line><span class=type>char</span> res[<span class=number>32</span>];</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>str_2_hex_str</span><span class=params>(<span class=type>char</span> *dest, <span class=type>char</span> *src)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>int</span> len = <span class=built_in>strlen</span>(src); <span class=comment>// 获取接收数据长度</span></span><br><span class=line>    <span class=type>int</span> i,j;</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>, j = <span class=number>0</span>; i &lt; len; i++) {</span><br><span class=line>        <span class=built_in>sprintf</span>(&amp;dest[j], <span class=string>"%02X"</span>, src[i]);</span><br><span class=line>        j+=<span class=number>2</span>; <span class=comment>// 每个16进制占2个长度</span></span><br><span class=line>    }</span><br><span class=line>    dest[j] = <span class=string>'\0'</span>; <span class=comment>// 添加字符串结束符</span></span><br><span class=line>    <span class=keyword>return</span> j; <span class=comment>// 返回字符串长度</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=type>int</span> len = <span class=built_in>str_2_hex_str</span>(res, data);</span><br><span class=line><span class=comment>///////////////////////////////</span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdlib.h&gt;</span> <span class=comment>// 要使用strtol()库函数，需要包含头文件</span></span></span><br><span class=line></span><br><span class=line><span class=type>char</span> data[] = <span class=string>"48656C6C6F20576F726C6421210D0A"</span>; <span class=comment>// 假如，我们接收到这样的数据</span></span><br><span class=line><span class=type>char</span> res[<span class=number>32</span>]; <span class=comment>// 储存转换后的结果</span></span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>hex_str_2_str</span><span class=params>(<span class=type>char</span> *dest, <span class=type>char</span> *src)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>int</span> len = <span class=built_in>strlen</span>(src); <span class=comment>// 获取接收数据长度</span></span><br><span class=line>    <span class=type>int</span> i,j;</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>, j = <span class=number>0</span>; i &lt; len; i+=<span class=number>2</span>) { <span class=comment>// 每次取两个字符</span></span><br><span class=line>        <span class=type>char</span> tmp_buf[<span class=number>3</span>]; <span class=comment>// 每两个字符组成一个16进制字符串，同时结尾需要空字符来告诉编译器我们的是字符串</span></span><br><span class=line>        <span class=type>char</span> *endptr; <span class=comment>// 保存已转换数值后的下一个字符</span></span><br><span class=line>        <span class=comment>// 以下为取待转换的16进制字符串</span></span><br><span class=line>        tmp_buf[<span class=number>0</span>] = src[i];</span><br><span class=line>        tmp_buf[<span class=number>1</span>] = src[i + <span class=number>1</span>];</span><br><span class=line>        tmp_buf[<span class=number>2</span>] = <span class=string>'\0'</span>; <span class=comment>// 记得添加空字符</span></span><br><span class=line>        <span class=comment>// 转换成16进制，base传16即可</span></span><br><span class=line>        dest[j++] = <span class=built_in>strtol</span>(tmp_buf, &amp;endptr, <span class=number>16</span>);</span><br><span class=line>    }</span><br><span class=line>    dest[j] = <span class=string>'\0'</span>; <span class=comment>// 添加字符串结束符</span></span><br><span class=line>    <span class=keyword>return</span> j;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=type>int</span> len = <span class=built_in>hex_str_2_str</span>(res, data);</span><br><span class=line></span><br></pre></td></tr></table></figure><h2 id=BASE64><a href=#BASE64 class=headerlink title=BASE64></a>BASE64</h2><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br></pre></td><td class=code><pre><span class=line><span class=comment>//base64加密</span></span><br><span class=line><span class=type>char</span> base64[<span class=number>65</span>] = <span class=string>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>;</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>encodeBase64</span><span class=params>(<span class=type>char</span>* str,<span class=type>int</span> len,<span class=type>char</span>** in)</span></span>{</span><br><span class=line>    </span><br><span class=line>    <span class=comment>//读取3个字节zxc，转换为二进制01111010 01111000 01100011</span></span><br><span class=line>    <span class=comment>//转换为4个6位字节，011110 100111 100001 100011</span></span><br><span class=line>    <span class=comment>//不足8位在前补0，变成00011110 00100111 00100001 00100011</span></span><br><span class=line>    <span class=comment>//若剩余的字节数不足以构成4个字节，补等号</span></span><br><span class=line>    <span class=type>int</span> encodeStrLen = <span class=number>1</span> + (len/<span class=number>3</span>)*<span class=number>4</span> ,k=<span class=number>0</span>;</span><br><span class=line>    encodeStrLen += len%<span class=number>3</span> ? <span class=number>4</span> : <span class=number>0</span>;</span><br><span class=line>    <span class=type>char</span>* encodeStr = (<span class=type>char</span>*)(<span class=built_in>malloc</span>(<span class=built_in>sizeof</span>(<span class=type>char</span>)*encodeStrLen));</span><br><span class=line>    <span class=keyword>for</span>(<span class=type>int</span> i=<span class=number>0</span>;i&lt;len;i++){</span><br><span class=line>        <span class=keyword>if</span>(len - i &gt;= <span class=number>3</span>){</span><br><span class=line>            encodeStr[k++] = base64[(<span class=type>unsigned</span> <span class=type>char</span>)str[i]&gt;&gt;<span class=number>2</span>];</span><br><span class=line>            encodeStr[k++] = base64[((<span class=type>unsigned</span> <span class=type>char</span>)str[i]&amp;<span class=number>0x03</span>)&lt;&lt;<span class=number>4</span> | (<span class=type>unsigned</span> <span class=type>char</span>)str[++i]&gt;&gt;<span class=number>4</span>];</span><br><span class=line>            encodeStr[k++] = base64[((<span class=type>unsigned</span> <span class=type>char</span>)str[i]&amp;<span class=number>0x0f</span>)&lt;&lt;<span class=number>2</span> | (<span class=type>unsigned</span> <span class=type>char</span>)str[++i]&gt;&gt;<span class=number>6</span>];</span><br><span class=line>            encodeStr[k++] = base64[(<span class=type>unsigned</span> <span class=type>char</span>)str[i]&amp;<span class=number>0x3f</span>];</span><br><span class=line>        }<span class=keyword>else</span> <span class=keyword>if</span>(len-i == <span class=number>2</span>){</span><br><span class=line>            encodeStr[k++] = base64[(<span class=type>unsigned</span> <span class=type>char</span>)str[i] &gt;&gt; <span class=number>2</span>];</span><br><span class=line>            encodeStr[k++] = base64[((<span class=type>unsigned</span> <span class=type>char</span>)str[i]&amp;<span class=number>0x03</span>) &lt;&lt; <span class=number>4</span> | ((<span class=type>unsigned</span> <span class=type>char</span>)str[++i] &gt;&gt; <span class=number>4</span>)];</span><br><span class=line>            encodeStr[k++] = base64[((<span class=type>unsigned</span> <span class=type>char</span>)str[i]&amp;<span class=number>0x0f</span>) &lt;&lt; <span class=number>2</span>];</span><br><span class=line>            encodeStr[k++] = <span class=string>'='</span>;</span><br><span class=line>        }<span class=keyword>else</span>{</span><br><span class=line>            encodeStr[k++] = base64[(<span class=type>unsigned</span> <span class=type>char</span>)str[i] &gt;&gt; <span class=number>2</span>];</span><br><span class=line>            encodeStr[k++] = base64[((<span class=type>unsigned</span> <span class=type>char</span>)str[i] &amp; <span class=number>0x03</span>) &lt;&lt; <span class=number>4</span>];                                                                                                              <span class=comment>//末尾补两个等于号</span></span><br><span class=line>            encodeStr[k++] = <span class=string>'='</span>;</span><br><span class=line>            encodeStr[k++] = <span class=string>'='</span>;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    encodeStr[k] = <span class=string>'\0'</span>;</span><br><span class=line>    *in = encodeStr;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment>* 解码既编码的逆过程，先找出编码后的字符在编码之前代表的数字</span></span><br><span class=line><span class=comment>* 编码中将3位个字符变成4个字符，得到这4个字符的每个字符代表的原本数字</span></span><br><span class=line><span class=comment>* 因为在编码中间每个字符用base64码表进行了替换，所以这里要先换回来</span></span><br><span class=line><span class=comment>* 在对换回来的数字进行位运算使其还原成3个字符</span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>decodeBase64</span><span class=params>(<span class=type>char</span>* str,<span class=type>int</span> len,<span class=type>char</span>** in)</span></span>{</span><br><span class=line>    </span><br><span class=line>    <span class=type>char</span> ascill[<span class=number>129</span>];</span><br><span class=line>    <span class=type>int</span> k = <span class=number>0</span>;</span><br><span class=line>    <span class=keyword>for</span>(<span class=type>int</span> i=<span class=number>0</span>;i&lt;<span class=number>64</span>;i++){</span><br><span class=line>        ascill[base64[i]] = k++;</span><br><span class=line>    }</span><br><span class=line>    <span class=type>int</span> decodeStrlen = len / <span class=number>4</span> * <span class=number>3</span> + <span class=number>1</span>;</span><br><span class=line>    <span class=type>char</span>* decodeStr = (<span class=type>char</span>*)<span class=built_in>malloc</span>(<span class=built_in>sizeof</span>(<span class=type>char</span>)*decodeStrlen);</span><br><span class=line>    k = <span class=number>0</span>;</span><br><span class=line>    <span class=keyword>for</span>(<span class=type>int</span> i=<span class=number>0</span>;i&lt;len;i++){</span><br><span class=line>        decodeStr[k++] = (ascill[str[i]] &lt;&lt; <span class=number>2</span>) | (ascill[str[++i]] &gt;&gt; <span class=number>4</span>);</span><br><span class=line>        <span class=keyword>if</span>(str[i<span class=number>+1</span>] == <span class=string>'='</span>){</span><br><span class=line>            <span class=keyword>break</span>;</span><br><span class=line>        }</span><br><span class=line>        decodeStr[k++] = (ascill[str[i]] &lt;&lt; <span class=number>4</span>) |  (ascill[str[++i]] &gt;&gt; <span class=number>2</span>);</span><br><span class=line>        <span class=keyword>if</span>(str[i<span class=number>+1</span>] == <span class=string>'='</span>){</span><br><span class=line>            <span class=keyword>break</span>;</span><br><span class=line>        }</span><br><span class=line>        decodeStr[k++] = (ascill[str[i]] &lt;&lt; <span class=number>6</span>) | (ascill[str[++i]]);</span><br><span class=line>    }</span><br><span class=line>    decodeStr[k] = <span class=string>'\0'</span>;</span><br><span class=line>    *in = decodeStr;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span></span>{</span><br><span class=line>    <span class=type>char</span> mm[]=<span class=string>"UAsFvs3tDyTxFPGb7WbyBYSm05VWrJxgjArj9mx490pfH1LO"</span>;</span><br><span class=line>    <span class=type>char</span> *mm1;</span><br><span class=line>    <span class=type>char</span> *mm2;</span><br><span class=line>    <span class=built_in>encodeBase64</span>(mm,<span class=built_in>strlen</span>(mm),&amp;mm1);</span><br><span class=line>    <span class=built_in>decodeBase64</span>(mm1,<span class=built_in>strlen</span>(mm1),&amp;mm2);</span><br><span class=line>    <span class=built_in>puts</span>(mm2);</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=XXTEA><a href=#XXTEA class=headerlink title=XXTEA></a>XXTEA</h2><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdint.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> DELTA 0x9e3779b9</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> MX (((z&gt;&gt;5^y<span class=string>&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class=line><span class=comment>//容易魔改</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>btea</span><span class=params>(<span class=type>uint32_t</span> * v, <span class=type>int</span> n, <span class=type>uint32_t</span> <span class=type>const</span> key[<span class=number>4</span>])</span> </span>{</span><br><span class=line><span class=comment>//v为数据，n为数据长度(负时为解密)，key为密钥</span></span><br><span class=line>    <span class=type>uint32_t</span> y,  z, sum;  <span class=type>unsigned</span> p, rounds, e;</span><br><span class=line>    <span class=keyword>if</span> (n &gt; <span class=number>1</span>)</span><br><span class=line>    <span class=comment>/* Coding Part */</span></span><br><span class=line>    {</span><br><span class=line>        rounds = <span class=number>6</span> + <span class=number>52</span> / n;</span><br><span class=line>        sum = <span class=number>0</span>;</span><br><span class=line>        z = v[n - <span class=number>1</span>];</span><br><span class=line>        <span class=keyword>do</span> {</span><br><span class=line>            sum += DELTA;</span><br><span class=line>            e = (sum &gt;&gt; <span class=number>2</span>) &amp; <span class=number>3</span>;</span><br><span class=line>            <span class=keyword>for</span> (p = <span class=number>0</span>; p &lt; n - <span class=number>1</span>; p++) {</span><br><span class=line>                y = v[p + <span class=number>1</span>];</span><br><span class=line>                z = v[p] += MX;</span><br><span class=line>            }</span><br><span class=line>            y = v[<span class=number>0</span>];</span><br><span class=line>            z = v[n - <span class=number>1</span>] += MX;</span><br><span class=line>        } <span class=keyword>while</span> (-- rounds );</span><br><span class=line>    } <span class=keyword>else</span> <span class=keyword>if</span> (n &lt; <span class=number>-1</span>)</span><br><span class=line>    <span class=comment>/* Decoding Part */</span></span><br><span class=line>    {</span><br><span class=line>        n = -n;</span><br><span class=line>        rounds = <span class=number>6</span> + <span class=number>52</span> / n;</span><br><span class=line>        sum = rounds * DELTA;</span><br><span class=line>        y = v[<span class=number>0</span>];</span><br><span class=line>        <span class=keyword>do</span> {</span><br><span class=line>            e = (sum &gt;&gt; <span class=number>2</span>) &amp; <span class=number>3</span>;</span><br><span class=line>            <span class=keyword>for</span> (p = n - <span class=number>1</span>; p &gt; <span class=number>0</span>; p--) {</span><br><span class=line>                z = v[p - <span class=number>1</span>];</span><br><span class=line>                y = v[p] -= MX;</span><br><span class=line>            }</span><br><span class=line>            z = v[n - <span class=number>1</span>];</span><br><span class=line>            y = v[<span class=number>0</span>] -= MX;</span><br><span class=line>            sum -= DELTA;</span><br><span class=line>        } <span class=keyword>while</span> (-- rounds );</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdlib.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> delta 0x9e3779b9</span></span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> v[<span class=number>8</span>] = {<span class=number>0x10BD3B47</span>, <span class=number>0x6155E0F9</span>, <span class=number>0x6AF7EBC5</span>, <span class=number>0x8D23435F</span>, <span class=number>0x1A091605</span>, <span class=number>0xD43D40EF</span>, <span class=number>0xB4B16A67</span>, <span class=number>0x6B3578A9</span>};</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> key[<span class=number>4</span>] = {<span class=number>0x00001234</span>, <span class=number>0x00002345</span>, <span class=number>0x00004567</span>, <span class=number>0x00006789</span>};</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> sum = <span class=number>0</span>;</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> y, z, p, rounds, e;</span><br><span class=line>    <span class=type>int</span> n = <span class=number>8</span>;</span><br><span class=line>    <span class=type>int</span> i = <span class=number>0</span>;</span><br><span class=line>    rounds = <span class=number>6</span> + <span class=number>52</span> / n;</span><br><span class=line>    y = v[<span class=number>0</span>];</span><br><span class=line>    sum = rounds * delta;</span><br><span class=line>    <span class=keyword>do</span></span><br><span class=line>    {</span><br><span class=line>        e = sum &gt;&gt; <span class=number>2</span> &amp; <span class=number>3</span>;</span><br><span class=line>        <span class=keyword>for</span> (p = n - <span class=number>1</span>; p &gt; <span class=number>0</span>; p--)</span><br><span class=line>        {</span><br><span class=line>            z = v[p - <span class=number>1</span>];</span><br><span class=line>            v[p] -= ((((z &gt;&gt; <span class=number>5</span>) ^ (y &lt;&lt; <span class=number>2</span>)) + ((y &gt;&gt; <span class=number>3</span>) ^ (z &lt;&lt; <span class=number>4</span>))) ^ ((key[(p &amp; <span class=number>3</span>) ^ e] ^ z) + (y ^ sum)));</span><br><span class=line>            y = v[p];</span><br><span class=line>        }</span><br><span class=line>        z = v[n - <span class=number>1</span>];</span><br><span class=line>        v[<span class=number>0</span>] -= (((key[(p ^ e) &amp; <span class=number>3</span>] ^ z) + (y ^ sum)) ^ (((y &lt;&lt; <span class=number>2</span>) ^ (z &gt;&gt; <span class=number>5</span>)) + ((z &lt;&lt; <span class=number>4</span>) ^ (y &gt;&gt; <span class=number>3</span>))));</span><br><span class=line>        y = v[<span class=number>0</span>];</span><br><span class=line>        sum = sum - delta;</span><br><span class=line>    } <span class=keyword>while</span> (--rounds);</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; n; i++)</span><br><span class=line>    {</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%c%c%c%c"</span>, *((<span class=type>char</span> *)&amp;v[i] + <span class=number>0</span>), *((<span class=type>char</span> *)&amp;v[i] + <span class=number>1</span>), *((<span class=type>char</span> *)&amp;v[i] + <span class=number>2</span>), *((<span class=type>char</span> *)&amp;v[i] + <span class=number>3</span>));</span><br><span class=line>        <span class=comment>// printf("%c%c%c%c",*((char*)&amp;v[i]+3),*((char*)&amp;v[i]+2),*((char*)&amp;v[i]+1),*((char*)&amp;v[i]+0));</span></span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=XTea><a href=#XTea class=headerlink title=XTea></a>XTea</h2><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdint.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>encipher</span><span class=params>(<span class=type>unsigned</span> <span class=type>int</span> num_rounds, <span class=type>uint32_t</span> v[<span class=number>2</span>], <span class=type>uint32_t</span> <span class=type>const</span> key[<span class=number>4</span>])</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> i;</span><br><span class=line>    <span class=type>uint32_t</span> v0 = v[<span class=number>0</span>], v1 = v[<span class=number>1</span>], sum = <span class=number>0</span>, delta = <span class=number>0x9E3779B9</span>;</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; num_rounds; i++)</span><br><span class=line>    {</span><br><span class=line>        v0 += (((v1 &lt;&lt; <span class=number>4</span>) ^ (v1 &gt;&gt; <span class=number>5</span>)) + v1) ^ (sum + key[sum &amp; <span class=number>3</span>]);</span><br><span class=line>        sum += delta;</span><br><span class=line>        v1 += (((v0 &lt;&lt; <span class=number>4</span>) ^ (v0 &gt;&gt; <span class=number>5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class=number>11</span>) &amp; <span class=number>3</span>]);</span><br><span class=line>    }</span><br><span class=line>    v[<span class=number>0</span>] = v0;</span><br><span class=line>    v[<span class=number>1</span>] = v1;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>decipher</span><span class=params>(<span class=type>unsigned</span> <span class=type>int</span> num_rounds, <span class=type>uint32_t</span> v[<span class=number>2</span>], <span class=type>uint32_t</span> <span class=type>const</span> key[<span class=number>4</span>])</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> i;</span><br><span class=line>    <span class=type>uint32_t</span> v0 = v[<span class=number>0</span>], v1 = v[<span class=number>1</span>], delta = <span class=number>0x9E3779B9</span>, sum = delta * num_rounds;</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; num_rounds; i++)</span><br><span class=line>    {</span><br><span class=line>        v1 -= (((v0 &lt;&lt; <span class=number>4</span>) ^ (v0 &gt;&gt; <span class=number>5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class=number>11</span>) &amp; <span class=number>3</span>]);</span><br><span class=line>        sum -= delta;</span><br><span class=line>        v0 -= (((v1 &lt;&lt; <span class=number>4</span>) ^ (v1 &gt;&gt; <span class=number>5</span>)) + v1) ^ (sum + key[sum &amp; <span class=number>3</span>]);</span><br><span class=line>    }</span><br><span class=line>    v[<span class=number>0</span>] = v0;</span><br><span class=line>    v[<span class=number>1</span>] = v1;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=Tea><a href=#Tea class=headerlink title=Tea></a>Tea</h2><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdint.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>encrypt</span><span class=params>(<span class=type>uint32_t</span> *v, <span class=type>uint32_t</span> *k)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> v0 = v[<span class=number>0</span>], v1 = v[<span class=number>1</span>], sum = <span class=number>0</span>, i;</span><br><span class=line>    <span class=type>uint32_t</span> delta = <span class=number>0x9e3779b9</span>;</span><br><span class=line>    <span class=type>uint32_t</span> k0 = k[<span class=number>0</span>], k1 = k[<span class=number>1</span>], k2 = k[<span class=number>2</span>], k3 = k[<span class=number>3</span>];</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>32</span>; i++)</span><br><span class=line>    {</span><br><span class=line>        sum += delta;</span><br><span class=line>        v0 += ((v1 &lt;&lt; <span class=number>4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class=number>5</span>) + k1);</span><br><span class=line>        v1 += ((v0 &lt;&lt; <span class=number>4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class=number>5</span>) + k3);</span><br><span class=line>    }</span><br><span class=line>    v[<span class=number>0</span>] = v0;</span><br><span class=line>    v[<span class=number>1</span>] = v1;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>decrypt</span><span class=params>(<span class=type>uint32_t</span> *v, <span class=type>uint32_t</span> *k)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> v0 = v[<span class=number>0</span>], v1 = v[<span class=number>1</span>], i;</span><br><span class=line>    <span class=type>uint32_t</span> delta = <span class=number>0x9e3779b9</span>;</span><br><span class=line>    <span class=type>uint32_t</span> sum = delta * <span class=number>32</span>;</span><br><span class=line>    <span class=type>uint32_t</span> k0 = k[<span class=number>0</span>], k1 = k[<span class=number>1</span>], k2 = k[<span class=number>2</span>], k3 = k[<span class=number>3</span>];</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>32</span>; i++)</span><br><span class=line>    {</span><br><span class=line>        v1 -= ((v0 &lt;&lt; <span class=number>4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class=number>5</span>) + k3);</span><br><span class=line>        v0 -= ((v1 &lt;&lt; <span class=number>4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class=number>5</span>) + k1);</span><br><span class=line>        sum -= delta;</span><br><span class=line>    }</span><br><span class=line>    v[<span class=number>0</span>] = v0;</span><br><span class=line>    v[<span class=number>1</span>] = v1;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=AES><a href=#AES class=headerlink title=AES></a>AES</h2><h3 id=伪代码><a href=#伪代码 class=headerlink title=伪代码></a>伪代码</h3><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br></pre></td><td class=code><pre><span class=line><span class=built_in>Cipher</span>(byte in[<span class=number>4</span>*Nb], byte out[<span class=number>4</span>*Nb], word w[Nb*(Nr<span class=number>+1</span>)])</span><br><span class=line>begin</span><br><span class=line>    byte state[<span class=number>4</span>, Nb]</span><br><span class=line>    state = in</span><br><span class=line>    <span class=built_in>AddRoundkey</span>(state, w[<span class=number>0</span>, Nb<span class=number>-1</span>])</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> round = <span class=number>1</span> step <span class=number>1</span> to Nr<span class=number>-1</span></span><br><span class=line>        <span class=built_in>SubBytes</span>(state)</span><br><span class=line>        <span class=built_in>ShiftRows</span>(state)</span><br><span class=line>        <span class=built_in>MixColumns</span>(state)</span><br><span class=line>        <span class=built_in>AddRoundKey</span>(state, w[round*Nb, (round<span class=number>+1</span>)*Nb - <span class=number>1</span>])</span><br><span class=line>    end</span><br><span class=line></span><br><span class=line>    <span class=built_in>SubBytes</span>(state)</span><br><span class=line>    <span class=built_in>ShiftRows</span>(state)</span><br><span class=line>    <span class=built_in>AddRoundKey</span>(state, w[Nr*Nb, (Nr<span class=number>+1</span>)*Nb - <span class=number>1</span>])</span><br><span class=line></span><br><span class=line>    out = state</span><br><span class=line>end</span><br><span class=line></span><br><span class=line><span class=built_in>InvCipher</span>(byte in[<span class=number>4</span>*Nb], byte out[<span class=number>4</span>*Nb], word w[Nb*(Nr_1)])</span><br><span class=line>begin</span><br><span class=line></span><br><span class=line>    byte stae[<span class=number>4</span>, Nb]</span><br><span class=line>    state = in</span><br><span class=line></span><br><span class=line>    <span class=built_in>AddRoundKey</span>(state, w[Nr*Nb, (Nr<span class=number>+1</span>)*Nb - <span class=number>1</span>])</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> round = Nr<span class=number>-1</span> step <span class=number>-1</span> downto <span class=number>1</span></span><br><span class=line>        <span class=built_in>InvShiftRows</span>(state)</span><br><span class=line>        <span class=built_in>InvSubBytes</span>(state)</span><br><span class=line>        <span class=built_in>AddRoundKey</span>(state, w[round*Nb, (round<span class=number>+1</span>)*Nb - <span class=number>1</span>])</span><br><span class=line>        <span class=built_in>InvMixColumns</span>(state)</span><br><span class=line>    end</span><br><span class=line></span><br><span class=line>    <span class=built_in>InvShiftRows</span>(state)</span><br><span class=line>    <span class=built_in>InvSubBytes</span>(state)</span><br><span class=line>    <span class=built_in>AddRoundKey</span>(state, w[<span class=number>0</span>, Nb<span class=number>-1</span>])</span><br><span class=line></span><br><span class=line>    out = state</span><br><span class=line>end</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>// 另一种等效的加解密步骤, Intel AES指令集采用的是这种步骤(两者加密密钥扩展是一样的)</span></span><br><span class=line><span class=comment>// SubBytes和ShiftRows可以交换</span></span><br><span class=line><span class=comment>// InvMixColumns(AddRoundKey(state, RoundKey)) = AddRoundKey(InvMixColumns(state), InvMixColumns(RoundKey)</span></span><br><span class=line></span><br><span class=line><span class=built_in>Cipher</span>(byte in[<span class=number>4</span>*Nb], byte out[<span class=number>4</span>*Nb], word w[Nb*(Nr<span class=number>+1</span>)])</span><br><span class=line>begin</span><br><span class=line>    byte state[<span class=number>4</span>, Nb]</span><br><span class=line>    state = in</span><br><span class=line>    <span class=built_in>AddRoundkey</span>(state, w[<span class=number>0</span>, Nb<span class=number>-1</span>])</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> round = <span class=number>1</span> step <span class=number>1</span> to Nr<span class=number>-1</span></span><br><span class=line>        <span class=built_in>ShiftRows</span>(state)</span><br><span class=line>        <span class=built_in>SubBytes</span>(state)</span><br><span class=line>        <span class=built_in>MixColumns</span>(state)</span><br><span class=line>        <span class=built_in>AddRoundKey</span>(state, w[round*Nb, (round<span class=number>+1</span>)*Nb - <span class=number>1</span>])</span><br><span class=line>    end</span><br><span class=line></span><br><span class=line>    <span class=built_in>ShiftRows</span>(state)</span><br><span class=line>    <span class=built_in>SubBytes</span>(state)</span><br><span class=line>    <span class=built_in>AddRoundKey</span>(state, w[Nr*Nb, (Nr<span class=number>+1</span>)*Nb - <span class=number>1</span>])</span><br><span class=line></span><br><span class=line>    out = state</span><br><span class=line>end</span><br><span class=line></span><br><span class=line><span class=built_in>InvCipher</span>(byte in[<span class=number>4</span>*Nb], byte out[<span class=number>4</span>*Nb], word w[Nb*(Nr_1)])</span><br><span class=line>begin</span><br><span class=line></span><br><span class=line>    byte stae[<span class=number>4</span>, Nb]</span><br><span class=line>    state = in</span><br><span class=line></span><br><span class=line>    <span class=built_in>AddRoundKey</span>(state, w[Nr*Nb, (Nr<span class=number>+1</span>)*Nb - <span class=number>1</span>])</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> round = Nr<span class=number>-1</span> step <span class=number>-1</span> downto <span class=number>1</span></span><br><span class=line>        <span class=built_in>InvSubBytes</span>(state)</span><br><span class=line>        <span class=built_in>InvShiftRows</span>(state)</span><br><span class=line>        <span class=built_in>InvMixColumns</span>(state)</span><br><span class=line>        <span class=built_in>AddRoundKey</span>(state, w[round*Nb, (round<span class=number>+1</span>)*Nb - <span class=number>1</span>])</span><br><span class=line>    end</span><br><span class=line></span><br><span class=line>    <span class=built_in>InvSubBytes</span>(state)</span><br><span class=line>    <span class=built_in>InvShiftRows</span>(state)</span><br><span class=line>    <span class=built_in>AddRoundKey</span>(state, w[<span class=number>0</span>, Nb<span class=number>-1</span>])</span><br><span class=line></span><br><span class=line>    out = state</span><br><span class=line>end</span><br><span class=line></span><br><span class=line><span class=comment>// 解密密钥扩展需要增加如下步骤</span></span><br><span class=line><span class=keyword>for</span> i = <span class=number>0</span> step <span class=number>1</span> <span class=built_in>to</span> (Nb*(Nr<span class=number>+1</span>)<span class=number>-1</span>)</span><br><span class=line>    dw[i] = w[i]</span><br><span class=line>end</span><br><span class=line><span class=comment>// 增加的运算</span></span><br><span class=line><span class=keyword>for</span> round=<span class=number>1</span> step <span class=number>1</span> to Nr<span class=number>-1</span></span><br><span class=line>    <span class=built_in>InvMixColumns</span>(dw[round*Nb, (round<span class=number>+1</span>)*Nb<span class=number>-1</span>])</span><br><span class=line>end <span class=keyword>for</span></span><br><span class=line></span><br></pre></td></tr></table></figure><h3 id=代码-1><a href=#代码-1 class=headerlink title="代码 1"></a>代码 1</h3><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>AddRoundKey</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *plaintext, <span class=type>unsigned</span> <span class=type>char</span> * CipherKey)</span><span class=comment>/*轮密钥加*/</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>16</span>; j++)  plaintext[j] = plaintext[j] ^ CipherKey[j];</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>SubBytes</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *plaintext, <span class=type>unsigned</span> <span class=type>char</span> *plaintextencrypt, <span class=type>int</span> count)</span><span class=comment>/*S盒置换*/</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>int</span> row, column;</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> Sbox[<span class=number>16</span>][<span class=number>16</span>] = {</span><br><span class=line>		      <span class=comment>/* 0     1     2     3     4     5     6     7     8     9     a     b     c     d     e     f */</span></span><br><span class=line>		<span class=comment>/*0*/</span>{ <span class=number>0x63</span>, <span class=number>0x7c</span>, <span class=number>0x77</span>, <span class=number>0x7b</span>, <span class=number>0xf2</span>, <span class=number>0x6b</span>, <span class=number>0x6f</span>, <span class=number>0xc5</span>, <span class=number>0x30</span>, <span class=number>0x01</span>, <span class=number>0x67</span>, <span class=number>0x2b</span>, <span class=number>0xfe</span>, <span class=number>0xd7</span>, <span class=number>0xab</span>, <span class=number>0x76</span> },</span><br><span class=line>		<span class=comment>/*1*/</span>{ <span class=number>0xca</span>, <span class=number>0x82</span>, <span class=number>0xc9</span>, <span class=number>0x7d</span>, <span class=number>0xfa</span>, <span class=number>0x59</span>, <span class=number>0x47</span>, <span class=number>0xf0</span>, <span class=number>0xad</span>, <span class=number>0xd4</span>, <span class=number>0xa2</span>, <span class=number>0xaf</span>, <span class=number>0x9c</span>, <span class=number>0xa4</span>, <span class=number>0x72</span>, <span class=number>0xc0</span> },</span><br><span class=line>		<span class=comment>/*2*/</span>{ <span class=number>0xb7</span>, <span class=number>0xfd</span>, <span class=number>0x93</span>, <span class=number>0x26</span>, <span class=number>0x36</span>, <span class=number>0x3f</span>, <span class=number>0xf7</span>, <span class=number>0xcc</span>, <span class=number>0x34</span>, <span class=number>0xa5</span>, <span class=number>0xe5</span>, <span class=number>0xf1</span>, <span class=number>0x71</span>, <span class=number>0xd8</span>, <span class=number>0x31</span>, <span class=number>0x15</span> },</span><br><span class=line>		<span class=comment>/*3*/</span>{ <span class=number>0x04</span>, <span class=number>0xc7</span>, <span class=number>0x23</span>, <span class=number>0xc3</span>, <span class=number>0x18</span>, <span class=number>0x96</span>, <span class=number>0x05</span>, <span class=number>0x9a</span>, <span class=number>0x07</span>, <span class=number>0x12</span>, <span class=number>0x80</span>, <span class=number>0xe2</span>, <span class=number>0xeb</span>, <span class=number>0x27</span>, <span class=number>0xb2</span>, <span class=number>0x75</span> },</span><br><span class=line>		<span class=comment>/*4*/</span>{ <span class=number>0x09</span>, <span class=number>0x83</span>, <span class=number>0x2c</span>, <span class=number>0x1a</span>, <span class=number>0x1b</span>, <span class=number>0x6e</span>, <span class=number>0x5a</span>, <span class=number>0xa0</span>, <span class=number>0x52</span>, <span class=number>0x3b</span>, <span class=number>0xd6</span>, <span class=number>0xb3</span>, <span class=number>0x29</span>, <span class=number>0xe3</span>, <span class=number>0x2f</span>, <span class=number>0x84</span> },</span><br><span class=line>		<span class=comment>/*5*/</span>{ <span class=number>0x53</span>, <span class=number>0xd1</span>, <span class=number>0x00</span>, <span class=number>0xed</span>, <span class=number>0x20</span>, <span class=number>0xfc</span>, <span class=number>0xb1</span>, <span class=number>0x5b</span>, <span class=number>0x6a</span>, <span class=number>0xcb</span>, <span class=number>0xbe</span>, <span class=number>0x39</span>, <span class=number>0x4a</span>, <span class=number>0x4c</span>, <span class=number>0x58</span>, <span class=number>0xcf</span> },</span><br><span class=line>		<span class=comment>/*6*/</span>{ <span class=number>0xd0</span>, <span class=number>0xef</span>, <span class=number>0xaa</span>, <span class=number>0xfb</span>, <span class=number>0x43</span>, <span class=number>0x4d</span>, <span class=number>0x33</span>, <span class=number>0x85</span>, <span class=number>0x45</span>, <span class=number>0xf9</span>, <span class=number>0x02</span>, <span class=number>0x7f</span>, <span class=number>0x50</span>, <span class=number>0x3c</span>, <span class=number>0x9f</span>, <span class=number>0xa8</span> },</span><br><span class=line>		<span class=comment>/*7*/</span>{ <span class=number>0x51</span>, <span class=number>0xa3</span>, <span class=number>0x40</span>, <span class=number>0x8f</span>, <span class=number>0x92</span>, <span class=number>0x9d</span>, <span class=number>0x38</span>, <span class=number>0xf5</span>, <span class=number>0xbc</span>, <span class=number>0xb6</span>, <span class=number>0xda</span>, <span class=number>0x21</span>, <span class=number>0x10</span>, <span class=number>0xff</span>, <span class=number>0xf3</span>, <span class=number>0xd2</span> },</span><br><span class=line>		<span class=comment>/*8*/</span>{ <span class=number>0xcd</span>, <span class=number>0x0c</span>, <span class=number>0x13</span>, <span class=number>0xec</span>, <span class=number>0x5f</span>, <span class=number>0x97</span>, <span class=number>0x44</span>, <span class=number>0x17</span>, <span class=number>0xc4</span>, <span class=number>0xa7</span>, <span class=number>0x7e</span>, <span class=number>0x3d</span>, <span class=number>0x64</span>, <span class=number>0x5d</span>, <span class=number>0x19</span>, <span class=number>0x73</span> },</span><br><span class=line>		<span class=comment>/*9*/</span>{ <span class=number>0x60</span>, <span class=number>0x81</span>, <span class=number>0x4f</span>, <span class=number>0xdc</span>, <span class=number>0x22</span>, <span class=number>0x2a</span>, <span class=number>0x90</span>, <span class=number>0x88</span>, <span class=number>0x46</span>, <span class=number>0xee</span>, <span class=number>0xb8</span>, <span class=number>0x14</span>, <span class=number>0xde</span>, <span class=number>0x5e</span>, <span class=number>0x0b</span>, <span class=number>0xdb</span> },</span><br><span class=line>		<span class=comment>/*a*/</span>{ <span class=number>0xe0</span>, <span class=number>0x32</span>, <span class=number>0x3a</span>, <span class=number>0x0a</span>, <span class=number>0x49</span>, <span class=number>0x06</span>, <span class=number>0x24</span>, <span class=number>0x5c</span>, <span class=number>0xc2</span>, <span class=number>0xd3</span>, <span class=number>0xac</span>, <span class=number>0x62</span>, <span class=number>0x91</span>, <span class=number>0x95</span>, <span class=number>0xe4</span>, <span class=number>0x79</span> },</span><br><span class=line>		<span class=comment>/*b*/</span>{ <span class=number>0xe7</span>, <span class=number>0xc8</span>, <span class=number>0x37</span>, <span class=number>0x6d</span>, <span class=number>0x8d</span>, <span class=number>0xd5</span>, <span class=number>0x4e</span>, <span class=number>0xa9</span>, <span class=number>0x6c</span>, <span class=number>0x56</span>, <span class=number>0xf4</span>, <span class=number>0xea</span>, <span class=number>0x65</span>, <span class=number>0x7a</span>, <span class=number>0xae</span>, <span class=number>0x08</span> },</span><br><span class=line>		<span class=comment>/*c*/</span>{ <span class=number>0xba</span>, <span class=number>0x78</span>, <span class=number>0x25</span>, <span class=number>0x2e</span>, <span class=number>0x1c</span>, <span class=number>0xa6</span>, <span class=number>0xb4</span>, <span class=number>0xc6</span>, <span class=number>0xe8</span>, <span class=number>0xdd</span>, <span class=number>0x74</span>, <span class=number>0x1f</span>, <span class=number>0x4b</span>, <span class=number>0xbd</span>, <span class=number>0x8b</span>, <span class=number>0x8a</span> },</span><br><span class=line>		<span class=comment>/*d*/</span>{ <span class=number>0x70</span>, <span class=number>0x3e</span>, <span class=number>0xb5</span>, <span class=number>0x66</span>, <span class=number>0x48</span>, <span class=number>0x03</span>, <span class=number>0xf6</span>, <span class=number>0x0e</span>, <span class=number>0x61</span>, <span class=number>0x35</span>, <span class=number>0x57</span>, <span class=number>0xb9</span>, <span class=number>0x86</span>, <span class=number>0xc1</span>, <span class=number>0x1d</span>, <span class=number>0x9e</span> },</span><br><span class=line>		<span class=comment>/*e*/</span>{ <span class=number>0xe1</span>, <span class=number>0xf8</span>, <span class=number>0x98</span>, <span class=number>0x11</span>, <span class=number>0x69</span>, <span class=number>0xd9</span>, <span class=number>0x8e</span>, <span class=number>0x94</span>, <span class=number>0x9b</span>, <span class=number>0x1e</span>, <span class=number>0x87</span>, <span class=number>0xe9</span>, <span class=number>0xce</span>, <span class=number>0x55</span>, <span class=number>0x28</span>, <span class=number>0xdf</span> },</span><br><span class=line>		<span class=comment>/*f*/</span>{ <span class=number>0x8c</span>, <span class=number>0xa1</span>, <span class=number>0x89</span>, <span class=number>0x0d</span>, <span class=number>0xbf</span>, <span class=number>0xe6</span>, <span class=number>0x42</span>, <span class=number>0x68</span>, <span class=number>0x41</span>, <span class=number>0x99</span>, <span class=number>0x2d</span>, <span class=number>0x0f</span>, <span class=number>0xb0</span>, <span class=number>0x54</span>, <span class=number>0xbb</span>, <span class=number>0x16</span> }</span><br><span class=line>	};<span class=comment>// 填充Sbox矩阵</span></span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; count; i++)</span><br><span class=line>	{</span><br><span class=line>		row = (plaintext[i] &amp; <span class=number>0xF0</span>) &gt;&gt; <span class=number>4</span>;</span><br><span class=line>		column = plaintext[i] &amp; <span class=number>0x0F</span>;</span><br><span class=line>		plaintextencrypt[i] = Sbox[row][column];</span><br><span class=line>	}</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>SubBytesRe</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *plaintext, <span class=type>unsigned</span> <span class=type>char</span> *plaintextencrypt, <span class=type>int</span> count)</span><span class=comment>/*S盒逆置换*/</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>int</span> row, column;</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> Sbox[<span class=number>16</span>][<span class=number>16</span>] = {</span><br><span class=line>		<span class=comment>/* 0     1     2     3     4     5     6     7     8     9     a     b     c     d     e     f */</span></span><br><span class=line>		{<span class=number>0x52</span>, <span class=number>0x09</span>, <span class=number>0x6a</span>, <span class=number>0xd5</span>, <span class=number>0x30</span>, <span class=number>0x36</span>, <span class=number>0xa5</span>, <span class=number>0x38</span>, <span class=number>0xbf</span>, <span class=number>0x40</span>, <span class=number>0xa3</span>, <span class=number>0x9e</span>, <span class=number>0x81</span>, <span class=number>0xf3</span>, <span class=number>0xd7</span>, <span class=number>0xfb</span>},</span><br><span class=line>		{<span class=number>0x7c</span>, <span class=number>0xe3</span>, <span class=number>0x39</span>, <span class=number>0x82</span>, <span class=number>0x9b</span>, <span class=number>0x2f</span>, <span class=number>0xff</span>, <span class=number>0x87</span>, <span class=number>0x34</span>, <span class=number>0x8e</span>, <span class=number>0x43</span>, <span class=number>0x44</span>, <span class=number>0xc4</span>, <span class=number>0xde</span>, <span class=number>0xe9</span>, <span class=number>0xcb</span>},</span><br><span class=line>		{<span class=number>0x54</span>, <span class=number>0x7b</span>, <span class=number>0x94</span>, <span class=number>0x32</span>, <span class=number>0xa6</span>, <span class=number>0xc2</span>, <span class=number>0x23</span>, <span class=number>0x3d</span>, <span class=number>0xee</span>, <span class=number>0x4c</span>, <span class=number>0x95</span>, <span class=number>0x0b</span>, <span class=number>0x42</span>, <span class=number>0xfa</span>, <span class=number>0xc3</span>, <span class=number>0x4e</span>},</span><br><span class=line>		{<span class=number>0x08</span>, <span class=number>0x2e</span>, <span class=number>0xa1</span>, <span class=number>0x66</span>, <span class=number>0x28</span>, <span class=number>0xd9</span>, <span class=number>0x24</span>, <span class=number>0xb2</span>, <span class=number>0x76</span>, <span class=number>0x5b</span>, <span class=number>0xa2</span>, <span class=number>0x49</span>, <span class=number>0x6d</span>, <span class=number>0x8b</span>, <span class=number>0xd1</span>, <span class=number>0x25</span>},</span><br><span class=line>		{<span class=number>0x72</span>, <span class=number>0xf8</span>, <span class=number>0xf6</span>, <span class=number>0x64</span>, <span class=number>0x86</span>, <span class=number>0x68</span>, <span class=number>0x98</span>, <span class=number>0x16</span>, <span class=number>0xd4</span>, <span class=number>0xa4</span>, <span class=number>0x5c</span>, <span class=number>0xcc</span>, <span class=number>0x5d</span>, <span class=number>0x65</span>, <span class=number>0xb6</span>, <span class=number>0x92</span>},</span><br><span class=line>		{<span class=number>0x6c</span>, <span class=number>0x70</span>, <span class=number>0x48</span>, <span class=number>0x50</span>, <span class=number>0xfd</span>, <span class=number>0xed</span>, <span class=number>0xb9</span>, <span class=number>0xda</span>, <span class=number>0x5e</span>, <span class=number>0x15</span>, <span class=number>0x46</span>, <span class=number>0x57</span>, <span class=number>0xa7</span>, <span class=number>0x8d</span>, <span class=number>0x9d</span>, <span class=number>0x84</span>},</span><br><span class=line>		{<span class=number>0x90</span>, <span class=number>0xd8</span>, <span class=number>0xab</span>, <span class=number>0x00</span>, <span class=number>0x8c</span>, <span class=number>0xbc</span>, <span class=number>0xd3</span>, <span class=number>0x0a</span>, <span class=number>0xf7</span>, <span class=number>0xe4</span>, <span class=number>0x58</span>, <span class=number>0x05</span>, <span class=number>0xb8</span>, <span class=number>0xb3</span>, <span class=number>0x45</span>, <span class=number>0x06</span>},</span><br><span class=line>		{<span class=number>0xd0</span>, <span class=number>0x2c</span>, <span class=number>0x1e</span>, <span class=number>0x8f</span>, <span class=number>0xca</span>, <span class=number>0x3f</span>, <span class=number>0x0f</span>, <span class=number>0x02</span>, <span class=number>0xc1</span>, <span class=number>0xaf</span>, <span class=number>0xbd</span>, <span class=number>0x03</span>, <span class=number>0x01</span>, <span class=number>0x13</span>, <span class=number>0x8a</span>, <span class=number>0x6b</span>},</span><br><span class=line>		{<span class=number>0x3a</span>, <span class=number>0x91</span>, <span class=number>0x11</span>, <span class=number>0x41</span>, <span class=number>0x4f</span>, <span class=number>0x67</span>, <span class=number>0xdc</span>, <span class=number>0xea</span>, <span class=number>0x97</span>, <span class=number>0xf2</span>, <span class=number>0xcf</span>, <span class=number>0xce</span>, <span class=number>0xf0</span>, <span class=number>0xb4</span>, <span class=number>0xe6</span>, <span class=number>0x73</span>},</span><br><span class=line>		{<span class=number>0x96</span>, <span class=number>0xac</span>, <span class=number>0x74</span>, <span class=number>0x22</span>, <span class=number>0xe7</span>, <span class=number>0xad</span>, <span class=number>0x35</span>, <span class=number>0x85</span>, <span class=number>0xe2</span>, <span class=number>0xf9</span>, <span class=number>0x37</span>, <span class=number>0xe8</span>, <span class=number>0x1c</span>, <span class=number>0x75</span>, <span class=number>0xdf</span>, <span class=number>0x6e</span>},</span><br><span class=line>		{<span class=number>0x47</span>, <span class=number>0xf1</span>, <span class=number>0x1a</span>, <span class=number>0x71</span>, <span class=number>0x1d</span>, <span class=number>0x29</span>, <span class=number>0xc5</span>, <span class=number>0x89</span>, <span class=number>0x6f</span>, <span class=number>0xb7</span>, <span class=number>0x62</span>, <span class=number>0x0e</span>, <span class=number>0xaa</span>, <span class=number>0x18</span>, <span class=number>0xbe</span>, <span class=number>0x1b</span>},</span><br><span class=line>		{<span class=number>0xfc</span>, <span class=number>0x56</span>, <span class=number>0x3e</span>, <span class=number>0x4b</span>, <span class=number>0xc6</span>, <span class=number>0xd2</span>, <span class=number>0x79</span>, <span class=number>0x20</span>, <span class=number>0x9a</span>, <span class=number>0xdb</span>, <span class=number>0xc0</span>, <span class=number>0xfe</span>, <span class=number>0x78</span>, <span class=number>0xcd</span>, <span class=number>0x5a</span>, <span class=number>0xf4</span>},</span><br><span class=line>		{<span class=number>0x1f</span>, <span class=number>0xdd</span>, <span class=number>0xa8</span>, <span class=number>0x33</span>, <span class=number>0x88</span>, <span class=number>0x07</span>, <span class=number>0xc7</span>, <span class=number>0x31</span>, <span class=number>0xb1</span>, <span class=number>0x12</span>, <span class=number>0x10</span>, <span class=number>0x59</span>, <span class=number>0x27</span>, <span class=number>0x80</span>, <span class=number>0xec</span>, <span class=number>0x5f</span>},</span><br><span class=line>		{<span class=number>0x60</span>, <span class=number>0x51</span>, <span class=number>0x7f</span>, <span class=number>0xa9</span>, <span class=number>0x19</span>, <span class=number>0xb5</span>, <span class=number>0x4a</span>, <span class=number>0x0d</span>, <span class=number>0x2d</span>, <span class=number>0xe5</span>, <span class=number>0x7a</span>, <span class=number>0x9f</span>, <span class=number>0x93</span>, <span class=number>0xc9</span>, <span class=number>0x9c</span>, <span class=number>0xef</span>},</span><br><span class=line>		{<span class=number>0xa0</span>, <span class=number>0xe0</span>, <span class=number>0x3b</span>, <span class=number>0x4d</span>, <span class=number>0xae</span>, <span class=number>0x2a</span>, <span class=number>0xf5</span>, <span class=number>0xb0</span>, <span class=number>0xc8</span>, <span class=number>0xeb</span>, <span class=number>0xbb</span>, <span class=number>0x3c</span>, <span class=number>0x83</span>, <span class=number>0x53</span>, <span class=number>0x99</span>, <span class=number>0x61</span>},</span><br><span class=line>		{<span class=number>0x17</span>, <span class=number>0x2b</span>, <span class=number>0x04</span>, <span class=number>0x7e</span>, <span class=number>0xba</span>, <span class=number>0x77</span>, <span class=number>0xd6</span>, <span class=number>0x26</span>, <span class=number>0xe1</span>, <span class=number>0x69</span>, <span class=number>0x14</span>, <span class=number>0x63</span>, <span class=number>0x55</span>, <span class=number>0x21</span>, <span class=number>0x0c</span>, <span class=number>0x7d</span>}</span><br><span class=line>	};	<span class=comment>// 填充Sbox矩阵</span></span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; count; i++)</span><br><span class=line>	{</span><br><span class=line>		row = (plaintext[i] &amp; <span class=number>0xF0</span>) &gt;&gt; <span class=number>4</span>;</span><br><span class=line>		column = plaintext[i] &amp; <span class=number>0x0F</span>;</span><br><span class=line>		plaintextencrypt[i] = Sbox[row][column];</span><br><span class=line>	}</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>ShiftRowsRe</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *plaintextencrypt)</span><span class=comment>/*行移位的逆*/</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> temp = <span class=number>0</span>;</span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; i++)<span class=comment>//第i行</span></span><br><span class=line>	{</span><br><span class=line>		<span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span> - i; j++)<span class=comment>//第j次左移</span></span><br><span class=line>		{</span><br><span class=line>			temp = plaintextencrypt[i];</span><br><span class=line>			<span class=keyword>for</span> (<span class=type>int</span> k = <span class=number>0</span>; k &lt; <span class=number>4</span>; k++)</span><br><span class=line>				plaintextencrypt[i + <span class=number>4</span> * k] = plaintextencrypt[i + <span class=number>4</span> * (k + <span class=number>1</span>)];</span><br><span class=line>			plaintextencrypt[i + <span class=number>12</span>] = temp;</span><br><span class=line>		}</span><br><span class=line>	}</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>ShiftRows</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *plaintextencrypt)</span><span class=comment>/*行移位*/</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> temp = <span class=number>0</span>;</span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; i++)<span class=comment>//第i行</span></span><br><span class=line>	{</span><br><span class=line>		<span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; i; j++)<span class=comment>//第j次左移</span></span><br><span class=line>		{</span><br><span class=line>			temp = plaintextencrypt[i];</span><br><span class=line>			<span class=keyword>for</span> (<span class=type>int</span> k = <span class=number>0</span>; k &lt; <span class=number>4</span>; k++)</span><br><span class=line>				plaintextencrypt[i + <span class=number>4</span> * k] = plaintextencrypt[i + <span class=number>4</span> * (k + <span class=number>1</span>)];</span><br><span class=line>			plaintextencrypt[i + <span class=number>12</span>] = temp;</span><br><span class=line>		}</span><br><span class=line>	}</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>unsigned</span> <span class=type>char</span> <span class=title>Mult2</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> num)</span><span class=comment>/*列混淆*/</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> temp = num &lt;&lt; <span class=number>1</span>;</span><br><span class=line>	<span class=keyword>if</span> ((num &gt;&gt; <span class=number>7</span>) &amp; <span class=number>0x01</span>)</span><br><span class=line>		temp = temp ^ <span class=number>27</span>;</span><br><span class=line>	<span class=keyword>return</span> temp;</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>unsigned</span> <span class=type>char</span> <span class=title>Mult3</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> num)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=keyword>return</span> <span class=built_in>Mult2</span>(num) ^ num;</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>MixColumns</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *plaintextencrypt, <span class=type>unsigned</span> <span class=type>char</span> *plaintextcrypt)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=type>int</span> i;</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>4</span>; i++)</span><br><span class=line>		plaintextcrypt[<span class=number>4</span> * i] = <span class=built_in>Mult2</span>(plaintextencrypt[<span class=number>4</span> * i]) ^ <span class=built_in>Mult3</span>(plaintextencrypt[<span class=number>4</span> * i + <span class=number>1</span>]) ^ plaintextencrypt[<span class=number>4</span> * i + <span class=number>2</span>] ^ plaintextencrypt[<span class=number>4</span> * i + <span class=number>3</span>];</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>4</span>; i++)</span><br><span class=line>		plaintextcrypt[<span class=number>4</span> * i + <span class=number>1</span>] = plaintextencrypt[<span class=number>4</span> * i] ^ <span class=built_in>Mult2</span>(plaintextencrypt[<span class=number>4</span> * i + <span class=number>1</span>]) ^ <span class=built_in>Mult3</span>(plaintextencrypt[<span class=number>4</span> * i + <span class=number>2</span>]) ^ plaintextencrypt[<span class=number>4</span> * i + <span class=number>3</span>];</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>4</span>; i++)</span><br><span class=line>		plaintextcrypt[<span class=number>4</span> * i + <span class=number>2</span>] = plaintextencrypt[<span class=number>4</span> * i] ^ plaintextencrypt[<span class=number>4</span> * i + <span class=number>1</span>] ^ <span class=built_in>Mult2</span>(plaintextencrypt[<span class=number>4</span> * i + <span class=number>2</span>]) ^ <span class=built_in>Mult3</span>(plaintextencrypt[<span class=number>4</span> * i + <span class=number>3</span>]);</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>4</span>; i++)</span><br><span class=line>		plaintextcrypt[<span class=number>4</span> * i + <span class=number>3</span>] = <span class=built_in>Mult3</span>(plaintextencrypt[<span class=number>4</span> * i]) ^ plaintextencrypt[<span class=number>4</span> * i + <span class=number>1</span>] ^ plaintextencrypt[<span class=number>4</span> * i + <span class=number>2</span>] ^ <span class=built_in>Mult2</span>(plaintextencrypt[<span class=number>4</span> * i + <span class=number>3</span>]);</span><br><span class=line>}</span><br><span class=line><span class=comment>/*逆列混淆*/</span> </span><br><span class=line><span class=meta>#<span class=keyword>define</span> xtime(x)   ((x<span class=string>&lt;&lt;1) ^ (((x&gt;</span>&gt;7) &amp; 1) * 0x1b))</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> Multiply(x,y) (((y &amp; 1) * x) ^ ((y&gt;&gt;1 &amp; 1) * xtime(x)) ^ ((y&gt;&gt;2 &amp; 1) * xtime(xtime(x))) ^ ((y&gt;&gt;3 &amp; 1) * xtime(xtime(xtime(x)))) ^ ((y&gt;&gt;4 &amp; 1) * xtime(xtime(xtime(xtime(x))))))</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>MixColumnsRe</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *state)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> a, b, c, d;</span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; i++)</span><br><span class=line>	{</span><br><span class=line>		a = state[<span class=number>4</span>*i];</span><br><span class=line>		b = state[<span class=number>4</span>*i<span class=number>+1</span>];</span><br><span class=line>		c = state[<span class=number>4</span>*i<span class=number>+2</span>];</span><br><span class=line>		d = state[<span class=number>4</span>*i<span class=number>+3</span>];</span><br><span class=line>		state[<span class=number>4</span> * i] = <span class=built_in>Multiply</span>(a, <span class=number>0x0e</span>) ^ <span class=built_in>Multiply</span>(b, <span class=number>0x0b</span>) ^ <span class=built_in>Multiply</span>(c, <span class=number>0x0d</span>) ^ <span class=built_in>Multiply</span>(d, <span class=number>0x09</span>);</span><br><span class=line>		state[<span class=number>4</span> * i + <span class=number>1</span>] = <span class=built_in>Multiply</span>(a, <span class=number>0x09</span>) ^ <span class=built_in>Multiply</span>(b, <span class=number>0x0e</span>) ^ <span class=built_in>Multiply</span>(c, <span class=number>0x0b</span>) ^ <span class=built_in>Multiply</span>(d, <span class=number>0x0d</span>);</span><br><span class=line>		state[<span class=number>4</span> * i + <span class=number>2</span>] = <span class=built_in>Multiply</span>(a, <span class=number>0x0d</span>) ^ <span class=built_in>Multiply</span>(b, <span class=number>0x09</span>) ^ <span class=built_in>Multiply</span>(c, <span class=number>0x0e</span>) ^ <span class=built_in>Multiply</span>(d, <span class=number>0x0b</span>);</span><br><span class=line>		state[<span class=number>4</span> * i + <span class=number>3</span>] = <span class=built_in>Multiply</span>(a, <span class=number>0x0b</span>) ^ <span class=built_in>Multiply</span>(b, <span class=number>0x0d</span>) ^ <span class=built_in>Multiply</span>(c, <span class=number>0x09</span>) ^ <span class=built_in>Multiply</span>(d, <span class=number>0x0e</span>);</span><br><span class=line>	}</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>int</span> <span class=title>CharToWord</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *character, <span class=type>int</span> first)</span><span class=comment>/*字节转字*/</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=keyword>return</span> (((<span class=type>int</span>)character[first] &amp; <span class=number>0x000000ff</span>) &lt;&lt; <span class=number>24</span>) | (((<span class=type>int</span>)character[first + <span class=number>1</span>] &amp; <span class=number>0x000000ff</span>) &lt;&lt; <span class=number>16</span>) | (((<span class=type>int</span>)character[first + <span class=number>2</span>] &amp; <span class=number>0x000000ff</span>) &lt;&lt; <span class=number>8</span>) | ((<span class=type>int</span>)character[first + <span class=number>3</span>] &amp; <span class=number>0x000000ff</span>);</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>WordToChar</span><span class=params>(<span class=type>unsigned</span> <span class=type>int</span> word, <span class=type>unsigned</span> <span class=type>char</span> *character)</span><span class=comment>/*字转字节*/</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; character[i++] = (word &gt;&gt; (<span class=number>8</span> * (<span class=number>3</span> - i))) &amp; <span class=number>0xFF</span>);</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>ExtendCipherKey</span><span class=params>(<span class=type>unsigned</span> <span class=type>int</span> *CipherKey_word, <span class=type>int</span> round)</span><span class=comment>/*密钥扩展*/</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> CipherKeyChar[<span class=number>4</span>] = { <span class=number>0</span> },CipherKeyCharEncrypt[<span class=number>4</span>] = { <span class=number>0</span> };</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>int</span> Rcon[<span class=number>10</span>] = { <span class=number>0x01000000</span>,<span class=number>0x02000000</span>,<span class=number>0x04000000</span>,<span class=number>0x08000000</span>,<span class=number>0x10000000</span>,<span class=number>0x20000000</span>,<span class=number>0x40000000</span>,<span class=number>0x80000000</span>,<span class=number>0x1B000000</span>,<span class=number>0x36000000</span> };	<span class=comment>//轮常量</span></span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>4</span>; i &lt; <span class=number>8</span>; i++)</span><br><span class=line>	{</span><br><span class=line>		<span class=keyword>if</span> (!(i % <span class=number>4</span>))</span><br><span class=line>		{</span><br><span class=line>			<span class=built_in>WordToChar</span>((CipherKey_word[i - <span class=number>1</span>] &gt;&gt; <span class=number>24</span>) | (CipherKey_word[i - <span class=number>1</span>] &lt;&lt; <span class=number>8</span>), CipherKeyChar);</span><br><span class=line>			<span class=built_in>SubBytes</span>(CipherKeyChar, CipherKeyCharEncrypt, <span class=number>4</span>);</span><br><span class=line>			CipherKey_word[i] = CipherKey_word[i - <span class=number>4</span>] ^ <span class=built_in>CharToWord</span>(CipherKeyCharEncrypt, <span class=number>0</span>) ^ Rcon[round];</span><br><span class=line>		}</span><br><span class=line>		<span class=keyword>else</span></span><br><span class=line>			CipherKey_word[i] = CipherKey_word[i - <span class=number>4</span>] ^ CipherKey_word[i - <span class=number>1</span>];</span><br><span class=line>	}</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>main</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"**************AES加解密***************\n"</span>);</span><br><span class=line>	<span class=type>int</span> i = <span class=number>0</span>, k;</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> PlainText[<span class=number>16</span>] = { <span class=number>0x32</span>,<span class=number>0x43</span>,<span class=number>0xf6</span>,<span class=number>0xa8</span>,<span class=number>0x88</span>,<span class=number>0x5a</span>,<span class=number>0x30</span>,<span class=number>0x8d</span>,<span class=number>0x31</span>,<span class=number>0x31</span>,<span class=number>0x98</span>,<span class=number>0xa2</span>,<span class=number>0xe0</span>,<span class=number>0x37</span>,<span class=number>0x07</span>,<span class=number>0x34</span> },</span><br><span class=line>		CipherKey[<span class=number>16</span>] = { <span class=number>0x2b</span>,<span class=number>0x7e</span>,<span class=number>0x15</span>,<span class=number>0x16</span>,<span class=number>0x28</span>,<span class=number>0xae</span>,<span class=number>0xd2</span>,<span class=number>0xa6</span>,<span class=number>0xab</span>,<span class=number>0xf7</span>,<span class=number>0x15</span>,<span class=number>0x88</span>,<span class=number>0x09</span>,<span class=number>0xcf</span>,<span class=number>0x4f</span>,<span class=number>0x3c</span> },</span><br><span class=line>		CipherKey1[<span class=number>16</span>] = { <span class=number>0x2b</span>,<span class=number>0x7e</span>,<span class=number>0x15</span>,<span class=number>0x16</span>,<span class=number>0x28</span>,<span class=number>0xae</span>,<span class=number>0xd2</span>,<span class=number>0xa6</span>,<span class=number>0xab</span>,<span class=number>0xf7</span>,<span class=number>0x15</span>,<span class=number>0x88</span>,<span class=number>0x09</span>,<span class=number>0xcf</span>,<span class=number>0x4f</span>,<span class=number>0x3c</span> },</span><br><span class=line>		PlainText1[<span class=number>16</span>] = { <span class=number>0</span> },</span><br><span class=line>		PlainText2[<span class=number>16</span>] = { <span class=number>0</span> };</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>int</span> CipherKey_word[<span class=number>44</span>] = { <span class=number>0</span> };</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>4</span>; CipherKey_word[i++] = <span class=built_in>CharToWord</span>(CipherKey, <span class=number>4</span> * i));</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"密钥："</span>);</span><br><span class=line>	<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>16</span>; k++) <span class=built_in>printf</span>(<span class=string>"%2X "</span>, CipherKey[k]);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n明文："</span>);</span><br><span class=line>	<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>16</span>; k++) <span class=built_in>printf</span>(<span class=string>"%02X "</span>, PlainText[k]);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n**************开始加密****************"</span>);</span><br><span class=line>	<span class=built_in>AddRoundKey</span>(PlainText, CipherKey);</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>9</span>; i++)</span><br><span class=line>	{</span><br><span class=line>		<span class=built_in>printf</span>(<span class=string>"\n第%d轮循环：\n"</span>, i + <span class=number>1</span>);</span><br><span class=line>		<span class=built_in>SubBytes</span>(PlainText, PlainText1, <span class=number>16</span>);<span class=comment>/*S盒置换*/</span></span><br><span class=line>		<span class=built_in>ShiftRows</span>(PlainText1);	<span class=comment>/*行移位*/</span></span><br><span class=line>		<span class=built_in>MixColumns</span>(PlainText1, PlainText2);	<span class=comment>/*列混淆*/</span></span><br><span class=line>		<span class=built_in>ExtendCipherKey</span>(CipherKey_word + <span class=number>4</span> * i, i);<span class=comment>/*子密钥生成*/</span></span><br><span class=line>		<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>4</span>; k++)  <span class=built_in>WordToChar</span>(CipherKey_word[k + <span class=number>4</span> * (i + <span class=number>1</span>)], CipherKey + <span class=number>4</span> * k);</span><br><span class=line>		<span class=built_in>printf</span>(<span class=string>"此时的子密钥为：    "</span>);</span><br><span class=line>		<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>16</span>; k++)  <span class=built_in>printf</span>(<span class=string>"%02X "</span>, CipherKey[k]);</span><br><span class=line>		<span class=built_in>AddRoundKey</span>(PlainText2, CipherKey);<span class=comment>/*轮密钥加*/</span></span><br><span class=line>		<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>16</span>; k++)  PlainText[k] = PlainText2[k];</span><br><span class=line>		<span class=built_in>printf</span>(<span class=string>"\n当前明文加密之后为："</span>);</span><br><span class=line>		<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>16</span>; k++)  <span class=built_in>printf</span>(<span class=string>"%02X "</span>, PlainText2[k]);</span><br><span class=line>		<span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>	}</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n最后一次循环：\n"</span>);</span><br><span class=line>	<span class=built_in>SubBytes</span>(PlainText, PlainText1, <span class=number>16</span>);</span><br><span class=line>	<span class=built_in>ShiftRows</span>(PlainText1);</span><br><span class=line>	<span class=built_in>ExtendCipherKey</span>(CipherKey_word + <span class=number>4</span> * i, i);</span><br><span class=line>	<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>4</span>;<span class=built_in>WordToChar</span>(CipherKey_word[k + <span class=number>4</span> * (i + <span class=number>1</span>)], CipherKey + <span class=number>4</span> * k), k++);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"此时的子密钥为：     "</span>);</span><br><span class=line>	<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>16</span>; k++)  <span class=built_in>printf</span>(<span class=string>"%02X "</span>, CipherKey[k]);</span><br><span class=line>	<span class=built_in>AddRoundKey</span>(PlainText1, CipherKey);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n\n最终AES加密后的密文为："</span>);</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i++)  <span class=built_in>printf</span>(<span class=string>"%02X "</span>, PlainText1[i]);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n\n**************开始解密***************"</span>);</span><br><span class=line>	<span class=built_in>AddRoundKey</span>(PlainText1, CipherKey);</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>9</span>; i++)</span><br><span class=line>	{</span><br><span class=line>		<span class=built_in>printf</span>(<span class=string>"\n第%d次循环："</span>, i + <span class=number>1</span>);</span><br><span class=line>	    <span class=built_in>SubBytesRe</span>(PlainText1, PlainText, <span class=number>16</span>);<span class=comment>/*S盒置换*/</span></span><br><span class=line>		<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>4</span>; <span class=built_in>WordToChar</span>(CipherKey_word[k + <span class=number>40</span> - <span class=number>4</span> * (i + <span class=number>1</span>)], CipherKey + <span class=number>4</span> * k),k++);<span class=comment>/*子密钥生成*/</span></span><br><span class=line>		<span class=built_in>ShiftRowsRe</span>(PlainText);<span class=comment>/*行移位逆*/</span></span><br><span class=line>		<span class=built_in>AddRoundKey</span>(PlainText, CipherKey);<span class=comment>/*轮密钥加*/</span></span><br><span class=line>		<span class=built_in>MixColumnsRe</span>(PlainText);<span class=comment>/*列混淆逆运算*/</span></span><br><span class=line>		<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>16</span>;PlainText1[k] = PlainText[k],k++);</span><br><span class=line>		<span class=built_in>printf</span>(<span class=string>"\n当前密文解密之后为："</span>);</span><br><span class=line>		<span class=keyword>for</span> (k = <span class=number>0</span>; k &lt; <span class=number>16</span>; k++)<span class=built_in>printf</span>(<span class=string>"%02X "</span>, PlainText[k]);</span><br><span class=line>		<span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>	}</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n最后一次循环："</span>);</span><br><span class=line>	<span class=built_in>ShiftRowsRe</span>(PlainText);<span class=comment>/*行移位逆*/</span></span><br><span class=line>	<span class=built_in>SubBytesRe</span>(PlainText, PlainText1, <span class=number>16</span>);<span class=comment>/*S盒置换*/</span></span><br><span class=line>	<span class=built_in>AddRoundKey</span>(PlainText1, CipherKey1);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n最终AES解密后的明文为："</span>);</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i++)  <span class=built_in>printf</span>(<span class=string>"%02X "</span>, PlainText1[i]);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>	<span class=built_in>system</span>(<span class=string>"pause"</span>);</span><br><span class=line>}</span><br><span class=line></span><br></pre></td></tr></table></figure><h3 id=代码-2><a href=#代码-2 class=headerlink title="代码 2"></a>代码 2</h3><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br><span class=line>315</span><br><span class=line>316</span><br><span class=line>317</span><br><span class=line>318</span><br><span class=line>319</span><br><span class=line>320</span><br><span class=line>321</span><br><span class=line>322</span><br><span class=line>323</span><br><span class=line>324</span><br><span class=line>325</span><br><span class=line>326</span><br><span class=line>327</span><br><span class=line>328</span><br><span class=line>329</span><br><span class=line>330</span><br><span class=line>331</span><br><span class=line>332</span><br><span class=line>333</span><br><span class=line>334</span><br><span class=line>335</span><br><span class=line>336</span><br><span class=line>337</span><br><span class=line>338</span><br><span class=line>339</span><br><span class=line>340</span><br><span class=line>341</span><br><span class=line>342</span><br><span class=line>343</span><br><span class=line>344</span><br><span class=line>345</span><br><span class=line>346</span><br><span class=line>347</span><br><span class=line>348</span><br><span class=line>349</span><br><span class=line>350</span><br><span class=line>351</span><br><span class=line>352</span><br><span class=line>353</span><br><span class=line>354</span><br><span class=line>355</span><br><span class=line>356</span><br><span class=line>357</span><br><span class=line>358</span><br><span class=line>359</span><br><span class=line>360</span><br><span class=line>361</span><br><span class=line>362</span><br><span class=line>363</span><br><span class=line>364</span><br><span class=line>365</span><br><span class=line>366</span><br><span class=line>367</span><br><span class=line>368</span><br><span class=line>369</span><br><span class=line>370</span><br><span class=line>371</span><br><span class=line>372</span><br><span class=line>373</span><br><span class=line>374</span><br><span class=line>375</span><br><span class=line>376</span><br><span class=line>377</span><br><span class=line>378</span><br><span class=line>379</span><br><span class=line>380</span><br><span class=line>381</span><br><span class=line>382</span><br><span class=line>383</span><br><span class=line>384</span><br><span class=line>385</span><br><span class=line>386</span><br><span class=line>387</span><br><span class=line>388</span><br><span class=line>389</span><br><span class=line>390</span><br><span class=line>391</span><br><span class=line>392</span><br><span class=line>393</span><br><span class=line>394</span><br><span class=line>395</span><br><span class=line>396</span><br><span class=line>397</span><br><span class=line>398</span><br><span class=line>399</span><br><span class=line>400</span><br><span class=line>401</span><br><span class=line>402</span><br><span class=line>403</span><br><span class=line>404</span><br><span class=line>405</span><br><span class=line>406</span><br><span class=line>407</span><br><span class=line>408</span><br><span class=line>409</span><br><span class=line>410</span><br><span class=line>411</span><br><span class=line>412</span><br><span class=line>413</span><br><span class=line>414</span><br><span class=line>415</span><br><span class=line>416</span><br><span class=line>417</span><br><span class=line>418</span><br><span class=line>419</span><br><span class=line>420</span><br><span class=line>421</span><br><span class=line>422</span><br><span class=line>423</span><br><span class=line>424</span><br><span class=line>425</span><br><span class=line>426</span><br><span class=line>427</span><br><span class=line>428</span><br><span class=line>429</span><br><span class=line>430</span><br><span class=line>431</span><br><span class=line>432</span><br><span class=line>433</span><br><span class=line>434</span><br><span class=line>435</span><br><span class=line>436</span><br></pre></td><td class=code><pre><span class=line><span class=comment>//</span></span><br><span class=line><span class=comment>// Created by Liming Shao on 2018/4/24.</span></span><br><span class=line><span class=comment>//</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdint.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;string.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=keyword>struct</span>{</span><br><span class=line>    <span class=type>uint32_t</span> eK[<span class=number>44</span>], dK[<span class=number>44</span>];    <span class=comment>// encKey, decKey</span></span><br><span class=line>    <span class=type>int</span> Nr; <span class=comment>// 10 rounds</span></span><br><span class=line>} AesKey;</span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> BLOCKSIZE 16</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> LOAD32H(x, y) \</span></span><br><span class=line><span class=meta>  do { (x) = ((uint32_t)((y)[0] &amp; 0xff)&lt;&lt;24) | ((uint32_t)((y)[1] &amp; 0xff)&lt;&lt;16) | \</span></span><br><span class=line><span class=meta>             ((uint32_t)((y)[2] &amp; 0xff)&lt;&lt;8)  | ((uint32_t)((y)[3] &amp; 0xff));} while(0)</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> STORE32H(x, y) \</span></span><br><span class=line><span class=meta>  do { (y)[0] = (uint8_t)(((x)&gt;&gt;24) &amp; 0xff); (y)[1] = (uint8_t)(((x)&gt;&gt;16) &amp; 0xff);   \</span></span><br><span class=line><span class=meta>       (y)[2] = (uint8_t)(((x)&gt;&gt;8) &amp; 0xff); (y)[3] = (uint8_t)((x) &amp; 0xff); } while(0)</span></span><br><span class=line></span><br><span class=line><span class=comment>/* extract a byte */</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> BYTE(x, n) (((x) &gt;&gt; (8 * (n))) &amp; 0xff)</span></span><br><span class=line></span><br><span class=line><span class=comment>/* used for keyExpansion */</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> MIX(x) (((S[BYTE(x, 2)] &lt;&lt; 24) &amp; 0xff000000) ^ ((S[BYTE(x, 1)] &lt;&lt; 16) &amp; 0xff0000) ^ \</span></span><br><span class=line><span class=meta>                ((S[BYTE(x, 0)] &lt;&lt; 8) &amp; 0xff00) ^ (S[BYTE(x, 3)] &amp; 0xff))</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> ROF32(x, n)  (((x) <span class=string>&lt;&lt; (n)) | ((x) &gt;</span>&gt; (32-(n))))</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> ROR32(x, n)  (((x) &gt;&gt; (n)) | ((x) &lt;&lt; (32-(n))))</span></span><br><span class=line></span><br><span class=line><span class=comment>/* for 128-bit blocks, Rijndael never uses more than 10 rcon values */</span></span><br><span class=line><span class=type>static</span> <span class=type>const</span> <span class=type>uint32_t</span> rcon[<span class=number>10</span>] = {</span><br><span class=line>        <span class=number>0x01000000UL</span>, <span class=number>0x02000000UL</span>, <span class=number>0x04000000UL</span>, <span class=number>0x08000000UL</span>, <span class=number>0x10000000UL</span>,</span><br><span class=line>        <span class=number>0x20000000UL</span>, <span class=number>0x40000000UL</span>, <span class=number>0x80000000UL</span>, <span class=number>0x1B000000UL</span>, <span class=number>0x36000000UL</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=type>unsigned</span> <span class=type>char</span> S[<span class=number>256</span>] = {</span><br><span class=line>        <span class=number>0x63</span>, <span class=number>0x7C</span>, <span class=number>0x77</span>, <span class=number>0x7B</span>, <span class=number>0xF2</span>, <span class=number>0x6B</span>, <span class=number>0x6F</span>, <span class=number>0xC5</span>, <span class=number>0x30</span>, <span class=number>0x01</span>, <span class=number>0x67</span>, <span class=number>0x2B</span>, <span class=number>0xFE</span>, <span class=number>0xD7</span>, <span class=number>0xAB</span>, <span class=number>0x76</span>,</span><br><span class=line>        <span class=number>0xCA</span>, <span class=number>0x82</span>, <span class=number>0xC9</span>, <span class=number>0x7D</span>, <span class=number>0xFA</span>, <span class=number>0x59</span>, <span class=number>0x47</span>, <span class=number>0xF0</span>, <span class=number>0xAD</span>, <span class=number>0xD4</span>, <span class=number>0xA2</span>, <span class=number>0xAF</span>, <span class=number>0x9C</span>, <span class=number>0xA4</span>, <span class=number>0x72</span>, <span class=number>0xC0</span>,</span><br><span class=line>        <span class=number>0xB7</span>, <span class=number>0xFD</span>, <span class=number>0x93</span>, <span class=number>0x26</span>, <span class=number>0x36</span>, <span class=number>0x3F</span>, <span class=number>0xF7</span>, <span class=number>0xCC</span>, <span class=number>0x34</span>, <span class=number>0xA5</span>, <span class=number>0xE5</span>, <span class=number>0xF1</span>, <span class=number>0x71</span>, <span class=number>0xD8</span>, <span class=number>0x31</span>, <span class=number>0x15</span>,</span><br><span class=line>        <span class=number>0x04</span>, <span class=number>0xC7</span>, <span class=number>0x23</span>, <span class=number>0xC3</span>, <span class=number>0x18</span>, <span class=number>0x96</span>, <span class=number>0x05</span>, <span class=number>0x9A</span>, <span class=number>0x07</span>, <span class=number>0x12</span>, <span class=number>0x80</span>, <span class=number>0xE2</span>, <span class=number>0xEB</span>, <span class=number>0x27</span>, <span class=number>0xB2</span>, <span class=number>0x75</span>,</span><br><span class=line>        <span class=number>0x09</span>, <span class=number>0x83</span>, <span class=number>0x2C</span>, <span class=number>0x1A</span>, <span class=number>0x1B</span>, <span class=number>0x6E</span>, <span class=number>0x5A</span>, <span class=number>0xA0</span>, <span class=number>0x52</span>, <span class=number>0x3B</span>, <span class=number>0xD6</span>, <span class=number>0xB3</span>, <span class=number>0x29</span>, <span class=number>0xE3</span>, <span class=number>0x2F</span>, <span class=number>0x84</span>,</span><br><span class=line>        <span class=number>0x53</span>, <span class=number>0xD1</span>, <span class=number>0x00</span>, <span class=number>0xED</span>, <span class=number>0x20</span>, <span class=number>0xFC</span>, <span class=number>0xB1</span>, <span class=number>0x5B</span>, <span class=number>0x6A</span>, <span class=number>0xCB</span>, <span class=number>0xBE</span>, <span class=number>0x39</span>, <span class=number>0x4A</span>, <span class=number>0x4C</span>, <span class=number>0x58</span>, <span class=number>0xCF</span>,</span><br><span class=line>        <span class=number>0xD0</span>, <span class=number>0xEF</span>, <span class=number>0xAA</span>, <span class=number>0xFB</span>, <span class=number>0x43</span>, <span class=number>0x4D</span>, <span class=number>0x33</span>, <span class=number>0x85</span>, <span class=number>0x45</span>, <span class=number>0xF9</span>, <span class=number>0x02</span>, <span class=number>0x7F</span>, <span class=number>0x50</span>, <span class=number>0x3C</span>, <span class=number>0x9F</span>, <span class=number>0xA8</span>,</span><br><span class=line>        <span class=number>0x51</span>, <span class=number>0xA3</span>, <span class=number>0x40</span>, <span class=number>0x8F</span>, <span class=number>0x92</span>, <span class=number>0x9D</span>, <span class=number>0x38</span>, <span class=number>0xF5</span>, <span class=number>0xBC</span>, <span class=number>0xB6</span>, <span class=number>0xDA</span>, <span class=number>0x21</span>, <span class=number>0x10</span>, <span class=number>0xFF</span>, <span class=number>0xF3</span>, <span class=number>0xD2</span>,</span><br><span class=line>        <span class=number>0xCD</span>, <span class=number>0x0C</span>, <span class=number>0x13</span>, <span class=number>0xEC</span>, <span class=number>0x5F</span>, <span class=number>0x97</span>, <span class=number>0x44</span>, <span class=number>0x17</span>, <span class=number>0xC4</span>, <span class=number>0xA7</span>, <span class=number>0x7E</span>, <span class=number>0x3D</span>, <span class=number>0x64</span>, <span class=number>0x5D</span>, <span class=number>0x19</span>, <span class=number>0x73</span>,</span><br><span class=line>        <span class=number>0x60</span>, <span class=number>0x81</span>, <span class=number>0x4F</span>, <span class=number>0xDC</span>, <span class=number>0x22</span>, <span class=number>0x2A</span>, <span class=number>0x90</span>, <span class=number>0x88</span>, <span class=number>0x46</span>, <span class=number>0xEE</span>, <span class=number>0xB8</span>, <span class=number>0x14</span>, <span class=number>0xDE</span>, <span class=number>0x5E</span>, <span class=number>0x0B</span>, <span class=number>0xDB</span>,</span><br><span class=line>        <span class=number>0xE0</span>, <span class=number>0x32</span>, <span class=number>0x3A</span>, <span class=number>0x0A</span>, <span class=number>0x49</span>, <span class=number>0x06</span>, <span class=number>0x24</span>, <span class=number>0x5C</span>, <span class=number>0xC2</span>, <span class=number>0xD3</span>, <span class=number>0xAC</span>, <span class=number>0x62</span>, <span class=number>0x91</span>, <span class=number>0x95</span>, <span class=number>0xE4</span>, <span class=number>0x79</span>,</span><br><span class=line>        <span class=number>0xE7</span>, <span class=number>0xC8</span>, <span class=number>0x37</span>, <span class=number>0x6D</span>, <span class=number>0x8D</span>, <span class=number>0xD5</span>, <span class=number>0x4E</span>, <span class=number>0xA9</span>, <span class=number>0x6C</span>, <span class=number>0x56</span>, <span class=number>0xF4</span>, <span class=number>0xEA</span>, <span class=number>0x65</span>, <span class=number>0x7A</span>, <span class=number>0xAE</span>, <span class=number>0x08</span>,</span><br><span class=line>        <span class=number>0xBA</span>, <span class=number>0x78</span>, <span class=number>0x25</span>, <span class=number>0x2E</span>, <span class=number>0x1C</span>, <span class=number>0xA6</span>, <span class=number>0xB4</span>, <span class=number>0xC6</span>, <span class=number>0xE8</span>, <span class=number>0xDD</span>, <span class=number>0x74</span>, <span class=number>0x1F</span>, <span class=number>0x4B</span>, <span class=number>0xBD</span>, <span class=number>0x8B</span>, <span class=number>0x8A</span>,</span><br><span class=line>        <span class=number>0x70</span>, <span class=number>0x3E</span>, <span class=number>0xB5</span>, <span class=number>0x66</span>, <span class=number>0x48</span>, <span class=number>0x03</span>, <span class=number>0xF6</span>, <span class=number>0x0E</span>, <span class=number>0x61</span>, <span class=number>0x35</span>, <span class=number>0x57</span>, <span class=number>0xB9</span>, <span class=number>0x86</span>, <span class=number>0xC1</span>, <span class=number>0x1D</span>, <span class=number>0x9E</span>,</span><br><span class=line>        <span class=number>0xE1</span>, <span class=number>0xF8</span>, <span class=number>0x98</span>, <span class=number>0x11</span>, <span class=number>0x69</span>, <span class=number>0xD9</span>, <span class=number>0x8E</span>, <span class=number>0x94</span>, <span class=number>0x9B</span>, <span class=number>0x1E</span>, <span class=number>0x87</span>, <span class=number>0xE9</span>, <span class=number>0xCE</span>, <span class=number>0x55</span>, <span class=number>0x28</span>, <span class=number>0xDF</span>,</span><br><span class=line>        <span class=number>0x8C</span>, <span class=number>0xA1</span>, <span class=number>0x89</span>, <span class=number>0x0D</span>, <span class=number>0xBF</span>, <span class=number>0xE6</span>, <span class=number>0x42</span>, <span class=number>0x68</span>, <span class=number>0x41</span>, <span class=number>0x99</span>, <span class=number>0x2D</span>, <span class=number>0x0F</span>, <span class=number>0xB0</span>, <span class=number>0x54</span>, <span class=number>0xBB</span>, <span class=number>0x16</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>// unsigned char inv_S[256] = {</span></span><br><span class=line><span class=comment>//         0x52, 0x09, 0x6A, 0xD5, 0x30, 0x36, 0xA5, 0x38, 0xBF, 0x40, 0xA3, 0x9E, 0x81, 0xF3, 0xD7, 0xFB,</span></span><br><span class=line><span class=comment>//         0x7C, 0xE3, 0x39, 0x82, 0x9B, 0x2F, 0xFF, 0x87, 0x34, 0x8E, 0x43, 0x44, 0xC4, 0xDE, 0xE9, 0xCB,</span></span><br><span class=line><span class=comment>//         0x54, 0x7B, 0x94, 0x32, 0xA6, 0xC2, 0x23, 0x3D, 0xEE, 0x4C, 0x95, 0x0B, 0x42, 0xFA, 0xC3, 0x4E,</span></span><br><span class=line><span class=comment>//         0x08, 0x2E, 0xA1, 0x66, 0x28, 0xD9, 0x24, 0xB2, 0x76, 0x5B, 0xA2, 0x49, 0x6D, 0x8B, 0xD1, 0x25,</span></span><br><span class=line><span class=comment>//         0x72, 0xF8, 0xF6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xD4, 0xA4, 0x5C, 0xCC, 0x5D, 0x65, 0xB6, 0x92,</span></span><br><span class=line><span class=comment>//         0x6C, 0x70, 0x48, 0x50, 0xFD, 0xED, 0xB9, 0xDA, 0x5E, 0x15, 0x46, 0x57, 0xA7, 0x8D, 0x9D, 0x84,</span></span><br><span class=line><span class=comment>//         0x90, 0xD8, 0xAB, 0x00, 0x8C, 0xBC, 0xD3, 0x0A, 0xF7, 0xE4, 0x58, 0x05, 0xB8, 0xB3, 0x45, 0x06,</span></span><br><span class=line><span class=comment>//         0xD0, 0x2C, 0x1E, 0x8F, 0xCA, 0x3F, 0x0F, 0x02, 0xC1, 0xAF, 0xBD, 0x03, 0x01, 0x13, 0x8A, 0x6B,</span></span><br><span class=line><span class=comment>//         0x3A, 0x91, 0x11, 0x41, 0x4F, 0x67, 0xDC, 0xEA, 0x97, 0xF2, 0xCF, 0xCE, 0xF0, 0xB4, 0xE6, 0x73,</span></span><br><span class=line><span class=comment>//         0x96, 0xAC, 0x74, 0x22, 0xE7, 0xAD, 0x35, 0x85, 0xE2, 0xF9, 0x37, 0xE8, 0x1C, 0x75, 0xDF, 0x6E,</span></span><br><span class=line><span class=comment>//         0x47, 0xF1, 0x1A, 0x71, 0x1D, 0x29, 0xC5, 0x89, 0x6F, 0xB7, 0x62, 0x0E, 0xAA, 0x18, 0xBE, 0x1B,</span></span><br><span class=line><span class=comment>//         0xFC, 0x56, 0x3E, 0x4B, 0xC6, 0xD2, 0x79, 0x20, 0x9A, 0xDB, 0xC0, 0xFE, 0x78, 0xCD, 0x5A, 0xF4,</span></span><br><span class=line><span class=comment>//         0x1F, 0xDD, 0xA8, 0x33, 0x88, 0x07, 0xC7, 0x31, 0xB1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xEC, 0x5F,</span></span><br><span class=line><span class=comment>//         0x60, 0x51, 0x7F, 0xA9, 0x19, 0xB5, 0x4A, 0x0D, 0x2D, 0xE5, 0x7A, 0x9F, 0x93, 0xC9, 0x9C, 0xEF,</span></span><br><span class=line><span class=comment>//         0xA0, 0xE0, 0x3B, 0x4D, 0xAE, 0x2A, 0xF5, 0xB0, 0xC8, 0xEB, 0xBB, 0x3C, 0x83, 0x53, 0x99, 0x61,</span></span><br><span class=line><span class=comment>//         0x17, 0x2B, 0x04, 0x7E, 0xBA, 0x77, 0xD6, 0x26, 0xE1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0C, 0x7D</span></span><br><span class=line><span class=comment>// };</span></span><br><span class=line></span><br><span class=line><span class=type>unsigned</span> <span class=type>char</span> inv_S[<span class=number>256</span>] = {</span><br><span class=line>      <span class=number>2</span>, <span class=number>15</span>, <span class=number>63</span>, <span class=number>202</span>, <span class=number>143</span>, <span class=number>30</span>, <span class=number>44</span>, <span class=number>208</span>, <span class=number>107</span>, <span class=number>138</span>, <span class=number>19</span>, <span class=number>1</span>, <span class=number>3</span>, <span class=number>189</span>, <span class=number>175</span>, <span class=number>193</span>, <span class=number>10</span>, <span class=number>211</span>, <span class=number>188</span>, <span class=number>140</span>, <span class=number>0</span>, <span class=number>171</span>, <span class=number>216</span>, <span class=number>144</span>, <span class=number>6</span>, <span class=number>69</span>, <span class=number>179</span>, <span class=number>184</span>, <span class=number>5</span>, <span class=number>88</span>, <span class=number>228</span>, <span class=number>247</span>, <span class=number>218</span>, <span class=number>185</span>, <span class=number>237</span>, <span class=number>253</span>, <span class=number>80</span>, <span class=number>72</span>, <span class=number>112</span>, <span class=number>108</span>, <span class=number>132</span>, <span class=number>157</span>, <span class=number>141</span>, <span class=number>167</span>, <span class=number>87</span>, <span class=number>70</span>, <span class=number>21</span>, <span class=number>94</span>, <span class=number>22</span>, <span class=number>152</span>, <span class=number>104</span>, <span class=number>134</span>, <span class=number>100</span>, <span class=number>246</span>, <span class=number>248</span>, <span class=number>114</span>, <span class=number>146</span>, <span class=number>182</span>, <span class=number>101</span>, <span class=number>93</span>, <span class=number>204</span>, <span class=number>92</span>, <span class=number>164</span>, <span class=number>212</span>, <span class=number>178</span>, <span class=number>36</span>, <span class=number>217</span>, <span class=number>40</span>, <span class=number>102</span>, <span class=number>161</span>, <span class=number>46</span>, <span class=number>8</span>, <span class=number>37</span>, <span class=number>209</span>, <span class=number>139</span>, <span class=number>109</span>, <span class=number>73</span>, <span class=number>162</span>, <span class=number>91</span>, <span class=number>118</span>, <span class=number>61</span>, <span class=number>35</span>, <span class=number>194</span>, <span class=number>166</span>, <span class=number>50</span>, <span class=number>148</span>, <span class=number>123</span>, <span class=number>84</span>, <span class=number>78</span>, <span class=number>195</span>, <span class=number>250</span>, <span class=number>66</span>, <span class=number>11</span>, <span class=number>149</span>, <span class=number>76</span>, <span class=number>238</span>, <span class=number>135</span>, <span class=number>255</span>, <span class=number>47</span>, <span class=number>155</span>, <span class=number>130</span>, <span class=number>57</span>, <span class=number>227</span>, <span class=number>124</span>, <span class=number>203</span>, <span class=number>233</span>, <span class=number>222</span>, <span class=number>196</span>, <span class=number>68</span>, <span class=number>67</span>, <span class=number>142</span>, <span class=number>52</span>, <span class=number>56</span>, <span class=number>165</span>, <span class=number>54</span>, <span class=number>48</span>, <span class=number>213</span>, <span class=number>106</span>, <span class=number>9</span>, <span class=number>82</span>, <span class=number>251</span>, <span class=number>215</span>, <span class=number>243</span>, <span class=number>129</span>, <span class=number>158</span>, <span class=number>163</span>, <span class=number>64</span>, <span class=number>191</span>, <span class=number>38</span>, <span class=number>214</span>, <span class=number>119</span>, <span class=number>186</span>, <span class=number>126</span>, <span class=number>4</span>, <span class=number>43</span>, <span class=number>23</span>, <span class=number>125</span>, <span class=number>12</span>, <span class=number>33</span>, <span class=number>85</span>, <span class=number>99</span>, <span class=number>20</span>, <span class=number>105</span>, <span class=number>225</span>, <span class=number>176</span>, <span class=number>245</span>, <span class=number>42</span>, <span class=number>174</span>, <span class=number>77</span>, <span class=number>59</span>, <span class=number>224</span>, <span class=number>160</span>, <span class=number>97</span>, <span class=number>153</span>, <span class=number>83</span>, <span class=number>131</span>, <span class=number>60</span>, <span class=number>187</span>, <span class=number>235</span>, <span class=number>200</span>, <span class=number>13</span>, <span class=number>74</span>, <span class=number>181</span>, <span class=number>25</span>, <span class=number>169</span>, <span class=number>127</span>, <span class=number>81</span>, <span class=number>96</span>, <span class=number>239</span>, <span class=number>156</span>, <span class=number>201</span>, <span class=number>147</span>, <span class=number>159</span>, <span class=number>122</span>, <span class=number>229</span>, <span class=number>45</span>, <span class=number>49</span>, <span class=number>199</span>, <span class=number>7</span>, <span class=number>136</span>, <span class=number>51</span>, <span class=number>168</span>, <span class=number>221</span>, <span class=number>31</span>, <span class=number>95</span>, <span class=number>236</span>, <span class=number>128</span>, <span class=number>39</span>, <span class=number>89</span>, <span class=number>16</span>, <span class=number>18</span>, <span class=number>177</span>, <span class=number>32</span>, <span class=number>121</span>, <span class=number>210</span>, <span class=number>198</span>, <span class=number>75</span>, <span class=number>62</span>, <span class=number>86</span>, <span class=number>252</span>, <span class=number>244</span>, <span class=number>90</span>, <span class=number>205</span>, <span class=number>120</span>, <span class=number>254</span>, <span class=number>192</span>, <span class=number>219</span>, <span class=number>154</span>, <span class=number>137</span>, <span class=number>197</span>, <span class=number>41</span>, <span class=number>29</span>, <span class=number>113</span>, <span class=number>26</span>, <span class=number>241</span>, <span class=number>71</span>, <span class=number>27</span>, <span class=number>190</span>, <span class=number>24</span>, <span class=number>170</span>, <span class=number>14</span>, <span class=number>98</span>, <span class=number>183</span>, <span class=number>111</span>, <span class=number>133</span>, <span class=number>53</span>, <span class=number>173</span>, <span class=number>231</span>, <span class=number>34</span>, <span class=number>116</span>, <span class=number>172</span>, <span class=number>150</span>, <span class=number>110</span>, <span class=number>223</span>, <span class=number>117</span>, <span class=number>28</span>, <span class=number>232</span>, <span class=number>55</span>, <span class=number>249</span>, <span class=number>226</span>, <span class=number>234</span>, <span class=number>220</span>, <span class=number>103</span>, <span class=number>79</span>, <span class=number>65</span>, <span class=number>17</span>, <span class=number>145</span>, <span class=number>58</span>, <span class=number>115</span>, <span class=number>230</span>, <span class=number>180</span>, <span class=number>240</span>, <span class=number>206</span>, <span class=number>207</span>, <span class=number>242</span>, <span class=number>151</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/* copy in[16] to state[4][4] */</span></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>loadStateArray</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>], <span class=type>const</span> <span class=type>uint8_t</span> *in)</span> </span>{</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span>; ++j) {</span><br><span class=line>            state[j][i] = *in++;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/* copy state[4][4] to out[16] */</span></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>storeStateArray</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>], <span class=type>uint8_t</span> *out)</span> </span>{</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span>; ++j) {</span><br><span class=line>            *out++ = state[j][i];</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>keyExpansion</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *key, <span class=type>uint32_t</span> keyLen, AesKey *aesKey)</span> </span>{</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (<span class=literal>NULL</span> == key || <span class=literal>NULL</span> == aesKey){</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"keyExpansion param is NULL\n"</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>-1</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (keyLen != <span class=number>16</span>){</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"keyExpansion keyLen = %d, Not support.\n"</span>, keyLen);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>-1</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=type>uint32_t</span> *w = aesKey-&gt;eK;</span><br><span class=line>    <span class=type>uint32_t</span> *v = aesKey-&gt;dK;</span><br><span class=line></span><br><span class=line>    <span class=comment>/* keyLen is 16 Bytes, generate uint32_t W[44]. */</span></span><br><span class=line></span><br><span class=line>    <span class=comment>/* W[0-3] */</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=built_in>LOAD32H</span>(w[i], key + <span class=number>4</span>*i);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=comment>/* W[4-43] */</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>10</span>; ++i) {</span><br><span class=line>        w[<span class=number>4</span>] = w[<span class=number>0</span>] ^ <span class=built_in>MIX</span>(w[<span class=number>3</span>]) ^ rcon[i];</span><br><span class=line>        w[<span class=number>5</span>] = w[<span class=number>1</span>] ^ w[<span class=number>4</span>];</span><br><span class=line>        w[<span class=number>6</span>] = w[<span class=number>2</span>] ^ w[<span class=number>5</span>];</span><br><span class=line>        w[<span class=number>7</span>] = w[<span class=number>3</span>] ^ w[<span class=number>6</span>];</span><br><span class=line>        w += <span class=number>4</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    w = aesKey-&gt;eK<span class=number>+44</span> - <span class=number>4</span>;</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>11</span>; ++j) {</span><br><span class=line></span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>            v[i] = w[i];</span><br><span class=line>        }</span><br><span class=line>        w -= <span class=number>4</span>;</span><br><span class=line>        v += <span class=number>4</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>addRoundKey</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>], <span class=type>const</span> <span class=type>uint32_t</span> *key)</span> </span>{</span><br><span class=line>    <span class=type>uint8_t</span> k[<span class=number>4</span>][<span class=number>4</span>];</span><br><span class=line></span><br><span class=line>    <span class=comment>/* i: row, j: col */</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span>; ++j) {</span><br><span class=line>            k[i][j] = (<span class=type>uint8_t</span>) <span class=built_in>BYTE</span>(key[j], <span class=number>3</span> - i);  <span class=comment>/* copy uint32 key[4] to uint8 k[4][4] */</span></span><br><span class=line>            state[i][j] ^= k[i][j];</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>subBytes</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>])</span> </span>{</span><br><span class=line>    <span class=comment>/* i: row, j: col */</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span>; ++j) {</span><br><span class=line>            state[i][j] = S[state[i][j]];</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>invSubBytes</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>])</span> </span>{</span><br><span class=line>    <span class=comment>/* i: row, j: col */</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span>; ++j) {</span><br><span class=line>            state[i][j] = inv_S[state[i][j]];</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>shiftRows</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>])</span> </span>{</span><br><span class=line>    <span class=type>uint32_t</span> block[<span class=number>4</span>] = {<span class=number>0</span>};</span><br><span class=line></span><br><span class=line>    <span class=comment>/* i: row */</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=built_in>LOAD32H</span>(block[i], state[i]);</span><br><span class=line>        block[i] = <span class=built_in>ROF32</span>(block[i], <span class=number>8</span>*i);</span><br><span class=line>        <span class=built_in>STORE32H</span>(block[i], state[i]);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>invShiftRows</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>])</span> </span>{</span><br><span class=line>    <span class=type>uint32_t</span> block[<span class=number>4</span>] = {<span class=number>0</span>};</span><br><span class=line></span><br><span class=line>    <span class=comment>/* i: row */</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=built_in>LOAD32H</span>(block[i], state[i]);</span><br><span class=line>        block[i] = <span class=built_in>ROR32</span>(block[i], <span class=number>8</span>*i);</span><br><span class=line>        <span class=built_in>STORE32H</span>(block[i], state[i]);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/* Galois Field (256) Multiplication of two Bytes */</span></span><br><span class=line><span class=function><span class=type>uint8_t</span> <span class=title>GMul</span><span class=params>(<span class=type>uint8_t</span> u, <span class=type>uint8_t</span> v)</span> </span>{</span><br><span class=line>    <span class=type>uint8_t</span> p = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>8</span>; ++i) {</span><br><span class=line>        <span class=keyword>if</span> (u &amp; <span class=number>0x01</span>) {    <span class=comment>//</span></span><br><span class=line>            p ^= v;</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=type>int</span> flag = (v &amp; <span class=number>0x80</span>);</span><br><span class=line>        v &lt;&lt;= <span class=number>1</span>;</span><br><span class=line>        <span class=keyword>if</span> (flag) {</span><br><span class=line>            v ^= <span class=number>0x1B</span>; <span class=comment>/* x^8 + x^4 + x^3 + x + 1 */</span></span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        u &gt;&gt;= <span class=number>1</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> p;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>mixColumns</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>])</span> </span>{</span><br><span class=line>    <span class=type>uint8_t</span> tmp[<span class=number>4</span>][<span class=number>4</span>];</span><br><span class=line>    <span class=type>uint8_t</span> M[<span class=number>4</span>][<span class=number>4</span>] = {{<span class=number>0x02</span>, <span class=number>0x03</span>, <span class=number>0x01</span>, <span class=number>0x01</span>},</span><br><span class=line>                       {<span class=number>0x01</span>, <span class=number>0x02</span>, <span class=number>0x03</span>, <span class=number>0x01</span>},</span><br><span class=line>                       {<span class=number>0x01</span>, <span class=number>0x01</span>, <span class=number>0x02</span>, <span class=number>0x03</span>},</span><br><span class=line>                       {<span class=number>0x03</span>, <span class=number>0x01</span>, <span class=number>0x01</span>, <span class=number>0x02</span>}};</span><br><span class=line></span><br><span class=line>    <span class=comment>/* copy state[4][4] to tmp[4][4] */</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span>; ++j){</span><br><span class=line>            tmp[i][j] = state[i][j];</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span>; ++j) {</span><br><span class=line>            state[i][j] = <span class=built_in>GMul</span>(M[i][<span class=number>0</span>], tmp[<span class=number>0</span>][j]) ^ <span class=built_in>GMul</span>(M[i][<span class=number>1</span>], tmp[<span class=number>1</span>][j])</span><br><span class=line>                        ^ <span class=built_in>GMul</span>(M[i][<span class=number>2</span>], tmp[<span class=number>2</span>][j]) ^ <span class=built_in>GMul</span>(M[i][<span class=number>3</span>], tmp[<span class=number>3</span>][j]);</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>invMixColumns</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>])</span> </span>{</span><br><span class=line>    <span class=type>uint8_t</span> tmp[<span class=number>4</span>][<span class=number>4</span>];</span><br><span class=line>    <span class=type>uint8_t</span> M[<span class=number>4</span>][<span class=number>4</span>] = {{<span class=number>0x0E</span>, <span class=number>0x0B</span>, <span class=number>0x0D</span>, <span class=number>0x09</span>},</span><br><span class=line>                       {<span class=number>0x09</span>, <span class=number>0x0E</span>, <span class=number>0x0B</span>, <span class=number>0x0D</span>},</span><br><span class=line>                       {<span class=number>0x0D</span>, <span class=number>0x09</span>, <span class=number>0x0E</span>, <span class=number>0x0B</span>},</span><br><span class=line>                       {<span class=number>0x0B</span>, <span class=number>0x0D</span>, <span class=number>0x09</span>, <span class=number>0x0E</span>}};</span><br><span class=line></span><br><span class=line>    <span class=comment>/* copy state[4][4] to tmp[4][4] */</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span>; ++j){</span><br><span class=line>            tmp[i][j] = state[i][j];</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>4</span>; ++j) {</span><br><span class=line>            state[i][j] = <span class=built_in>GMul</span>(M[i][<span class=number>0</span>], tmp[<span class=number>0</span>][j]) ^ <span class=built_in>GMul</span>(M[i][<span class=number>1</span>], tmp[<span class=number>1</span>][j])</span><br><span class=line>                          ^ <span class=built_in>GMul</span>(M[i][<span class=number>2</span>], tmp[<span class=number>2</span>][j]) ^ <span class=built_in>GMul</span>(M[i][<span class=number>3</span>], tmp[<span class=number>3</span>][j]);</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>aesEncrypt</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *key, <span class=type>uint32_t</span> keyLen, <span class=type>const</span> <span class=type>uint8_t</span> *pt, <span class=type>uint8_t</span> *ct, <span class=type>uint32_t</span> len)</span> </span>{</span><br><span class=line></span><br><span class=line>    AesKey aesKey;</span><br><span class=line>    <span class=type>uint8_t</span> *pos = ct;</span><br><span class=line>    <span class=type>const</span> <span class=type>uint32_t</span> *rk = aesKey.eK;</span><br><span class=line>    <span class=type>uint8_t</span> out[BLOCKSIZE] = {<span class=number>0</span>};</span><br><span class=line>    <span class=type>uint8_t</span> actualKey[<span class=number>16</span>] = {<span class=number>0</span>};</span><br><span class=line>    <span class=type>uint8_t</span> state[<span class=number>4</span>][<span class=number>4</span>] = {<span class=number>0</span>};</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (<span class=literal>NULL</span> == key || <span class=literal>NULL</span> == pt || <span class=literal>NULL</span> == ct){</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"param err.\n"</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>-1</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (keyLen &gt; <span class=number>16</span>){</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"keyLen must be 16.\n"</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>-1</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (len % BLOCKSIZE){</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"inLen is invalid.\n"</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>-1</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=built_in>memcpy</span>(actualKey, key, keyLen);</span><br><span class=line>    <span class=built_in>keyExpansion</span>(actualKey, <span class=number>16</span>, &amp;aesKey);</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; len; i += BLOCKSIZE) {</span><br><span class=line></span><br><span class=line>        <span class=built_in>loadStateArray</span>(state, pt);</span><br><span class=line>        <span class=built_in>addRoundKey</span>(state, rk);</span><br><span class=line></span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>1</span>; j &lt; <span class=number>10</span>; ++j) {</span><br><span class=line>            rk += <span class=number>4</span>;</span><br><span class=line>            <span class=built_in>subBytes</span>(state);</span><br><span class=line>            <span class=built_in>shiftRows</span>(state);</span><br><span class=line>            <span class=built_in>mixColumns</span>(state);</span><br><span class=line>            <span class=built_in>addRoundKey</span>(state, rk);</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=built_in>subBytes</span>(state);</span><br><span class=line>        <span class=built_in>shiftRows</span>(state);</span><br><span class=line>        <span class=built_in>addRoundKey</span>(state, rk<span class=number>+4</span>);</span><br><span class=line></span><br><span class=line>        <span class=built_in>storeStateArray</span>(state, pos);</span><br><span class=line></span><br><span class=line>        pos += BLOCKSIZE;</span><br><span class=line>        pt += BLOCKSIZE;</span><br><span class=line>        rk = aesKey.eK;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>aesDecrypt</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *key, <span class=type>uint32_t</span> keyLen, <span class=type>const</span> <span class=type>uint8_t</span> *ct, <span class=type>uint8_t</span> *pt, <span class=type>uint32_t</span> len)</span> </span>{</span><br><span class=line>    AesKey aesKey;</span><br><span class=line>    <span class=type>uint8_t</span> *pos = pt;</span><br><span class=line>    <span class=type>const</span> <span class=type>uint32_t</span> *rk = aesKey.dK;</span><br><span class=line>    <span class=type>uint8_t</span> out[BLOCKSIZE] = {<span class=number>0</span>};</span><br><span class=line>    <span class=type>uint8_t</span> actualKey[<span class=number>16</span>] = {<span class=number>0</span>};</span><br><span class=line>    <span class=type>uint8_t</span> state[<span class=number>4</span>][<span class=number>4</span>] = {<span class=number>0</span>};</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (<span class=literal>NULL</span> == key || <span class=literal>NULL</span> == ct || <span class=literal>NULL</span> == pt){</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"param err.\n"</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>-1</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (keyLen &gt; <span class=number>16</span>){</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"keyLen must be 16.\n"</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>-1</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (len % BLOCKSIZE){</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"inLen is invalid.\n"</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>-1</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=built_in>memcpy</span>(actualKey, key, keyLen);</span><br><span class=line>    <span class=built_in>keyExpansion</span>(actualKey, <span class=number>16</span>, &amp;aesKey);</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; len; i += BLOCKSIZE) {</span><br><span class=line>        <span class=built_in>loadStateArray</span>(state, ct);</span><br><span class=line>        <span class=built_in>addRoundKey</span>(state, rk);</span><br><span class=line></span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>1</span>; j &lt; <span class=number>10</span>; ++j) {</span><br><span class=line>            rk += <span class=number>4</span>;</span><br><span class=line>            <span class=built_in>invShiftRows</span>(state);</span><br><span class=line>            <span class=built_in>invSubBytes</span>(state);</span><br><span class=line>            <span class=built_in>addRoundKey</span>(state, rk);</span><br><span class=line>            <span class=built_in>invMixColumns</span>(state);</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=built_in>invSubBytes</span>(state);</span><br><span class=line>        <span class=built_in>invShiftRows</span>(state);</span><br><span class=line>        <span class=built_in>addRoundKey</span>(state, rk<span class=number>+4</span>);</span><br><span class=line></span><br><span class=line>        <span class=built_in>storeStateArray</span>(state, pos);</span><br><span class=line>        pos += BLOCKSIZE;</span><br><span class=line>        ct += BLOCKSIZE;</span><br><span class=line>        rk = aesKey.dK;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>printHex</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *ptr, <span class=type>int</span> len, <span class=type>char</span> *tag)</span> </span>{</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s\ndata[%d]: "</span>, tag, len);</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; len; ++i) {</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%.2X "</span>, *ptr++);</span><br><span class=line>    }</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>printState</span><span class=params>(<span class=type>uint8_t</span> (*state)[<span class=number>4</span>], <span class=type>char</span> *tag)</span> </span>{</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s\n"</span>, tag);</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i) {</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%.2X %.2X %.2X %.2X\n"</span>, state[i][<span class=number>0</span>], state[i][<span class=number>1</span>], state[i][<span class=number>2</span>], state[i][<span class=number>3</span>]);</span><br><span class=line>    }</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span> </span>{</span><br><span class=line></span><br><span class=line>    <span class=comment>// case 1</span></span><br><span class=line>    <span class=type>const</span> <span class=type>uint8_t</span> key[<span class=number>16</span>] = { <span class=number>0x05</span>,<span class=number>0x06</span>,<span class=number>0x07</span>,<span class=number>0x08</span>,<span class=number>0x37</span>,<span class=number>0x42</span>,<span class=number>0x4d</span>,<span class=number>0x58</span>,<span class=number>0x63</span>,<span class=number>0x00</span>,<span class=number>0x0a</span>,<span class=number>0x0c</span>,<span class=number>0x0d</span>,<span class=number>0x0e</span>,<span class=number>0x0f</span>,<span class=number>0x10</span> };</span><br><span class=line>    <span class=type>const</span> <span class=type>uint8_t</span> pt[<span class=number>48</span>]={ </span><br><span class=line>        <span class=number>0x71</span>,<span class=number>0x55</span>,<span class=number>0x7f</span>,<span class=number>0xa8</span>,<span class=number>0xfa</span>,<span class=number>0x0e</span>,<span class=number>0xa3</span>,<span class=number>0x19</span>,<span class=number>0xa0</span>,<span class=number>0x5c</span>,<span class=number>0xf9</span>,<span class=number>0x0e</span>,<span class=number>0x9b</span>,<span class=number>0x0b</span>,<span class=number>0x5e</span>,<span class=number>0xfc</span>,<span class=number>0xb5</span>,<span class=number>0xa8</span>,<span class=number>0x49</span>,<span class=number>0xfd</span>,<span class=number>0x90</span>,<span class=number>0x99</span>,<span class=number>0x74</span>,<span class=number>0xc7</span>,<span class=number>0x77</span>,<span class=number>0x02</span>,<span class=number>0x6a</span>,<span class=number>0xf5</span>,<span class=number>0x9a</span>,<span class=number>0x6a</span>,<span class=number>0xba</span>,<span class=number>0x7f</span>,<span class=number>0xfb</span>,<span class=number>0xe7</span>,<span class=number>0x68</span>,<span class=number>0xda</span>,<span class=number>0x54</span>,<span class=number>0xee</span>,<span class=number>0xe8</span>,<span class=number>0xbb</span>,<span class=number>0x78</span>,<span class=number>0x01</span>,<span class=number>0xe7</span>,<span class=number>0xbb</span>,<span class=number>0xa2</span>,<span class=number>0x95</span>,<span class=number>0x95</span>,<span class=number>0xfa</span>,<span class=number>0x00</span>,<span class=number>0x00</span></span><br><span class=line>    };</span><br><span class=line>    <span class=type>uint8_t</span> ct[<span class=number>48</span>] = {<span class=number>0</span>};</span><br><span class=line>    <span class=type>uint8_t</span> plain[<span class=number>48</span>] = {<span class=number>0</span>}; </span><br><span class=line></span><br><span class=line>    <span class=comment>// aesEncrypt(key, 16, pt, ct, 16);</span></span><br><span class=line>    <span class=comment>// printHex(pt, 16, "plain data:");</span></span><br><span class=line>    <span class=comment>// printf("expect cipher:\n39 25 84 1D 02 DC 09 FB DC 11 85 97 19 6A 0B 32\n");</span></span><br><span class=line></span><br><span class=line>    <span class=comment>// printHex(ct, 16, "after encryption:");</span></span><br><span class=line></span><br><span class=line>    <span class=built_in>aesDecrypt</span>(key, <span class=number>16</span>, pt, plain, <span class=number>48</span>);</span><br><span class=line>    <span class=built_in>printHex</span>(plain, <span class=number>48</span>, <span class=string>"after decryption:"</span>);</span><br><span class=line></span><br><span class=line>    <span class=comment>// // case 2</span></span><br><span class=line>    <span class=comment>// const uint8_t key2[]="1234567890123456";</span></span><br><span class=line>    <span class=comment>// const uint8_t *data = (uint8_t*)"abcdefghijklmnopqrstuvwxyz123456";</span></span><br><span class=line>    <span class=comment>// uint8_t ct2[32] = {0};</span></span><br><span class=line>    <span class=comment>// uint8_t plain2[32] = {0};</span></span><br><span class=line>    <span class=comment>// aesEncrypt(key2, 16, data, ct2, 32);</span></span><br><span class=line></span><br><span class=line>    <span class=comment>// printf("\nplain text:\n%s\n", data);</span></span><br><span class=line>    <span class=comment>// printf("expect ciphertext:\nfcad715bd73b5cb0488f840f3bad7889\n");</span></span><br><span class=line>    <span class=comment>// printHex(ct2, 32, "after encryption:");</span></span><br><span class=line></span><br><span class=line>    <span class=comment>// aesDecrypt(key2, 16, ct2, plain2, 32);</span></span><br><span class=line>    <span class=comment>// printHex(plain2, 32, "after decryption:");</span></span><br><span class=line></span><br><span class=line>    <span class=comment>// printf("output plain text\n");</span></span><br><span class=line>    <span class=comment>// for (int i = 0; i &lt; 32; ++i) {</span></span><br><span class=line>    <span class=comment>//     printf("%c ", plain2[i]);</span></span><br><span class=line>    <span class=comment>// }</span></span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h3 id=逆盒脚本><a href=#逆盒脚本 class=headerlink title=逆盒脚本></a>逆盒脚本</h3><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"stdio.h"</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"stdint.h"</span></span></span><br><span class=line></span><br><span class=line><span class=type>unsigned</span> <span class=type>char</span> S[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0x63</span>, <span class=number>0x7C</span>, <span class=number>0x77</span>, <span class=number>0x7B</span>, <span class=number>0xF2</span>, <span class=number>0x6B</span>, <span class=number>0x6F</span>, <span class=number>0xC5</span>, <span class=number>0x30</span>, <span class=number>0x01</span>, <span class=number>0x67</span>, <span class=number>0x2B</span>, <span class=number>0xFE</span>, <span class=number>0xD7</span>, <span class=number>0xAB</span>, <span class=number>0x76</span>,</span><br><span class=line>    <span class=number>0xCA</span>, <span class=number>0x82</span>, <span class=number>0xC9</span>, <span class=number>0x7D</span>, <span class=number>0xFA</span>, <span class=number>0x59</span>, <span class=number>0x47</span>, <span class=number>0xF0</span>, <span class=number>0xAD</span>, <span class=number>0xD4</span>, <span class=number>0xA2</span>, <span class=number>0xAF</span>, <span class=number>0x9C</span>, <span class=number>0xA4</span>, <span class=number>0x72</span>, <span class=number>0xC0</span>,</span><br><span class=line>    <span class=number>0xB7</span>, <span class=number>0xFD</span>, <span class=number>0x93</span>, <span class=number>0x26</span>, <span class=number>0x36</span>, <span class=number>0x3F</span>, <span class=number>0xF7</span>, <span class=number>0xCC</span>, <span class=number>0x34</span>, <span class=number>0xA5</span>, <span class=number>0xE5</span>, <span class=number>0xF1</span>, <span class=number>0x71</span>, <span class=number>0xD8</span>, <span class=number>0x31</span>, <span class=number>0x15</span>,</span><br><span class=line>    <span class=number>0x04</span>, <span class=number>0xC7</span>, <span class=number>0x23</span>, <span class=number>0xC3</span>, <span class=number>0x18</span>, <span class=number>0x96</span>, <span class=number>0x05</span>, <span class=number>0x9A</span>, <span class=number>0x07</span>, <span class=number>0x12</span>, <span class=number>0x80</span>, <span class=number>0xE2</span>, <span class=number>0xEB</span>, <span class=number>0x27</span>, <span class=number>0xB2</span>, <span class=number>0x75</span>,</span><br><span class=line>    <span class=number>0x09</span>, <span class=number>0x83</span>, <span class=number>0x2C</span>, <span class=number>0x1A</span>, <span class=number>0x1B</span>, <span class=number>0x6E</span>, <span class=number>0x5A</span>, <span class=number>0xA0</span>, <span class=number>0x52</span>, <span class=number>0x3B</span>, <span class=number>0xD6</span>, <span class=number>0xB3</span>, <span class=number>0x29</span>, <span class=number>0xE3</span>, <span class=number>0x2F</span>, <span class=number>0x84</span>,</span><br><span class=line>    <span class=number>0x53</span>, <span class=number>0xD1</span>, <span class=number>0x00</span>, <span class=number>0xED</span>, <span class=number>0x20</span>, <span class=number>0xFC</span>, <span class=number>0xB1</span>, <span class=number>0x5B</span>, <span class=number>0x6A</span>, <span class=number>0xCB</span>, <span class=number>0xBE</span>, <span class=number>0x39</span>, <span class=number>0x4A</span>, <span class=number>0x4C</span>, <span class=number>0x58</span>, <span class=number>0xCF</span>,</span><br><span class=line>    <span class=number>0xD0</span>, <span class=number>0xEF</span>, <span class=number>0xAA</span>, <span class=number>0xFB</span>, <span class=number>0x43</span>, <span class=number>0x4D</span>, <span class=number>0x33</span>, <span class=number>0x85</span>, <span class=number>0x45</span>, <span class=number>0xF9</span>, <span class=number>0x02</span>, <span class=number>0x7F</span>, <span class=number>0x50</span>, <span class=number>0x3C</span>, <span class=number>0x9F</span>, <span class=number>0xA8</span>,</span><br><span class=line>    <span class=number>0x51</span>, <span class=number>0xA3</span>, <span class=number>0x40</span>, <span class=number>0x8F</span>, <span class=number>0x92</span>, <span class=number>0x9D</span>, <span class=number>0x38</span>, <span class=number>0xF5</span>, <span class=number>0xBC</span>, <span class=number>0xB6</span>, <span class=number>0xDA</span>, <span class=number>0x21</span>, <span class=number>0x10</span>, <span class=number>0xFF</span>, <span class=number>0xF3</span>, <span class=number>0xD2</span>,</span><br><span class=line>    <span class=number>0xCD</span>, <span class=number>0x0C</span>, <span class=number>0x13</span>, <span class=number>0xEC</span>, <span class=number>0x5F</span>, <span class=number>0x97</span>, <span class=number>0x44</span>, <span class=number>0x17</span>, <span class=number>0xC4</span>, <span class=number>0xA7</span>, <span class=number>0x7E</span>, <span class=number>0x3D</span>, <span class=number>0x64</span>, <span class=number>0x5D</span>, <span class=number>0x19</span>, <span class=number>0x73</span>,</span><br><span class=line>    <span class=number>0x60</span>, <span class=number>0x81</span>, <span class=number>0x4F</span>, <span class=number>0xDC</span>, <span class=number>0x22</span>, <span class=number>0x2A</span>, <span class=number>0x90</span>, <span class=number>0x88</span>, <span class=number>0x46</span>, <span class=number>0xEE</span>, <span class=number>0xB8</span>, <span class=number>0x14</span>, <span class=number>0xDE</span>, <span class=number>0x5E</span>, <span class=number>0x0B</span>, <span class=number>0xDB</span>,</span><br><span class=line>    <span class=number>0xE0</span>, <span class=number>0x32</span>, <span class=number>0x3A</span>, <span class=number>0x0A</span>, <span class=number>0x49</span>, <span class=number>0x06</span>, <span class=number>0x24</span>, <span class=number>0x5C</span>, <span class=number>0xC2</span>, <span class=number>0xD3</span>, <span class=number>0xAC</span>, <span class=number>0x62</span>, <span class=number>0x91</span>, <span class=number>0x95</span>, <span class=number>0xE4</span>, <span class=number>0x79</span>,</span><br><span class=line>    <span class=number>0xE7</span>, <span class=number>0xC8</span>, <span class=number>0x37</span>, <span class=number>0x6D</span>, <span class=number>0x8D</span>, <span class=number>0xD5</span>, <span class=number>0x4E</span>, <span class=number>0xA9</span>, <span class=number>0x6C</span>, <span class=number>0x56</span>, <span class=number>0xF4</span>, <span class=number>0xEA</span>, <span class=number>0x65</span>, <span class=number>0x7A</span>, <span class=number>0xAE</span>, <span class=number>0x08</span>,</span><br><span class=line>    <span class=number>0xBA</span>, <span class=number>0x78</span>, <span class=number>0x25</span>, <span class=number>0x2E</span>, <span class=number>0x1C</span>, <span class=number>0xA6</span>, <span class=number>0xB4</span>, <span class=number>0xC6</span>, <span class=number>0xE8</span>, <span class=number>0xDD</span>, <span class=number>0x74</span>, <span class=number>0x1F</span>, <span class=number>0x4B</span>, <span class=number>0xBD</span>, <span class=number>0x8B</span>, <span class=number>0x8A</span>,</span><br><span class=line>    <span class=number>0x70</span>, <span class=number>0x3E</span>, <span class=number>0xB5</span>, <span class=number>0x66</span>, <span class=number>0x48</span>, <span class=number>0x03</span>, <span class=number>0xF6</span>, <span class=number>0x0E</span>, <span class=number>0x61</span>, <span class=number>0x35</span>, <span class=number>0x57</span>, <span class=number>0xB9</span>, <span class=number>0x86</span>, <span class=number>0xC1</span>, <span class=number>0x1D</span>, <span class=number>0x9E</span>,</span><br><span class=line>    <span class=number>0xE1</span>, <span class=number>0xF8</span>, <span class=number>0x98</span>, <span class=number>0x11</span>, <span class=number>0x69</span>, <span class=number>0xD9</span>, <span class=number>0x8E</span>, <span class=number>0x94</span>, <span class=number>0x9B</span>, <span class=number>0x1E</span>, <span class=number>0x87</span>, <span class=number>0xE9</span>, <span class=number>0xCE</span>, <span class=number>0x55</span>, <span class=number>0x28</span>, <span class=number>0xDF</span>,</span><br><span class=line>    <span class=number>0x8C</span>, <span class=number>0xA1</span>, <span class=number>0x89</span>, <span class=number>0x0D</span>, <span class=number>0xBF</span>, <span class=number>0xE6</span>, <span class=number>0x42</span>, <span class=number>0x68</span>, <span class=number>0x41</span>, <span class=number>0x99</span>, <span class=number>0x2D</span>, <span class=number>0x0F</span>, <span class=number>0xB0</span>, <span class=number>0x54</span>, <span class=number>0xBB</span>, <span class=number>0x16</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=type>uint8_t</span> INV_S[<span class=number>256</span>] = {};</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span> </span>{</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>size_t</span> i = <span class=number>0</span>; i &lt; <span class=number>256</span>; i++)</span><br><span class=line>    {</span><br><span class=line>        <span class=comment>// 脱裤子放屁，，， 等于 INV_S[S[i]] = i;</span></span><br><span class=line>        INV_S[(((S[i] &amp; <span class=number>0xF0</span>) &gt;&gt; <span class=number>4</span>) &lt;&lt; <span class=number>4</span>) + (S[i] &amp; <span class=number>0xF</span>)] = i;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>size_t</span> i = <span class=number>0</span>; i &lt; <span class=number>256</span>; i++)</span><br><span class=line>    {</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%x"</span>, INV_S[i]);</span><br><span class=line>        <span class=keyword>if</span> (i &lt; <span class=number>255</span>) <span class=built_in>printf</span>(<span class=string>", "</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=BlowFish><a href=#BlowFish class=headerlink title=BlowFish></a>BlowFish</h2><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// 轮函数</span></span><br><span class=line><span class=function>DWORD <span class=title>Feistel</span><span class=params>(DWORD x)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	DWORD h = S[<span class=number>0</span>][x &gt;&gt; <span class=number>24</span>] + S[<span class=number>1</span>][x &gt;&gt; <span class=number>16</span> &amp; <span class=number>0xff</span>];</span><br><span class=line>	<span class=keyword>return</span> (h ^ S[<span class=number>2</span>][x &gt;&gt; <span class=number>8</span> &amp; <span class=number>0xff</span>]) + S[<span class=number>3</span>][x &amp; <span class=number>0xff</span>];</span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>encrypt</span><span class=params>(DWORD&amp; XL, DWORD&amp; XR)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i += <span class=number>2</span>)</span><br><span class=line>	{</span><br><span class=line>		XL ^= P[i];</span><br><span class=line>		XR ^= <span class=built_in>Feistel</span>(XL);</span><br><span class=line>		XR ^= P[i + <span class=number>1</span>];</span><br><span class=line>		XL ^= <span class=built_in>Feistel</span>(XR);</span><br><span class=line>	}</span><br><span class=line>	XL ^= P[<span class=number>16</span>];</span><br><span class=line>	XR ^= P[<span class=number>17</span>];</span><br><span class=line>	<span class=built_in>swap</span>(XL, XR);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>decrypt</span><span class=params>(DWORD&amp; XL, DWORD&amp; XR)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>	<span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>16</span>; i &gt; <span class=number>0</span>; i -= <span class=number>2</span>)</span><br><span class=line>	{</span><br><span class=line>		XL ^= P[i + <span class=number>1</span>];</span><br><span class=line>		XR ^= <span class=built_in>Feistel</span>(XL);</span><br><span class=line>		XR ^= P[i];</span><br><span class=line>		XL ^= <span class=built_in>Feistel</span>(XR);</span><br><span class=line>	}</span><br><span class=line>	XL ^= P[<span class=number>1</span>];</span><br><span class=line>	XR ^= P[<span class=number>0</span>];</span><br><span class=line>	<span class=built_in>swap</span>(XL, XR);</span><br><span class=line>}</span><br><span class=line></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> Crypto.Cipher <span class=keyword>import</span> Blowfish</span><br><span class=line><span class=keyword>import</span> codecs</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">BlowfishCipher</span>:</span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">__init__</span>(<span class=params>self</span>):</span><br><span class=line>        <span class=keyword>pass</span></span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">encrypt</span>(<span class=params>self, plaintext, key</span>):</span><br><span class=line>        key = key.encode(<span class=string>"utf-8"</span>)</span><br><span class=line>        cipher = Blowfish.new(key, Blowfish.MODE_ECB)</span><br><span class=line>        </span><br><span class=line>        <span class=comment># 将明文填充到8字节的倍数</span></span><br><span class=line>        plaintext = plaintext.ljust((<span class=built_in>len</span>(plaintext) + <span class=number>7</span>) // <span class=number>8</span> * <span class=number>8</span>)</span><br><span class=line>        </span><br><span class=line>        ciphertext = cipher.encrypt(plaintext.encode(<span class=string>'utf-8'</span>))</span><br><span class=line>        hex_encode = codecs.encode(ciphertext, <span class=string>'hex_codec'</span>).decode(<span class=string>'utf-8'</span>)</span><br><span class=line>        <span class=keyword>return</span> hex_encode</span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">decrypt</span>(<span class=params>self, ciphertext, key</span>):</span><br><span class=line>        key = key.encode(<span class=string>"utf-8"</span>)</span><br><span class=line>        cipher = Blowfish.new(key, Blowfish.MODE_ECB)</span><br><span class=line>        </span><br><span class=line>        ciphertext = codecs.decode(ciphertext, <span class=string>'hex_codec'</span>)</span><br><span class=line>        decrypted_text = cipher.decrypt(ciphertext).decode(<span class=string>'utf-8'</span>).rstrip()</span><br><span class=line>        <span class=keyword>return</span> decrypted_text</span><br><span class=line></span><br><span class=line><span class=keyword>if</span> __name__ == <span class=string>'__main__'</span>:</span><br><span class=line>    plaintext = <span class=string>''</span></span><br><span class=line>    key = <span class=string>'UzBtZTBuZV9EMGcz'</span></span><br><span class=line>    </span><br><span class=line>    blowfish_cipher = BlowfishCipher()</span><br><span class=line>    encrypted_text=<span class=string>'11a51f049550e2508f17e16cf1632b47'</span></span><br><span class=line>    decrypted_text = blowfish_cipher.decrypt(encrypted_text, key)</span><br><span class=line>    <span class=built_in>print</span>(<span class=string>f"加密: <span class=subst>{encrypted_text}</span>, 解密: <span class=subst>{decrypted_text}</span>"</span>)</span><br><span class=line></span><br></pre></td></tr></table></figure><h2 id=SM4><a href=#SM4 class=headerlink title=SM4></a>SM4</h2><p>加解密同源</p><h3 id=代码1><a href=#代码1 class=headerlink title=代码1></a>代码1</h3><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> u8 unsigned char</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> u32 unsigned long</span></span><br><span class=line></span><br><span class=line><span class=comment>// S盒</span></span><br><span class=line><span class=type>const</span> u8 Sbox[<span class=number>256</span>] = {</span><br><span class=line>	<span class=number>0xd6</span>,<span class=number>0x90</span>,<span class=number>0xe9</span>,<span class=number>0xfe</span>,<span class=number>0xcc</span>,<span class=number>0xe1</span>,<span class=number>0x3d</span>,<span class=number>0xb7</span>,<span class=number>0x16</span>,<span class=number>0xb6</span>,<span class=number>0x14</span>,<span class=number>0xc2</span>,<span class=number>0x28</span>,<span class=number>0xfb</span>,<span class=number>0x2c</span>,<span class=number>0x05</span>,</span><br><span class=line>	<span class=number>0x2b</span>,<span class=number>0x67</span>,<span class=number>0x9a</span>,<span class=number>0x76</span>,<span class=number>0x2a</span>,<span class=number>0xbe</span>,<span class=number>0x04</span>,<span class=number>0xc3</span>,<span class=number>0xaa</span>,<span class=number>0x44</span>,<span class=number>0x13</span>,<span class=number>0x26</span>,<span class=number>0x49</span>,<span class=number>0x86</span>,<span class=number>0x06</span>,<span class=number>0x99</span>,</span><br><span class=line>	<span class=number>0x9c</span>,<span class=number>0x42</span>,<span class=number>0x50</span>,<span class=number>0xf4</span>,<span class=number>0x91</span>,<span class=number>0xef</span>,<span class=number>0x98</span>,<span class=number>0x7a</span>,<span class=number>0x33</span>,<span class=number>0x54</span>,<span class=number>0x0b</span>,<span class=number>0x43</span>,<span class=number>0xed</span>,<span class=number>0xcf</span>,<span class=number>0xac</span>,<span class=number>0x62</span>,</span><br><span class=line>	<span class=number>0xe4</span>,<span class=number>0xb3</span>,<span class=number>0x1c</span>,<span class=number>0xa9</span>,<span class=number>0xc9</span>,<span class=number>0x08</span>,<span class=number>0xe8</span>,<span class=number>0x95</span>,<span class=number>0x80</span>,<span class=number>0xdf</span>,<span class=number>0x94</span>,<span class=number>0xfa</span>,<span class=number>0x75</span>,<span class=number>0x8f</span>,<span class=number>0x3f</span>,<span class=number>0xa6</span>,</span><br><span class=line>	<span class=number>0x47</span>,<span class=number>0x07</span>,<span class=number>0xa7</span>,<span class=number>0xfc</span>,<span class=number>0xf3</span>,<span class=number>0x73</span>,<span class=number>0x17</span>,<span class=number>0xba</span>,<span class=number>0x83</span>,<span class=number>0x59</span>,<span class=number>0x3c</span>,<span class=number>0x19</span>,<span class=number>0xe6</span>,<span class=number>0x85</span>,<span class=number>0x4f</span>,<span class=number>0xa8</span>,</span><br><span class=line>	<span class=number>0x68</span>,<span class=number>0x6b</span>,<span class=number>0x81</span>,<span class=number>0xb2</span>,<span class=number>0x71</span>,<span class=number>0x64</span>,<span class=number>0xda</span>,<span class=number>0x8b</span>,<span class=number>0xf8</span>,<span class=number>0xeb</span>,<span class=number>0x0f</span>,<span class=number>0x4b</span>,<span class=number>0x70</span>,<span class=number>0x56</span>,<span class=number>0x9d</span>,<span class=number>0x35</span>,</span><br><span class=line>	<span class=number>0x1e</span>,<span class=number>0x24</span>,<span class=number>0x0e</span>,<span class=number>0x5e</span>,<span class=number>0x63</span>,<span class=number>0x58</span>,<span class=number>0xd1</span>,<span class=number>0xa2</span>,<span class=number>0x25</span>,<span class=number>0x22</span>,<span class=number>0x7c</span>,<span class=number>0x3b</span>,<span class=number>0x01</span>,<span class=number>0x21</span>,<span class=number>0x78</span>,<span class=number>0x87</span>,</span><br><span class=line>	<span class=number>0xd4</span>,<span class=number>0x00</span>,<span class=number>0x46</span>,<span class=number>0x57</span>,<span class=number>0x9f</span>,<span class=number>0xd3</span>,<span class=number>0x27</span>,<span class=number>0x52</span>,<span class=number>0x4c</span>,<span class=number>0x36</span>,<span class=number>0x02</span>,<span class=number>0xe7</span>,<span class=number>0xa0</span>,<span class=number>0xc4</span>,<span class=number>0xc8</span>,<span class=number>0x9e</span>,</span><br><span class=line>	<span class=number>0xea</span>,<span class=number>0xbf</span>,<span class=number>0x8a</span>,<span class=number>0xd2</span>,<span class=number>0x40</span>,<span class=number>0xc7</span>,<span class=number>0x38</span>,<span class=number>0xb5</span>,<span class=number>0xa3</span>,<span class=number>0xf7</span>,<span class=number>0xf2</span>,<span class=number>0xce</span>,<span class=number>0xf9</span>,<span class=number>0x61</span>,<span class=number>0x15</span>,<span class=number>0xa1</span>,</span><br><span class=line>	<span class=number>0xe0</span>,<span class=number>0xae</span>,<span class=number>0x5d</span>,<span class=number>0xa4</span>,<span class=number>0x9b</span>,<span class=number>0x34</span>,<span class=number>0x1a</span>,<span class=number>0x55</span>,<span class=number>0xad</span>,<span class=number>0x93</span>,<span class=number>0x32</span>,<span class=number>0x30</span>,<span class=number>0xf5</span>,<span class=number>0x8c</span>,<span class=number>0xb1</span>,<span class=number>0xe3</span>,</span><br><span class=line>	<span class=number>0x1d</span>,<span class=number>0xf6</span>,<span class=number>0xe2</span>,<span class=number>0x2e</span>,<span class=number>0x82</span>,<span class=number>0x66</span>,<span class=number>0xca</span>,<span class=number>0x60</span>,<span class=number>0xc0</span>,<span class=number>0x29</span>,<span class=number>0x23</span>,<span class=number>0xab</span>,<span class=number>0x0d</span>,<span class=number>0x53</span>,<span class=number>0x4e</span>,<span class=number>0x6f</span>,</span><br><span class=line>	<span class=number>0xd5</span>,<span class=number>0xdb</span>,<span class=number>0x37</span>,<span class=number>0x45</span>,<span class=number>0xde</span>,<span class=number>0xfd</span>,<span class=number>0x8e</span>,<span class=number>0x2f</span>,<span class=number>0x03</span>,<span class=number>0xff</span>,<span class=number>0x6a</span>,<span class=number>0x72</span>,<span class=number>0x6d</span>,<span class=number>0x6c</span>,<span class=number>0x5b</span>,<span class=number>0x51</span>,</span><br><span class=line>	<span class=number>0x8d</span>,<span class=number>0x1b</span>,<span class=number>0xaf</span>,<span class=number>0x92</span>,<span class=number>0xbb</span>,<span class=number>0xdd</span>,<span class=number>0xbc</span>,<span class=number>0x7f</span>,<span class=number>0x11</span>,<span class=number>0xd9</span>,<span class=number>0x5c</span>,<span class=number>0x41</span>,<span class=number>0x1f</span>,<span class=number>0x10</span>,<span class=number>0x5a</span>,<span class=number>0xd8</span>,</span><br><span class=line>	<span class=number>0x0a</span>,<span class=number>0xc1</span>,<span class=number>0x31</span>,<span class=number>0x88</span>,<span class=number>0xa5</span>,<span class=number>0xcd</span>,<span class=number>0x7b</span>,<span class=number>0xbd</span>,<span class=number>0x2d</span>,<span class=number>0x74</span>,<span class=number>0xd0</span>,<span class=number>0x12</span>,<span class=number>0xb8</span>,<span class=number>0xe5</span>,<span class=number>0xb4</span>,<span class=number>0xb0</span>,</span><br><span class=line>	<span class=number>0x89</span>,<span class=number>0x69</span>,<span class=number>0x97</span>,<span class=number>0x4a</span>,<span class=number>0x0c</span>,<span class=number>0x96</span>,<span class=number>0x77</span>,<span class=number>0x7e</span>,<span class=number>0x65</span>,<span class=number>0xb9</span>,<span class=number>0xf1</span>,<span class=number>0x09</span>,<span class=number>0xc5</span>,<span class=number>0x6e</span>,<span class=number>0xc6</span>,<span class=number>0x84</span>,</span><br><span class=line>	<span class=number>0x18</span>,<span class=number>0xf0</span>,<span class=number>0x7d</span>,<span class=number>0xec</span>,<span class=number>0x3a</span>,<span class=number>0xdc</span>,<span class=number>0x4d</span>,<span class=number>0x20</span>,<span class=number>0x79</span>,<span class=number>0xee</span>,<span class=number>0x5f</span>,<span class=number>0x3e</span>,<span class=number>0xd7</span>,<span class=number>0xcb</span>,<span class=number>0x39</span>,<span class=number>0x48</span></span><br><span class=line>};</span><br><span class=line>	</span><br><span class=line><span class=comment>// 密钥扩展算法的常数FK </span></span><br><span class=line><span class=type>const</span> u32 FK[<span class=number>4</span>] = {</span><br><span class=line>	<span class=number>0xa3b1bac6</span>, <span class=number>0x56aa3350</span>, <span class=number>0x677d9197</span>, <span class=number>0xb27022dc</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>// 密钥扩展算法的固定参数CK </span></span><br><span class=line><span class=type>const</span> u32 CK[<span class=number>32</span>] = {</span><br><span class=line>	<span class=number>0x00070e15</span>, <span class=number>0x1c232a31</span>, <span class=number>0x383f464d</span>, <span class=number>0x545b6269</span>,</span><br><span class=line>	<span class=number>0x70777e85</span>, <span class=number>0x8c939aa1</span>, <span class=number>0xa8afb6bd</span>, <span class=number>0xc4cbd2d9</span>,</span><br><span class=line>	<span class=number>0xe0e7eef5</span>, <span class=number>0xfc030a11</span>, <span class=number>0x181f262d</span>, <span class=number>0x343b4249</span>,</span><br><span class=line>	<span class=number>0x50575e65</span>, <span class=number>0x6c737a81</span>, <span class=number>0x888f969d</span>, <span class=number>0xa4abb2b9</span>,</span><br><span class=line>	<span class=number>0xc0c7ced5</span>, <span class=number>0xdce3eaf1</span>, <span class=number>0xf8ff060d</span>, <span class=number>0x141b2229</span>,</span><br><span class=line>	<span class=number>0x30373e45</span>, <span class=number>0x4c535a61</span>, <span class=number>0x686f767d</span>, <span class=number>0x848b9299</span>,</span><br><span class=line>	<span class=number>0xa0a7aeb5</span>, <span class=number>0xbcc3cad1</span>, <span class=number>0xd8dfe6ed</span>, <span class=number>0xf4fb0209</span>,</span><br><span class=line>	<span class=number>0x10171e25</span>, <span class=number>0x2c333a41</span>, <span class=number>0x484f565d</span>, <span class=number>0x646b7279</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=function>u32 <span class=title>functionB</span><span class=params>(u32 b)</span></span>; <span class=comment>// 查S盒的函数B </span></span><br><span class=line><span class=function>u32 <span class=title>loopLeft</span><span class=params>(u32 a, <span class=type>short</span> length)</span></span>; <span class=comment>// 循环左移函数 </span></span><br><span class=line><span class=function>u32 <span class=title>functionL1</span><span class=params>(u32 a)</span></span>; <span class=comment>// 线性变换L</span></span><br><span class=line><span class=function>u32 <span class=title>functionL2</span><span class=params>(u32 a)</span></span>; <span class=comment>// 线性变换L'</span></span><br><span class=line><span class=function>u32 <span class=title>functionT</span><span class=params>(u32 a, <span class=type>short</span> mode)</span></span>; <span class=comment>// 合成变换T</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>extendFirst</span><span class=params>(u32 MK[], u32 K[])</span></span>; <span class=comment>// 密钥扩展算法第一步</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>extendSecond</span><span class=params>(u32 RK[], u32 K[])</span></span>; <span class=comment>// 密钥扩展算法第二步</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>getRK</span><span class=params>(u32 MK[], u32 K[], u32 RK[])</span></span>; <span class=comment>// 轮密钥获取算法</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>iterate32</span><span class=params>(u32 X[], u32 RK[])</span></span>; <span class=comment>// 迭代算法</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>reverse</span><span class=params>(u32 X[], u32 Y[])</span></span>; <span class=comment>// 反转函数 </span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>encryptSM4</span><span class=params>(u32 X[], u32 RK[], u32 Y[])</span></span>; <span class=comment>// 加密算法</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>decryptSM4</span><span class=params>(u32 X[], u32 RK[], u32 Y[])</span></span>; <span class=comment>// 解密算法</span></span><br><span class=line> </span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>	查S盒的函数B </span></span><br><span class=line><span class=comment>	参数:	u32 b</span></span><br><span class=line><span class=comment>	返回值:	查S盒的结果u32 b</span></span><br><span class=line><span class=comment>*/</span> </span><br><span class=line><span class=function>u32 <span class=title>functionB</span><span class=params>(u32 b)</span> </span>{</span><br><span class=line>	u8 a[<span class=number>4</span>];</span><br><span class=line>	<span class=type>short</span> i;</span><br><span class=line>	a[<span class=number>0</span>] = b / <span class=number>0x1000000</span>;</span><br><span class=line>	a[<span class=number>1</span>] = b / <span class=number>0x10000</span>;</span><br><span class=line>	a[<span class=number>2</span>] = b / <span class=number>0x100</span>;</span><br><span class=line>	a[<span class=number>3</span>] = b;</span><br><span class=line>	b = Sbox[a[<span class=number>0</span>]] * <span class=number>0x1000000</span> + Sbox[a[<span class=number>1</span>]] * <span class=number>0x10000</span> + Sbox[a[<span class=number>2</span>]] * <span class=number>0x100</span> + Sbox[a[<span class=number>3</span>]];</span><br><span class=line>	<span class=keyword>return</span> b;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>	循环左移算法</span></span><br><span class=line><span class=comment>	参数：	u32 a    length：循环左移位数</span></span><br><span class=line><span class=comment>	返回值：u32 b </span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function>u32 <span class=title>loopLeft</span><span class=params>(u32 a, <span class=type>short</span> length)</span> </span>{</span><br><span class=line>	<span class=type>short</span> i;</span><br><span class=line>	<span class=keyword>for</span>(i = <span class=number>0</span>; i &lt; length; i++) {</span><br><span class=line>		a = a * <span class=number>2</span> + a / <span class=number>0x80000000</span>;</span><br><span class=line>	}</span><br><span class=line>	<span class=keyword>return</span> a;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/* </span></span><br><span class=line><span class=comment>	密钥线性变换函数L</span></span><br><span class=line><span class=comment>	参数：	u32 a</span></span><br><span class=line><span class=comment>	返回值：线性变换后的u32 a	</span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function>u32 <span class=title>functionL1</span><span class=params>(u32 a)</span> </span>{</span><br><span class=line>	<span class=keyword>return</span> a ^ <span class=built_in>loopLeft</span>(a, <span class=number>2</span>) ^ <span class=built_in>loopLeft</span>(a, <span class=number>10</span>) ^ <span class=built_in>loopLeft</span>(a, <span class=number>18</span>) ^ <span class=built_in>loopLeft</span>(a, <span class=number>24</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/* </span></span><br><span class=line><span class=comment>	密钥线性变换函数L'</span></span><br><span class=line><span class=comment>	参数：	u32 a</span></span><br><span class=line><span class=comment>	返回值：移位操作后的u32 a	</span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function>u32 <span class=title>functionL2</span><span class=params>(u32 a)</span> </span>{</span><br><span class=line>	<span class=keyword>return</span> a ^ <span class=built_in>loopLeft</span>(a, <span class=number>13</span>) ^ <span class=built_in>loopLeft</span>(a, <span class=number>23</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>	合成变换T</span></span><br><span class=line><span class=comment>	参数：	u32 a    short mode：1表示明文的T，调用L；2表示密钥的T，调用L' </span></span><br><span class=line><span class=comment>	返回值：合成变换后的u32 a </span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function>u32 <span class=title>functionT</span><span class=params>(u32 a, <span class=type>short</span> mode)</span> </span>{</span><br><span class=line>	<span class=keyword>return</span> mode == <span class=number>1</span> ? <span class=built_in>functionL1</span>(<span class=built_in>functionB</span>(a)) : <span class=built_in>functionL2</span>(<span class=built_in>functionB</span>(a));</span><br><span class=line>}</span><br><span class=line> </span><br><span class=line><span class=comment>/* </span></span><br><span class=line><span class=comment>	密钥扩展算法第一步</span></span><br><span class=line><span class=comment>	参数：	MK[4]：密钥  K[4]:中间数据，保存结果	（FK[4]：常数） </span></span><br><span class=line><span class=comment>	返回值：无 </span></span><br><span class=line><span class=comment>*/</span> </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>extendFirst</span><span class=params>(u32 MK[], u32 K[])</span> </span>{</span><br><span class=line>	<span class=type>int</span> i;</span><br><span class=line>	<span class=keyword>for</span>(i = <span class=number>0</span>; i &lt; <span class=number>4</span>; i++) {</span><br><span class=line>		K[i] = MK[i] ^ FK[i]; </span><br><span class=line>	} </span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/* </span></span><br><span class=line><span class=comment>	密钥扩展算法第二步</span></span><br><span class=line><span class=comment>	参数：	RK[32]：轮密钥，保存结果    K[4]：中间数据 （CK[32]：固定参数） </span></span><br><span class=line><span class=comment>	返回值：无</span></span><br><span class=line><span class=comment>*/</span> </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>extendSecond</span><span class=params>(u32 RK[], u32 K[])</span> </span>{</span><br><span class=line>	<span class=type>short</span> i;</span><br><span class=line>	<span class=keyword>for</span>(i = <span class=number>0</span>; i &lt;<span class=number>32</span>; i++) {</span><br><span class=line>		K[(i<span class=number>+4</span>)%<span class=number>4</span>] = K[i%<span class=number>4</span>] ^ <span class=built_in>functionT</span>(K[(i<span class=number>+1</span>)%<span class=number>4</span>] ^ K[(i<span class=number>+2</span>)%<span class=number>4</span>] ^ K[(i<span class=number>+3</span>)%<span class=number>4</span>] ^ CK[i], <span class=number>2</span>);</span><br><span class=line>		RK[i] = K[(i<span class=number>+4</span>)%<span class=number>4</span>];</span><br><span class=line>	} </span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>	密钥扩展算法 </span></span><br><span class=line><span class=comment>	参数：	MK[4]：密钥     K[4]：中间数据    RK[32]：轮密钥，保存结果 </span></span><br><span class=line><span class=comment>	返回值：无 </span></span><br><span class=line><span class=comment>*/</span> </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>getRK</span><span class=params>(u32 MK[], u32 K[], u32 RK[])</span> </span>{</span><br><span class=line>	<span class=built_in>extendFirst</span>(MK, K);</span><br><span class=line>	<span class=built_in>extendSecond</span>(RK, K);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>	迭代32次</span></span><br><span class=line><span class=comment>	参数：	u32 X[4]：迭代对象，保存结果    u32 RK[32]：轮密钥</span></span><br><span class=line><span class=comment>	返回值：无	  </span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>iterate32</span><span class=params>(u32 X[], u32 RK[])</span> </span>{</span><br><span class=line>	<span class=type>short</span> i;</span><br><span class=line>	<span class=keyword>for</span>(i = <span class=number>0</span>; i &lt; <span class=number>32</span>; i++) {</span><br><span class=line>		X[(i<span class=number>+4</span>)%<span class=number>4</span>] = X[i%<span class=number>4</span>] ^ <span class=built_in>functionT</span>(X[(i<span class=number>+1</span>)%<span class=number>4</span>] ^ X[(i<span class=number>+2</span>)%<span class=number>4</span>] ^ X[(i<span class=number>+3</span>)%<span class=number>4</span>] ^ RK[i], <span class=number>1</span>);</span><br><span class=line>	}</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>	反转函数 </span></span><br><span class=line><span class=comment>	参数；	u32 X[4]：反转对象    u32 Y[4]：反转结果</span></span><br><span class=line><span class=comment>	返回值：无 </span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>reverse</span><span class=params>(u32 X[], u32 Y[])</span> </span>{</span><br><span class=line>	 <span class=type>short</span> i;</span><br><span class=line>	 <span class=keyword>for</span>(i = <span class=number>0</span>; i &lt; <span class=number>4</span>; i++){</span><br><span class=line>	 	Y[i] = X[<span class=number>4</span> - <span class=number>1</span> - i];</span><br><span class=line>	 } </span><br><span class=line>} </span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>	加密算法</span></span><br><span class=line><span class=comment>	参数：	u32 X[4]：明文    u32 RK[32]：轮密钥    u32 Y[4]：密文，保存结果 </span></span><br><span class=line><span class=comment>	返回值：无 </span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>encryptSM4</span><span class=params>(u32 X[], u32 RK[], u32 Y[])</span> </span>{</span><br><span class=line>	<span class=built_in>iterate32</span>(X, RK);</span><br><span class=line>	<span class=built_in>reverse</span>(X, Y);</span><br><span class=line>} </span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>	解密算法</span></span><br><span class=line><span class=comment>	参数： 	u32 X[4]：密文    u32 RK[32]：轮密钥    u32 Y[4]：明文，保存结果</span></span><br><span class=line><span class=comment>	返回值：无 </span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>decryptSM4</span><span class=params>(u32 X[], u32 RK[], u32 Y[])</span> </span>{</span><br><span class=line>	<span class=type>short</span> i;</span><br><span class=line>	u32 reverseRK[<span class=number>32</span>];</span><br><span class=line>	<span class=keyword>for</span>(i = <span class=number>0</span>; i &lt; <span class=number>32</span>; i++) {</span><br><span class=line>		reverseRK[i] = RK[<span class=number>32</span><span class=number>-1</span>-i];</span><br><span class=line>	}</span><br><span class=line>	<span class=built_in>iterate32</span>(X, reverseRK);</span><br><span class=line>	<span class=built_in>reverse</span>(X, Y);</span><br><span class=line>}</span><br><span class=line> </span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>	测试数据：</span></span><br><span class=line><span class=comment>	明文：	01234567 89abcdef fedcba98 76543210</span></span><br><span class=line><span class=comment>	密钥：	01234567 89abcdef fedcba98 76543210</span></span><br><span class=line><span class=comment>	密文：	681edf34 d206965e 86b3e94f 536e4246 </span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>(<span class=type>void</span>)</span> </span>{</span><br><span class=line>	u32 X[<span class=number>4</span>]; <span class=comment>// 明文 </span></span><br><span class=line>	u32 MK[<span class=number>4</span>]; <span class=comment>// 密钥 </span></span><br><span class=line>	u32 RK[<span class=number>32</span>]; <span class=comment>// 轮密钥  </span></span><br><span class=line>	u32 K[<span class=number>4</span>]; <span class=comment>// 中间数据 </span></span><br><span class=line>	u32 Y[<span class=number>4</span>]; <span class=comment>// 密文 </span></span><br><span class=line>	<span class=type>short</span> i; <span class=comment>// 临时变量 </span></span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"明文："</span>); </span><br><span class=line>	<span class=built_in>scanf</span>(<span class=string>"%8x%8x%8x%8x"</span>, &amp;X[<span class=number>0</span>], &amp;X[<span class=number>1</span>], &amp;X[<span class=number>2</span>], &amp;X[<span class=number>3</span>]);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"密钥："</span>); </span><br><span class=line>	<span class=built_in>scanf</span>(<span class=string>"%8x%8x%8x%8x"</span>, &amp;MK[<span class=number>0</span>], &amp;MK[<span class=number>1</span>], &amp;MK[<span class=number>2</span>], &amp;MK[<span class=number>3</span>]);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"**************生成轮密钥*****************\n"</span>); </span><br><span class=line>	<span class=built_in>getRK</span>(MK, K, RK);</span><br><span class=line>	<span class=keyword>for</span>(i = <span class=number>0</span>; i &lt; <span class=number>32</span>; i++) {</span><br><span class=line>		<span class=built_in>printf</span>(<span class=string>"[%2d]：%08x    "</span>, i, RK[i]);</span><br><span class=line>		<span class=keyword>if</span>(i%<span class=number>4</span> == <span class=number>3</span>)	<span class=built_in>printf</span>(<span class=string>"\n"</span>); </span><br><span class=line>	}</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"************** 生成密文 *****************\n"</span>); </span><br><span class=line>	<span class=built_in>encryptSM4</span>(X, RK, Y);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"%08x %08x %08x %08x\n"</span>, Y[<span class=number>0</span>], Y[<span class=number>1</span>], Y[<span class=number>2</span>], Y[<span class=number>3</span>]);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"************** 生成明文 *****************\n"</span>);  </span><br><span class=line>	<span class=built_in>decryptSM4</span>(Y, RK, X);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"%08x %08x %08x %08x\n"</span>, X[<span class=number>0</span>], X[<span class=number>1</span>], X[<span class=number>2</span>], X[<span class=number>3</span>]);</span><br><span class=line>	<span class=keyword>return</span> <span class=number>0</span>;	</span><br><span class=line>} </span><br><span class=line></span><br></pre></td></tr></table></figure><h3 id=代码2><a href=#代码2 class=headerlink title=代码2></a>代码2</h3><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br><span class=line>315</span><br><span class=line>316</span><br><span class=line>317</span><br><span class=line>318</span><br><span class=line>319</span><br><span class=line>320</span><br><span class=line>321</span><br><span class=line>322</span><br><span class=line>323</span><br><span class=line>324</span><br><span class=line>325</span><br><span class=line>326</span><br><span class=line>327</span><br><span class=line>328</span><br><span class=line>329</span><br><span class=line>330</span><br><span class=line>331</span><br><span class=line>332</span><br><span class=line>333</span><br><span class=line>334</span><br><span class=line>335</span><br><span class=line>336</span><br><span class=line>337</span><br><span class=line>338</span><br><span class=line>339</span><br><span class=line>340</span><br><span class=line>341</span><br><span class=line>342</span><br><span class=line>343</span><br><span class=line>344</span><br><span class=line>345</span><br><span class=line>346</span><br><span class=line>347</span><br><span class=line>348</span><br><span class=line>349</span><br><span class=line>350</span><br><span class=line>351</span><br><span class=line>352</span><br><span class=line>353</span><br><span class=line>354</span><br><span class=line>355</span><br><span class=line>356</span><br><span class=line>357</span><br><span class=line>358</span><br><span class=line>359</span><br><span class=line>360</span><br><span class=line>361</span><br><span class=line>362</span><br><span class=line>363</span><br><span class=line>364</span><br><span class=line>365</span><br><span class=line>366</span><br><span class=line>367</span><br><span class=line>368</span><br><span class=line>369</span><br><span class=line>370</span><br><span class=line>371</span><br><span class=line>372</span><br><span class=line>373</span><br><span class=line>374</span><br><span class=line>375</span><br><span class=line>376</span><br><span class=line>377</span><br><span class=line>378</span><br><span class=line>379</span><br><span class=line>380</span><br><span class=line>381</span><br><span class=line>382</span><br><span class=line>383</span><br><span class=line>384</span><br><span class=line>385</span><br><span class=line>386</span><br><span class=line>387</span><br><span class=line>388</span><br><span class=line>389</span><br><span class=line>390</span><br><span class=line>391</span><br><span class=line>392</span><br><span class=line>393</span><br><span class=line>394</span><br><span class=line>395</span><br><span class=line>396</span><br><span class=line>397</span><br><span class=line>398</span><br><span class=line>399</span><br><span class=line>400</span><br><span class=line>401</span><br><span class=line>402</span><br><span class=line>403</span><br><span class=line>404</span><br><span class=line>405</span><br><span class=line>406</span><br><span class=line>407</span><br><span class=line>408</span><br><span class=line>409</span><br><span class=line>410</span><br><span class=line>411</span><br><span class=line>412</span><br><span class=line>413</span><br><span class=line>414</span><br><span class=line>415</span><br><span class=line>416</span><br><span class=line>417</span><br><span class=line>418</span><br><span class=line>419</span><br><span class=line>420</span><br><span class=line>421</span><br><span class=line>422</span><br><span class=line>423</span><br><span class=line>424</span><br><span class=line>425</span><br><span class=line>426</span><br><span class=line>427</span><br><span class=line>428</span><br><span class=line>429</span><br><span class=line>430</span><br><span class=line>431</span><br><span class=line>432</span><br><span class=line>433</span><br><span class=line>434</span><br><span class=line>435</span><br><span class=line>436</span><br><span class=line>437</span><br><span class=line>438</span><br><span class=line>439</span><br><span class=line>440</span><br><span class=line>441</span><br><span class=line>442</span><br><span class=line>443</span><br><span class=line>444</span><br><span class=line>445</span><br><span class=line>446</span><br><span class=line>447</span><br><span class=line>448</span><br><span class=line>449</span><br><span class=line>450</span><br><span class=line>451</span><br><span class=line>452</span><br><span class=line>453</span><br><span class=line>454</span><br><span class=line>455</span><br><span class=line>456</span><br></pre></td><td class=code><pre><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * SM4 Encryption alogrithm (SMS4 algorithm)</span></span><br><span class=line><span class=comment> * GM/T 0002-2012 Chinese National Standard ref:http://www.oscca.gov.cn/</span></span><br><span class=line><span class=comment> * thanks to Xyssl</span></span><br><span class=line><span class=comment> * thnaks and refers to http://hi.baidu.com/numax/blog/item/80addfefddfb93e4cf1b3e61.html</span></span><br><span class=line><span class=comment> * author:goldboar</span></span><br><span class=line><span class=comment> * email:goldboar@163.com</span></span><br><span class=line><span class=comment> * 2012-4-20</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_ENCRYPT 1</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_DECRYPT 0</span></span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=type>unsigned</span> <span class=type>char</span> uint8;</span><br><span class=line><span class=keyword>typedef</span> <span class=type>unsigned</span> <span class=type>int</span> uint32;</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * \brief          SM4 context structure</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>typedef</span> <span class=keyword>struct</span></span><br><span class=line>{</span><br><span class=line>    <span class=type>int</span> mode;      <span class=comment>/*!&lt;  encrypt/decrypt   */</span></span><br><span class=line>    uint32 sk[<span class=number>32</span>]; <span class=comment>/*!&lt;  SM4 subkeys       */</span></span><br><span class=line>} sm4_context;</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * \brief          SM4 key schedule (128-bit, encryption)</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * \param ctx      SM4 context to be initialized</span></span><br><span class=line><span class=comment> * \param key      16-byte secret key</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>sm4_setkey_enc</span><span class=params>(sm4_context *ctx, uint8 key[<span class=number>16</span>])</span></span>;</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * \brief          SM4 key schedule (128-bit, decryption)</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * \param ctx      SM4 context to be initialized</span></span><br><span class=line><span class=comment> * \param key      16-byte secret key</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>sm4_setkey_dec</span><span class=params>(sm4_context *ctx, uint8 key[<span class=number>16</span>])</span></span>;</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * \brief          SM4-ECB block encryption/decryption</span></span><br><span class=line><span class=comment> * \param ctx      SM4 context</span></span><br><span class=line><span class=comment> * \param mode     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class=line><span class=comment> * \param length   length of the input data</span></span><br><span class=line><span class=comment> * \param input    input block</span></span><br><span class=line><span class=comment> * \param output   output block</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>sm4_crypt_ecb</span><span class=params>(sm4_context *ctx,</span></span></span><br><span class=line><span class=params><span class=function>                   <span class=type>int</span> mode,</span></span></span><br><span class=line><span class=params><span class=function>                   <span class=type>int</span> length,</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 *input,</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 *output)</span></span>;</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * \brief          SM4-CBC buffer encryption/decryption</span></span><br><span class=line><span class=comment> * \param ctx      SM4 context</span></span><br><span class=line><span class=comment> * \param mode     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class=line><span class=comment> * \param length   length of the input data</span></span><br><span class=line><span class=comment> * \param iv       initialization vector (updated after use)</span></span><br><span class=line><span class=comment> * \param input    buffer holding the input data</span></span><br><span class=line><span class=comment> * \param output   buffer holding the output data</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>sm4_crypt_cbc</span><span class=params>(sm4_context *ctx,</span></span></span><br><span class=line><span class=params><span class=function>                   <span class=type>int</span> mode,</span></span></span><br><span class=line><span class=params><span class=function>                   <span class=type>int</span> length,</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 iv[<span class=number>16</span>],</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 *input,</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 *output)</span></span>;</span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;string.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;time.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;ctype.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * 32-bit integer manipulation macros (big endian)</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=meta>#<span class=keyword>ifndef</span> GET_UINT32_BE</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> GET_UINT32_BE(n, b, i)                                                                                                 \</span></span><br><span class=line><span class=meta>    {                                                                                                                         \</span></span><br><span class=line><span class=meta>        (n) = ((uint32)(b)[(i)] &lt;&lt; 24) | ((uint32)(b)[(i) + 1] &lt;&lt; 16) | ((uint32)(b)[(i) + 2] &lt;&lt; 8) | ((uint32)(b)[(i) + 3]); \</span></span><br><span class=line><span class=meta>    }</span></span><br><span class=line><span class=meta>#<span class=keyword>endif</span></span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>ifndef</span> PUT_UINT32_BE</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> PUT_UINT32_BE(n, b, i)              \</span></span><br><span class=line><span class=meta>    {                                      \</span></span><br><span class=line><span class=meta>        (b)[(i)] = (uint8)((n) &gt;&gt; 24);     \</span></span><br><span class=line><span class=meta>        (b)[(i) + 1] = (uint8)((n) &gt;&gt; 16); \</span></span><br><span class=line><span class=meta>        (b)[(i) + 2] = (uint8)((n) &gt;&gt; 8);  \</span></span><br><span class=line><span class=meta>        (b)[(i) + 3] = (uint8)((n));       \</span></span><br><span class=line><span class=meta>    }</span></span><br><span class=line><span class=meta>#<span class=keyword>endif</span></span></span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> *rotate shift left marco definition</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SHL(x, n) (((x) &amp; 0xFFFFFFFF) &lt;&lt; n)</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> ROTL(x, n) (SHL((x), n) | ((x) &gt;&gt; (32 - n)))</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SWAP(a, b)    \</span></span><br><span class=line><span class=meta>    {                 \</span></span><br><span class=line><span class=meta>        uint32 t = a; \</span></span><br><span class=line><span class=meta>        a = b;        \</span></span><br><span class=line><span class=meta>        b = t;        \</span></span><br><span class=line><span class=meta>        t = 0;        \</span></span><br><span class=line><span class=meta>    }</span></span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Expanded SM4 S-boxes</span></span><br><span class=line><span class=comment> /* Sbox table: 8bits input convert to 8 bits output*/</span></span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>const</span> uint8 SboxTable[<span class=number>16</span>][<span class=number>16</span>] = {</span><br><span class=line>        {<span class=number>0xd6</span>, <span class=number>0x90</span>, <span class=number>0xe9</span>, <span class=number>0xfe</span>, <span class=number>0xcc</span>, <span class=number>0xe1</span>, <span class=number>0x3d</span>, <span class=number>0xb7</span>, <span class=number>0x16</span>, <span class=number>0xb6</span>, <span class=number>0x14</span>, <span class=number>0xc2</span>, <span class=number>0x28</span>, <span class=number>0xfb</span>, <span class=number>0x2c</span>, <span class=number>0x05</span>},</span><br><span class=line>        {<span class=number>0x2b</span>, <span class=number>0x67</span>, <span class=number>0x9a</span>, <span class=number>0x76</span>, <span class=number>0x2a</span>, <span class=number>0xbe</span>, <span class=number>0x04</span>, <span class=number>0xc3</span>, <span class=number>0xaa</span>, <span class=number>0x44</span>, <span class=number>0x13</span>, <span class=number>0x26</span>, <span class=number>0x49</span>, <span class=number>0x86</span>, <span class=number>0x06</span>, <span class=number>0x99</span>},</span><br><span class=line>        {<span class=number>0x9c</span>, <span class=number>0x42</span>, <span class=number>0x50</span>, <span class=number>0xf4</span>, <span class=number>0x91</span>, <span class=number>0xef</span>, <span class=number>0x98</span>, <span class=number>0x7a</span>, <span class=number>0x33</span>, <span class=number>0x54</span>, <span class=number>0x0b</span>, <span class=number>0x43</span>, <span class=number>0xed</span>, <span class=number>0xcf</span>, <span class=number>0xac</span>, <span class=number>0x62</span>},</span><br><span class=line>        {<span class=number>0xe4</span>, <span class=number>0xb3</span>, <span class=number>0x1c</span>, <span class=number>0xa9</span>, <span class=number>0xc9</span>, <span class=number>0x08</span>, <span class=number>0xe8</span>, <span class=number>0x95</span>, <span class=number>0x80</span>, <span class=number>0xdf</span>, <span class=number>0x94</span>, <span class=number>0xfa</span>, <span class=number>0x75</span>, <span class=number>0x8f</span>, <span class=number>0x3f</span>, <span class=number>0xa6</span>},</span><br><span class=line>        {<span class=number>0x47</span>, <span class=number>0x07</span>, <span class=number>0xa7</span>, <span class=number>0xfc</span>, <span class=number>0xf3</span>, <span class=number>0x73</span>, <span class=number>0x17</span>, <span class=number>0xba</span>, <span class=number>0x83</span>, <span class=number>0x59</span>, <span class=number>0x3c</span>, <span class=number>0x19</span>, <span class=number>0xe6</span>, <span class=number>0x85</span>, <span class=number>0x4f</span>, <span class=number>0xa8</span>},</span><br><span class=line>        {<span class=number>0x68</span>, <span class=number>0x6b</span>, <span class=number>0x81</span>, <span class=number>0xb2</span>, <span class=number>0x71</span>, <span class=number>0x64</span>, <span class=number>0xda</span>, <span class=number>0x8b</span>, <span class=number>0xf8</span>, <span class=number>0xeb</span>, <span class=number>0x0f</span>, <span class=number>0x4b</span>, <span class=number>0x70</span>, <span class=number>0x56</span>, <span class=number>0x9d</span>, <span class=number>0x35</span>},</span><br><span class=line>        {<span class=number>0x1e</span>, <span class=number>0x24</span>, <span class=number>0x0e</span>, <span class=number>0x5e</span>, <span class=number>0x63</span>, <span class=number>0x58</span>, <span class=number>0xd1</span>, <span class=number>0xa2</span>, <span class=number>0x25</span>, <span class=number>0x22</span>, <span class=number>0x7c</span>, <span class=number>0x3b</span>, <span class=number>0x01</span>, <span class=number>0x21</span>, <span class=number>0x78</span>, <span class=number>0x87</span>},</span><br><span class=line>        {<span class=number>0xd4</span>, <span class=number>0x00</span>, <span class=number>0x46</span>, <span class=number>0x57</span>, <span class=number>0x9f</span>, <span class=number>0xd3</span>, <span class=number>0x27</span>, <span class=number>0x52</span>, <span class=number>0x4c</span>, <span class=number>0x36</span>, <span class=number>0x02</span>, <span class=number>0xe7</span>, <span class=number>0xa0</span>, <span class=number>0xc4</span>, <span class=number>0xc8</span>, <span class=number>0x9e</span>},</span><br><span class=line>        {<span class=number>0xea</span>, <span class=number>0xbf</span>, <span class=number>0x8a</span>, <span class=number>0xd2</span>, <span class=number>0x40</span>, <span class=number>0xc7</span>, <span class=number>0x38</span>, <span class=number>0xb5</span>, <span class=number>0xa3</span>, <span class=number>0xf7</span>, <span class=number>0xf2</span>, <span class=number>0xce</span>, <span class=number>0xf9</span>, <span class=number>0x61</span>, <span class=number>0x15</span>, <span class=number>0xa1</span>},</span><br><span class=line>        {<span class=number>0xe0</span>, <span class=number>0xae</span>, <span class=number>0x5d</span>, <span class=number>0xa4</span>, <span class=number>0x9b</span>, <span class=number>0x34</span>, <span class=number>0x1a</span>, <span class=number>0x55</span>, <span class=number>0xad</span>, <span class=number>0x93</span>, <span class=number>0x32</span>, <span class=number>0x30</span>, <span class=number>0xf5</span>, <span class=number>0x8c</span>, <span class=number>0xb1</span>, <span class=number>0xe3</span>},</span><br><span class=line>        {<span class=number>0x1d</span>, <span class=number>0xf6</span>, <span class=number>0xe2</span>, <span class=number>0x2e</span>, <span class=number>0x82</span>, <span class=number>0x66</span>, <span class=number>0xca</span>, <span class=number>0x60</span>, <span class=number>0xc0</span>, <span class=number>0x29</span>, <span class=number>0x23</span>, <span class=number>0xab</span>, <span class=number>0x0d</span>, <span class=number>0x53</span>, <span class=number>0x4e</span>, <span class=number>0x6f</span>},</span><br><span class=line>        {<span class=number>0xd5</span>, <span class=number>0xdb</span>, <span class=number>0x37</span>, <span class=number>0x45</span>, <span class=number>0xde</span>, <span class=number>0xfd</span>, <span class=number>0x8e</span>, <span class=number>0x2f</span>, <span class=number>0x03</span>, <span class=number>0xff</span>, <span class=number>0x6a</span>, <span class=number>0x72</span>, <span class=number>0x6d</span>, <span class=number>0x6c</span>, <span class=number>0x5b</span>, <span class=number>0x51</span>},</span><br><span class=line>        {<span class=number>0x8d</span>, <span class=number>0x1b</span>, <span class=number>0xaf</span>, <span class=number>0x92</span>, <span class=number>0xbb</span>, <span class=number>0xdd</span>, <span class=number>0xbc</span>, <span class=number>0x7f</span>, <span class=number>0x11</span>, <span class=number>0xd9</span>, <span class=number>0x5c</span>, <span class=number>0x41</span>, <span class=number>0x1f</span>, <span class=number>0x10</span>, <span class=number>0x5a</span>, <span class=number>0xd8</span>},</span><br><span class=line>        {<span class=number>0x0a</span>, <span class=number>0xc1</span>, <span class=number>0x31</span>, <span class=number>0x88</span>, <span class=number>0xa5</span>, <span class=number>0xcd</span>, <span class=number>0x7b</span>, <span class=number>0xbd</span>, <span class=number>0x2d</span>, <span class=number>0x74</span>, <span class=number>0xd0</span>, <span class=number>0x12</span>, <span class=number>0xb8</span>, <span class=number>0xe5</span>, <span class=number>0xb4</span>, <span class=number>0xb0</span>},</span><br><span class=line>        {<span class=number>0x89</span>, <span class=number>0x69</span>, <span class=number>0x97</span>, <span class=number>0x4a</span>, <span class=number>0x0c</span>, <span class=number>0x96</span>, <span class=number>0x77</span>, <span class=number>0x7e</span>, <span class=number>0x65</span>, <span class=number>0xb9</span>, <span class=number>0xf1</span>, <span class=number>0x09</span>, <span class=number>0xc5</span>, <span class=number>0x6e</span>, <span class=number>0xc6</span>, <span class=number>0x84</span>},</span><br><span class=line>        {<span class=number>0x18</span>, <span class=number>0xf0</span>, <span class=number>0x7d</span>, <span class=number>0xec</span>, <span class=number>0x3a</span>, <span class=number>0xdc</span>, <span class=number>0x4d</span>, <span class=number>0x20</span>, <span class=number>0x79</span>, <span class=number>0xee</span>, <span class=number>0x5f</span>, <span class=number>0x3e</span>, <span class=number>0xd7</span>, <span class=number>0xcb</span>, <span class=number>0x39</span>, <span class=number>0x48</span>}</span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/* System parameter */</span></span><br><span class=line><span class=type>static</span> <span class=type>const</span> uint32 FK[<span class=number>4</span>] = {<span class=number>0xa3b1bac6</span>, <span class=number>0x56aa3350</span>, <span class=number>0x677d9197</span>, <span class=number>0xb27022dc</span>};</span><br><span class=line></span><br><span class=line><span class=comment>/* fixed parameter */</span></span><br><span class=line><span class=type>static</span> <span class=type>const</span> uint32 CK[<span class=number>32</span>] = {</span><br><span class=line>        <span class=number>0x00070e15</span>, <span class=number>0x1c232a31</span>, <span class=number>0x383f464d</span>, <span class=number>0x545b6269</span>,</span><br><span class=line>        <span class=number>0x70777e85</span>, <span class=number>0x8c939aa1</span>, <span class=number>0xa8afb6bd</span>, <span class=number>0xc4cbd2d9</span>,</span><br><span class=line>        <span class=number>0xe0e7eef5</span>, <span class=number>0xfc030a11</span>, <span class=number>0x181f262d</span>, <span class=number>0x343b4249</span>,</span><br><span class=line>        <span class=number>0x50575e65</span>, <span class=number>0x6c737a81</span>, <span class=number>0x888f969d</span>, <span class=number>0xa4abb2b9</span>,</span><br><span class=line>        <span class=number>0xc0c7ced5</span>, <span class=number>0xdce3eaf1</span>, <span class=number>0xf8ff060d</span>, <span class=number>0x141b2229</span>,</span><br><span class=line>        <span class=number>0x30373e45</span>, <span class=number>0x4c535a61</span>, <span class=number>0x686f767d</span>, <span class=number>0x848b9299</span>,</span><br><span class=line>        <span class=number>0xa0a7aeb5</span>, <span class=number>0xbcc3cad1</span>, <span class=number>0xd8dfe6ed</span>, <span class=number>0xf4fb0209</span>,</span><br><span class=line>        <span class=number>0x10171e25</span>, <span class=number>0x2c333a41</span>, <span class=number>0x484f565d</span>, <span class=number>0x646b7279</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * private function:</span></span><br><span class=line><span class=comment> * look up in SboxTable and get the related value.</span></span><br><span class=line><span class=comment> * args:    [in] inch: 0x00~0xFF (8 bits unsigned value).</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>static</span> uint8 <span class=title>sm4Sbox</span><span class=params>(uint8 inch)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    uint8 *pTable = (uint8 *)SboxTable;</span><br><span class=line>    uint8 retVal = (uint8)(pTable[inch]);</span><br><span class=line>    <span class=keyword>return</span> retVal;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>printHex_withSpace</span><span class=params>(<span class=type>char</span> *name, <span class=type>void</span> *ptr, <span class=type>int</span> len)</span></span>;</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>hexdump</span><span class=params>(<span class=type>char</span> *name, <span class=type>const</span> <span class=type>void</span> *data, <span class=type>size_t</span> size)</span></span>;</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * private F(Lt) function:</span></span><br><span class=line><span class=comment> * "T algorithm" == "L algorithm" + "t algorithm".</span></span><br><span class=line><span class=comment> * args:    [in] a: a is a 32 bits unsigned value;</span></span><br><span class=line><span class=comment> * return: c: c is calculated with line algorithm "L" and nonline algorithm "t"</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>static</span> uint32 <span class=title>sm4Lt</span><span class=params>(uint32 ka)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    uint32 bb = <span class=number>0</span>;</span><br><span class=line>    uint32 c = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    uint8 a[<span class=number>4</span>];</span><br><span class=line>    uint8 b[<span class=number>4</span>];</span><br><span class=line></span><br><span class=line>    <span class=built_in>PUT_UINT32_BE</span>(ka, a, <span class=number>0</span>)</span><br><span class=line></span><br><span class=line>    b[<span class=number>0</span>] = <span class=built_in>sm4Sbox</span>(a[<span class=number>0</span>]);</span><br><span class=line>    b[<span class=number>1</span>] = <span class=built_in>sm4Sbox</span>(a[<span class=number>1</span>]);</span><br><span class=line>    b[<span class=number>2</span>] = <span class=built_in>sm4Sbox</span>(a[<span class=number>2</span>]);</span><br><span class=line>    b[<span class=number>3</span>] = <span class=built_in>sm4Sbox</span>(a[<span class=number>3</span>]);</span><br><span class=line></span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(bb, b, <span class=number>0</span>)</span><br><span class=line></span><br><span class=line>    c = bb ^ (<span class=built_in>ROTL</span>(bb, <span class=number>2</span>)) ^ (<span class=built_in>ROTL</span>(bb, <span class=number>10</span>)) ^ (<span class=built_in>ROTL</span>(bb, <span class=number>18</span>)) ^ (<span class=built_in>ROTL</span>(bb, <span class=number>24</span>));</span><br><span class=line>    <span class=keyword>return</span> c;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * private F function:</span></span><br><span class=line><span class=comment> * Calculating and getting encryption/decryption contents.</span></span><br><span class=line><span class=comment> * args:    [in] x0: original contents;</span></span><br><span class=line><span class=comment> * args:    [in] x1: original contents;</span></span><br><span class=line><span class=comment> * args:    [in] x2: original contents;</span></span><br><span class=line><span class=comment> * args:    [in] x3: original contents;</span></span><br><span class=line><span class=comment> * args:    [in] rk: encryption/decryption key;</span></span><br><span class=line><span class=comment> * return the contents of encryption/decryption contents.</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>static</span> uint32 <span class=title>sm4F</span><span class=params>(uint32 x0, uint32 x1, uint32 x2, uint32 x3, uint32 rk)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>return</span> (x0 ^ <span class=built_in>sm4Lt</span>(x1 ^ x2 ^ x3 ^ rk));</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/* private function:</span></span><br><span class=line><span class=comment> * Calculating round encryption key.</span></span><br><span class=line><span class=comment> * args:    [in] a: a is a 32 bits unsigned value;</span></span><br><span class=line><span class=comment> * return: sk[i]: i{0,1,2,3,...31}.</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>static</span> uint32 <span class=title>sm4CalciRK</span><span class=params>(uint32 ka)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    uint32 bb = <span class=number>0</span>;</span><br><span class=line>    uint32 rk = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    uint8 a[<span class=number>4</span>];</span><br><span class=line>    uint8 b[<span class=number>4</span>];</span><br><span class=line></span><br><span class=line>    <span class=built_in>PUT_UINT32_BE</span>(ka, a, <span class=number>0</span>)</span><br><span class=line></span><br><span class=line>    b[<span class=number>0</span>] = <span class=built_in>sm4Sbox</span>(a[<span class=number>0</span>]);</span><br><span class=line>    b[<span class=number>1</span>] = <span class=built_in>sm4Sbox</span>(a[<span class=number>1</span>]);</span><br><span class=line>    b[<span class=number>2</span>] = <span class=built_in>sm4Sbox</span>(a[<span class=number>2</span>]);</span><br><span class=line>    b[<span class=number>3</span>] = <span class=built_in>sm4Sbox</span>(a[<span class=number>3</span>]);</span><br><span class=line></span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(bb, b, <span class=number>0</span>)</span><br><span class=line></span><br><span class=line>    rk = bb ^ (<span class=built_in>ROTL</span>(bb, <span class=number>13</span>)) ^ (<span class=built_in>ROTL</span>(bb, <span class=number>23</span>));</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> rk;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>void</span> <span class=title>sm4_setkey</span><span class=params>(uint32 SK[<span class=number>32</span>], uint8 key[<span class=number>16</span>])</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    uint32 MK[<span class=number>4</span>];</span><br><span class=line>    uint32 k[<span class=number>36</span>];</span><br><span class=line>    uint32 i = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(MK[<span class=number>0</span>], key, <span class=number>0</span>);</span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(MK[<span class=number>1</span>], key, <span class=number>4</span>);</span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(MK[<span class=number>2</span>], key, <span class=number>8</span>);</span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(MK[<span class=number>3</span>], key, <span class=number>12</span>);</span><br><span class=line></span><br><span class=line>    k[<span class=number>0</span>] = MK[<span class=number>0</span>] ^ FK[<span class=number>0</span>];</span><br><span class=line>    k[<span class=number>1</span>] = MK[<span class=number>1</span>] ^ FK[<span class=number>1</span>];</span><br><span class=line>    k[<span class=number>2</span>] = MK[<span class=number>2</span>] ^ FK[<span class=number>2</span>];</span><br><span class=line>    k[<span class=number>3</span>] = MK[<span class=number>3</span>] ^ FK[<span class=number>3</span>];</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>for</span> (; i &lt; <span class=number>32</span>; i++)</span><br><span class=line>    {</span><br><span class=line>        k[i + <span class=number>4</span>] = k[i] ^ (<span class=built_in>sm4CalciRK</span>(k[i + <span class=number>1</span>] ^ k[i + <span class=number>2</span>] ^ k[i + <span class=number>3</span>] ^ CK[i]));</span><br><span class=line>        SK[i] = k[i + <span class=number>4</span>];</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * SM4 standard one round processing</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>void</span> <span class=title>sm4_one_round</span><span class=params>(uint32 sk[<span class=number>32</span>],</span></span></span><br><span class=line><span class=params><span class=function>                          uint8 input[<span class=number>16</span>],</span></span></span><br><span class=line><span class=params><span class=function>                          uint8 output[<span class=number>16</span>])</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    uint32 i = <span class=number>0</span>;</span><br><span class=line>    uint32 ulbuf[<span class=number>36</span>];</span><br><span class=line></span><br><span class=line>    <span class=built_in>memset</span>(ulbuf, <span class=number>0</span>, <span class=built_in>sizeof</span>(ulbuf));</span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(ulbuf[<span class=number>0</span>], input, <span class=number>0</span>)</span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(ulbuf[<span class=number>1</span>], input, <span class=number>4</span>)</span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(ulbuf[<span class=number>2</span>], input, <span class=number>8</span>)</span><br><span class=line>    <span class=built_in>GET_UINT32_BE</span>(ulbuf[<span class=number>3</span>], input, <span class=number>12</span>)</span><br><span class=line></span><br><span class=line>    <span class=keyword>while</span> (i &lt; <span class=number>32</span>)</span><br><span class=line>    {</span><br><span class=line>        ulbuf[i + <span class=number>4</span>] = <span class=built_in>sm4F</span>(ulbuf[i], ulbuf[i + <span class=number>1</span>], ulbuf[i + <span class=number>2</span>], ulbuf[i + <span class=number>3</span>], sk[i]);</span><br><span class=line>        i++;</span><br><span class=line>    }</span><br><span class=line>    </span><br><span class=line>    <span class=built_in>PUT_UINT32_BE</span>(ulbuf[<span class=number>35</span>], output, <span class=number>0</span>);</span><br><span class=line>    <span class=built_in>PUT_UINT32_BE</span>(ulbuf[<span class=number>34</span>], output, <span class=number>4</span>);</span><br><span class=line>    <span class=built_in>PUT_UINT32_BE</span>(ulbuf[<span class=number>33</span>], output, <span class=number>8</span>);</span><br><span class=line>    <span class=built_in>PUT_UINT32_BE</span>(ulbuf[<span class=number>32</span>], output, <span class=number>12</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * SM4 key schedule (128-bit, encryption)</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>sm4_setkey_enc</span><span class=params>(sm4_context *ctx, uint8 key[<span class=number>16</span>])</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    ctx-&gt;mode = SM4_ENCRYPT;</span><br><span class=line>    <span class=built_in>sm4_setkey</span>(ctx-&gt;sk, key);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * SM4 key schedule (128-bit, decryption)</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>sm4_setkey_dec</span><span class=params>(sm4_context *ctx, uint8 key[<span class=number>16</span>])</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>int</span> i;</span><br><span class=line>    ctx-&gt;mode = SM4_ENCRYPT;</span><br><span class=line>    <span class=built_in>sm4_setkey</span>(ctx-&gt;sk, key);</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i++)</span><br><span class=line>    {</span><br><span class=line>        <span class=built_in>SWAP</span>(ctx-&gt;sk[i], ctx-&gt;sk[<span class=number>31</span> - i]);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * SM4-ECB block encryption/decryption</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>sm4_crypt_ecb</span><span class=params>(sm4_context *ctx,</span></span></span><br><span class=line><span class=params><span class=function>                   <span class=type>int</span> mode,</span></span></span><br><span class=line><span class=params><span class=function>                   <span class=type>int</span> length,</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 *input,</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 *output)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>while</span> (length &gt; <span class=number>0</span>)</span><br><span class=line>    {</span><br><span class=line>        <span class=built_in>sm4_one_round</span>(ctx-&gt;sk, input, output);</span><br><span class=line>        input += <span class=number>16</span>;</span><br><span class=line>        output += <span class=number>16</span>;</span><br><span class=line>        length -= <span class=number>16</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * SM4-CBC buffer encryption/decryption</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>sm4_crypt_cbc</span><span class=params>(sm4_context *ctx,</span></span></span><br><span class=line><span class=params><span class=function>                   <span class=type>int</span> mode,</span></span></span><br><span class=line><span class=params><span class=function>                   <span class=type>int</span> length,</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 iv[<span class=number>16</span>],</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 *input,</span></span></span><br><span class=line><span class=params><span class=function>                   uint8 *output)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>int</span> i;</span><br><span class=line>    uint8 temp[<span class=number>16</span>];</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (mode == SM4_ENCRYPT)</span><br><span class=line>    {</span><br><span class=line>        <span class=keyword>while</span> (length &gt; <span class=number>0</span>)</span><br><span class=line>        {</span><br><span class=line>            <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i++)</span><br><span class=line>                output[i] = (uint8)(input[i] ^ iv[i]);</span><br><span class=line></span><br><span class=line>            <span class=built_in>sm4_one_round</span>(ctx-&gt;sk, output, output);</span><br><span class=line>            <span class=built_in>memcpy</span>(iv, output, <span class=number>16</span>);</span><br><span class=line></span><br><span class=line>            input += <span class=number>16</span>;</span><br><span class=line>            output += <span class=number>16</span>;</span><br><span class=line>            length -= <span class=number>16</span>;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>else</span> <span class=comment>/* SM4_DECRYPT */</span></span><br><span class=line>    {</span><br><span class=line>        <span class=keyword>while</span> (length &gt; <span class=number>0</span>)</span><br><span class=line>        {</span><br><span class=line>            <span class=built_in>memcpy</span>(temp, input, <span class=number>16</span>);</span><br><span class=line>            <span class=built_in>sm4_one_round</span>(ctx-&gt;sk, input, output);</span><br><span class=line></span><br><span class=line>            <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i++)</span><br><span class=line>                output[i] = (uint8)(output[i] ^ iv[i]);</span><br><span class=line></span><br><span class=line>            <span class=built_in>memcpy</span>(iv, temp, <span class=number>16</span>);</span><br><span class=line></span><br><span class=line>            input += <span class=number>16</span>;</span><br><span class=line>            output += <span class=number>16</span>;</span><br><span class=line>            length -= <span class=number>16</span>;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>printHex</span><span class=params>(<span class=type>char</span> *name, <span class=type>void</span> *ptr, <span class=type>int</span> len)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s"</span>, name);</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>size_t</span> i = <span class=number>0</span>; i &lt; len; i++)</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%02x"</span>, ((uint8 *)ptr)[i]);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>printHex_withSpace</span><span class=params>(<span class=type>char</span> *name, <span class=type>void</span> *ptr, <span class=type>int</span> len)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s\n"</span>, name);</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>size_t</span> i = <span class=number>0</span>; i &lt; len * <span class=number>4</span>; i++)</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%02x "</span>, ((uint8 *)ptr)[i]);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>hexdump</span><span class=params>(<span class=type>char</span> *name, <span class=type>const</span> <span class=type>void</span> *data, <span class=type>size_t</span> size)</span> </span>{</span><br><span class=line>    <span class=type>const</span> <span class=type>unsigned</span> <span class=type>char</span> *byte_data = (<span class=type>const</span> <span class=type>unsigned</span> <span class=type>char</span> *)data;</span><br><span class=line>    <span class=type>size_t</span> i, j;</span><br><span class=line></span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s\n"</span>, name);</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; size; i += <span class=number>16</span>) {</span><br><span class=line>        <span class=comment>// 打印偏移地址</span></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%08zx  "</span>, i);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 打印十六进制数据</span></span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; <span class=number>16</span>; ++j) {</span><br><span class=line>            <span class=keyword>if</span> (i + j &lt; size) {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"%02x "</span>, byte_data[i + j]);</span><br><span class=line>            } <span class=keyword>else</span> {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"   "</span>); <span class=comment>// 不足部分用空格填充</span></span><br><span class=line>            }</span><br><span class=line></span><br><span class=line>            <span class=comment>// 在每8字节后添加一个额外的空格</span></span><br><span class=line>            <span class=keyword>if</span> (j == <span class=number>7</span>) {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>" "</span>);</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>" |"</span>);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 打印ASCII字符</span></span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; <span class=number>16</span>; ++j) {</span><br><span class=line>            <span class=keyword>if</span> (i + j &lt; size) {</span><br><span class=line>                <span class=type>unsigned</span> <span class=type>char</span> ch = byte_data[i + j];</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"%c"</span>, <span class=built_in>isprint</span>(ch) ? ch : <span class=string>'.'</span>);</span><br><span class=line>            } <span class=keyword>else</span> {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>" "</span>);</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"|\n"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    uint8 key[<span class=number>16</span>] = {<span class=number>0x01</span>, <span class=number>0x23</span>, <span class=number>0x45</span>, <span class=number>0x67</span>, <span class=number>0x89</span>, <span class=number>0xab</span>, <span class=number>0xcd</span>, <span class=number>0xef</span>, <span class=number>0xfe</span>, <span class=number>0xdc</span>, <span class=number>0xba</span>, <span class=number>0x98</span>, <span class=number>0x76</span>, <span class=number>0x54</span>, <span class=number>0x32</span>, <span class=number>0x10</span>};</span><br><span class=line>    uint8 input[<span class=number>16</span>] = {<span class=number>0x01</span>, <span class=number>0x23</span>, <span class=number>0x45</span>, <span class=number>0x67</span>, <span class=number>0x89</span>, <span class=number>0xab</span>, <span class=number>0xcd</span>, <span class=number>0xef</span>, <span class=number>0xfe</span>, <span class=number>0xdc</span>, <span class=number>0xba</span>, <span class=number>0x98</span>, <span class=number>0x76</span>, <span class=number>0x54</span>, <span class=number>0x32</span>, <span class=number>0x10</span>};</span><br><span class=line>    uint8 output[<span class=number>16</span>];</span><br><span class=line></span><br><span class=line>    sm4_context ctx;</span><br><span class=line>    uint32 i;</span><br><span class=line></span><br><span class=line>    <span class=built_in>printHex</span>(<span class=string>"Key: "</span>, key, <span class=number>16</span>);</span><br><span class=line></span><br><span class=line>    <span class=comment>// encrypt standard testing vector</span></span><br><span class=line>    <span class=built_in>sm4_setkey_enc</span>(&amp;ctx, key);</span><br><span class=line>    <span class=built_in>hexdump</span>(<span class=string>"RK_enc: "</span>, ctx.sk, <span class=number>32</span> * <span class=number>4</span>);</span><br><span class=line></span><br><span class=line>    <span class=built_in>sm4_crypt_ecb</span>(&amp;ctx, <span class=number>1</span>, <span class=number>16</span>, input, output);</span><br><span class=line>    <span class=built_in>printHex</span>(<span class=string>"Crypted: "</span>, output, <span class=number>16</span>);</span><br><span class=line></span><br><span class=line>    <span class=comment>// decrypt testing</span></span><br><span class=line>    <span class=built_in>sm4_setkey_dec</span>(&amp;ctx, key);</span><br><span class=line>    <span class=built_in>hexdump</span>(<span class=string>"RK_dec: "</span>, ctx.sk, <span class=number>32</span> * <span class=number>4</span>);</span><br><span class=line></span><br><span class=line>    <span class=built_in>sm4_crypt_ecb</span>(&amp;ctx, <span class=number>0</span>, <span class=number>16</span>, output, output);</span><br><span class=line>    <span class=built_in>printHex</span>(<span class=string>"Original: "</span>, output, <span class=number>16</span>);</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h3 id=一份利用-SBOX-TX-加速运算的-SM4-代码><a href=#一份利用-SBOX-TX-加速运算的-SM4-代码 class=headerlink title="一份利用 SBOX_TX 加速运算的 SM4 代码"></a>一份利用 SBOX_TX 加速运算的 SM4 代码</h3><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br><span class=line>315</span><br><span class=line>316</span><br><span class=line>317</span><br><span class=line>318</span><br><span class=line>319</span><br><span class=line>320</span><br><span class=line>321</span><br><span class=line>322</span><br><span class=line>323</span><br><span class=line>324</span><br><span class=line>325</span><br><span class=line>326</span><br><span class=line>327</span><br><span class=line>328</span><br><span class=line>329</span><br><span class=line>330</span><br><span class=line>331</span><br><span class=line>332</span><br><span class=line>333</span><br><span class=line>334</span><br><span class=line>335</span><br><span class=line>336</span><br><span class=line>337</span><br><span class=line>338</span><br><span class=line>339</span><br><span class=line>340</span><br><span class=line>341</span><br><span class=line>342</span><br><span class=line>343</span><br><span class=line>344</span><br><span class=line>345</span><br><span class=line>346</span><br><span class=line>347</span><br><span class=line>348</span><br><span class=line>349</span><br><span class=line>350</span><br><span class=line>351</span><br><span class=line>352</span><br><span class=line>353</span><br><span class=line>354</span><br><span class=line>355</span><br><span class=line>356</span><br><span class=line>357</span><br><span class=line>358</span><br><span class=line>359</span><br><span class=line>360</span><br><span class=line>361</span><br><span class=line>362</span><br><span class=line>363</span><br><span class=line>364</span><br><span class=line>365</span><br><span class=line>366</span><br><span class=line>367</span><br><span class=line>368</span><br><span class=line>369</span><br><span class=line>370</span><br><span class=line>371</span><br><span class=line>372</span><br><span class=line>373</span><br><span class=line>374</span><br><span class=line>375</span><br><span class=line>376</span><br><span class=line>377</span><br><span class=line>378</span><br><span class=line>379</span><br><span class=line>380</span><br><span class=line>381</span><br><span class=line>382</span><br><span class=line>383</span><br><span class=line>384</span><br><span class=line>385</span><br><span class=line>386</span><br><span class=line>387</span><br><span class=line>388</span><br><span class=line>389</span><br><span class=line>390</span><br><span class=line>391</span><br><span class=line>392</span><br><span class=line>393</span><br><span class=line>394</span><br><span class=line>395</span><br><span class=line>396</span><br><span class=line>397</span><br><span class=line>398</span><br><span class=line>399</span><br><span class=line>400</span><br><span class=line>401</span><br><span class=line>402</span><br><span class=line>403</span><br><span class=line>404</span><br><span class=line>405</span><br><span class=line>406</span><br><span class=line>407</span><br><span class=line>408</span><br><span class=line>409</span><br><span class=line>410</span><br><span class=line>411</span><br><span class=line>412</span><br><span class=line>413</span><br><span class=line>414</span><br><span class=line>415</span><br><span class=line>416</span><br><span class=line>417</span><br><span class=line>418</span><br><span class=line>419</span><br><span class=line>420</span><br><span class=line>421</span><br><span class=line>422</span><br><span class=line>423</span><br><span class=line>424</span><br><span class=line>425</span><br><span class=line>426</span><br><span class=line>427</span><br><span class=line>428</span><br><span class=line>429</span><br><span class=line>430</span><br><span class=line>431</span><br><span class=line>432</span><br><span class=line>433</span><br><span class=line>434</span><br><span class=line>435</span><br><span class=line>436</span><br><span class=line>437</span><br><span class=line>438</span><br><span class=line>439</span><br><span class=line>440</span><br><span class=line>441</span><br><span class=line>442</span><br><span class=line>443</span><br><span class=line>444</span><br><span class=line>445</span><br><span class=line>446</span><br><span class=line>447</span><br><span class=line>448</span><br><span class=line>449</span><br><span class=line>450</span><br><span class=line>451</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"stdlib.h"</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"ctype.h"</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"stdio.h"</span></span></span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=type>unsigned</span> <span class=type>char</span> <span class=type>uint8_t</span>;</span><br><span class=line><span class=keyword>typedef</span> <span class=type>unsigned</span> <span class=type>int</span> <span class=type>uint32_t</span>;</span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_ENCRYPT 1</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_DECRYPT 0</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_BLOCK_SIZE 16</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_KEY_SCHEDULE 32</span></span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=keyword>struct</span> <span class="title class_">SM4_KEY_st</span></span><br><span class=line>{</span><br><span class=line>    <span class=type>uint32_t</span> rk[SM4_KEY_SCHEDULE];</span><br><span class=line>} SM4_KEY;</span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>const</span> <span class=type>uint8_t</span> SM4_S[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0xD6</span>, <span class=number>0x90</span>, <span class=number>0xE9</span>, <span class=number>0xFE</span>, <span class=number>0xCC</span>, <span class=number>0xE1</span>, <span class=number>0x3D</span>, <span class=number>0xB7</span>, <span class=number>0x16</span>, <span class=number>0xB6</span>, <span class=number>0x14</span>, <span class=number>0xC2</span>,</span><br><span class=line>    <span class=number>0x28</span>, <span class=number>0xFB</span>, <span class=number>0x2C</span>, <span class=number>0x05</span>, <span class=number>0x2B</span>, <span class=number>0x67</span>, <span class=number>0x9A</span>, <span class=number>0x76</span>, <span class=number>0x2A</span>, <span class=number>0xBE</span>, <span class=number>0x04</span>, <span class=number>0xC3</span>,</span><br><span class=line>    <span class=number>0xAA</span>, <span class=number>0x44</span>, <span class=number>0x13</span>, <span class=number>0x26</span>, <span class=number>0x49</span>, <span class=number>0x86</span>, <span class=number>0x06</span>, <span class=number>0x99</span>, <span class=number>0x9C</span>, <span class=number>0x42</span>, <span class=number>0x50</span>, <span class=number>0xF4</span>,</span><br><span class=line>    <span class=number>0x91</span>, <span class=number>0xEF</span>, <span class=number>0x98</span>, <span class=number>0x7A</span>, <span class=number>0x33</span>, <span class=number>0x54</span>, <span class=number>0x0B</span>, <span class=number>0x43</span>, <span class=number>0xED</span>, <span class=number>0xCF</span>, <span class=number>0xAC</span>, <span class=number>0x62</span>,</span><br><span class=line>    <span class=number>0xE4</span>, <span class=number>0xB3</span>, <span class=number>0x1C</span>, <span class=number>0xA9</span>, <span class=number>0xC9</span>, <span class=number>0x08</span>, <span class=number>0xE8</span>, <span class=number>0x95</span>, <span class=number>0x80</span>, <span class=number>0xDF</span>, <span class=number>0x94</span>, <span class=number>0xFA</span>,</span><br><span class=line>    <span class=number>0x75</span>, <span class=number>0x8F</span>, <span class=number>0x3F</span>, <span class=number>0xA6</span>, <span class=number>0x47</span>, <span class=number>0x07</span>, <span class=number>0xA7</span>, <span class=number>0xFC</span>, <span class=number>0xF3</span>, <span class=number>0x73</span>, <span class=number>0x17</span>, <span class=number>0xBA</span>,</span><br><span class=line>    <span class=number>0x83</span>, <span class=number>0x59</span>, <span class=number>0x3C</span>, <span class=number>0x19</span>, <span class=number>0xE6</span>, <span class=number>0x85</span>, <span class=number>0x4F</span>, <span class=number>0xA8</span>, <span class=number>0x68</span>, <span class=number>0x6B</span>, <span class=number>0x81</span>, <span class=number>0xB2</span>,</span><br><span class=line>    <span class=number>0x71</span>, <span class=number>0x64</span>, <span class=number>0xDA</span>, <span class=number>0x8B</span>, <span class=number>0xF8</span>, <span class=number>0xEB</span>, <span class=number>0x0F</span>, <span class=number>0x4B</span>, <span class=number>0x70</span>, <span class=number>0x56</span>, <span class=number>0x9D</span>, <span class=number>0x35</span>,</span><br><span class=line>    <span class=number>0x1E</span>, <span class=number>0x24</span>, <span class=number>0x0E</span>, <span class=number>0x5E</span>, <span class=number>0x63</span>, <span class=number>0x58</span>, <span class=number>0xD1</span>, <span class=number>0xA2</span>, <span class=number>0x25</span>, <span class=number>0x22</span>, <span class=number>0x7C</span>, <span class=number>0x3B</span>,</span><br><span class=line>    <span class=number>0x01</span>, <span class=number>0x21</span>, <span class=number>0x78</span>, <span class=number>0x87</span>, <span class=number>0xD4</span>, <span class=number>0x00</span>, <span class=number>0x46</span>, <span class=number>0x57</span>, <span class=number>0x9F</span>, <span class=number>0xD3</span>, <span class=number>0x27</span>, <span class=number>0x52</span>,</span><br><span class=line>    <span class=number>0x4C</span>, <span class=number>0x36</span>, <span class=number>0x02</span>, <span class=number>0xE7</span>, <span class=number>0xA0</span>, <span class=number>0xC4</span>, <span class=number>0xC8</span>, <span class=number>0x9E</span>, <span class=number>0xEA</span>, <span class=number>0xBF</span>, <span class=number>0x8A</span>, <span class=number>0xD2</span>,</span><br><span class=line>    <span class=number>0x40</span>, <span class=number>0xC7</span>, <span class=number>0x38</span>, <span class=number>0xB5</span>, <span class=number>0xA3</span>, <span class=number>0xF7</span>, <span class=number>0xF2</span>, <span class=number>0xCE</span>, <span class=number>0xF9</span>, <span class=number>0x61</span>, <span class=number>0x15</span>, <span class=number>0xA1</span>,</span><br><span class=line>    <span class=number>0xE0</span>, <span class=number>0xAE</span>, <span class=number>0x5D</span>, <span class=number>0xA4</span>, <span class=number>0x9B</span>, <span class=number>0x34</span>, <span class=number>0x1A</span>, <span class=number>0x55</span>, <span class=number>0xAD</span>, <span class=number>0x93</span>, <span class=number>0x32</span>, <span class=number>0x30</span>,</span><br><span class=line>    <span class=number>0xF5</span>, <span class=number>0x8C</span>, <span class=number>0xB1</span>, <span class=number>0xE3</span>, <span class=number>0x1D</span>, <span class=number>0xF6</span>, <span class=number>0xE2</span>, <span class=number>0x2E</span>, <span class=number>0x82</span>, <span class=number>0x66</span>, <span class=number>0xCA</span>, <span class=number>0x60</span>,</span><br><span class=line>    <span class=number>0xC0</span>, <span class=number>0x29</span>, <span class=number>0x23</span>, <span class=number>0xAB</span>, <span class=number>0x0D</span>, <span class=number>0x53</span>, <span class=number>0x4E</span>, <span class=number>0x6F</span>, <span class=number>0xD5</span>, <span class=number>0xDB</span>, <span class=number>0x37</span>, <span class=number>0x45</span>,</span><br><span class=line>    <span class=number>0xDE</span>, <span class=number>0xFD</span>, <span class=number>0x8E</span>, <span class=number>0x2F</span>, <span class=number>0x03</span>, <span class=number>0xFF</span>, <span class=number>0x6A</span>, <span class=number>0x72</span>, <span class=number>0x6D</span>, <span class=number>0x6C</span>, <span class=number>0x5B</span>, <span class=number>0x51</span>,</span><br><span class=line>    <span class=number>0x8D</span>, <span class=number>0x1B</span>, <span class=number>0xAF</span>, <span class=number>0x92</span>, <span class=number>0xBB</span>, <span class=number>0xDD</span>, <span class=number>0xBC</span>, <span class=number>0x7F</span>, <span class=number>0x11</span>, <span class=number>0xD9</span>, <span class=number>0x5C</span>, <span class=number>0x41</span>,</span><br><span class=line>    <span class=number>0x1F</span>, <span class=number>0x10</span>, <span class=number>0x5A</span>, <span class=number>0xD8</span>, <span class=number>0x0A</span>, <span class=number>0xC1</span>, <span class=number>0x31</span>, <span class=number>0x88</span>, <span class=number>0xA5</span>, <span class=number>0xCD</span>, <span class=number>0x7B</span>, <span class=number>0xBD</span>,</span><br><span class=line>    <span class=number>0x2D</span>, <span class=number>0x74</span>, <span class=number>0xD0</span>, <span class=number>0x12</span>, <span class=number>0xB8</span>, <span class=number>0xE5</span>, <span class=number>0xB4</span>, <span class=number>0xB0</span>, <span class=number>0x89</span>, <span class=number>0x69</span>, <span class=number>0x97</span>, <span class=number>0x4A</span>,</span><br><span class=line>    <span class=number>0x0C</span>, <span class=number>0x96</span>, <span class=number>0x77</span>, <span class=number>0x7E</span>, <span class=number>0x65</span>, <span class=number>0xB9</span>, <span class=number>0xF1</span>, <span class=number>0x09</span>, <span class=number>0xC5</span>, <span class=number>0x6E</span>, <span class=number>0xC6</span>, <span class=number>0x84</span>,</span><br><span class=line>    <span class=number>0x18</span>, <span class=number>0xF0</span>, <span class=number>0x7D</span>, <span class=number>0xEC</span>, <span class=number>0x3A</span>, <span class=number>0xDC</span>, <span class=number>0x4D</span>, <span class=number>0x20</span>, <span class=number>0x79</span>, <span class=number>0xEE</span>, <span class=number>0x5F</span>, <span class=number>0x3E</span>,</span><br><span class=line>    <span class=number>0xD7</span>, <span class=number>0xCB</span>, <span class=number>0x39</span>, <span class=number>0x48</span>};</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * SM4_SBOX_T[j] == L(SM4_SBOX[j]).</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=type>static</span> <span class=type>const</span> <span class=type>uint32_t</span> SM4_SBOX_T0[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0x8ED55B5B</span>, <span class=number>0xD0924242</span>, <span class=number>0x4DEAA7A7</span>, <span class=number>0x06FDFBFB</span>, <span class=number>0xFCCF3333</span>, <span class=number>0x65E28787</span>,</span><br><span class=line>    <span class=number>0xC93DF4F4</span>, <span class=number>0x6BB5DEDE</span>, <span class=number>0x4E165858</span>, <span class=number>0x6EB4DADA</span>, <span class=number>0x44145050</span>, <span class=number>0xCAC10B0B</span>,</span><br><span class=line>    <span class=number>0x8828A0A0</span>, <span class=number>0x17F8EFEF</span>, <span class=number>0x9C2CB0B0</span>, <span class=number>0x11051414</span>, <span class=number>0x872BACAC</span>, <span class=number>0xFB669D9D</span>,</span><br><span class=line>    <span class=number>0xF2986A6A</span>, <span class=number>0xAE77D9D9</span>, <span class=number>0x822AA8A8</span>, <span class=number>0x46BCFAFA</span>, <span class=number>0x14041010</span>, <span class=number>0xCFC00F0F</span>,</span><br><span class=line>    <span class=number>0x02A8AAAA</span>, <span class=number>0x54451111</span>, <span class=number>0x5F134C4C</span>, <span class=number>0xBE269898</span>, <span class=number>0x6D482525</span>, <span class=number>0x9E841A1A</span>,</span><br><span class=line>    <span class=number>0x1E061818</span>, <span class=number>0xFD9B6666</span>, <span class=number>0xEC9E7272</span>, <span class=number>0x4A430909</span>, <span class=number>0x10514141</span>, <span class=number>0x24F7D3D3</span>,</span><br><span class=line>    <span class=number>0xD5934646</span>, <span class=number>0x53ECBFBF</span>, <span class=number>0xF89A6262</span>, <span class=number>0x927BE9E9</span>, <span class=number>0xFF33CCCC</span>, <span class=number>0x04555151</span>,</span><br><span class=line>    <span class=number>0x270B2C2C</span>, <span class=number>0x4F420D0D</span>, <span class=number>0x59EEB7B7</span>, <span class=number>0xF3CC3F3F</span>, <span class=number>0x1CAEB2B2</span>, <span class=number>0xEA638989</span>,</span><br><span class=line>    <span class=number>0x74E79393</span>, <span class=number>0x7FB1CECE</span>, <span class=number>0x6C1C7070</span>, <span class=number>0x0DABA6A6</span>, <span class=number>0xEDCA2727</span>, <span class=number>0x28082020</span>,</span><br><span class=line>    <span class=number>0x48EBA3A3</span>, <span class=number>0xC1975656</span>, <span class=number>0x80820202</span>, <span class=number>0xA3DC7F7F</span>, <span class=number>0xC4965252</span>, <span class=number>0x12F9EBEB</span>,</span><br><span class=line>    <span class=number>0xA174D5D5</span>, <span class=number>0xB38D3E3E</span>, <span class=number>0xC33FFCFC</span>, <span class=number>0x3EA49A9A</span>, <span class=number>0x5B461D1D</span>, <span class=number>0x1B071C1C</span>,</span><br><span class=line>    <span class=number>0x3BA59E9E</span>, <span class=number>0x0CFFF3F3</span>, <span class=number>0x3FF0CFCF</span>, <span class=number>0xBF72CDCD</span>, <span class=number>0x4B175C5C</span>, <span class=number>0x52B8EAEA</span>,</span><br><span class=line>    <span class=number>0x8F810E0E</span>, <span class=number>0x3D586565</span>, <span class=number>0xCC3CF0F0</span>, <span class=number>0x7D196464</span>, <span class=number>0x7EE59B9B</span>, <span class=number>0x91871616</span>,</span><br><span class=line>    <span class=number>0x734E3D3D</span>, <span class=number>0x08AAA2A2</span>, <span class=number>0xC869A1A1</span>, <span class=number>0xC76AADAD</span>, <span class=number>0x85830606</span>, <span class=number>0x7AB0CACA</span>,</span><br><span class=line>    <span class=number>0xB570C5C5</span>, <span class=number>0xF4659191</span>, <span class=number>0xB2D96B6B</span>, <span class=number>0xA7892E2E</span>, <span class=number>0x18FBE3E3</span>, <span class=number>0x47E8AFAF</span>,</span><br><span class=line>    <span class=number>0x330F3C3C</span>, <span class=number>0x674A2D2D</span>, <span class=number>0xB071C1C1</span>, <span class=number>0x0E575959</span>, <span class=number>0xE99F7676</span>, <span class=number>0xE135D4D4</span>,</span><br><span class=line>    <span class=number>0x661E7878</span>, <span class=number>0xB4249090</span>, <span class=number>0x360E3838</span>, <span class=number>0x265F7979</span>, <span class=number>0xEF628D8D</span>, <span class=number>0x38596161</span>,</span><br><span class=line>    <span class=number>0x95D24747</span>, <span class=number>0x2AA08A8A</span>, <span class=number>0xB1259494</span>, <span class=number>0xAA228888</span>, <span class=number>0x8C7DF1F1</span>, <span class=number>0xD73BECEC</span>,</span><br><span class=line>    <span class=number>0x05010404</span>, <span class=number>0xA5218484</span>, <span class=number>0x9879E1E1</span>, <span class=number>0x9B851E1E</span>, <span class=number>0x84D75353</span>, <span class=number>0x00000000</span>,</span><br><span class=line>    <span class=number>0x5E471919</span>, <span class=number>0x0B565D5D</span>, <span class=number>0xE39D7E7E</span>, <span class=number>0x9FD04F4F</span>, <span class=number>0xBB279C9C</span>, <span class=number>0x1A534949</span>,</span><br><span class=line>    <span class=number>0x7C4D3131</span>, <span class=number>0xEE36D8D8</span>, <span class=number>0x0A020808</span>, <span class=number>0x7BE49F9F</span>, <span class=number>0x20A28282</span>, <span class=number>0xD4C71313</span>,</span><br><span class=line>    <span class=number>0xE8CB2323</span>, <span class=number>0xE69C7A7A</span>, <span class=number>0x42E9ABAB</span>, <span class=number>0x43BDFEFE</span>, <span class=number>0xA2882A2A</span>, <span class=number>0x9AD14B4B</span>,</span><br><span class=line>    <span class=number>0x40410101</span>, <span class=number>0xDBC41F1F</span>, <span class=number>0xD838E0E0</span>, <span class=number>0x61B7D6D6</span>, <span class=number>0x2FA18E8E</span>, <span class=number>0x2BF4DFDF</span>,</span><br><span class=line>    <span class=number>0x3AF1CBCB</span>, <span class=number>0xF6CD3B3B</span>, <span class=number>0x1DFAE7E7</span>, <span class=number>0xE5608585</span>, <span class=number>0x41155454</span>, <span class=number>0x25A38686</span>,</span><br><span class=line>    <span class=number>0x60E38383</span>, <span class=number>0x16ACBABA</span>, <span class=number>0x295C7575</span>, <span class=number>0x34A69292</span>, <span class=number>0xF7996E6E</span>, <span class=number>0xE434D0D0</span>,</span><br><span class=line>    <span class=number>0x721A6868</span>, <span class=number>0x01545555</span>, <span class=number>0x19AFB6B6</span>, <span class=number>0xDF914E4E</span>, <span class=number>0xFA32C8C8</span>, <span class=number>0xF030C0C0</span>,</span><br><span class=line>    <span class=number>0x21F6D7D7</span>, <span class=number>0xBC8E3232</span>, <span class=number>0x75B3C6C6</span>, <span class=number>0x6FE08F8F</span>, <span class=number>0x691D7474</span>, <span class=number>0x2EF5DBDB</span>,</span><br><span class=line>    <span class=number>0x6AE18B8B</span>, <span class=number>0x962EB8B8</span>, <span class=number>0x8A800A0A</span>, <span class=number>0xFE679999</span>, <span class=number>0xE2C92B2B</span>, <span class=number>0xE0618181</span>,</span><br><span class=line>    <span class=number>0xC0C30303</span>, <span class=number>0x8D29A4A4</span>, <span class=number>0xAF238C8C</span>, <span class=number>0x07A9AEAE</span>, <span class=number>0x390D3434</span>, <span class=number>0x1F524D4D</span>,</span><br><span class=line>    <span class=number>0x764F3939</span>, <span class=number>0xD36EBDBD</span>, <span class=number>0x81D65757</span>, <span class=number>0xB7D86F6F</span>, <span class=number>0xEB37DCDC</span>, <span class=number>0x51441515</span>,</span><br><span class=line>    <span class=number>0xA6DD7B7B</span>, <span class=number>0x09FEF7F7</span>, <span class=number>0xB68C3A3A</span>, <span class=number>0x932FBCBC</span>, <span class=number>0x0F030C0C</span>, <span class=number>0x03FCFFFF</span>,</span><br><span class=line>    <span class=number>0xC26BA9A9</span>, <span class=number>0xBA73C9C9</span>, <span class=number>0xD96CB5B5</span>, <span class=number>0xDC6DB1B1</span>, <span class=number>0x375A6D6D</span>, <span class=number>0x15504545</span>,</span><br><span class=line>    <span class=number>0xB98F3636</span>, <span class=number>0x771B6C6C</span>, <span class=number>0x13ADBEBE</span>, <span class=number>0xDA904A4A</span>, <span class=number>0x57B9EEEE</span>, <span class=number>0xA9DE7777</span>,</span><br><span class=line>    <span class=number>0x4CBEF2F2</span>, <span class=number>0x837EFDFD</span>, <span class=number>0x55114444</span>, <span class=number>0xBDDA6767</span>, <span class=number>0x2C5D7171</span>, <span class=number>0x45400505</span>,</span><br><span class=line>    <span class=number>0x631F7C7C</span>, <span class=number>0x50104040</span>, <span class=number>0x325B6969</span>, <span class=number>0xB8DB6363</span>, <span class=number>0x220A2828</span>, <span class=number>0xC5C20707</span>,</span><br><span class=line>    <span class=number>0xF531C4C4</span>, <span class=number>0xA88A2222</span>, <span class=number>0x31A79696</span>, <span class=number>0xF9CE3737</span>, <span class=number>0x977AEDED</span>, <span class=number>0x49BFF6F6</span>,</span><br><span class=line>    <span class=number>0x992DB4B4</span>, <span class=number>0xA475D1D1</span>, <span class=number>0x90D34343</span>, <span class=number>0x5A124848</span>, <span class=number>0x58BAE2E2</span>, <span class=number>0x71E69797</span>,</span><br><span class=line>    <span class=number>0x64B6D2D2</span>, <span class=number>0x70B2C2C2</span>, <span class=number>0xAD8B2626</span>, <span class=number>0xCD68A5A5</span>, <span class=number>0xCB955E5E</span>, <span class=number>0x624B2929</span>,</span><br><span class=line>    <span class=number>0x3C0C3030</span>, <span class=number>0xCE945A5A</span>, <span class=number>0xAB76DDDD</span>, <span class=number>0x867FF9F9</span>, <span class=number>0xF1649595</span>, <span class=number>0x5DBBE6E6</span>,</span><br><span class=line>    <span class=number>0x35F2C7C7</span>, <span class=number>0x2D092424</span>, <span class=number>0xD1C61717</span>, <span class=number>0xD66FB9B9</span>, <span class=number>0xDEC51B1B</span>, <span class=number>0x94861212</span>,</span><br><span class=line>    <span class=number>0x78186060</span>, <span class=number>0x30F3C3C3</span>, <span class=number>0x897CF5F5</span>, <span class=number>0x5CEFB3B3</span>, <span class=number>0xD23AE8E8</span>, <span class=number>0xACDF7373</span>,</span><br><span class=line>    <span class=number>0x794C3535</span>, <span class=number>0xA0208080</span>, <span class=number>0x9D78E5E5</span>, <span class=number>0x56EDBBBB</span>, <span class=number>0x235E7D7D</span>, <span class=number>0xC63EF8F8</span>,</span><br><span class=line>    <span class=number>0x8BD45F5F</span>, <span class=number>0xE7C82F2F</span>, <span class=number>0xDD39E4E4</span>, <span class=number>0x68492121</span>};</span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>uint32_t</span> SM4_SBOX_T1[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0x5B8ED55B</span>, <span class=number>0x42D09242</span>, <span class=number>0xA74DEAA7</span>, <span class=number>0xFB06FDFB</span>, <span class=number>0x33FCCF33</span>, <span class=number>0x8765E287</span>,</span><br><span class=line>    <span class=number>0xF4C93DF4</span>, <span class=number>0xDE6BB5DE</span>, <span class=number>0x584E1658</span>, <span class=number>0xDA6EB4DA</span>, <span class=number>0x50441450</span>, <span class=number>0x0BCAC10B</span>,</span><br><span class=line>    <span class=number>0xA08828A0</span>, <span class=number>0xEF17F8EF</span>, <span class=number>0xB09C2CB0</span>, <span class=number>0x14110514</span>, <span class=number>0xAC872BAC</span>, <span class=number>0x9DFB669D</span>,</span><br><span class=line>    <span class=number>0x6AF2986A</span>, <span class=number>0xD9AE77D9</span>, <span class=number>0xA8822AA8</span>, <span class=number>0xFA46BCFA</span>, <span class=number>0x10140410</span>, <span class=number>0x0FCFC00F</span>,</span><br><span class=line>    <span class=number>0xAA02A8AA</span>, <span class=number>0x11544511</span>, <span class=number>0x4C5F134C</span>, <span class=number>0x98BE2698</span>, <span class=number>0x256D4825</span>, <span class=number>0x1A9E841A</span>,</span><br><span class=line>    <span class=number>0x181E0618</span>, <span class=number>0x66FD9B66</span>, <span class=number>0x72EC9E72</span>, <span class=number>0x094A4309</span>, <span class=number>0x41105141</span>, <span class=number>0xD324F7D3</span>,</span><br><span class=line>    <span class=number>0x46D59346</span>, <span class=number>0xBF53ECBF</span>, <span class=number>0x62F89A62</span>, <span class=number>0xE9927BE9</span>, <span class=number>0xCCFF33CC</span>, <span class=number>0x51045551</span>,</span><br><span class=line>    <span class=number>0x2C270B2C</span>, <span class=number>0x0D4F420D</span>, <span class=number>0xB759EEB7</span>, <span class=number>0x3FF3CC3F</span>, <span class=number>0xB21CAEB2</span>, <span class=number>0x89EA6389</span>,</span><br><span class=line>    <span class=number>0x9374E793</span>, <span class=number>0xCE7FB1CE</span>, <span class=number>0x706C1C70</span>, <span class=number>0xA60DABA6</span>, <span class=number>0x27EDCA27</span>, <span class=number>0x20280820</span>,</span><br><span class=line>    <span class=number>0xA348EBA3</span>, <span class=number>0x56C19756</span>, <span class=number>0x02808202</span>, <span class=number>0x7FA3DC7F</span>, <span class=number>0x52C49652</span>, <span class=number>0xEB12F9EB</span>,</span><br><span class=line>    <span class=number>0xD5A174D5</span>, <span class=number>0x3EB38D3E</span>, <span class=number>0xFCC33FFC</span>, <span class=number>0x9A3EA49A</span>, <span class=number>0x1D5B461D</span>, <span class=number>0x1C1B071C</span>,</span><br><span class=line>    <span class=number>0x9E3BA59E</span>, <span class=number>0xF30CFFF3</span>, <span class=number>0xCF3FF0CF</span>, <span class=number>0xCDBF72CD</span>, <span class=number>0x5C4B175C</span>, <span class=number>0xEA52B8EA</span>,</span><br><span class=line>    <span class=number>0x0E8F810E</span>, <span class=number>0x653D5865</span>, <span class=number>0xF0CC3CF0</span>, <span class=number>0x647D1964</span>, <span class=number>0x9B7EE59B</span>, <span class=number>0x16918716</span>,</span><br><span class=line>    <span class=number>0x3D734E3D</span>, <span class=number>0xA208AAA2</span>, <span class=number>0xA1C869A1</span>, <span class=number>0xADC76AAD</span>, <span class=number>0x06858306</span>, <span class=number>0xCA7AB0CA</span>,</span><br><span class=line>    <span class=number>0xC5B570C5</span>, <span class=number>0x91F46591</span>, <span class=number>0x6BB2D96B</span>, <span class=number>0x2EA7892E</span>, <span class=number>0xE318FBE3</span>, <span class=number>0xAF47E8AF</span>,</span><br><span class=line>    <span class=number>0x3C330F3C</span>, <span class=number>0x2D674A2D</span>, <span class=number>0xC1B071C1</span>, <span class=number>0x590E5759</span>, <span class=number>0x76E99F76</span>, <span class=number>0xD4E135D4</span>,</span><br><span class=line>    <span class=number>0x78661E78</span>, <span class=number>0x90B42490</span>, <span class=number>0x38360E38</span>, <span class=number>0x79265F79</span>, <span class=number>0x8DEF628D</span>, <span class=number>0x61385961</span>,</span><br><span class=line>    <span class=number>0x4795D247</span>, <span class=number>0x8A2AA08A</span>, <span class=number>0x94B12594</span>, <span class=number>0x88AA2288</span>, <span class=number>0xF18C7DF1</span>, <span class=number>0xECD73BEC</span>,</span><br><span class=line>    <span class=number>0x04050104</span>, <span class=number>0x84A52184</span>, <span class=number>0xE19879E1</span>, <span class=number>0x1E9B851E</span>, <span class=number>0x5384D753</span>, <span class=number>0x00000000</span>,</span><br><span class=line>    <span class=number>0x195E4719</span>, <span class=number>0x5D0B565D</span>, <span class=number>0x7EE39D7E</span>, <span class=number>0x4F9FD04F</span>, <span class=number>0x9CBB279C</span>, <span class=number>0x491A5349</span>,</span><br><span class=line>    <span class=number>0x317C4D31</span>, <span class=number>0xD8EE36D8</span>, <span class=number>0x080A0208</span>, <span class=number>0x9F7BE49F</span>, <span class=number>0x8220A282</span>, <span class=number>0x13D4C713</span>,</span><br><span class=line>    <span class=number>0x23E8CB23</span>, <span class=number>0x7AE69C7A</span>, <span class=number>0xAB42E9AB</span>, <span class=number>0xFE43BDFE</span>, <span class=number>0x2AA2882A</span>, <span class=number>0x4B9AD14B</span>,</span><br><span class=line>    <span class=number>0x01404101</span>, <span class=number>0x1FDBC41F</span>, <span class=number>0xE0D838E0</span>, <span class=number>0xD661B7D6</span>, <span class=number>0x8E2FA18E</span>, <span class=number>0xDF2BF4DF</span>,</span><br><span class=line>    <span class=number>0xCB3AF1CB</span>, <span class=number>0x3BF6CD3B</span>, <span class=number>0xE71DFAE7</span>, <span class=number>0x85E56085</span>, <span class=number>0x54411554</span>, <span class=number>0x8625A386</span>,</span><br><span class=line>    <span class=number>0x8360E383</span>, <span class=number>0xBA16ACBA</span>, <span class=number>0x75295C75</span>, <span class=number>0x9234A692</span>, <span class=number>0x6EF7996E</span>, <span class=number>0xD0E434D0</span>,</span><br><span class=line>    <span class=number>0x68721A68</span>, <span class=number>0x55015455</span>, <span class=number>0xB619AFB6</span>, <span class=number>0x4EDF914E</span>, <span class=number>0xC8FA32C8</span>, <span class=number>0xC0F030C0</span>,</span><br><span class=line>    <span class=number>0xD721F6D7</span>, <span class=number>0x32BC8E32</span>, <span class=number>0xC675B3C6</span>, <span class=number>0x8F6FE08F</span>, <span class=number>0x74691D74</span>, <span class=number>0xDB2EF5DB</span>,</span><br><span class=line>    <span class=number>0x8B6AE18B</span>, <span class=number>0xB8962EB8</span>, <span class=number>0x0A8A800A</span>, <span class=number>0x99FE6799</span>, <span class=number>0x2BE2C92B</span>, <span class=number>0x81E06181</span>,</span><br><span class=line>    <span class=number>0x03C0C303</span>, <span class=number>0xA48D29A4</span>, <span class=number>0x8CAF238C</span>, <span class=number>0xAE07A9AE</span>, <span class=number>0x34390D34</span>, <span class=number>0x4D1F524D</span>,</span><br><span class=line>    <span class=number>0x39764F39</span>, <span class=number>0xBDD36EBD</span>, <span class=number>0x5781D657</span>, <span class=number>0x6FB7D86F</span>, <span class=number>0xDCEB37DC</span>, <span class=number>0x15514415</span>,</span><br><span class=line>    <span class=number>0x7BA6DD7B</span>, <span class=number>0xF709FEF7</span>, <span class=number>0x3AB68C3A</span>, <span class=number>0xBC932FBC</span>, <span class=number>0x0C0F030C</span>, <span class=number>0xFF03FCFF</span>,</span><br><span class=line>    <span class=number>0xA9C26BA9</span>, <span class=number>0xC9BA73C9</span>, <span class=number>0xB5D96CB5</span>, <span class=number>0xB1DC6DB1</span>, <span class=number>0x6D375A6D</span>, <span class=number>0x45155045</span>,</span><br><span class=line>    <span class=number>0x36B98F36</span>, <span class=number>0x6C771B6C</span>, <span class=number>0xBE13ADBE</span>, <span class=number>0x4ADA904A</span>, <span class=number>0xEE57B9EE</span>, <span class=number>0x77A9DE77</span>,</span><br><span class=line>    <span class=number>0xF24CBEF2</span>, <span class=number>0xFD837EFD</span>, <span class=number>0x44551144</span>, <span class=number>0x67BDDA67</span>, <span class=number>0x712C5D71</span>, <span class=number>0x05454005</span>,</span><br><span class=line>    <span class=number>0x7C631F7C</span>, <span class=number>0x40501040</span>, <span class=number>0x69325B69</span>, <span class=number>0x63B8DB63</span>, <span class=number>0x28220A28</span>, <span class=number>0x07C5C207</span>,</span><br><span class=line>    <span class=number>0xC4F531C4</span>, <span class=number>0x22A88A22</span>, <span class=number>0x9631A796</span>, <span class=number>0x37F9CE37</span>, <span class=number>0xED977AED</span>, <span class=number>0xF649BFF6</span>,</span><br><span class=line>    <span class=number>0xB4992DB4</span>, <span class=number>0xD1A475D1</span>, <span class=number>0x4390D343</span>, <span class=number>0x485A1248</span>, <span class=number>0xE258BAE2</span>, <span class=number>0x9771E697</span>,</span><br><span class=line>    <span class=number>0xD264B6D2</span>, <span class=number>0xC270B2C2</span>, <span class=number>0x26AD8B26</span>, <span class=number>0xA5CD68A5</span>, <span class=number>0x5ECB955E</span>, <span class=number>0x29624B29</span>,</span><br><span class=line>    <span class=number>0x303C0C30</span>, <span class=number>0x5ACE945A</span>, <span class=number>0xDDAB76DD</span>, <span class=number>0xF9867FF9</span>, <span class=number>0x95F16495</span>, <span class=number>0xE65DBBE6</span>,</span><br><span class=line>    <span class=number>0xC735F2C7</span>, <span class=number>0x242D0924</span>, <span class=number>0x17D1C617</span>, <span class=number>0xB9D66FB9</span>, <span class=number>0x1BDEC51B</span>, <span class=number>0x12948612</span>,</span><br><span class=line>    <span class=number>0x60781860</span>, <span class=number>0xC330F3C3</span>, <span class=number>0xF5897CF5</span>, <span class=number>0xB35CEFB3</span>, <span class=number>0xE8D23AE8</span>, <span class=number>0x73ACDF73</span>,</span><br><span class=line>    <span class=number>0x35794C35</span>, <span class=number>0x80A02080</span>, <span class=number>0xE59D78E5</span>, <span class=number>0xBB56EDBB</span>, <span class=number>0x7D235E7D</span>, <span class=number>0xF8C63EF8</span>,</span><br><span class=line>    <span class=number>0x5F8BD45F</span>, <span class=number>0x2FE7C82F</span>, <span class=number>0xE4DD39E4</span>, <span class=number>0x21684921</span>};</span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>uint32_t</span> SM4_SBOX_T2[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0x5B5B8ED5</span>, <span class=number>0x4242D092</span>, <span class=number>0xA7A74DEA</span>, <span class=number>0xFBFB06FD</span>, <span class=number>0x3333FCCF</span>, <span class=number>0x878765E2</span>,</span><br><span class=line>    <span class=number>0xF4F4C93D</span>, <span class=number>0xDEDE6BB5</span>, <span class=number>0x58584E16</span>, <span class=number>0xDADA6EB4</span>, <span class=number>0x50504414</span>, <span class=number>0x0B0BCAC1</span>,</span><br><span class=line>    <span class=number>0xA0A08828</span>, <span class=number>0xEFEF17F8</span>, <span class=number>0xB0B09C2C</span>, <span class=number>0x14141105</span>, <span class=number>0xACAC872B</span>, <span class=number>0x9D9DFB66</span>,</span><br><span class=line>    <span class=number>0x6A6AF298</span>, <span class=number>0xD9D9AE77</span>, <span class=number>0xA8A8822A</span>, <span class=number>0xFAFA46BC</span>, <span class=number>0x10101404</span>, <span class=number>0x0F0FCFC0</span>,</span><br><span class=line>    <span class=number>0xAAAA02A8</span>, <span class=number>0x11115445</span>, <span class=number>0x4C4C5F13</span>, <span class=number>0x9898BE26</span>, <span class=number>0x25256D48</span>, <span class=number>0x1A1A9E84</span>,</span><br><span class=line>    <span class=number>0x18181E06</span>, <span class=number>0x6666FD9B</span>, <span class=number>0x7272EC9E</span>, <span class=number>0x09094A43</span>, <span class=number>0x41411051</span>, <span class=number>0xD3D324F7</span>,</span><br><span class=line>    <span class=number>0x4646D593</span>, <span class=number>0xBFBF53EC</span>, <span class=number>0x6262F89A</span>, <span class=number>0xE9E9927B</span>, <span class=number>0xCCCCFF33</span>, <span class=number>0x51510455</span>,</span><br><span class=line>    <span class=number>0x2C2C270B</span>, <span class=number>0x0D0D4F42</span>, <span class=number>0xB7B759EE</span>, <span class=number>0x3F3FF3CC</span>, <span class=number>0xB2B21CAE</span>, <span class=number>0x8989EA63</span>,</span><br><span class=line>    <span class=number>0x939374E7</span>, <span class=number>0xCECE7FB1</span>, <span class=number>0x70706C1C</span>, <span class=number>0xA6A60DAB</span>, <span class=number>0x2727EDCA</span>, <span class=number>0x20202808</span>,</span><br><span class=line>    <span class=number>0xA3A348EB</span>, <span class=number>0x5656C197</span>, <span class=number>0x02028082</span>, <span class=number>0x7F7FA3DC</span>, <span class=number>0x5252C496</span>, <span class=number>0xEBEB12F9</span>,</span><br><span class=line>    <span class=number>0xD5D5A174</span>, <span class=number>0x3E3EB38D</span>, <span class=number>0xFCFCC33F</span>, <span class=number>0x9A9A3EA4</span>, <span class=number>0x1D1D5B46</span>, <span class=number>0x1C1C1B07</span>,</span><br><span class=line>    <span class=number>0x9E9E3BA5</span>, <span class=number>0xF3F30CFF</span>, <span class=number>0xCFCF3FF0</span>, <span class=number>0xCDCDBF72</span>, <span class=number>0x5C5C4B17</span>, <span class=number>0xEAEA52B8</span>,</span><br><span class=line>    <span class=number>0x0E0E8F81</span>, <span class=number>0x65653D58</span>, <span class=number>0xF0F0CC3C</span>, <span class=number>0x64647D19</span>, <span class=number>0x9B9B7EE5</span>, <span class=number>0x16169187</span>,</span><br><span class=line>    <span class=number>0x3D3D734E</span>, <span class=number>0xA2A208AA</span>, <span class=number>0xA1A1C869</span>, <span class=number>0xADADC76A</span>, <span class=number>0x06068583</span>, <span class=number>0xCACA7AB0</span>,</span><br><span class=line>    <span class=number>0xC5C5B570</span>, <span class=number>0x9191F465</span>, <span class=number>0x6B6BB2D9</span>, <span class=number>0x2E2EA789</span>, <span class=number>0xE3E318FB</span>, <span class=number>0xAFAF47E8</span>,</span><br><span class=line>    <span class=number>0x3C3C330F</span>, <span class=number>0x2D2D674A</span>, <span class=number>0xC1C1B071</span>, <span class=number>0x59590E57</span>, <span class=number>0x7676E99F</span>, <span class=number>0xD4D4E135</span>,</span><br><span class=line>    <span class=number>0x7878661E</span>, <span class=number>0x9090B424</span>, <span class=number>0x3838360E</span>, <span class=number>0x7979265F</span>, <span class=number>0x8D8DEF62</span>, <span class=number>0x61613859</span>,</span><br><span class=line>    <span class=number>0x474795D2</span>, <span class=number>0x8A8A2AA0</span>, <span class=number>0x9494B125</span>, <span class=number>0x8888AA22</span>, <span class=number>0xF1F18C7D</span>, <span class=number>0xECECD73B</span>,</span><br><span class=line>    <span class=number>0x04040501</span>, <span class=number>0x8484A521</span>, <span class=number>0xE1E19879</span>, <span class=number>0x1E1E9B85</span>, <span class=number>0x535384D7</span>, <span class=number>0x00000000</span>,</span><br><span class=line>    <span class=number>0x19195E47</span>, <span class=number>0x5D5D0B56</span>, <span class=number>0x7E7EE39D</span>, <span class=number>0x4F4F9FD0</span>, <span class=number>0x9C9CBB27</span>, <span class=number>0x49491A53</span>,</span><br><span class=line>    <span class=number>0x31317C4D</span>, <span class=number>0xD8D8EE36</span>, <span class=number>0x08080A02</span>, <span class=number>0x9F9F7BE4</span>, <span class=number>0x828220A2</span>, <span class=number>0x1313D4C7</span>,</span><br><span class=line>    <span class=number>0x2323E8CB</span>, <span class=number>0x7A7AE69C</span>, <span class=number>0xABAB42E9</span>, <span class=number>0xFEFE43BD</span>, <span class=number>0x2A2AA288</span>, <span class=number>0x4B4B9AD1</span>,</span><br><span class=line>    <span class=number>0x01014041</span>, <span class=number>0x1F1FDBC4</span>, <span class=number>0xE0E0D838</span>, <span class=number>0xD6D661B7</span>, <span class=number>0x8E8E2FA1</span>, <span class=number>0xDFDF2BF4</span>,</span><br><span class=line>    <span class=number>0xCBCB3AF1</span>, <span class=number>0x3B3BF6CD</span>, <span class=number>0xE7E71DFA</span>, <span class=number>0x8585E560</span>, <span class=number>0x54544115</span>, <span class=number>0x868625A3</span>,</span><br><span class=line>    <span class=number>0x838360E3</span>, <span class=number>0xBABA16AC</span>, <span class=number>0x7575295C</span>, <span class=number>0x929234A6</span>, <span class=number>0x6E6EF799</span>, <span class=number>0xD0D0E434</span>,</span><br><span class=line>    <span class=number>0x6868721A</span>, <span class=number>0x55550154</span>, <span class=number>0xB6B619AF</span>, <span class=number>0x4E4EDF91</span>, <span class=number>0xC8C8FA32</span>, <span class=number>0xC0C0F030</span>,</span><br><span class=line>    <span class=number>0xD7D721F6</span>, <span class=number>0x3232BC8E</span>, <span class=number>0xC6C675B3</span>, <span class=number>0x8F8F6FE0</span>, <span class=number>0x7474691D</span>, <span class=number>0xDBDB2EF5</span>,</span><br><span class=line>    <span class=number>0x8B8B6AE1</span>, <span class=number>0xB8B8962E</span>, <span class=number>0x0A0A8A80</span>, <span class=number>0x9999FE67</span>, <span class=number>0x2B2BE2C9</span>, <span class=number>0x8181E061</span>,</span><br><span class=line>    <span class=number>0x0303C0C3</span>, <span class=number>0xA4A48D29</span>, <span class=number>0x8C8CAF23</span>, <span class=number>0xAEAE07A9</span>, <span class=number>0x3434390D</span>, <span class=number>0x4D4D1F52</span>,</span><br><span class=line>    <span class=number>0x3939764F</span>, <span class=number>0xBDBDD36E</span>, <span class=number>0x575781D6</span>, <span class=number>0x6F6FB7D8</span>, <span class=number>0xDCDCEB37</span>, <span class=number>0x15155144</span>,</span><br><span class=line>    <span class=number>0x7B7BA6DD</span>, <span class=number>0xF7F709FE</span>, <span class=number>0x3A3AB68C</span>, <span class=number>0xBCBC932F</span>, <span class=number>0x0C0C0F03</span>, <span class=number>0xFFFF03FC</span>,</span><br><span class=line>    <span class=number>0xA9A9C26B</span>, <span class=number>0xC9C9BA73</span>, <span class=number>0xB5B5D96C</span>, <span class=number>0xB1B1DC6D</span>, <span class=number>0x6D6D375A</span>, <span class=number>0x45451550</span>,</span><br><span class=line>    <span class=number>0x3636B98F</span>, <span class=number>0x6C6C771B</span>, <span class=number>0xBEBE13AD</span>, <span class=number>0x4A4ADA90</span>, <span class=number>0xEEEE57B9</span>, <span class=number>0x7777A9DE</span>,</span><br><span class=line>    <span class=number>0xF2F24CBE</span>, <span class=number>0xFDFD837E</span>, <span class=number>0x44445511</span>, <span class=number>0x6767BDDA</span>, <span class=number>0x71712C5D</span>, <span class=number>0x05054540</span>,</span><br><span class=line>    <span class=number>0x7C7C631F</span>, <span class=number>0x40405010</span>, <span class=number>0x6969325B</span>, <span class=number>0x6363B8DB</span>, <span class=number>0x2828220A</span>, <span class=number>0x0707C5C2</span>,</span><br><span class=line>    <span class=number>0xC4C4F531</span>, <span class=number>0x2222A88A</span>, <span class=number>0x969631A7</span>, <span class=number>0x3737F9CE</span>, <span class=number>0xEDED977A</span>, <span class=number>0xF6F649BF</span>,</span><br><span class=line>    <span class=number>0xB4B4992D</span>, <span class=number>0xD1D1A475</span>, <span class=number>0x434390D3</span>, <span class=number>0x48485A12</span>, <span class=number>0xE2E258BA</span>, <span class=number>0x979771E6</span>,</span><br><span class=line>    <span class=number>0xD2D264B6</span>, <span class=number>0xC2C270B2</span>, <span class=number>0x2626AD8B</span>, <span class=number>0xA5A5CD68</span>, <span class=number>0x5E5ECB95</span>, <span class=number>0x2929624B</span>,</span><br><span class=line>    <span class=number>0x30303C0C</span>, <span class=number>0x5A5ACE94</span>, <span class=number>0xDDDDAB76</span>, <span class=number>0xF9F9867F</span>, <span class=number>0x9595F164</span>, <span class=number>0xE6E65DBB</span>,</span><br><span class=line>    <span class=number>0xC7C735F2</span>, <span class=number>0x24242D09</span>, <span class=number>0x1717D1C6</span>, <span class=number>0xB9B9D66F</span>, <span class=number>0x1B1BDEC5</span>, <span class=number>0x12129486</span>,</span><br><span class=line>    <span class=number>0x60607818</span>, <span class=number>0xC3C330F3</span>, <span class=number>0xF5F5897C</span>, <span class=number>0xB3B35CEF</span>, <span class=number>0xE8E8D23A</span>, <span class=number>0x7373ACDF</span>,</span><br><span class=line>    <span class=number>0x3535794C</span>, <span class=number>0x8080A020</span>, <span class=number>0xE5E59D78</span>, <span class=number>0xBBBB56ED</span>, <span class=number>0x7D7D235E</span>, <span class=number>0xF8F8C63E</span>,</span><br><span class=line>    <span class=number>0x5F5F8BD4</span>, <span class=number>0x2F2FE7C8</span>, <span class=number>0xE4E4DD39</span>, <span class=number>0x21216849</span>};</span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>uint32_t</span> SM4_SBOX_T3[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0xD55B5B8E</span>, <span class=number>0x924242D0</span>, <span class=number>0xEAA7A74D</span>, <span class=number>0xFDFBFB06</span>, <span class=number>0xCF3333FC</span>, <span class=number>0xE2878765</span>,</span><br><span class=line>    <span class=number>0x3DF4F4C9</span>, <span class=number>0xB5DEDE6B</span>, <span class=number>0x1658584E</span>, <span class=number>0xB4DADA6E</span>, <span class=number>0x14505044</span>, <span class=number>0xC10B0BCA</span>,</span><br><span class=line>    <span class=number>0x28A0A088</span>, <span class=number>0xF8EFEF17</span>, <span class=number>0x2CB0B09C</span>, <span class=number>0x05141411</span>, <span class=number>0x2BACAC87</span>, <span class=number>0x669D9DFB</span>,</span><br><span class=line>    <span class=number>0x986A6AF2</span>, <span class=number>0x77D9D9AE</span>, <span class=number>0x2AA8A882</span>, <span class=number>0xBCFAFA46</span>, <span class=number>0x04101014</span>, <span class=number>0xC00F0FCF</span>,</span><br><span class=line>    <span class=number>0xA8AAAA02</span>, <span class=number>0x45111154</span>, <span class=number>0x134C4C5F</span>, <span class=number>0x269898BE</span>, <span class=number>0x4825256D</span>, <span class=number>0x841A1A9E</span>,</span><br><span class=line>    <span class=number>0x0618181E</span>, <span class=number>0x9B6666FD</span>, <span class=number>0x9E7272EC</span>, <span class=number>0x4309094A</span>, <span class=number>0x51414110</span>, <span class=number>0xF7D3D324</span>,</span><br><span class=line>    <span class=number>0x934646D5</span>, <span class=number>0xECBFBF53</span>, <span class=number>0x9A6262F8</span>, <span class=number>0x7BE9E992</span>, <span class=number>0x33CCCCFF</span>, <span class=number>0x55515104</span>,</span><br><span class=line>    <span class=number>0x0B2C2C27</span>, <span class=number>0x420D0D4F</span>, <span class=number>0xEEB7B759</span>, <span class=number>0xCC3F3FF3</span>, <span class=number>0xAEB2B21C</span>, <span class=number>0x638989EA</span>,</span><br><span class=line>    <span class=number>0xE7939374</span>, <span class=number>0xB1CECE7F</span>, <span class=number>0x1C70706C</span>, <span class=number>0xABA6A60D</span>, <span class=number>0xCA2727ED</span>, <span class=number>0x08202028</span>,</span><br><span class=line>    <span class=number>0xEBA3A348</span>, <span class=number>0x975656C1</span>, <span class=number>0x82020280</span>, <span class=number>0xDC7F7FA3</span>, <span class=number>0x965252C4</span>, <span class=number>0xF9EBEB12</span>,</span><br><span class=line>    <span class=number>0x74D5D5A1</span>, <span class=number>0x8D3E3EB3</span>, <span class=number>0x3FFCFCC3</span>, <span class=number>0xA49A9A3E</span>, <span class=number>0x461D1D5B</span>, <span class=number>0x071C1C1B</span>,</span><br><span class=line>    <span class=number>0xA59E9E3B</span>, <span class=number>0xFFF3F30C</span>, <span class=number>0xF0CFCF3F</span>, <span class=number>0x72CDCDBF</span>, <span class=number>0x175C5C4B</span>, <span class=number>0xB8EAEA52</span>,</span><br><span class=line>    <span class=number>0x810E0E8F</span>, <span class=number>0x5865653D</span>, <span class=number>0x3CF0F0CC</span>, <span class=number>0x1964647D</span>, <span class=number>0xE59B9B7E</span>, <span class=number>0x87161691</span>,</span><br><span class=line>    <span class=number>0x4E3D3D73</span>, <span class=number>0xAAA2A208</span>, <span class=number>0x69A1A1C8</span>, <span class=number>0x6AADADC7</span>, <span class=number>0x83060685</span>, <span class=number>0xB0CACA7A</span>,</span><br><span class=line>    <span class=number>0x70C5C5B5</span>, <span class=number>0x659191F4</span>, <span class=number>0xD96B6BB2</span>, <span class=number>0x892E2EA7</span>, <span class=number>0xFBE3E318</span>, <span class=number>0xE8AFAF47</span>,</span><br><span class=line>    <span class=number>0x0F3C3C33</span>, <span class=number>0x4A2D2D67</span>, <span class=number>0x71C1C1B0</span>, <span class=number>0x5759590E</span>, <span class=number>0x9F7676E9</span>, <span class=number>0x35D4D4E1</span>,</span><br><span class=line>    <span class=number>0x1E787866</span>, <span class=number>0x249090B4</span>, <span class=number>0x0E383836</span>, <span class=number>0x5F797926</span>, <span class=number>0x628D8DEF</span>, <span class=number>0x59616138</span>,</span><br><span class=line>    <span class=number>0xD2474795</span>, <span class=number>0xA08A8A2A</span>, <span class=number>0x259494B1</span>, <span class=number>0x228888AA</span>, <span class=number>0x7DF1F18C</span>, <span class=number>0x3BECECD7</span>,</span><br><span class=line>    <span class=number>0x01040405</span>, <span class=number>0x218484A5</span>, <span class=number>0x79E1E198</span>, <span class=number>0x851E1E9B</span>, <span class=number>0xD7535384</span>, <span class=number>0x00000000</span>,</span><br><span class=line>    <span class=number>0x4719195E</span>, <span class=number>0x565D5D0B</span>, <span class=number>0x9D7E7EE3</span>, <span class=number>0xD04F4F9F</span>, <span class=number>0x279C9CBB</span>, <span class=number>0x5349491A</span>,</span><br><span class=line>    <span class=number>0x4D31317C</span>, <span class=number>0x36D8D8EE</span>, <span class=number>0x0208080A</span>, <span class=number>0xE49F9F7B</span>, <span class=number>0xA2828220</span>, <span class=number>0xC71313D4</span>,</span><br><span class=line>    <span class=number>0xCB2323E8</span>, <span class=number>0x9C7A7AE6</span>, <span class=number>0xE9ABAB42</span>, <span class=number>0xBDFEFE43</span>, <span class=number>0x882A2AA2</span>, <span class=number>0xD14B4B9A</span>,</span><br><span class=line>    <span class=number>0x41010140</span>, <span class=number>0xC41F1FDB</span>, <span class=number>0x38E0E0D8</span>, <span class=number>0xB7D6D661</span>, <span class=number>0xA18E8E2F</span>, <span class=number>0xF4DFDF2B</span>,</span><br><span class=line>    <span class=number>0xF1CBCB3A</span>, <span class=number>0xCD3B3BF6</span>, <span class=number>0xFAE7E71D</span>, <span class=number>0x608585E5</span>, <span class=number>0x15545441</span>, <span class=number>0xA3868625</span>,</span><br><span class=line>    <span class=number>0xE3838360</span>, <span class=number>0xACBABA16</span>, <span class=number>0x5C757529</span>, <span class=number>0xA6929234</span>, <span class=number>0x996E6EF7</span>, <span class=number>0x34D0D0E4</span>,</span><br><span class=line>    <span class=number>0x1A686872</span>, <span class=number>0x54555501</span>, <span class=number>0xAFB6B619</span>, <span class=number>0x914E4EDF</span>, <span class=number>0x32C8C8FA</span>, <span class=number>0x30C0C0F0</span>,</span><br><span class=line>    <span class=number>0xF6D7D721</span>, <span class=number>0x8E3232BC</span>, <span class=number>0xB3C6C675</span>, <span class=number>0xE08F8F6F</span>, <span class=number>0x1D747469</span>, <span class=number>0xF5DBDB2E</span>,</span><br><span class=line>    <span class=number>0xE18B8B6A</span>, <span class=number>0x2EB8B896</span>, <span class=number>0x800A0A8A</span>, <span class=number>0x679999FE</span>, <span class=number>0xC92B2BE2</span>, <span class=number>0x618181E0</span>,</span><br><span class=line>    <span class=number>0xC30303C0</span>, <span class=number>0x29A4A48D</span>, <span class=number>0x238C8CAF</span>, <span class=number>0xA9AEAE07</span>, <span class=number>0x0D343439</span>, <span class=number>0x524D4D1F</span>,</span><br><span class=line>    <span class=number>0x4F393976</span>, <span class=number>0x6EBDBDD3</span>, <span class=number>0xD6575781</span>, <span class=number>0xD86F6FB7</span>, <span class=number>0x37DCDCEB</span>, <span class=number>0x44151551</span>,</span><br><span class=line>    <span class=number>0xDD7B7BA6</span>, <span class=number>0xFEF7F709</span>, <span class=number>0x8C3A3AB6</span>, <span class=number>0x2FBCBC93</span>, <span class=number>0x030C0C0F</span>, <span class=number>0xFCFFFF03</span>,</span><br><span class=line>    <span class=number>0x6BA9A9C2</span>, <span class=number>0x73C9C9BA</span>, <span class=number>0x6CB5B5D9</span>, <span class=number>0x6DB1B1DC</span>, <span class=number>0x5A6D6D37</span>, <span class=number>0x50454515</span>,</span><br><span class=line>    <span class=number>0x8F3636B9</span>, <span class=number>0x1B6C6C77</span>, <span class=number>0xADBEBE13</span>, <span class=number>0x904A4ADA</span>, <span class=number>0xB9EEEE57</span>, <span class=number>0xDE7777A9</span>,</span><br><span class=line>    <span class=number>0xBEF2F24C</span>, <span class=number>0x7EFDFD83</span>, <span class=number>0x11444455</span>, <span class=number>0xDA6767BD</span>, <span class=number>0x5D71712C</span>, <span class=number>0x40050545</span>,</span><br><span class=line>    <span class=number>0x1F7C7C63</span>, <span class=number>0x10404050</span>, <span class=number>0x5B696932</span>, <span class=number>0xDB6363B8</span>, <span class=number>0x0A282822</span>, <span class=number>0xC20707C5</span>,</span><br><span class=line>    <span class=number>0x31C4C4F5</span>, <span class=number>0x8A2222A8</span>, <span class=number>0xA7969631</span>, <span class=number>0xCE3737F9</span>, <span class=number>0x7AEDED97</span>, <span class=number>0xBFF6F649</span>,</span><br><span class=line>    <span class=number>0x2DB4B499</span>, <span class=number>0x75D1D1A4</span>, <span class=number>0xD3434390</span>, <span class=number>0x1248485A</span>, <span class=number>0xBAE2E258</span>, <span class=number>0xE6979771</span>,</span><br><span class=line>    <span class=number>0xB6D2D264</span>, <span class=number>0xB2C2C270</span>, <span class=number>0x8B2626AD</span>, <span class=number>0x68A5A5CD</span>, <span class=number>0x955E5ECB</span>, <span class=number>0x4B292962</span>,</span><br><span class=line>    <span class=number>0x0C30303C</span>, <span class=number>0x945A5ACE</span>, <span class=number>0x76DDDDAB</span>, <span class=number>0x7FF9F986</span>, <span class=number>0x649595F1</span>, <span class=number>0xBBE6E65D</span>,</span><br><span class=line>    <span class=number>0xF2C7C735</span>, <span class=number>0x0924242D</span>, <span class=number>0xC61717D1</span>, <span class=number>0x6FB9B9D6</span>, <span class=number>0xC51B1BDE</span>, <span class=number>0x86121294</span>,</span><br><span class=line>    <span class=number>0x18606078</span>, <span class=number>0xF3C3C330</span>, <span class=number>0x7CF5F589</span>, <span class=number>0xEFB3B35C</span>, <span class=number>0x3AE8E8D2</span>, <span class=number>0xDF7373AC</span>,</span><br><span class=line>    <span class=number>0x4C353579</span>, <span class=number>0x208080A0</span>, <span class=number>0x78E5E59D</span>, <span class=number>0xEDBBBB56</span>, <span class=number>0x5E7D7D23</span>, <span class=number>0x3EF8F8C6</span>,</span><br><span class=line>    <span class=number>0xD45F5F8B</span>, <span class=number>0xC82F2FE7</span>, <span class=number>0x39E4E4DD</span>, <span class=number>0x49212168</span>};</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>rotl</span><span class=params>(<span class=type>uint32_t</span> a, <span class=type>uint8_t</span> n)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>return</span> (a &lt;&lt; n) | (a &gt;&gt; (<span class=number>32</span> - n));</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>load_u32_be</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *b, <span class=type>uint32_t</span> n)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>return</span> ((<span class=type>uint32_t</span>)b[<span class=number>4</span> * n] &lt;&lt; <span class=number>24</span>) |</span><br><span class=line>           ((<span class=type>uint32_t</span>)b[<span class=number>4</span> * n + <span class=number>1</span>] &lt;&lt; <span class=number>16</span>) |</span><br><span class=line>           ((<span class=type>uint32_t</span>)b[<span class=number>4</span> * n + <span class=number>2</span>] &lt;&lt; <span class=number>8</span>) |</span><br><span class=line>           ((<span class=type>uint32_t</span>)b[<span class=number>4</span> * n + <span class=number>3</span>]);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>void</span> <span class=title>store_u32_be</span><span class=params>(<span class=type>uint32_t</span> v, <span class=type>uint8_t</span> *b)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    b[<span class=number>0</span>] = (<span class=type>uint8_t</span>)(v &gt;&gt; <span class=number>24</span>);</span><br><span class=line>    b[<span class=number>1</span>] = (<span class=type>uint8_t</span>)(v &gt;&gt; <span class=number>16</span>);</span><br><span class=line>    b[<span class=number>2</span>] = (<span class=type>uint8_t</span>)(v &gt;&gt; <span class=number>8</span>);</span><br><span class=line>    b[<span class=number>3</span>] = (<span class=type>uint8_t</span>)(v);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>SM4_T_non_lin_sub</span><span class=params>(<span class=type>uint32_t</span> X)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> t = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    t |= ((<span class=type>uint32_t</span>)SM4_S[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>24</span>)]) &lt;&lt; <span class=number>24</span>;</span><br><span class=line>    t |= ((<span class=type>uint32_t</span>)SM4_S[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>16</span>)]) &lt;&lt; <span class=number>16</span>;</span><br><span class=line>    t |= ((<span class=type>uint32_t</span>)SM4_S[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>8</span>)]) &lt;&lt; <span class=number>8</span>;</span><br><span class=line>    t |= SM4_S[(<span class=type>uint8_t</span>)X];</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> t;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>SM4_T_slow</span><span class=params>(<span class=type>uint32_t</span> X)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> t = <span class=built_in>SM4_T_non_lin_sub</span>(X);</span><br><span class=line></span><br><span class=line>    <span class=comment>/*</span></span><br><span class=line><span class=comment>     * L linear transform</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=keyword>return</span> t ^ <span class=built_in>rotl</span>(t, <span class=number>2</span>) ^ <span class=built_in>rotl</span>(t, <span class=number>10</span>) ^ <span class=built_in>rotl</span>(t, <span class=number>18</span>) ^ <span class=built_in>rotl</span>(t, <span class=number>24</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>SM4_T</span><span class=params>(<span class=type>uint32_t</span> X)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>return</span> SM4_SBOX_T0[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>24</span>)] ^</span><br><span class=line>           SM4_SBOX_T1[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>16</span>)] ^</span><br><span class=line>           SM4_SBOX_T2[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>8</span>)] ^</span><br><span class=line>           SM4_SBOX_T3[(<span class=type>uint8_t</span>)X];</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>SM4_key_sub</span><span class=params>(<span class=type>uint32_t</span> X)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> t = <span class=built_in>SM4_T_non_lin_sub</span>(X);</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> t ^ <span class=built_in>rotl</span>(t, <span class=number>13</span>) ^ <span class=built_in>rotl</span>(t, <span class=number>23</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>ossl_sm4_set_key</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *key, SM4_KEY *ks)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=comment>/*</span></span><br><span class=line><span class=comment>     * Family Key</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=type>static</span> <span class=type>const</span> <span class=type>uint32_t</span> FK[<span class=number>4</span>] = {</span><br><span class=line>        <span class=number>0xa3b1bac6</span>, <span class=number>0x56aa3350</span>, <span class=number>0x677d9197</span>, <span class=number>0xb27022dc</span>};</span><br><span class=line></span><br><span class=line>    <span class=comment>/*</span></span><br><span class=line><span class=comment>     * Constant Key</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=type>static</span> <span class=type>const</span> <span class=type>uint32_t</span> CK[<span class=number>32</span>] = {</span><br><span class=line>        <span class=number>0x00070E15</span>, <span class=number>0x1C232A31</span>, <span class=number>0x383F464D</span>, <span class=number>0x545B6269</span>,</span><br><span class=line>        <span class=number>0x70777E85</span>, <span class=number>0x8C939AA1</span>, <span class=number>0xA8AFB6BD</span>, <span class=number>0xC4CBD2D9</span>,</span><br><span class=line>        <span class=number>0xE0E7EEF5</span>, <span class=number>0xFC030A11</span>, <span class=number>0x181F262D</span>, <span class=number>0x343B4249</span>,</span><br><span class=line>        <span class=number>0x50575E65</span>, <span class=number>0x6C737A81</span>, <span class=number>0x888F969D</span>, <span class=number>0xA4ABB2B9</span>,</span><br><span class=line>        <span class=number>0xC0C7CED5</span>, <span class=number>0xDCE3EAF1</span>, <span class=number>0xF8FF060D</span>, <span class=number>0x141B2229</span>,</span><br><span class=line>        <span class=number>0x30373E45</span>, <span class=number>0x4C535A61</span>, <span class=number>0x686F767D</span>, <span class=number>0x848B9299</span>,</span><br><span class=line>        <span class=number>0xA0A7AEB5</span>, <span class=number>0xBCC3CAD1</span>, <span class=number>0xD8DFE6ED</span>, <span class=number>0xF4FB0209</span>,</span><br><span class=line>        <span class=number>0x10171E25</span>, <span class=number>0x2C333A41</span>, <span class=number>0x484F565D</span>, <span class=number>0x646B7279</span>};</span><br><span class=line></span><br><span class=line>    <span class=type>uint32_t</span> K[<span class=number>4</span>];</span><br><span class=line>    <span class=type>int</span> i;</span><br><span class=line></span><br><span class=line>    K[<span class=number>0</span>] = <span class=built_in>load_u32_be</span>(key, <span class=number>0</span>) ^ FK[<span class=number>0</span>];</span><br><span class=line>    K[<span class=number>1</span>] = <span class=built_in>load_u32_be</span>(key, <span class=number>1</span>) ^ FK[<span class=number>1</span>];</span><br><span class=line>    K[<span class=number>2</span>] = <span class=built_in>load_u32_be</span>(key, <span class=number>2</span>) ^ FK[<span class=number>2</span>];</span><br><span class=line>    K[<span class=number>3</span>] = <span class=built_in>load_u32_be</span>(key, <span class=number>3</span>) ^ FK[<span class=number>3</span>];</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; SM4_KEY_SCHEDULE; i = i + <span class=number>4</span>)</span><br><span class=line>    {</span><br><span class=line>        K[<span class=number>0</span>] ^= <span class=built_in>SM4_key_sub</span>(K[<span class=number>1</span>] ^ K[<span class=number>2</span>] ^ K[<span class=number>3</span>] ^ CK[i]);</span><br><span class=line>        K[<span class=number>1</span>] ^= <span class=built_in>SM4_key_sub</span>(K[<span class=number>2</span>] ^ K[<span class=number>3</span>] ^ K[<span class=number>0</span>] ^ CK[i + <span class=number>1</span>]);</span><br><span class=line>        K[<span class=number>2</span>] ^= <span class=built_in>SM4_key_sub</span>(K[<span class=number>3</span>] ^ K[<span class=number>0</span>] ^ K[<span class=number>1</span>] ^ CK[i + <span class=number>2</span>]);</span><br><span class=line>        K[<span class=number>3</span>] ^= <span class=built_in>SM4_key_sub</span>(K[<span class=number>0</span>] ^ K[<span class=number>1</span>] ^ K[<span class=number>2</span>] ^ CK[i + <span class=number>3</span>]);</span><br><span class=line>        ks-&gt;rk[i] = K[<span class=number>0</span>];</span><br><span class=line>        ks-&gt;rk[i + <span class=number>1</span>] = K[<span class=number>1</span>];</span><br><span class=line>        ks-&gt;rk[i + <span class=number>2</span>] = K[<span class=number>2</span>];</span><br><span class=line>        ks-&gt;rk[i + <span class=number>3</span>] = K[<span class=number>3</span>];</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>1</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_RNDS(k0, k1, k2, k3, F)         \</span></span><br><span class=line><span class=meta>    do                                      \</span></span><br><span class=line><span class=meta>    {                                       \</span></span><br><span class=line><span class=meta>        B0 ^= F(B1 ^ B2 ^ B3 ^ ks-&gt;rk[k0]); \</span></span><br><span class=line><span class=meta>        B1 ^= F(B0 ^ B2 ^ B3 ^ ks-&gt;rk[k1]); \</span></span><br><span class=line><span class=meta>        B2 ^= F(B0 ^ B1 ^ B3 ^ ks-&gt;rk[k2]); \</span></span><br><span class=line><span class=meta>        B3 ^= F(B0 ^ B1 ^ B2 ^ ks-&gt;rk[k3]); \</span></span><br><span class=line><span class=meta>    } while (0)</span></span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>ossl_sm4_encrypt</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *in, <span class=type>uint8_t</span> *out, <span class=type>const</span> SM4_KEY *ks)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> B0 = <span class=built_in>load_u32_be</span>(in, <span class=number>0</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B1 = <span class=built_in>load_u32_be</span>(in, <span class=number>1</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B2 = <span class=built_in>load_u32_be</span>(in, <span class=number>2</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B3 = <span class=built_in>load_u32_be</span>(in, <span class=number>3</span>);</span><br><span class=line></span><br><span class=line>    <span class=comment>/*</span></span><br><span class=line><span class=comment>     * Uses byte-wise sbox in the first and last rounds to provide some</span></span><br><span class=line><span class=comment>     * protection from cache based side channels.</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>0</span>, <span class=number>1</span>, <span class=number>2</span>, <span class=number>3</span>, SM4_T_slow);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>4</span>, <span class=number>5</span>, <span class=number>6</span>, <span class=number>7</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>8</span>, <span class=number>9</span>, <span class=number>10</span>, <span class=number>11</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>12</span>, <span class=number>13</span>, <span class=number>14</span>, <span class=number>15</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>16</span>, <span class=number>17</span>, <span class=number>18</span>, <span class=number>19</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>20</span>, <span class=number>21</span>, <span class=number>22</span>, <span class=number>23</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>24</span>, <span class=number>25</span>, <span class=number>26</span>, <span class=number>27</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>28</span>, <span class=number>29</span>, <span class=number>30</span>, <span class=number>31</span>, SM4_T_slow);</span><br><span class=line>	</span><br><span class=line>    <span class=comment>// 这个函数会导致小端 -&gt; 大端，直接内存 dump 密文的没有关系，如果是直接在这里比较密文的话要注意是大端，如果是写进内存比较直接默认比较就行</span></span><br><span class=line>    <span class=comment>// 0x666c6167 -&gt; 0x67616c66</span></span><br><span class=line>    <span class=built_in>store_u32_be</span>(B3, out);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B2, out + <span class=number>4</span>);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B1, out + <span class=number>8</span>);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B0, out + <span class=number>12</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>ossl_sm4_decrypt</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *in, <span class=type>uint8_t</span> *out, <span class=type>const</span> SM4_KEY *ks)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> B0 = <span class=built_in>load_u32_be</span>(in, <span class=number>0</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B1 = <span class=built_in>load_u32_be</span>(in, <span class=number>1</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B2 = <span class=built_in>load_u32_be</span>(in, <span class=number>2</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B3 = <span class=built_in>load_u32_be</span>(in, <span class=number>3</span>);</span><br><span class=line></span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>31</span>, <span class=number>30</span>, <span class=number>29</span>, <span class=number>28</span>, SM4_T_slow);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>27</span>, <span class=number>26</span>, <span class=number>25</span>, <span class=number>24</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>23</span>, <span class=number>22</span>, <span class=number>21</span>, <span class=number>20</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>19</span>, <span class=number>18</span>, <span class=number>17</span>, <span class=number>16</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>15</span>, <span class=number>14</span>, <span class=number>13</span>, <span class=number>12</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>11</span>, <span class=number>10</span>, <span class=number>9</span>, <span class=number>8</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>7</span>, <span class=number>6</span>, <span class=number>5</span>, <span class=number>4</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>3</span>, <span class=number>2</span>, <span class=number>1</span>, <span class=number>0</span>, SM4_T_slow);</span><br><span class=line>	</span><br><span class=line>    <span class=comment>// 这个函数会导致小端 -&gt; 大端，直接内存 dump 密文的没有关系，如果是直接在这里比较密文的话要注意是大端，如果是写进内存比较直接默认比较就行</span></span><br><span class=line>    <span class=comment>// 0x666c6167 -&gt; 0x67616c66</span></span><br><span class=line>    <span class=built_in>store_u32_be</span>(B3, out);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B2, out + <span class=number>4</span>);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B1, out + <span class=number>8</span>);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B0, out + <span class=number>12</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>printHex</span><span class=params>(<span class=type>char</span> *name, <span class=type>void</span> *ptr, <span class=type>int</span> len)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s"</span>, name);</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>size_t</span> i = <span class=number>0</span>; i &lt; len; i++)</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%02x"</span>, ((<span class=type>uint8_t</span> *)ptr)[i]);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>hexdump</span><span class=params>(<span class=type>char</span> *name, <span class=type>const</span> <span class=type>void</span> *data, <span class=type>size_t</span> size)</span> </span>{</span><br><span class=line>    <span class=type>const</span> <span class=type>unsigned</span> <span class=type>char</span> *byte_data = (<span class=type>const</span> <span class=type>unsigned</span> <span class=type>char</span> *)data;</span><br><span class=line>    <span class=type>size_t</span> i, j;</span><br><span class=line></span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s\n"</span>, name);</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; size; i += <span class=number>16</span>) {</span><br><span class=line>        <span class=comment>// 打印偏移地址</span></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%08zx  "</span>, i);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 打印十六进制数据</span></span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; <span class=number>16</span>; ++j) {</span><br><span class=line>            <span class=keyword>if</span> (i + j &lt; size) {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"%02x "</span>, byte_data[i + j]);</span><br><span class=line>            } <span class=keyword>else</span> {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"   "</span>); <span class=comment>// 不足部分用空格填充</span></span><br><span class=line>            }</span><br><span class=line></span><br><span class=line>            <span class=comment>// 在每8字节后添加一个额外的空格</span></span><br><span class=line>            <span class=keyword>if</span> (j == <span class=number>7</span>) {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>" "</span>);</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>" |"</span>);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 打印ASCII字符</span></span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; <span class=number>16</span>; ++j) {</span><br><span class=line>            <span class=keyword>if</span> (i + j &lt; size) {</span><br><span class=line>                <span class=type>unsigned</span> <span class=type>char</span> ch = byte_data[i + j];</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"%c"</span>, <span class=built_in>isprint</span>(ch) ? ch : <span class=string>'.'</span>);</span><br><span class=line>            } <span class=keyword>else</span> {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>" "</span>);</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"|\n"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    SM4_KEY *ks = (SM4_KEY *) <span class=built_in>malloc</span>(<span class=built_in>sizeof</span>(SM4_KEY));</span><br><span class=line>    <span class=type>uint8_t</span> key[<span class=number>16</span>] = {<span class=number>0x01</span>, <span class=number>0x23</span>, <span class=number>0x45</span>, <span class=number>0x67</span>, <span class=number>0x89</span>, <span class=number>0xab</span>, <span class=number>0xcd</span>, <span class=number>0xef</span>, <span class=number>0xfe</span>, <span class=number>0xdc</span>, <span class=number>0xba</span>, <span class=number>0x98</span>, <span class=number>0x76</span>, <span class=number>0x54</span>, <span class=number>0x32</span>, <span class=number>0x10</span>};</span><br><span class=line>    <span class=type>uint8_t</span> input[<span class=number>16</span>] = {<span class=number>0x01</span>, <span class=number>0x23</span>, <span class=number>0x45</span>, <span class=number>0x67</span>, <span class=number>0x89</span>, <span class=number>0xab</span>, <span class=number>0xcd</span>, <span class=number>0xef</span>, <span class=number>0xfe</span>, <span class=number>0xdc</span>, <span class=number>0xba</span>, <span class=number>0x98</span>, <span class=number>0x76</span>, <span class=number>0x54</span>, <span class=number>0x32</span>, <span class=number>0x10</span>};</span><br><span class=line>    <span class=type>uint8_t</span> output[<span class=number>16</span>];</span><br><span class=line></span><br><span class=line>    <span class=built_in>ossl_sm4_set_key</span>(key, ks);</span><br><span class=line>    <span class=built_in>ossl_sm4_encrypt</span>(input, output, ks);</span><br><span class=line></span><br><span class=line>    <span class=built_in>printHex</span>(<span class=string>"Output: "</span>, output, <span class=number>16</span>);</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=DES><a href=#DES class=headerlink title=DES></a>DES</h2><p>标志位修改一下就行了，加解密同源，实际上就是把 sub_key 倒过来</p><h3 id=代码1-1><a href=#代码1-1 class=headerlink title=代码1></a>代码1</h3><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdio.h&gt;</span>  </span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;string.h&gt;</span> </span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdlib.h&gt;</span> </span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>"table.h"</span><span class=comment>//存储各种数据表的头文件 </span></span></span><br><span class=line></span><br><span class=line><span class=comment>// 十六轮子密钥 </span></span><br><span class=line><span class=type>static</span> <span class=type>bool</span> SubKey[<span class=number>16</span>][<span class=number>48</span>] = { <span class=number>0</span> }; </span><br><span class=line><span class=comment>/*-----------------------------自定义函数-----------------------------*/</span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>SetKey</span><span class=params>(<span class=type>char</span> My_key[<span class=number>8</span>])</span></span>; <span class=comment>//生成16轮的子密钥 </span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>ByteToBit</span><span class=params>(<span class=type>bool</span> * Data_out, <span class=type>char</span> * Data_in, <span class=type>int</span> Num)</span></span>; <span class=comment>//字节转换成位</span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>BitToByte</span><span class=params>(<span class=type>char</span> My_message[<span class=number>8</span>], <span class=type>bool</span> * Message_in, <span class=type>int</span> Num)</span></span>; <span class=comment>//位转换成字节 </span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>TableReplace</span><span class=params>(<span class=type>bool</span> *Data_out, <span class=type>bool</span> *Data_in, <span class=type>const</span> <span class=type>char</span> *Table, <span class=type>int</span> Num)</span></span>;  <span class=comment>//各种表的置换算法 </span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>Bitcopy</span><span class=params>(<span class=type>bool</span> * Data_out, <span class=type>bool</span> * Data_in, <span class=type>int</span> Num)</span></span>;  <span class=comment>//二进制数组的拷贝 </span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>Loop_bit</span><span class=params>(<span class=type>bool</span> * Data_out, <span class=type>int</span> movstep, <span class=type>int</span> len)</span></span>;  <span class=comment>//左移</span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>Run_Des</span><span class=params>(<span class=type>char</span> My_message[<span class=number>8</span>], <span class=type>char</span> CIPhertext[<span class=number>64</span>])</span></span>;<span class=comment>//des的轮加密算法</span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>Xor</span><span class=params>(<span class=type>bool</span> * Message_out, <span class=type>bool</span> * Message_in, <span class=type>int</span> Num)</span></span>; <span class=comment>//执行异或 </span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>S_change</span><span class=params>(<span class=type>bool</span> * Data_out, <span class=type>bool</span> * Data_in)</span></span>;  <span class=comment>// S盒变换 </span></span><br><span class=line> <span class=function><span class=type>void</span> <span class=title>Run_desDes</span><span class=params>(<span class=type>char</span> My_message[<span class=number>8</span>], <span class=type>char</span> CIPhertext[<span class=number>64</span>])</span></span>;<span class=comment>// DES轮解密算法 </span></span><br><span class=line><span class=comment>/*--------------------------*/</span></span><br><span class=line></span><br><span class=line><span class=comment>/*--------------------------主函数----------------------------------*/</span></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i = <span class=number>0</span>, j;    </span><br><span class=line>	<span class=type>char</span> My_key[<span class=number>8</span>] = { <span class=number>0</span> };  <span class=comment>//记录加密密钥    </span></span><br><span class=line>	<span class=type>char</span> You_key[<span class=number>8</span>] = { <span class=number>0</span> }; <span class=comment>//解密密钥    </span></span><br><span class=line>	<span class=type>char</span> My_message[<span class=number>8</span>] = { <span class=number>0</span> }; <span class=comment>//明文    </span></span><br><span class=line>	<span class=type>char</span> CIPhertext[<span class=number>64</span>] = { <span class=number>0</span> };<span class=comment>//密文    </span></span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"请输入你要加密的内容(8 Byte):\n"</span>);    </span><br><span class=line>	<span class=built_in>scanf</span>(<span class=string>"%s"</span>, My_message);    </span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"请输入你的加密密钥(8 Byte):\n"</span>);    </span><br><span class=line>	<span class=built_in>scanf</span>(<span class=string>"%s"</span>, My_key);    </span><br><span class=line>	i = <span class=built_in>strlen</span>(My_key);    </span><br><span class=line>	<span class=keyword>while</span> (i != <span class=number>8</span>)<span class=comment>//确保密钥长度为8byte    </span></span><br><span class=line>	{      </span><br><span class=line>	    <span class=built_in>printf</span>(<span class=string>"请输入加密密钥(8 Byte)\n"</span>);      </span><br><span class=line>	    <span class=built_in>scanf</span>(<span class=string>"%s"</span>, My_key);      </span><br><span class=line>	    i = <span class=number>0</span>;       </span><br><span class=line>	    i = <span class=built_in>strlen</span>(My_key);   </span><br><span class=line>	}    </span><br><span class=line>	<span class=built_in>SetKey</span>(My_key);  <span class=comment>//生成16轮的加密子密钥  </span></span><br><span class=line>	<span class=built_in>Run_Des</span>(My_message, CIPhertext); <span class=comment>//des的轮加密过程   </span></span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"经过加密的密文为(二进制):\n"</span>);    </span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"%s"</span>, CIPhertext);    </span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n"</span>);    </span><br><span class=line>	<span class=built_in>Run_desDes</span>(My_message, CIPhertext);<span class=comment>//解密;    </span></span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"解密结果为:\n"</span>);    </span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"%s"</span>, My_message);    </span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>	<span class=keyword>return</span> <span class=number>0</span>; </span><br><span class=line>}</span><br><span class=line></span><br><span class=line> <span class=comment>/*--------------------具体函数定义----------------------*/</span> </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>Bitcopy</span><span class=params>(<span class=type>bool</span> * Data_out, <span class=type>bool</span> * Data_in, <span class=type>int</span> Num)</span> <span class=comment>//二进制数组拷贝 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i = <span class=number>0</span>;    </span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; Num; i++)       </span><br><span class=line>	Data_out[i] = Data_in[i]; </span><br><span class=line>} </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>ByteToBit</span><span class=params>(<span class=type>bool</span> * Data_out, <span class=type>char</span> * Data_in, <span class=type>int</span> Num)</span> <span class=comment>//字节转位，num为二进制位数 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i, j;    </span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; Num; i++)       </span><br><span class=line>	Data_out[i] = (Data_in[i / <span class=number>8</span>] &gt;&gt; (i % <span class=number>8</span>)) &amp; <span class=number>0x01</span>; </span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>BitToByte</span><span class=params>(<span class=type>char</span> My_message[<span class=number>8</span>], <span class=type>bool</span> * Message_in, <span class=type>int</span> Num)</span> <span class=comment>//位转换成字节，num为位数 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i = <span class=number>0</span>;    </span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; (Num / <span class=number>8</span>); i++)    </span><br><span class=line>		My_message[i] = <span class=number>0</span>;</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; Num; i++)   </span><br><span class=line>		My_message[i / <span class=number>8</span>] |= Message_in[i] &lt;&lt; (i % <span class=number>8</span>);</span><br><span class=line>} </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>TableReplace</span><span class=params>(<span class=type>bool</span> *Data_out, <span class=type>bool</span> * Data_in, <span class=type>const</span> <span class=type>char</span> *Table, <span class=type>int</span> Num)</span> <span class=comment>// 置换算法,Num表示置换表的长度 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i = <span class=number>0</span>;    </span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> Temp[<span class=number>256</span>] = { <span class=number>0</span> };    </span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; Num; i++)    </span><br><span class=line>	{       </span><br><span class=line>	 Temp[i] = Data_in[Table[i] - <span class=number>1</span>];<span class=comment>//将输入数据的指定位置作为输出数据的第i位    </span></span><br><span class=line>	 }    </span><br><span class=line>	 <span class=built_in>Bitcopy</span>(Data_out, Temp, Num);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>Loop_bit</span><span class=params>(<span class=type>bool</span> * Data_out, <span class=type>int</span> movstep, <span class=type>int</span> len)</span><span class=comment>//左循环移位 </span></span></span><br><span class=line><span class=function></span>{   </span><br><span class=line>	 <span class=type>static</span> <span class=type>bool</span> Temp[<span class=number>256</span>] = { <span class=number>0</span> };   </span><br><span class=line>	 <span class=built_in>Bitcopy</span>(Temp, Data_out, movstep);<span class=comment>//将前movstep位数据放入temp缓存   </span></span><br><span class=line>	 <span class=built_in>Bitcopy</span>(Data_out, Data_out + movstep, len - movstep);<span class=comment>//数据依次向左移位    </span></span><br><span class=line>	 <span class=built_in>Bitcopy</span>(Data_out + len - movstep, Temp, movstep);<span class=comment>//将temp中缓存的数据放入最后</span></span><br><span class=line> } </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>Xor</span><span class=params>(<span class=type>bool</span> * Message_out, <span class=type>bool</span> * Message_in, <span class=type>int</span> Num)</span><span class=comment>//执行异或 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i;</span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; Num; i++)    </span><br><span class=line>	{       </span><br><span class=line>	 Message_out[i] = Message_out[i] ^ Message_in[i];   </span><br><span class=line>	} </span><br><span class=line>} </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>SetKey</span><span class=params>(<span class=type>char</span> My_key[<span class=number>8</span>])</span><span class=comment>//8字节的初始密钥 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i, j;    </span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> Key_bit[<span class=number>64</span>] = { <span class=number>0</span> }; <span class=comment>//Key的二进制缓存    </span></span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> *Key_bit_L, *Key_bit_R;    </span><br><span class=line>	Key_bit_L = &amp;Key_bit[<span class=number>0</span>]; <span class=comment>//key的左边28位    </span></span><br><span class=line>	Key_bit_R = &amp;Key_bit[<span class=number>28</span>]; <span class=comment>//key的右边28位  </span></span><br><span class=line>	<span class=built_in>ByteToBit</span>(Key_bit, My_key, <span class=number>64</span>);    </span><br><span class=line>	<span class=built_in>TableReplace</span>(Key_bit, Key_bit, PC1_Table, <span class=number>56</span>);<span class=comment>//pc-1 置换    </span></span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i++)<span class=comment>//生成第i个子密钥Subkey[i]  </span></span><br><span class=line>	{        </span><br><span class=line>		<span class=built_in>Loop_bit</span>(Key_bit_L, Move_Table[i], <span class=number>28</span>);<span class=comment>//左边28位进行左循环移位        </span></span><br><span class=line>		<span class=built_in>Loop_bit</span>(Key_bit_R, Move_Table[i], <span class=number>28</span>);<span class=comment>//右边28位进行左循环移位        </span></span><br><span class=line>		<span class=built_in>TableReplace</span>(SubKey[i], Key_bit, PC2_Table, <span class=number>48</span>);<span class=comment>//pc-2置换    </span></span><br><span class=line>	} </span><br><span class=line>} </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>S_change</span><span class=params>(<span class=type>bool</span> * Data_out, <span class=type>bool</span> * Data_in)</span> <span class=comment>//S盒变换 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i;    </span><br><span class=line>	<span class=type>int</span> r = <span class=number>0</span>, c = <span class=number>0</span>;<span class=comment>//S盒的行和列    </span></span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>8</span>; i++, Data_in = Data_in + <span class=number>6</span>, Data_out = Data_out + <span class=number>4</span>) <span class=comment>// 每6bit输入进行一次代换    </span></span><br><span class=line>	{        </span><br><span class=line>		r = Data_in[<span class=number>0</span>] * <span class=number>2</span> + Data_in[<span class=number>5</span>] * <span class=number>1</span>;<span class=comment>//将m1m6转换为十进制数，作为行数        </span></span><br><span class=line>		c = Data_in[<span class=number>1</span>] * <span class=number>8</span> + Data_in[<span class=number>2</span>] * <span class=number>4</span> + Data_in[<span class=number>3</span>] * <span class=number>2</span> + Data_in[<span class=number>4</span>] * <span class=number>1</span>;<span class=comment>//将m2m3m4m5转换为十进制数，作为列数        	</span></span><br><span class=line>		<span class=built_in>ByteToBit</span>(Data_out, &amp;S_Box[i][r][c], <span class=number>4</span>);<span class=comment>//取S盒数据,将其二进制形式的每一位填到输出的指定位置    </span></span><br><span class=line>	} </span><br><span class=line>} </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>F_change</span><span class=params>(<span class=type>bool</span> Data_out[<span class=number>32</span>], <span class=type>bool</span> Data_in[<span class=number>48</span>])</span>   <span class=comment>// f函数 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i;    </span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> Message_E[<span class=number>48</span>] = { <span class=number>0</span> };  <span class=comment>//存放E置换的结果    </span></span><br><span class=line>	<span class=built_in>TableReplace</span>(Message_E, Data_out, E_Table, <span class=number>48</span>);<span class=comment>//E表置换    </span></span><br><span class=line>	<span class=built_in>Xor</span>(Message_E, Data_in, <span class=number>48</span>);<span class=comment>//与密钥K[i]异或    </span></span><br><span class=line>	<span class=built_in>S_change</span>(Data_out, Message_E);  <span class=comment>// S盒变换    </span></span><br><span class=line>	<span class=built_in>TableReplace</span>(Data_out, Data_out, P_Table, <span class=number>32</span>);  <span class=comment>//P置换 </span></span><br><span class=line>}</span><br><span class=line><span class=function><span class=type>void</span> <span class=title>Run_Des</span><span class=params>(<span class=type>char</span> My_message[<span class=number>8</span>], <span class=type>char</span> CIPhertext[<span class=number>64</span>])</span><span class=comment>//des轮加密算法 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i;    </span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> Message_bit[<span class=number>64</span>] = { <span class=number>0</span> };    </span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> *Message_bit_L = &amp;Message_bit[<span class=number>0</span>], *Message_bit_R = &amp;Message_bit[<span class=number>32</span>];<span class=comment>//分成左右两部分，每部分32位    </span></span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> Temp[<span class=number>32</span>] = { <span class=number>0</span> };    </span><br><span class=line>	<span class=built_in>ByteToBit</span>(Message_bit, My_message, <span class=number>64</span>);    		</span><br><span class=line>	<span class=built_in>TableReplace</span>(Message_bit, Message_bit, IP_Table, <span class=number>64</span>);<span class=comment>//初始置换    </span></span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i++)<span class=comment>//每一轮的加密    </span></span><br><span class=line>	{        </span><br><span class=line>		<span class=built_in>Bitcopy</span>(Temp, Message_bit_R, <span class=number>32</span>);<span class=comment>//缓存右32位        </span></span><br><span class=line>		<span class=built_in>F_change</span>(Message_bit_R, SubKey[i]);<span class=comment>//轮函数F        </span></span><br><span class=line>		<span class=built_in>Xor</span>(Message_bit_R, Message_bit_L, <span class=number>32</span>);<span class=comment>//左32位与轮函数F输出进行异或        </span></span><br><span class=line>		<span class=built_in>Bitcopy</span>(Message_bit_L, Temp, <span class=number>32</span>);<span class=comment>//右32位R(i-1)作为下一轮的Li    </span></span><br><span class=line>	}    </span><br><span class=line>	<span class=built_in>TableReplace</span>(Message_bit, Message_bit, IPR_Table, <span class=number>64</span>);<span class=comment>//逆初始置换    </span></span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>64</span>;i++)        </span><br><span class=line>	CIPhertext[i] = Message_bit[i]+<span class=string>'0'</span>;<span class=comment>//由于是将bool型数据赋给字符型数据，因此要+'0'    </span></span><br><span class=line>	CIPhertext[i] = <span class=string>'\0'</span>; </span><br><span class=line>} </span><br><span class=line><span class=function><span class=type>void</span> <span class=title>Run_desDes</span><span class=params>(<span class=type>char</span> My_message[<span class=number>8</span>], <span class=type>char</span> CIPhertext[<span class=number>64</span>])</span><span class=comment>// DES轮解密算法 </span></span></span><br><span class=line><span class=function></span>{    </span><br><span class=line>	<span class=type>int</span> i = <span class=number>0</span>;    </span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> Message_bit[<span class=number>64</span>] = { <span class=number>0</span> };    </span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> * Message_bit_L = &amp;Message_bit[<span class=number>0</span>], *Message_bit_R = &amp;Message_bit[<span class=number>32</span>];    </span><br><span class=line>	<span class=type>static</span> <span class=type>bool</span> Temp[<span class=number>32</span>] = { <span class=number>0</span> };    </span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>64</span>; i++)        </span><br><span class=line>	Message_bit[i] = CIPhertext[i]-<span class=string>'0'</span>;    </span><br><span class=line>	<span class=built_in>TableReplace</span>(Message_bit, Message_bit, IP_Table, <span class=number>64</span>);    </span><br><span class=line>	<span class=keyword>for</span> (i = <span class=number>15</span>; i &gt;= <span class=number>0</span>; i--)<span class=comment>//与加密过程的区别是子密钥使用顺序相反    </span></span><br><span class=line>	{        </span><br><span class=line>		<span class=built_in>Bitcopy</span>(Temp, Message_bit_L, <span class=number>32</span>);        </span><br><span class=line>		<span class=built_in>F_change</span>(Message_bit_L, SubKey[i]);        </span><br><span class=line>		<span class=built_in>Xor</span>(Message_bit_L, Message_bit_R, <span class=number>32</span>);	</span><br><span class=line>		<span class=built_in>Bitcopy</span>(Message_bit_R, Temp, <span class=number>32</span>);    }    			</span><br><span class=line>		<span class=built_in>TableReplace</span>(Message_bit, Message_bit, IPR_Table, <span class=number>64</span>);    </span><br><span class=line>		<span class=built_in>BitToByte</span>(My_message, Message_bit, <span class=number>64</span>); </span><br><span class=line>	}</span><br><span class=line>}</span><br><span class=line></span><br></pre></td></tr></table></figure><h3 id=代码2-1><a href=#代码2-1 class=headerlink title=代码2></a>代码2</h3><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br><span class=line>315</span><br><span class=line>316</span><br><span class=line>317</span><br><span class=line>318</span><br><span class=line>319</span><br><span class=line>320</span><br><span class=line>321</span><br><span class=line>322</span><br><span class=line>323</span><br><span class=line>324</span><br><span class=line>325</span><br><span class=line>326</span><br><span class=line>327</span><br><span class=line>328</span><br><span class=line>329</span><br><span class=line>330</span><br><span class=line>331</span><br><span class=line>332</span><br><span class=line>333</span><br><span class=line>334</span><br><span class=line>335</span><br><span class=line>336</span><br><span class=line>337</span><br><span class=line>338</span><br><span class=line>339</span><br><span class=line>340</span><br><span class=line>341</span><br><span class=line>342</span><br><span class=line>343</span><br><span class=line>344</span><br><span class=line>345</span><br><span class=line>346</span><br><span class=line>347</span><br><span class=line>348</span><br><span class=line>349</span><br><span class=line>350</span><br><span class=line>351</span><br><span class=line>352</span><br><span class=line>353</span><br><span class=line>354</span><br><span class=line>355</span><br><span class=line>356</span><br><span class=line>357</span><br><span class=line>358</span><br><span class=line>359</span><br><span class=line>360</span><br><span class=line>361</span><br></pre></td><td class=code><pre><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Data Encryption Standard</span></span><br><span class=line><span class=comment> * An approach to DES algorithm</span></span><br><span class=line><span class=comment> * </span></span><br><span class=line><span class=comment> * By: Daniel Huertas Gonzalez</span></span><br><span class=line><span class=comment> * Email: huertas.dani@gmail.com</span></span><br><span class=line><span class=comment> * Version: 0.1</span></span><br><span class=line><span class=comment> * </span></span><br><span class=line><span class=comment> * Based on the document FIPS PUB 46-3</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdlib.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdint.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> LB32_MASK   0x00000001</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> LB64_MASK   0x0000000000000001</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> L64_MASK    0x00000000ffffffff</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> H64_MASK    0xffffffff00000000</span></span><br><span class=line></span><br><span class=line><span class=comment>/* Initial Permutation Table */</span></span><br><span class=line><span class=type>static</span> <span class=type>char</span> IP[] = {</span><br><span class=line>    <span class=number>58</span>, <span class=number>50</span>, <span class=number>42</span>, <span class=number>34</span>, <span class=number>26</span>, <span class=number>18</span>, <span class=number>10</span>,  <span class=number>2</span>, </span><br><span class=line>    <span class=number>60</span>, <span class=number>52</span>, <span class=number>44</span>, <span class=number>36</span>, <span class=number>28</span>, <span class=number>20</span>, <span class=number>12</span>,  <span class=number>4</span>, </span><br><span class=line>    <span class=number>62</span>, <span class=number>54</span>, <span class=number>46</span>, <span class=number>38</span>, <span class=number>30</span>, <span class=number>22</span>, <span class=number>14</span>,  <span class=number>6</span>, </span><br><span class=line>    <span class=number>64</span>, <span class=number>56</span>, <span class=number>48</span>, <span class=number>40</span>, <span class=number>32</span>, <span class=number>24</span>, <span class=number>16</span>,  <span class=number>8</span>, </span><br><span class=line>    <span class=number>57</span>, <span class=number>49</span>, <span class=number>41</span>, <span class=number>33</span>, <span class=number>25</span>, <span class=number>17</span>,  <span class=number>9</span>,  <span class=number>1</span>, </span><br><span class=line>    <span class=number>59</span>, <span class=number>51</span>, <span class=number>43</span>, <span class=number>35</span>, <span class=number>27</span>, <span class=number>19</span>, <span class=number>11</span>,  <span class=number>3</span>, </span><br><span class=line>    <span class=number>61</span>, <span class=number>53</span>, <span class=number>45</span>, <span class=number>37</span>, <span class=number>29</span>, <span class=number>21</span>, <span class=number>13</span>,  <span class=number>5</span>, </span><br><span class=line>    <span class=number>63</span>, <span class=number>55</span>, <span class=number>47</span>, <span class=number>39</span>, <span class=number>31</span>, <span class=number>23</span>, <span class=number>15</span>,  <span class=number>7</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/* Inverse Initial Permutation Table */</span></span><br><span class=line><span class=type>static</span> <span class=type>char</span> PI[] = {</span><br><span class=line>    <span class=number>40</span>,  <span class=number>8</span>, <span class=number>48</span>, <span class=number>16</span>, <span class=number>56</span>, <span class=number>24</span>, <span class=number>64</span>, <span class=number>32</span>, </span><br><span class=line>    <span class=number>39</span>,  <span class=number>7</span>, <span class=number>47</span>, <span class=number>15</span>, <span class=number>55</span>, <span class=number>23</span>, <span class=number>63</span>, <span class=number>31</span>, </span><br><span class=line>    <span class=number>38</span>,  <span class=number>6</span>, <span class=number>46</span>, <span class=number>14</span>, <span class=number>54</span>, <span class=number>22</span>, <span class=number>62</span>, <span class=number>30</span>, </span><br><span class=line>    <span class=number>37</span>,  <span class=number>5</span>, <span class=number>45</span>, <span class=number>13</span>, <span class=number>53</span>, <span class=number>21</span>, <span class=number>61</span>, <span class=number>29</span>, </span><br><span class=line>    <span class=number>36</span>,  <span class=number>4</span>, <span class=number>44</span>, <span class=number>12</span>, <span class=number>52</span>, <span class=number>20</span>, <span class=number>60</span>, <span class=number>28</span>, </span><br><span class=line>    <span class=number>35</span>,  <span class=number>3</span>, <span class=number>43</span>, <span class=number>11</span>, <span class=number>51</span>, <span class=number>19</span>, <span class=number>59</span>, <span class=number>27</span>, </span><br><span class=line>    <span class=number>34</span>,  <span class=number>2</span>, <span class=number>42</span>, <span class=number>10</span>, <span class=number>50</span>, <span class=number>18</span>, <span class=number>58</span>, <span class=number>26</span>, </span><br><span class=line>    <span class=number>33</span>,  <span class=number>1</span>, <span class=number>41</span>,  <span class=number>9</span>, <span class=number>49</span>, <span class=number>17</span>, <span class=number>57</span>, <span class=number>25</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/*Expansion table */</span></span><br><span class=line><span class=type>static</span> <span class=type>char</span> E[] = {</span><br><span class=line>    <span class=number>32</span>,  <span class=number>1</span>,  <span class=number>2</span>,  <span class=number>3</span>,  <span class=number>4</span>,  <span class=number>5</span>,  </span><br><span class=line>     <span class=number>4</span>,  <span class=number>5</span>,  <span class=number>6</span>,  <span class=number>7</span>,  <span class=number>8</span>,  <span class=number>9</span>,  </span><br><span class=line>     <span class=number>8</span>,  <span class=number>9</span>, <span class=number>10</span>, <span class=number>11</span>, <span class=number>12</span>, <span class=number>13</span>, </span><br><span class=line>    <span class=number>12</span>, <span class=number>13</span>, <span class=number>14</span>, <span class=number>15</span>, <span class=number>16</span>, <span class=number>17</span>, </span><br><span class=line>    <span class=number>16</span>, <span class=number>17</span>, <span class=number>18</span>, <span class=number>19</span>, <span class=number>20</span>, <span class=number>21</span>, </span><br><span class=line>    <span class=number>20</span>, <span class=number>21</span>, <span class=number>22</span>, <span class=number>23</span>, <span class=number>24</span>, <span class=number>25</span>, </span><br><span class=line>    <span class=number>24</span>, <span class=number>25</span>, <span class=number>26</span>, <span class=number>27</span>, <span class=number>28</span>, <span class=number>29</span>, </span><br><span class=line>    <span class=number>28</span>, <span class=number>29</span>, <span class=number>30</span>, <span class=number>31</span>, <span class=number>32</span>,  <span class=number>1</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/* Post S-Box permutation */</span></span><br><span class=line><span class=type>static</span> <span class=type>char</span> P[] = {</span><br><span class=line>    <span class=number>16</span>,  <span class=number>7</span>, <span class=number>20</span>, <span class=number>21</span>, </span><br><span class=line>    <span class=number>29</span>, <span class=number>12</span>, <span class=number>28</span>, <span class=number>17</span>, </span><br><span class=line>     <span class=number>1</span>, <span class=number>15</span>, <span class=number>23</span>, <span class=number>26</span>, </span><br><span class=line>     <span class=number>5</span>, <span class=number>18</span>, <span class=number>31</span>, <span class=number>10</span>, </span><br><span class=line>     <span class=number>2</span>,  <span class=number>8</span>, <span class=number>24</span>, <span class=number>14</span>, </span><br><span class=line>    <span class=number>32</span>, <span class=number>27</span>,  <span class=number>3</span>,  <span class=number>9</span>, </span><br><span class=line>    <span class=number>19</span>, <span class=number>13</span>, <span class=number>30</span>,  <span class=number>6</span>, </span><br><span class=line>    <span class=number>22</span>, <span class=number>11</span>,  <span class=number>4</span>, <span class=number>25</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/* The S-Box tables */</span></span><br><span class=line><span class=type>static</span> <span class=type>char</span> S[<span class=number>8</span>][<span class=number>64</span>] = {{</span><br><span class=line>    <span class=comment>/* S1 */</span></span><br><span class=line>    <span class=number>14</span>,  <span class=number>4</span>, <span class=number>13</span>,  <span class=number>1</span>,  <span class=number>2</span>, <span class=number>15</span>, <span class=number>11</span>,  <span class=number>8</span>,  <span class=number>3</span>, <span class=number>10</span>,  <span class=number>6</span>, <span class=number>12</span>,  <span class=number>5</span>,  <span class=number>9</span>,  <span class=number>0</span>,  <span class=number>7</span>,  </span><br><span class=line>     <span class=number>0</span>, <span class=number>15</span>,  <span class=number>7</span>,  <span class=number>4</span>, <span class=number>14</span>,  <span class=number>2</span>, <span class=number>13</span>,  <span class=number>1</span>, <span class=number>10</span>,  <span class=number>6</span>, <span class=number>12</span>, <span class=number>11</span>,  <span class=number>9</span>,  <span class=number>5</span>,  <span class=number>3</span>,  <span class=number>8</span>,  </span><br><span class=line>     <span class=number>4</span>,  <span class=number>1</span>, <span class=number>14</span>,  <span class=number>8</span>, <span class=number>13</span>,  <span class=number>6</span>,  <span class=number>2</span>, <span class=number>11</span>, <span class=number>15</span>, <span class=number>12</span>,  <span class=number>9</span>,  <span class=number>7</span>,  <span class=number>3</span>, <span class=number>10</span>,  <span class=number>5</span>,  <span class=number>0</span>, </span><br><span class=line>    <span class=number>15</span>, <span class=number>12</span>,  <span class=number>8</span>,  <span class=number>2</span>,  <span class=number>4</span>,  <span class=number>9</span>,  <span class=number>1</span>,  <span class=number>7</span>,  <span class=number>5</span>, <span class=number>11</span>,  <span class=number>3</span>, <span class=number>14</span>, <span class=number>10</span>,  <span class=number>0</span>,  <span class=number>6</span>, <span class=number>13</span></span><br><span class=line>},{</span><br><span class=line>    <span class=comment>/* S2 */</span></span><br><span class=line>    <span class=number>15</span>,  <span class=number>1</span>,  <span class=number>8</span>, <span class=number>14</span>,  <span class=number>6</span>, <span class=number>11</span>,  <span class=number>3</span>,  <span class=number>4</span>,  <span class=number>9</span>,  <span class=number>7</span>,  <span class=number>2</span>, <span class=number>13</span>, <span class=number>12</span>,  <span class=number>0</span>,  <span class=number>5</span>, <span class=number>10</span>,  </span><br><span class=line>     <span class=number>3</span>, <span class=number>13</span>,  <span class=number>4</span>,  <span class=number>7</span>, <span class=number>15</span>,  <span class=number>2</span>,  <span class=number>8</span>, <span class=number>14</span>, <span class=number>12</span>,  <span class=number>0</span>,  <span class=number>1</span>, <span class=number>10</span>,  <span class=number>6</span>,  <span class=number>9</span>, <span class=number>11</span>,  <span class=number>5</span>,  </span><br><span class=line>     <span class=number>0</span>, <span class=number>14</span>,  <span class=number>7</span>, <span class=number>11</span>, <span class=number>10</span>,  <span class=number>4</span>, <span class=number>13</span>,  <span class=number>1</span>,  <span class=number>5</span>,  <span class=number>8</span>, <span class=number>12</span>,  <span class=number>6</span>,  <span class=number>9</span>,  <span class=number>3</span>,  <span class=number>2</span>, <span class=number>15</span>, </span><br><span class=line>    <span class=number>13</span>,  <span class=number>8</span>, <span class=number>10</span>,  <span class=number>1</span>,  <span class=number>3</span>, <span class=number>15</span>,  <span class=number>4</span>,  <span class=number>2</span>, <span class=number>11</span>,  <span class=number>6</span>,  <span class=number>7</span>, <span class=number>12</span>,  <span class=number>0</span>,  <span class=number>5</span>, <span class=number>14</span>,  <span class=number>9</span></span><br><span class=line>},{</span><br><span class=line>    <span class=comment>/* S3 */</span></span><br><span class=line>    <span class=number>10</span>,  <span class=number>0</span>,  <span class=number>9</span>, <span class=number>14</span>,  <span class=number>6</span>,  <span class=number>3</span>, <span class=number>15</span>,  <span class=number>5</span>,  <span class=number>1</span>, <span class=number>13</span>, <span class=number>12</span>,  <span class=number>7</span>, <span class=number>11</span>,  <span class=number>4</span>,  <span class=number>2</span>,  <span class=number>8</span>,  </span><br><span class=line>    <span class=number>13</span>,  <span class=number>7</span>,  <span class=number>0</span>,  <span class=number>9</span>,  <span class=number>3</span>,  <span class=number>4</span>,  <span class=number>6</span>, <span class=number>10</span>,  <span class=number>2</span>,  <span class=number>8</span>,  <span class=number>5</span>, <span class=number>14</span>, <span class=number>12</span>, <span class=number>11</span>, <span class=number>15</span>,  <span class=number>1</span>,  </span><br><span class=line>    <span class=number>13</span>,  <span class=number>6</span>,  <span class=number>4</span>,  <span class=number>9</span>,  <span class=number>8</span>, <span class=number>15</span>,  <span class=number>3</span>,  <span class=number>0</span>, <span class=number>11</span>,  <span class=number>1</span>,  <span class=number>2</span>, <span class=number>12</span>,  <span class=number>5</span>, <span class=number>10</span>, <span class=number>14</span>,  <span class=number>7</span>,</span><br><span class=line>     <span class=number>1</span>, <span class=number>10</span>, <span class=number>13</span>,  <span class=number>0</span>,  <span class=number>6</span>,  <span class=number>9</span>,  <span class=number>8</span>,  <span class=number>7</span>,  <span class=number>4</span>, <span class=number>15</span>, <span class=number>14</span>,  <span class=number>3</span>, <span class=number>11</span>,  <span class=number>5</span>,  <span class=number>2</span>, <span class=number>12</span></span><br><span class=line>},{</span><br><span class=line>    <span class=comment>/* S4 */</span></span><br><span class=line>     <span class=number>7</span>, <span class=number>13</span>, <span class=number>14</span>,  <span class=number>3</span>,  <span class=number>0</span>,  <span class=number>6</span>,  <span class=number>9</span>, <span class=number>10</span>,  <span class=number>1</span>,  <span class=number>2</span>,  <span class=number>8</span>,  <span class=number>5</span>, <span class=number>11</span>, <span class=number>12</span>,  <span class=number>4</span>, <span class=number>15</span>,  </span><br><span class=line>    <span class=number>13</span>,  <span class=number>8</span>, <span class=number>11</span>,  <span class=number>5</span>,  <span class=number>6</span>, <span class=number>15</span>,  <span class=number>0</span>,  <span class=number>3</span>,  <span class=number>4</span>,  <span class=number>7</span>,  <span class=number>2</span>, <span class=number>12</span>,  <span class=number>1</span>, <span class=number>10</span>, <span class=number>14</span>,  <span class=number>9</span>,  </span><br><span class=line>    <span class=number>10</span>,  <span class=number>6</span>,  <span class=number>9</span>,  <span class=number>0</span>, <span class=number>12</span>, <span class=number>11</span>,  <span class=number>7</span>, <span class=number>13</span>, <span class=number>15</span>,  <span class=number>1</span>,  <span class=number>3</span>, <span class=number>14</span>,  <span class=number>5</span>,  <span class=number>2</span>,  <span class=number>8</span>,  <span class=number>4</span>,</span><br><span class=line>     <span class=number>3</span>, <span class=number>15</span>,  <span class=number>0</span>,  <span class=number>6</span>, <span class=number>10</span>,  <span class=number>1</span>, <span class=number>13</span>,  <span class=number>8</span>,  <span class=number>9</span>,  <span class=number>4</span>,  <span class=number>5</span>, <span class=number>11</span>, <span class=number>12</span>,  <span class=number>7</span>,  <span class=number>2</span>, <span class=number>14</span></span><br><span class=line>},{</span><br><span class=line>    <span class=comment>/* S5 */</span></span><br><span class=line>     <span class=number>2</span>, <span class=number>12</span>,  <span class=number>4</span>,  <span class=number>1</span>,  <span class=number>7</span>, <span class=number>10</span>, <span class=number>11</span>,  <span class=number>6</span>,  <span class=number>8</span>,  <span class=number>5</span>,  <span class=number>3</span>, <span class=number>15</span>, <span class=number>13</span>,  <span class=number>0</span>, <span class=number>14</span>,  <span class=number>9</span>, </span><br><span class=line>    <span class=number>14</span>, <span class=number>11</span>,  <span class=number>2</span>, <span class=number>12</span>,  <span class=number>4</span>,  <span class=number>7</span>, <span class=number>13</span>,  <span class=number>1</span>,  <span class=number>5</span>,  <span class=number>0</span>, <span class=number>15</span>, <span class=number>10</span>,  <span class=number>3</span>,  <span class=number>9</span>,  <span class=number>8</span>,  <span class=number>6</span>, </span><br><span class=line>     <span class=number>4</span>,  <span class=number>2</span>,  <span class=number>1</span>, <span class=number>11</span>, <span class=number>10</span>, <span class=number>13</span>,  <span class=number>7</span>,  <span class=number>8</span>, <span class=number>15</span>,  <span class=number>9</span>, <span class=number>12</span>,  <span class=number>5</span>,  <span class=number>6</span>,  <span class=number>3</span>,  <span class=number>0</span>, <span class=number>14</span>, </span><br><span class=line>    <span class=number>11</span>,  <span class=number>8</span>, <span class=number>12</span>,  <span class=number>7</span>,  <span class=number>1</span>, <span class=number>14</span>,  <span class=number>2</span>, <span class=number>13</span>,  <span class=number>6</span>, <span class=number>15</span>,  <span class=number>0</span>,  <span class=number>9</span>, <span class=number>10</span>,  <span class=number>4</span>,  <span class=number>5</span>,  <span class=number>3</span></span><br><span class=line>},{</span><br><span class=line>    <span class=comment>/* S6 */</span></span><br><span class=line>    <span class=number>12</span>,  <span class=number>1</span>, <span class=number>10</span>, <span class=number>15</span>,  <span class=number>9</span>,  <span class=number>2</span>,  <span class=number>6</span>,  <span class=number>8</span>,  <span class=number>0</span>, <span class=number>13</span>,  <span class=number>3</span>,  <span class=number>4</span>, <span class=number>14</span>,  <span class=number>7</span>,  <span class=number>5</span>, <span class=number>11</span>,</span><br><span class=line>    <span class=number>10</span>, <span class=number>15</span>,  <span class=number>4</span>,  <span class=number>2</span>,  <span class=number>7</span>, <span class=number>12</span>,  <span class=number>9</span>,  <span class=number>5</span>,  <span class=number>6</span>,  <span class=number>1</span>, <span class=number>13</span>, <span class=number>14</span>,  <span class=number>0</span>, <span class=number>11</span>,  <span class=number>3</span>,  <span class=number>8</span>,</span><br><span class=line>     <span class=number>9</span>, <span class=number>14</span>, <span class=number>15</span>,  <span class=number>5</span>,  <span class=number>2</span>,  <span class=number>8</span>, <span class=number>12</span>,  <span class=number>3</span>,  <span class=number>7</span>,  <span class=number>0</span>,  <span class=number>4</span>, <span class=number>10</span>,  <span class=number>1</span>, <span class=number>13</span>, <span class=number>11</span>,  <span class=number>6</span>,</span><br><span class=line>     <span class=number>4</span>,  <span class=number>3</span>,  <span class=number>2</span>, <span class=number>12</span>,  <span class=number>9</span>,  <span class=number>5</span>, <span class=number>15</span>, <span class=number>10</span>, <span class=number>11</span>, <span class=number>14</span>,  <span class=number>1</span>,  <span class=number>7</span>,  <span class=number>6</span>,  <span class=number>0</span>,  <span class=number>8</span>, <span class=number>13</span></span><br><span class=line>},{</span><br><span class=line>    <span class=comment>/* S7 */</span></span><br><span class=line>     <span class=number>4</span>, <span class=number>11</span>,  <span class=number>2</span>, <span class=number>14</span>, <span class=number>15</span>,  <span class=number>0</span>,  <span class=number>8</span>, <span class=number>13</span>,  <span class=number>3</span>, <span class=number>12</span>,  <span class=number>9</span>,  <span class=number>7</span>,  <span class=number>5</span>, <span class=number>10</span>,  <span class=number>6</span>,  <span class=number>1</span>,</span><br><span class=line>    <span class=number>13</span>,  <span class=number>0</span>, <span class=number>11</span>,  <span class=number>7</span>,  <span class=number>4</span>,  <span class=number>9</span>,  <span class=number>1</span>, <span class=number>10</span>, <span class=number>14</span>,  <span class=number>3</span>,  <span class=number>5</span>, <span class=number>12</span>,  <span class=number>2</span>, <span class=number>15</span>,  <span class=number>8</span>,  <span class=number>6</span>,</span><br><span class=line>     <span class=number>1</span>,  <span class=number>4</span>, <span class=number>11</span>, <span class=number>13</span>, <span class=number>12</span>,  <span class=number>3</span>,  <span class=number>7</span>, <span class=number>14</span>, <span class=number>10</span>, <span class=number>15</span>,  <span class=number>6</span>,  <span class=number>8</span>,  <span class=number>0</span>,  <span class=number>5</span>,  <span class=number>9</span>,  <span class=number>2</span>,</span><br><span class=line>     <span class=number>6</span>, <span class=number>11</span>, <span class=number>13</span>,  <span class=number>8</span>,  <span class=number>1</span>,  <span class=number>4</span>, <span class=number>10</span>,  <span class=number>7</span>,  <span class=number>9</span>,  <span class=number>5</span>,  <span class=number>0</span>, <span class=number>15</span>, <span class=number>14</span>,  <span class=number>2</span>,  <span class=number>3</span>, <span class=number>12</span></span><br><span class=line>},{</span><br><span class=line>    <span class=comment>/* S8 */</span></span><br><span class=line>    <span class=number>13</span>,  <span class=number>2</span>,  <span class=number>8</span>,  <span class=number>4</span>,  <span class=number>6</span>, <span class=number>15</span>, <span class=number>11</span>,  <span class=number>1</span>, <span class=number>10</span>,  <span class=number>9</span>,  <span class=number>3</span>, <span class=number>14</span>,  <span class=number>5</span>,  <span class=number>0</span>, <span class=number>12</span>,  <span class=number>7</span>,</span><br><span class=line>     <span class=number>1</span>, <span class=number>15</span>, <span class=number>13</span>,  <span class=number>8</span>, <span class=number>10</span>,  <span class=number>3</span>,  <span class=number>7</span>,  <span class=number>4</span>, <span class=number>12</span>,  <span class=number>5</span>,  <span class=number>6</span>, <span class=number>11</span>,  <span class=number>0</span>, <span class=number>14</span>,  <span class=number>9</span>,  <span class=number>2</span>,</span><br><span class=line>     <span class=number>7</span>, <span class=number>11</span>,  <span class=number>4</span>,  <span class=number>1</span>,  <span class=number>9</span>, <span class=number>12</span>, <span class=number>14</span>,  <span class=number>2</span>,  <span class=number>0</span>,  <span class=number>6</span>, <span class=number>10</span>, <span class=number>13</span>, <span class=number>15</span>,  <span class=number>3</span>,  <span class=number>5</span>,  <span class=number>8</span>,</span><br><span class=line>     <span class=number>2</span>,  <span class=number>1</span>, <span class=number>14</span>,  <span class=number>7</span>,  <span class=number>4</span>, <span class=number>10</span>,  <span class=number>8</span>, <span class=number>13</span>, <span class=number>15</span>, <span class=number>12</span>,  <span class=number>9</span>,  <span class=number>0</span>,  <span class=number>3</span>,  <span class=number>5</span>,  <span class=number>6</span>, <span class=number>11</span></span><br><span class=line>}};</span><br><span class=line></span><br><span class=line><span class=comment>/* Permuted Choice 1 Table */</span></span><br><span class=line><span class=type>static</span> <span class=type>char</span> PC1[] = {</span><br><span class=line>    <span class=number>57</span>, <span class=number>49</span>, <span class=number>41</span>, <span class=number>33</span>, <span class=number>25</span>, <span class=number>17</span>,  <span class=number>9</span>,</span><br><span class=line>     <span class=number>1</span>, <span class=number>58</span>, <span class=number>50</span>, <span class=number>42</span>, <span class=number>34</span>, <span class=number>26</span>, <span class=number>18</span>,</span><br><span class=line>    <span class=number>10</span>,  <span class=number>2</span>, <span class=number>59</span>, <span class=number>51</span>, <span class=number>43</span>, <span class=number>35</span>, <span class=number>27</span>,</span><br><span class=line>    <span class=number>19</span>, <span class=number>11</span>,  <span class=number>3</span>, <span class=number>60</span>, <span class=number>52</span>, <span class=number>44</span>, <span class=number>36</span>,</span><br><span class=line>    </span><br><span class=line>    <span class=number>63</span>, <span class=number>55</span>, <span class=number>47</span>, <span class=number>39</span>, <span class=number>31</span>, <span class=number>23</span>, <span class=number>15</span>,</span><br><span class=line>     <span class=number>7</span>, <span class=number>62</span>, <span class=number>54</span>, <span class=number>46</span>, <span class=number>38</span>, <span class=number>30</span>, <span class=number>22</span>,</span><br><span class=line>    <span class=number>14</span>,  <span class=number>6</span>, <span class=number>61</span>, <span class=number>53</span>, <span class=number>45</span>, <span class=number>37</span>, <span class=number>29</span>,</span><br><span class=line>    <span class=number>21</span>, <span class=number>13</span>,  <span class=number>5</span>, <span class=number>28</span>, <span class=number>20</span>, <span class=number>12</span>,  <span class=number>4</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/* Permuted Choice 2 Table */</span></span><br><span class=line><span class=type>static</span> <span class=type>char</span> PC2[] = {</span><br><span class=line>    <span class=number>14</span>, <span class=number>17</span>, <span class=number>11</span>, <span class=number>24</span>,  <span class=number>1</span>,  <span class=number>5</span>,</span><br><span class=line>     <span class=number>3</span>, <span class=number>28</span>, <span class=number>15</span>,  <span class=number>6</span>, <span class=number>21</span>, <span class=number>10</span>,</span><br><span class=line>    <span class=number>23</span>, <span class=number>19</span>, <span class=number>12</span>,  <span class=number>4</span>, <span class=number>26</span>,  <span class=number>8</span>,</span><br><span class=line>    <span class=number>16</span>,  <span class=number>7</span>, <span class=number>27</span>, <span class=number>20</span>, <span class=number>13</span>,  <span class=number>2</span>,</span><br><span class=line>    <span class=number>41</span>, <span class=number>52</span>, <span class=number>31</span>, <span class=number>37</span>, <span class=number>47</span>, <span class=number>55</span>,</span><br><span class=line>    <span class=number>30</span>, <span class=number>40</span>, <span class=number>51</span>, <span class=number>45</span>, <span class=number>33</span>, <span class=number>48</span>,</span><br><span class=line>    <span class=number>44</span>, <span class=number>49</span>, <span class=number>39</span>, <span class=number>56</span>, <span class=number>34</span>, <span class=number>53</span>,</span><br><span class=line>    <span class=number>46</span>, <span class=number>42</span>, <span class=number>50</span>, <span class=number>36</span>, <span class=number>29</span>, <span class=number>32</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/* Iteration Shift Array */</span></span><br><span class=line><span class=type>static</span> <span class=type>char</span> iteration_shift[] = {</span><br><span class=line> <span class=comment>/* 1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16 */</span></span><br><span class=line>    <span class=number>1</span>,  <span class=number>1</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>1</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>2</span>,  <span class=number>1</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * The DES function</span></span><br><span class=line><span class=comment> * input: 64 bit message</span></span><br><span class=line><span class=comment> * key: 64 bit key for encryption/decryption</span></span><br><span class=line><span class=comment> * mode: 'e' = encryption; 'd' = decryption</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>uint64_t</span> <span class=title>des</span><span class=params>(<span class=type>uint64_t</span> input, <span class=type>uint64_t</span> key, <span class=type>char</span> mode)</span> </span>{</span><br><span class=line>    </span><br><span class=line>    <span class=type>int</span> i, j;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>/* 8 bits */</span></span><br><span class=line>    <span class=type>char</span> row, column;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>/* 28 bits */</span></span><br><span class=line>    <span class=type>uint32_t</span> C                  = <span class=number>0</span>;</span><br><span class=line>    <span class=type>uint32_t</span> D                  = <span class=number>0</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>/* 32 bits */</span></span><br><span class=line>    <span class=type>uint32_t</span> L                  = <span class=number>0</span>;</span><br><span class=line>    <span class=type>uint32_t</span> R                  = <span class=number>0</span>;</span><br><span class=line>    <span class=type>uint32_t</span> s_output           = <span class=number>0</span>;</span><br><span class=line>    <span class=type>uint32_t</span> f_function_res     = <span class=number>0</span>;</span><br><span class=line>    <span class=type>uint32_t</span> temp               = <span class=number>0</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>/* 48 bits */</span></span><br><span class=line>    <span class=type>uint64_t</span> sub_key[<span class=number>16</span>]        = {<span class=number>0</span>};</span><br><span class=line>    <span class=type>uint64_t</span> s_input            = <span class=number>0</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>/* 56 bits */</span></span><br><span class=line>    <span class=type>uint64_t</span> permuted_choice_1  = <span class=number>0</span>;</span><br><span class=line>    <span class=type>uint64_t</span> permuted_choice_2  = <span class=number>0</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>/* 64 bits */</span></span><br><span class=line>    <span class=type>uint64_t</span> init_perm_res      = <span class=number>0</span>;</span><br><span class=line>    <span class=type>uint64_t</span> inv_init_perm_res  = <span class=number>0</span>;</span><br><span class=line>    <span class=type>uint64_t</span> pre_output         = <span class=number>0</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>/* initial permutation */</span></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>64</span>; i++) {</span><br><span class=line>        </span><br><span class=line>        init_perm_res &lt;&lt;= <span class=number>1</span>;</span><br><span class=line>        init_perm_res |= (input &gt;&gt; (<span class=number>64</span>-IP[i])) &amp; LB64_MASK;</span><br><span class=line>        </span><br><span class=line>    }</span><br><span class=line>    </span><br><span class=line>    L = (<span class=type>uint32_t</span>) (init_perm_res &gt;&gt; <span class=number>32</span>) &amp; L64_MASK;</span><br><span class=line>    R = (<span class=type>uint32_t</span>) init_perm_res &amp; L64_MASK;</span><br><span class=line>        </span><br><span class=line>    <span class=comment>/* initial key schedule calculation */</span></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>56</span>; i++) {</span><br><span class=line>        </span><br><span class=line>        permuted_choice_1 &lt;&lt;= <span class=number>1</span>;</span><br><span class=line>        permuted_choice_1 |= (key &gt;&gt; (<span class=number>64</span>-PC1[i])) &amp; LB64_MASK;</span><br><span class=line></span><br><span class=line>    }</span><br><span class=line>    </span><br><span class=line>    C = (<span class=type>uint32_t</span>) ((permuted_choice_1 &gt;&gt; <span class=number>28</span>) &amp; <span class=number>0x000000000fffffff</span>);</span><br><span class=line>    D = (<span class=type>uint32_t</span>) (permuted_choice_1 &amp; <span class=number>0x000000000fffffff</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>/* Calculation of the 16 keys */</span></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i&lt; <span class=number>16</span>; i++) {</span><br><span class=line>        </span><br><span class=line>        <span class=comment>/* key schedule */</span></span><br><span class=line>        <span class=comment>// shifting Ci and Di</span></span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; iteration_shift[i]; j++) {</span><br><span class=line>            </span><br><span class=line>            C = <span class=number>0x0fffffff</span> &amp; (C &lt;&lt; <span class=number>1</span>) | <span class=number>0x00000001</span> &amp; (C &gt;&gt; <span class=number>27</span>);</span><br><span class=line>            D = <span class=number>0x0fffffff</span> &amp; (D &lt;&lt; <span class=number>1</span>) | <span class=number>0x00000001</span> &amp; (D &gt;&gt; <span class=number>27</span>);</span><br><span class=line>            </span><br><span class=line>        }</span><br><span class=line>        </span><br><span class=line>        permuted_choice_2 = <span class=number>0</span>;</span><br><span class=line>        permuted_choice_2 = (((<span class=type>uint64_t</span>) C) &lt;&lt; <span class=number>28</span>) | (<span class=type>uint64_t</span>) D ;</span><br><span class=line>        </span><br><span class=line>        sub_key[i] = <span class=number>0</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; <span class=number>48</span>; j++) {</span><br><span class=line>            </span><br><span class=line>            sub_key[i] &lt;&lt;= <span class=number>1</span>;</span><br><span class=line>            sub_key[i] |= (permuted_choice_2 &gt;&gt; (<span class=number>56</span>-PC2[j])) &amp; LB64_MASK;</span><br><span class=line>            </span><br><span class=line>        }</span><br><span class=line>        </span><br><span class=line>    }</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i++) {</span><br><span class=line>        </span><br><span class=line>        <span class=comment>/* f(R,k) function */</span></span><br><span class=line>        s_input = <span class=number>0</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j&lt; <span class=number>48</span>; j++) {</span><br><span class=line>            </span><br><span class=line>            s_input &lt;&lt;= <span class=number>1</span>;</span><br><span class=line>            s_input |= (<span class=type>uint64_t</span>) ((R &gt;&gt; (<span class=number>32</span>-E[j])) &amp; LB32_MASK);</span><br><span class=line>            </span><br><span class=line>        }</span><br><span class=line>        </span><br><span class=line>        <span class=comment>/* </span></span><br><span class=line><span class=comment>         * Encryption/Decryption </span></span><br><span class=line><span class=comment>         * XORing expanded Ri with Ki</span></span><br><span class=line><span class=comment>         */</span></span><br><span class=line>        <span class=keyword>if</span> (mode == <span class=string>'d'</span>) {</span><br><span class=line>            <span class=comment>// decryption</span></span><br><span class=line>            s_input = s_input ^ sub_key[<span class=number>15</span>-i];</span><br><span class=line>            </span><br><span class=line>        } <span class=keyword>else</span> {</span><br><span class=line>            <span class=comment>// encryption</span></span><br><span class=line>            s_input = s_input ^ sub_key[i];</span><br><span class=line>            </span><br><span class=line>        }</span><br><span class=line>        </span><br><span class=line>        <span class=comment>/* S-Box Tables */</span></span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; <span class=number>8</span>; j++) {</span><br><span class=line>            <span class=comment>// 00 00 RCCC CR00 00 00 00 00 00 s_input</span></span><br><span class=line>            <span class=comment>// 00 00 1000 0100 00 00 00 00 00 row mask</span></span><br><span class=line>            <span class=comment>// 00 00 0111 1000 00 00 00 00 00 column mask</span></span><br><span class=line>            </span><br><span class=line>            row = (<span class=type>char</span>) ((s_input &amp; (<span class=number>0x0000840000000000</span> &gt;&gt; <span class=number>6</span>*j)) &gt;&gt; <span class=number>42</span><span class=number>-6</span>*j);</span><br><span class=line>            row = (row &gt;&gt; <span class=number>4</span>) | row &amp; <span class=number>0x01</span>;</span><br><span class=line>            </span><br><span class=line>            column = (<span class=type>char</span>) ((s_input &amp; (<span class=number>0x0000780000000000</span> &gt;&gt; <span class=number>6</span>*j)) &gt;&gt; <span class=number>43</span><span class=number>-6</span>*j);</span><br><span class=line>            </span><br><span class=line>            s_output &lt;&lt;= <span class=number>4</span>;</span><br><span class=line>            s_output |= (<span class=type>uint32_t</span>) (S[j][<span class=number>16</span>*row + column] &amp; <span class=number>0x0f</span>);</span><br><span class=line>            </span><br><span class=line>        }</span><br><span class=line>        </span><br><span class=line>        f_function_res = <span class=number>0</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; <span class=number>32</span>; j++) {</span><br><span class=line>            </span><br><span class=line>            f_function_res &lt;&lt;= <span class=number>1</span>;</span><br><span class=line>            f_function_res |= (s_output &gt;&gt; (<span class=number>32</span> - P[j])) &amp; LB32_MASK;</span><br><span class=line>            </span><br><span class=line>        }</span><br><span class=line>        </span><br><span class=line>        temp = R;</span><br><span class=line>        R = L ^ f_function_res;</span><br><span class=line>        L = temp;</span><br><span class=line>        </span><br><span class=line>    }</span><br><span class=line>    </span><br><span class=line>    pre_output = (((<span class=type>uint64_t</span>) R) &lt;&lt; <span class=number>32</span>) | (<span class=type>uint64_t</span>) L;</span><br><span class=line>        </span><br><span class=line>    <span class=comment>/* inverse initial permutation */</span></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>64</span>; i++) {</span><br><span class=line>        </span><br><span class=line>        inv_init_perm_res &lt;&lt;= <span class=number>1</span>;</span><br><span class=line>        inv_init_perm_res |= (pre_output &gt;&gt; (<span class=number>64</span>-PI[i])) &amp; LB64_MASK;</span><br><span class=line>        </span><br><span class=line>    }</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> inv_init_perm_res;</span><br><span class=line>    </span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>(<span class=type>int</span> argc, <span class=type>const</span> <span class=type>char</span> * argv[])</span> </span>{</span><br><span class=line></span><br><span class=line>    <span class=type>int</span> i;</span><br><span class=line>    </span><br><span class=line>    <span class=type>uint64_t</span> input = <span class=number>0x9474B8E8C73BCA7D</span>;</span><br><span class=line>    <span class=type>uint64_t</span> key = <span class=number>0x0000000000000000</span>;</span><br><span class=line>    <span class=type>uint64_t</span> result = input;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>/*</span></span><br><span class=line><span class=comment>     * TESTING IMPLEMENTATION OF DES</span></span><br><span class=line><span class=comment>     * Ronald L. Rivest </span></span><br><span class=line><span class=comment>     * X0:  9474B8E8C73BCA7D</span></span><br><span class=line><span class=comment>     * X16: 1B1A2DDB4C642438</span></span><br><span class=line><span class=comment>     *</span></span><br><span class=line><span class=comment>     * OUTPUT:</span></span><br><span class=line><span class=comment>     * E: 8da744e0c94e5e17</span></span><br><span class=line><span class=comment>     * D: 0cdb25e3ba3c6d79</span></span><br><span class=line><span class=comment>     * E: 4784c4ba5006081f</span></span><br><span class=line><span class=comment>     * D: 1cf1fc126f2ef842</span></span><br><span class=line><span class=comment>     * E: e4be250042098d13</span></span><br><span class=line><span class=comment>     * D: 7bfc5dc6adb5797c</span></span><br><span class=line><span class=comment>     * E: 1ab3b4d82082fb28</span></span><br><span class=line><span class=comment>     * D: c1576a14de707097</span></span><br><span class=line><span class=comment>     * E: 739b68cd2e26782a</span></span><br><span class=line><span class=comment>     * D: 2a59f0c464506edb</span></span><br><span class=line><span class=comment>     * E: a5c39d4251f0a81e</span></span><br><span class=line><span class=comment>     * D: 7239ac9a6107ddb1</span></span><br><span class=line><span class=comment>     * E: 070cac8590241233</span></span><br><span class=line><span class=comment>     * D: 78f87b6e3dfecf61</span></span><br><span class=line><span class=comment>     * E: 95ec2578c2c433f0</span></span><br><span class=line><span class=comment>     * D: 1b1a2ddb4c642438  &lt;-- X16</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>16</span>; i++) {</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (i%<span class=number>2</span> == <span class=number>0</span>) {</span><br><span class=line>            </span><br><span class=line>            result = <span class=built_in>des</span>(result, result, <span class=string>'e'</span>);</span><br><span class=line>            <span class=built_in>printf</span> (<span class=string>"E: %016llx\n"</span>, result);</span><br><span class=line>            </span><br><span class=line>        } <span class=keyword>else</span> {</span><br><span class=line>            </span><br><span class=line>            result = <span class=built_in>des</span>(result, result, <span class=string>'d'</span>);</span><br><span class=line>            <span class=built_in>printf</span> (<span class=string>"D: %016llx\n"</span>, result);</span><br><span class=line>            </span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    </span><br><span class=line>    <span class=comment>//result = des(input, key, 'e');</span></span><br><span class=line>    <span class=comment>//printf ("E: %016llx\n", result);</span></span><br><span class=line>    </span><br><span class=line>    <span class=comment>//result = des(result, key, 'd');</span></span><br><span class=line>    <span class=comment>//printf ("D: %016llx\n", result);</span></span><br><span class=line>    </span><br><span class=line>    <span class=built_in>exit</span>(<span class=number>0</span>);</span><br><span class=line>    </span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=BASE58><a href=#BASE58 class=headerlink title=BASE58></a>BASE58</h2><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdlib.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;string.h&gt;</span></span></span><br><span class=line> </span><br><span class=line><span class=function><span class=type>unsigned</span> <span class=type>char</span>* <span class=title>en_base58</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span>* input)</span>  <span class=comment>// 编码</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>static</span> <span class=type>char</span>* nb58 = (<span class=type>char</span>*)<span class=string>"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"</span>;</span><br><span class=line>    <span class=type>size_t</span> len = <span class=built_in>strlen</span>((<span class=type>char</span>*)input);</span><br><span class=line>    <span class=type>size_t</span> rlen = (len / <span class=number>2</span> + <span class=number>1</span>) * <span class=number>3</span>;</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span>* ret = (<span class=type>unsigned</span> <span class=type>char</span>*)<span class=built_in>malloc</span>(rlen + len);</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span>* src = ret + rlen;</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span>* rptr = ret + rlen;</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span>* ptr, * e = src + len - <span class=number>1</span>;</span><br><span class=line>    <span class=type>size_t</span> i;</span><br><span class=line>    <span class=built_in>memcpy</span>(src, input, len);</span><br><span class=line>    <span class=keyword>while</span> (src &lt;= e)</span><br><span class=line>    {</span><br><span class=line>        <span class=keyword>if</span> (*src)</span><br><span class=line>        {</span><br><span class=line>            <span class=type>unsigned</span> <span class=type>char</span> rest = <span class=number>0</span>;</span><br><span class=line>            ptr = src;</span><br><span class=line>            <span class=keyword>while</span> (ptr &lt;= e)</span><br><span class=line>            {</span><br><span class=line>                <span class=type>unsigned</span> <span class=type>int</span> c = rest * <span class=number>256</span>;</span><br><span class=line>                rest = (c + *ptr) % <span class=number>58</span>;</span><br><span class=line>                *ptr = (c + *ptr) / <span class=number>58</span>;</span><br><span class=line>                ptr++;</span><br><span class=line>            }</span><br><span class=line>            --rptr;</span><br><span class=line>            *rptr = nb58[rest];</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>else</span></span><br><span class=line>        {</span><br><span class=line>            src++;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; ret + rlen - rptr; i++)</span><br><span class=line>        ret[i] = rptr[i];</span><br><span class=line>    ret[i] = <span class=number>0</span>;</span><br><span class=line>    <span class=keyword>return</span> ret;</span><br><span class=line>}</span><br><span class=line> </span><br><span class=line><span class=function><span class=type>bool</span> <span class=title>de_base58</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span>* src)</span>  <span class=comment>// 解码</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>static</span> <span class=type>char</span> b58n[] =</span><br><span class=line>    {</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>,  <span class=number>0</span>,  <span class=number>1</span>,  <span class=number>2</span>,  <span class=number>3</span>,  <span class=number>4</span>,  <span class=number>5</span>,  <span class=number>6</span>,  <span class=number>7</span>,  <span class=number>8</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>,  <span class=number>9</span>, <span class=number>10</span>, <span class=number>11</span>, <span class=number>12</span>, <span class=number>13</span>, <span class=number>14</span>, <span class=number>15</span>, <span class=number>16</span>, <span class=number>-1</span>, <span class=number>17</span>, <span class=number>18</span>, <span class=number>19</span>, <span class=number>20</span>, <span class=number>21</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>22</span>, <span class=number>23</span>, <span class=number>24</span>, <span class=number>25</span>, <span class=number>26</span>, <span class=number>27</span>, <span class=number>28</span>, <span class=number>29</span>, <span class=number>30</span>, <span class=number>31</span>, <span class=number>32</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>33</span>, <span class=number>34</span>, <span class=number>35</span>, <span class=number>36</span>, <span class=number>37</span>, <span class=number>38</span>, <span class=number>39</span>, <span class=number>40</span>, <span class=number>41</span>, <span class=number>42</span>, <span class=number>43</span>, <span class=number>-1</span>, <span class=number>44</span>, <span class=number>45</span>, <span class=number>46</span>,</span><br><span class=line>        <span class=number>47</span>, <span class=number>48</span>, <span class=number>49</span>, <span class=number>50</span>, <span class=number>51</span>, <span class=number>52</span>, <span class=number>53</span>, <span class=number>54</span>, <span class=number>55</span>, <span class=number>56</span>, <span class=number>57</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>        <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>, <span class=number>-1</span>,</span><br><span class=line>    };</span><br><span class=line>    <span class=type>size_t</span> len = <span class=built_in>strlen</span>((<span class=type>char</span>*)src);</span><br><span class=line>    <span class=type>size_t</span> rlen = (len / <span class=number>4</span> + <span class=number>1</span>) * <span class=number>3</span>;</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span>* ret = (<span class=type>unsigned</span> <span class=type>char</span>*)<span class=built_in>malloc</span>(rlen);</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span>* rptr = ret + rlen;</span><br><span class=line>    <span class=type>size_t</span> i;</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span>* ptr;</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; len; i++)</span><br><span class=line>    {</span><br><span class=line>        <span class=type>char</span> rest = b58n[src[i]];</span><br><span class=line>        <span class=keyword>if</span> (rest &lt; <span class=number>0</span>)</span><br><span class=line>        {</span><br><span class=line>            <span class=built_in>free</span>(ret);</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>NULL</span>;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>for</span> (ptr = ret + rlen - <span class=number>1</span>; ptr &gt;= rptr; ptr--)</span><br><span class=line>        {</span><br><span class=line>            <span class=type>unsigned</span> <span class=type>int</span> c = rest + *ptr * <span class=number>58</span>;</span><br><span class=line>            *ptr = c % <span class=number>256</span>;</span><br><span class=line>            rest = c / <span class=number>256</span>;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>if</span> (rest &gt; <span class=number>0</span>)</span><br><span class=line>        {</span><br><span class=line>            rptr--;</span><br><span class=line>            <span class=keyword>if</span> (rptr &lt; ret)</span><br><span class=line>            {</span><br><span class=line>                <span class=built_in>free</span>(ret);</span><br><span class=line>                <span class=keyword>return</span> <span class=literal>NULL</span>;</span><br><span class=line>            }</span><br><span class=line>            *rptr = rest;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; ret + rlen - rptr; i++)</span><br><span class=line>        ret[i] = rptr[i];</span><br><span class=line>    ret[i] = <span class=number>0</span>;</span><br><span class=line>    <span class=built_in>memcpy</span>(src, ret, <span class=built_in>strlen</span>((<span class=type>char</span>*)src));</span><br><span class=line>}</span><br><span class=line> </span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>char</span> str[] = <span class=string>"9EGJCxbxRGT"</span>;</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s\n"</span>, <span class=built_in>en_base58</span>((<span class=type>unsigned</span> <span class=type>char</span>*)<span class=string>"12345678"</span>));</span><br><span class=line>    <span class=built_in>de_base58</span>((<span class=type>unsigned</span> <span class=type>char</span>*)str);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s"</span>, str);</span><br><span class=line>    <span class=built_in>getchar</span>();</span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=SHA1><a href=#SHA1 class=headerlink title=SHA1></a>SHA1</h2><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdlib.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;string.h&gt;</span> </span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> rol(x,y) ((x<span class=string>&lt;&lt;y)|(x&gt;</span>&gt;(32-y)))  <span class=comment>//循环左移 </span></span></span><br><span class=line></span><br><span class=line><span class=comment>//一次循环过程，str为填充后的数据或是数据中的一部分 </span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>round</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> str[<span class=number>64</span>],<span class=type>unsigned</span> <span class=type>int</span> h[<span class=number>5</span>])</span></span>{</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>int</span> a, b, c, d, e,tmp,w[<span class=number>80</span>];</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>int</span> i;</span><br><span class=line>	<span class=keyword>for</span>(i=<span class=number>0</span>;i&lt;<span class=number>16</span>;i++){</span><br><span class=line>		w[i]=((<span class=type>unsigned</span> <span class=type>int</span>)str[i*<span class=number>4</span>]&lt;&lt;<span class=number>24</span>)|(((<span class=type>unsigned</span> <span class=type>int</span>)str[i*<span class=number>4</span><span class=number>+1</span>])&lt;&lt;<span class=number>16</span>)|</span><br><span class=line>						(((<span class=type>unsigned</span> <span class=type>int</span>)str[i*<span class=number>4</span><span class=number>+2</span>])&lt;&lt;<span class=number>8</span>)|(((<span class=type>unsigned</span> <span class=type>int</span>)str[i*<span class=number>4</span><span class=number>+3</span>])&lt;&lt;<span class=number>0</span>);</span><br><span class=line>	}</span><br><span class=line>	<span class=keyword>for</span> (i=<span class=number>16</span>;i&lt;<span class=number>80</span>;i++ ){</span><br><span class=line>		tmp = w[i<span class=number>-3</span>]^w[i<span class=number>-8</span>]^w[i<span class=number>-14</span>]^w[i<span class=number>-16</span>];</span><br><span class=line>		w[i]=<span class=built_in>rol</span>(tmp,<span class=number>1</span>);</span><br><span class=line>    }</span><br><span class=line>    </span><br><span class=line>    a=h[<span class=number>0</span>];b=h[<span class=number>1</span>];c=h[<span class=number>2</span>];d=h[<span class=number>3</span>];e=h[<span class=number>4</span>];</span><br><span class=line>    <span class=keyword>for</span>(i=<span class=number>0</span>;i&lt;<span class=number>80</span>;i++){</span><br><span class=line>    	<span class=keyword>switch</span>(i/<span class=number>20</span>){</span><br><span class=line>    		<span class=keyword>case</span> <span class=number>0</span>:tmp=<span class=built_in>rol</span>(a,<span class=number>5</span>)+((b&amp;c)|(d&amp;~b))+e+w[i]<span class=number>+0x5a827999</span>;<span class=keyword>break</span>;</span><br><span class=line>    		<span class=keyword>case</span> <span class=number>1</span>:tmp=<span class=built_in>rol</span>(a,<span class=number>5</span>)+(b^c^d)+e+w[i]<span class=number>+0x6ed9eba1</span>;<span class=keyword>break</span>;</span><br><span class=line>    		<span class=keyword>case</span> <span class=number>2</span>:tmp=<span class=built_in>rol</span>(a,<span class=number>5</span>)+((b&amp;c)|(b&amp;d)|(c&amp;d))+e+w[i] <span class=number>+0x8f1bbcdc</span>;<span class=keyword>break</span>;</span><br><span class=line>    		<span class=keyword>case</span> <span class=number>3</span>:tmp=<span class=built_in>rol</span>(a,<span class=number>5</span>)+(b^c^d)+e+w[i] + <span class=number>0xca62c1d6</span>;<span class=keyword>break</span>;</span><br><span class=line>		}</span><br><span class=line>		e=d;d=c;</span><br><span class=line>		c=<span class=built_in>rol</span>(b,<span class=number>30</span>);</span><br><span class=line>		b=a;a=tmp;</span><br><span class=line>	}</span><br><span class=line>	h[<span class=number>0</span>]+=a;h[<span class=number>1</span>]+=b;h[<span class=number>2</span>]+=c;h[<span class=number>3</span>]+=d;h[<span class=number>4</span>]+=e;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>//sha-1算法 </span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>sha1</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span>*input,<span class=type>long</span> <span class=type>long</span> len,<span class=type>unsigned</span> <span class=type>char</span>*output)</span></span>{</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> temp[<span class=number>64</span>];</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>int</span> h[<span class=number>5</span>]={<span class=number>0x67452301</span>,<span class=number>0xefcdab89</span>,<span class=number>0x98badcfe</span>,<span class=number>0x10325476</span>,<span class=number>0xc3d2e1f0</span>};</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>int</span> i,n=len,tmp;</span><br><span class=line>	<span class=keyword>while</span>(n&gt;=<span class=number>64</span>){</span><br><span class=line>		<span class=built_in>memcpy</span>(temp,input+len-n,<span class=number>64</span>);</span><br><span class=line>		<span class=built_in>round</span>(temp,h);</span><br><span class=line>		n-=<span class=number>64</span>;</span><br><span class=line>	}</span><br><span class=line>	</span><br><span class=line>	<span class=keyword>if</span>(n&gt;=<span class=number>56</span>){</span><br><span class=line>		<span class=built_in>memset</span>(temp,<span class=number>0</span>,<span class=number>64</span>);</span><br><span class=line>		<span class=built_in>memcpy</span>(temp,input+len-n,n);temp[n]=<span class=number>128</span>;</span><br><span class=line>		<span class=built_in>round</span>(temp,h);</span><br><span class=line>		<span class=built_in>memset</span>(temp,<span class=number>0</span>,<span class=number>64</span>);</span><br><span class=line>		<span class=keyword>for</span>(i=<span class=number>56</span>;i&lt;<span class=number>64</span>;i++)</span><br><span class=line>			temp[i]=((len*<span class=number>8</span>)&gt;&gt;(<span class=number>63</span>-i)*<span class=number>8</span>)&amp;<span class=number>0xff</span>;</span><br><span class=line>		<span class=built_in>round</span>(temp,h);</span><br><span class=line>	}</span><br><span class=line>	<span class=keyword>else</span>{</span><br><span class=line>		<span class=built_in>memset</span>(temp,<span class=number>0</span>,<span class=number>64</span>);</span><br><span class=line>		<span class=built_in>memcpy</span>(temp,input+len-n,n);temp[n]=<span class=number>128</span>;</span><br><span class=line>		<span class=keyword>for</span>(i=<span class=number>56</span>;i&lt;<span class=number>64</span>;i++)</span><br><span class=line>			temp[i]=((len*<span class=number>8</span>)&gt;&gt;(<span class=number>63</span>-i)*<span class=number>8</span>)&amp;<span class=number>0xff</span>;</span><br><span class=line>		<span class=built_in>round</span>(temp,h);	</span><br><span class=line>	}</span><br><span class=line>	</span><br><span class=line>	<span class=keyword>for</span>(i=<span class=number>0</span>;i&lt;<span class=number>20</span>;i++){</span><br><span class=line>		tmp=(h[i/<span class=number>4</span>]&gt;&gt;((<span class=number>3</span>-i%<span class=number>4</span>)*<span class=number>8</span>))&amp;<span class=number>0xff</span>;</span><br><span class=line>		<span class=built_in>sprintf</span>((<span class=type>char</span>*)output<span class=number>+2</span>*i,<span class=string>"%02x"</span>,tmp);</span><br><span class=line>	}</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>//测试 </span></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span></span>{</span><br><span class=line>	<span class=type>unsigned</span> <span class=type>char</span> input[]=<span class=string>"this is a test aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"</span>,output[<span class=number>40</span>]={<span class=number>0</span>};</span><br><span class=line>	<span class=built_in>sha1</span>(input,<span class=built_in>strlen</span>((<span class=type>char</span>*)input),output);</span><br><span class=line>	<span class=built_in>printf</span>(<span class=string>"%s\n"</span>,output);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br></pre></td></tr></table></figure><h2 id=CRC32><a href=#CRC32 class=headerlink title=CRC32></a>CRC32</h2><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br></pre></td><td class=code><pre><span class=line><span class=comment>/* crc32.c</span></span><br><span class=line><span class=comment>   Copyright (C) 2009-2024 Free Software Foundation, Inc.</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>   This file is part of the libiberty library.</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>   This file is free software; you can redistribute it and/or modify</span></span><br><span class=line><span class=comment>   it under the terms of the GNU General Public License as published by</span></span><br><span class=line><span class=comment>   the Free Software Foundation; either version 2 of the License, or</span></span><br><span class=line><span class=comment>   (at your option) any later version.</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>   In addition to the permissions in the GNU General Public License, the</span></span><br><span class=line><span class=comment>   Free Software Foundation gives you unlimited permission to link the</span></span><br><span class=line><span class=comment>   compiled version of this file into combinations with other programs,</span></span><br><span class=line><span class=comment>   and to distribute those combinations without any restriction coming</span></span><br><span class=line><span class=comment>   from the use of this file.  (The General Public License restrictions</span></span><br><span class=line><span class=comment>   do apply in other respects; for example, they cover modification of</span></span><br><span class=line><span class=comment>   the file, and distribution when not linked into a combined</span></span><br><span class=line><span class=comment>   executable.)</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>   This program is distributed in the hope that it will be useful,</span></span><br><span class=line><span class=comment>   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class=line><span class=comment>   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class=line><span class=comment>   GNU General Public License for more details.</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>   You should have received a copy of the GNU General Public License</span></span><br><span class=line><span class=comment>   along with this program; if not, write to the Free Software</span></span><br><span class=line><span class=comment>   Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA 02110-1301, USA.</span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>ifdef</span> HAVE_CONFIG_H</span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"config.h"</span></span></span><br><span class=line><span class=meta>#<span class=keyword>endif</span></span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"libiberty.h"</span></span></span><br><span class=line></span><br><span class=line><span class=comment>/* This table was generated by the following program.</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>   #include &lt;stdio.h&gt;</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>   int</span></span><br><span class=line><span class=comment>   main ()</span></span><br><span class=line><span class=comment>   {</span></span><br><span class=line><span class=comment>     unsigned int i, j;</span></span><br><span class=line><span class=comment>     unsigned int c;</span></span><br><span class=line><span class=comment>     int table[256];</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>     for (i = 0; i &lt; 256; i++)</span></span><br><span class=line><span class=comment>       {</span></span><br><span class=line><span class=comment>	 for (c = i &lt;&lt; 24, j = 8; j &gt; 0; --j)</span></span><br><span class=line><span class=comment>	   c = c &amp; 0x80000000 ? (c &lt;&lt; 1) ^ 0x04c11db7 : (c &lt;&lt; 1);</span></span><br><span class=line><span class=comment>	 table[i] = c;</span></span><br><span class=line><span class=comment>       }</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>     printf ("static const unsigned int crc32_table[] =\n{\n");</span></span><br><span class=line><span class=comment>     for (i = 0; i &lt; 256; i += 4)</span></span><br><span class=line><span class=comment>       {</span></span><br><span class=line><span class=comment>	 printf ("  0x%08x, 0x%08x, 0x%08x, 0x%08x",</span></span><br><span class=line><span class=comment>		 table[i + 0], table[i + 1], table[i + 2], table[i + 3]);</span></span><br><span class=line><span class=comment>	 if (i + 4 &lt; 256)</span></span><br><span class=line><span class=comment>	   putchar (',');</span></span><br><span class=line><span class=comment>	 putchar ('\n');</span></span><br><span class=line><span class=comment>       }</span></span><br><span class=line><span class=comment>     printf ("};\n");</span></span><br><span class=line><span class=comment>     return 0;</span></span><br><span class=line><span class=comment>   }</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>   For more information on CRC, see, e.g.,</span></span><br><span class=line><span class=comment>   http://www.ross.net/crc/download/crc_v3.txt.  */</span></span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>const</span> <span class=type>unsigned</span> <span class=type>int</span> crc32_table[] =</span><br><span class=line>{</span><br><span class=line>  <span class=number>0x00000000</span>, <span class=number>0x04c11db7</span>, <span class=number>0x09823b6e</span>, <span class=number>0x0d4326d9</span>,</span><br><span class=line>  <span class=number>0x130476dc</span>, <span class=number>0x17c56b6b</span>, <span class=number>0x1a864db2</span>, <span class=number>0x1e475005</span>,</span><br><span class=line>  <span class=number>0x2608edb8</span>, <span class=number>0x22c9f00f</span>, <span class=number>0x2f8ad6d6</span>, <span class=number>0x2b4bcb61</span>,</span><br><span class=line>  <span class=number>0x350c9b64</span>, <span class=number>0x31cd86d3</span>, <span class=number>0x3c8ea00a</span>, <span class=number>0x384fbdbd</span>,</span><br><span class=line>  <span class=number>0x4c11db70</span>, <span class=number>0x48d0c6c7</span>, <span class=number>0x4593e01e</span>, <span class=number>0x4152fda9</span>,</span><br><span class=line>  <span class=number>0x5f15adac</span>, <span class=number>0x5bd4b01b</span>, <span class=number>0x569796c2</span>, <span class=number>0x52568b75</span>,</span><br><span class=line>  <span class=number>0x6a1936c8</span>, <span class=number>0x6ed82b7f</span>, <span class=number>0x639b0da6</span>, <span class=number>0x675a1011</span>,</span><br><span class=line>  <span class=number>0x791d4014</span>, <span class=number>0x7ddc5da3</span>, <span class=number>0x709f7b7a</span>, <span class=number>0x745e66cd</span>,</span><br><span class=line>  <span class=number>0x9823b6e0</span>, <span class=number>0x9ce2ab57</span>, <span class=number>0x91a18d8e</span>, <span class=number>0x95609039</span>,</span><br><span class=line>  <span class=number>0x8b27c03c</span>, <span class=number>0x8fe6dd8b</span>, <span class=number>0x82a5fb52</span>, <span class=number>0x8664e6e5</span>,</span><br><span class=line>  <span class=number>0xbe2b5b58</span>, <span class=number>0xbaea46ef</span>, <span class=number>0xb7a96036</span>, <span class=number>0xb3687d81</span>,</span><br><span class=line>  <span class=number>0xad2f2d84</span>, <span class=number>0xa9ee3033</span>, <span class=number>0xa4ad16ea</span>, <span class=number>0xa06c0b5d</span>,</span><br><span class=line>  <span class=number>0xd4326d90</span>, <span class=number>0xd0f37027</span>, <span class=number>0xddb056fe</span>, <span class=number>0xd9714b49</span>,</span><br><span class=line>  <span class=number>0xc7361b4c</span>, <span class=number>0xc3f706fb</span>, <span class=number>0xceb42022</span>, <span class=number>0xca753d95</span>,</span><br><span class=line>  <span class=number>0xf23a8028</span>, <span class=number>0xf6fb9d9f</span>, <span class=number>0xfbb8bb46</span>, <span class=number>0xff79a6f1</span>,</span><br><span class=line>  <span class=number>0xe13ef6f4</span>, <span class=number>0xe5ffeb43</span>, <span class=number>0xe8bccd9a</span>, <span class=number>0xec7dd02d</span>,</span><br><span class=line>  <span class=number>0x34867077</span>, <span class=number>0x30476dc0</span>, <span class=number>0x3d044b19</span>, <span class=number>0x39c556ae</span>,</span><br><span class=line>  <span class=number>0x278206ab</span>, <span class=number>0x23431b1c</span>, <span class=number>0x2e003dc5</span>, <span class=number>0x2ac12072</span>,</span><br><span class=line>  <span class=number>0x128e9dcf</span>, <span class=number>0x164f8078</span>, <span class=number>0x1b0ca6a1</span>, <span class=number>0x1fcdbb16</span>,</span><br><span class=line>  <span class=number>0x018aeb13</span>, <span class=number>0x054bf6a4</span>, <span class=number>0x0808d07d</span>, <span class=number>0x0cc9cdca</span>,</span><br><span class=line>  <span class=number>0x7897ab07</span>, <span class=number>0x7c56b6b0</span>, <span class=number>0x71159069</span>, <span class=number>0x75d48dde</span>,</span><br><span class=line>  <span class=number>0x6b93dddb</span>, <span class=number>0x6f52c06c</span>, <span class=number>0x6211e6b5</span>, <span class=number>0x66d0fb02</span>,</span><br><span class=line>  <span class=number>0x5e9f46bf</span>, <span class=number>0x5a5e5b08</span>, <span class=number>0x571d7dd1</span>, <span class=number>0x53dc6066</span>,</span><br><span class=line>  <span class=number>0x4d9b3063</span>, <span class=number>0x495a2dd4</span>, <span class=number>0x44190b0d</span>, <span class=number>0x40d816ba</span>,</span><br><span class=line>  <span class=number>0xaca5c697</span>, <span class=number>0xa864db20</span>, <span class=number>0xa527fdf9</span>, <span class=number>0xa1e6e04e</span>,</span><br><span class=line>  <span class=number>0xbfa1b04b</span>, <span class=number>0xbb60adfc</span>, <span class=number>0xb6238b25</span>, <span class=number>0xb2e29692</span>,</span><br><span class=line>  <span class=number>0x8aad2b2f</span>, <span class=number>0x8e6c3698</span>, <span class=number>0x832f1041</span>, <span class=number>0x87ee0df6</span>,</span><br><span class=line>  <span class=number>0x99a95df3</span>, <span class=number>0x9d684044</span>, <span class=number>0x902b669d</span>, <span class=number>0x94ea7b2a</span>,</span><br><span class=line>  <span class=number>0xe0b41de7</span>, <span class=number>0xe4750050</span>, <span class=number>0xe9362689</span>, <span class=number>0xedf73b3e</span>,</span><br><span class=line>  <span class=number>0xf3b06b3b</span>, <span class=number>0xf771768c</span>, <span class=number>0xfa325055</span>, <span class=number>0xfef34de2</span>,</span><br><span class=line>  <span class=number>0xc6bcf05f</span>, <span class=number>0xc27dede8</span>, <span class=number>0xcf3ecb31</span>, <span class=number>0xcbffd686</span>,</span><br><span class=line>  <span class=number>0xd5b88683</span>, <span class=number>0xd1799b34</span>, <span class=number>0xdc3abded</span>, <span class=number>0xd8fba05a</span>,</span><br><span class=line>  <span class=number>0x690ce0ee</span>, <span class=number>0x6dcdfd59</span>, <span class=number>0x608edb80</span>, <span class=number>0x644fc637</span>,</span><br><span class=line>  <span class=number>0x7a089632</span>, <span class=number>0x7ec98b85</span>, <span class=number>0x738aad5c</span>, <span class=number>0x774bb0eb</span>,</span><br><span class=line>  <span class=number>0x4f040d56</span>, <span class=number>0x4bc510e1</span>, <span class=number>0x46863638</span>, <span class=number>0x42472b8f</span>,</span><br><span class=line>  <span class=number>0x5c007b8a</span>, <span class=number>0x58c1663d</span>, <span class=number>0x558240e4</span>, <span class=number>0x51435d53</span>,</span><br><span class=line>  <span class=number>0x251d3b9e</span>, <span class=number>0x21dc2629</span>, <span class=number>0x2c9f00f0</span>, <span class=number>0x285e1d47</span>,</span><br><span class=line>  <span class=number>0x36194d42</span>, <span class=number>0x32d850f5</span>, <span class=number>0x3f9b762c</span>, <span class=number>0x3b5a6b9b</span>,</span><br><span class=line>  <span class=number>0x0315d626</span>, <span class=number>0x07d4cb91</span>, <span class=number>0x0a97ed48</span>, <span class=number>0x0e56f0ff</span>,</span><br><span class=line>  <span class=number>0x1011a0fa</span>, <span class=number>0x14d0bd4d</span>, <span class=number>0x19939b94</span>, <span class=number>0x1d528623</span>,</span><br><span class=line>  <span class=number>0xf12f560e</span>, <span class=number>0xf5ee4bb9</span>, <span class=number>0xf8ad6d60</span>, <span class=number>0xfc6c70d7</span>,</span><br><span class=line>  <span class=number>0xe22b20d2</span>, <span class=number>0xe6ea3d65</span>, <span class=number>0xeba91bbc</span>, <span class=number>0xef68060b</span>,</span><br><span class=line>  <span class=number>0xd727bbb6</span>, <span class=number>0xd3e6a601</span>, <span class=number>0xdea580d8</span>, <span class=number>0xda649d6f</span>,</span><br><span class=line>  <span class=number>0xc423cd6a</span>, <span class=number>0xc0e2d0dd</span>, <span class=number>0xcda1f604</span>, <span class=number>0xc960ebb3</span>,</span><br><span class=line>  <span class=number>0xbd3e8d7e</span>, <span class=number>0xb9ff90c9</span>, <span class=number>0xb4bcb610</span>, <span class=number>0xb07daba7</span>,</span><br><span class=line>  <span class=number>0xae3afba2</span>, <span class=number>0xaafbe615</span>, <span class=number>0xa7b8c0cc</span>, <span class=number>0xa379dd7b</span>,</span><br><span class=line>  <span class=number>0x9b3660c6</span>, <span class=number>0x9ff77d71</span>, <span class=number>0x92b45ba8</span>, <span class=number>0x9675461f</span>,</span><br><span class=line>  <span class=number>0x8832161a</span>, <span class=number>0x8cf30bad</span>, <span class=number>0x81b02d74</span>, <span class=number>0x857130c3</span>,</span><br><span class=line>  <span class=number>0x5d8a9099</span>, <span class=number>0x594b8d2e</span>, <span class=number>0x5408abf7</span>, <span class=number>0x50c9b640</span>,</span><br><span class=line>  <span class=number>0x4e8ee645</span>, <span class=number>0x4a4ffbf2</span>, <span class=number>0x470cdd2b</span>, <span class=number>0x43cdc09c</span>,</span><br><span class=line>  <span class=number>0x7b827d21</span>, <span class=number>0x7f436096</span>, <span class=number>0x7200464f</span>, <span class=number>0x76c15bf8</span>,</span><br><span class=line>  <span class=number>0x68860bfd</span>, <span class=number>0x6c47164a</span>, <span class=number>0x61043093</span>, <span class=number>0x65c52d24</span>,</span><br><span class=line>  <span class=number>0x119b4be9</span>, <span class=number>0x155a565e</span>, <span class=number>0x18197087</span>, <span class=number>0x1cd86d30</span>,</span><br><span class=line>  <span class=number>0x029f3d35</span>, <span class=number>0x065e2082</span>, <span class=number>0x0b1d065b</span>, <span class=number>0x0fdc1bec</span>,</span><br><span class=line>  <span class=number>0x3793a651</span>, <span class=number>0x3352bbe6</span>, <span class=number>0x3e119d3f</span>, <span class=number>0x3ad08088</span>,</span><br><span class=line>  <span class=number>0x2497d08d</span>, <span class=number>0x2056cd3a</span>, <span class=number>0x2d15ebe3</span>, <span class=number>0x29d4f654</span>,</span><br><span class=line>  <span class=number>0xc5a92679</span>, <span class=number>0xc1683bce</span>, <span class=number>0xcc2b1d17</span>, <span class=number>0xc8ea00a0</span>,</span><br><span class=line>  <span class=number>0xd6ad50a5</span>, <span class=number>0xd26c4d12</span>, <span class=number>0xdf2f6bcb</span>, <span class=number>0xdbee767c</span>,</span><br><span class=line>  <span class=number>0xe3a1cbc1</span>, <span class=number>0xe760d676</span>, <span class=number>0xea23f0af</span>, <span class=number>0xeee2ed18</span>,</span><br><span class=line>  <span class=number>0xf0a5bd1d</span>, <span class=number>0xf464a0aa</span>, <span class=number>0xf9278673</span>, <span class=number>0xfde69bc4</span>,</span><br><span class=line>  <span class=number>0x89b8fd09</span>, <span class=number>0x8d79e0be</span>, <span class=number>0x803ac667</span>, <span class=number>0x84fbdbd0</span>,</span><br><span class=line>  <span class=number>0x9abc8bd5</span>, <span class=number>0x9e7d9662</span>, <span class=number>0x933eb0bb</span>, <span class=number>0x97ffad0c</span>,</span><br><span class=line>  <span class=number>0xafb010b1</span>, <span class=number>0xab710d06</span>, <span class=number>0xa6322bdf</span>, <span class=number>0xa2f33668</span>,</span><br><span class=line>  <span class=number>0xbcb4666d</span>, <span class=number>0xb8757bda</span>, <span class=number>0xb5365d03</span>, <span class=number>0xb1f740b4</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>@deftypefn Extension {unsigned int} crc32 (const unsigned char *@var{buf}, @</span></span><br><span class=line><span class=comment>  int @var{len}, unsigned int @var{init})</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>Compute the 32-bit CRC of @var{buf} which has length @var{len}.  The</span></span><br><span class=line><span class=comment>starting value is @var{init}; this may be used to compute the CRC of</span></span><br><span class=line><span class=comment>data split across multiple buffers by passing the return value of each</span></span><br><span class=line><span class=comment>call as the @var{init} parameter of the next.</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>This is used by the @command{gdb} remote protocol for the @samp{qCRC}</span></span><br><span class=line><span class=comment>command.  In order to get the same results as gdb for a block of data,</span></span><br><span class=line><span class=comment>you must pass the first CRC parameter as @code{0xffffffff}.</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>This CRC can be specified as:</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>  Width  : 32</span></span><br><span class=line><span class=comment>  Poly   : 0x04c11db7</span></span><br><span class=line><span class=comment>  Init   : parameter, typically 0xffffffff</span></span><br><span class=line><span class=comment>  RefIn  : false</span></span><br><span class=line><span class=comment>  RefOut : false</span></span><br><span class=line><span class=comment>  XorOut : 0</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>This differs from the "standard" CRC-32 algorithm in that the values</span></span><br><span class=line><span class=comment>are not reflected, and there is no final XOR value.  These differences</span></span><br><span class=line><span class=comment>make it easy to compose the values of multiple blocks.</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>@end deftypefn</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line></span><br><span class=line><span class=function><span class=type>unsigned</span> <span class=type>int</span></span></span><br><span class=line><span class=function><span class=title>xcrc32</span> <span class=params>(<span class=type>const</span> <span class=type>unsigned</span> <span class=type>char</span> *buf, <span class=type>int</span> len, <span class=type>unsigned</span> <span class=type>int</span> init)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>  <span class=type>unsigned</span> <span class=type>int</span> crc = init;</span><br><span class=line>  <span class=keyword>while</span> (len--)</span><br><span class=line>    {</span><br><span class=line>      crc = (crc &lt;&lt; <span class=number>8</span>) ^ crc32_table[((crc &gt;&gt; <span class=number>24</span>) ^ *buf) &amp; <span class=number>255</span>];</span><br><span class=line>      buf++;</span><br><span class=line>    }</span><br><span class=line>  <span class=keyword>return</span> crc;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=MD5><a href=#MD5 class=headerlink title=MD5></a>MD5</h2><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br></pre></td><td class=code><pre><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Derived from the RSA Data Security, Inc. MD5 Message-Digest Algorithm</span></span><br><span class=line><span class=comment> * and modified slightly to be functionally identical but condensed into control structures.</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdint.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;string.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdlib.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=keyword>struct</span>{</span><br><span class=line>    <span class=type>uint64_t</span> size;        <span class=comment>// Size of input in bytes</span></span><br><span class=line>    <span class=type>uint32_t</span> buffer[<span class=number>4</span>];   <span class=comment>// Current accumulation of hash</span></span><br><span class=line>    <span class=type>uint8_t</span> input[<span class=number>64</span>];    <span class=comment>// Input to be used in the next step</span></span><br><span class=line>    <span class=type>uint8_t</span> digest[<span class=number>16</span>];   <span class=comment>// Result of algorithm</span></span><br><span class=line>} MD5Context;</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Constants defined by the MD5 algorithm</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> A 0x67452301</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> B 0xefcdab89</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> C 0x98badcfe</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> D 0x10325476</span></span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>uint32_t</span> S[] = {<span class=number>7</span>, <span class=number>12</span>, <span class=number>17</span>, <span class=number>22</span>, <span class=number>7</span>, <span class=number>12</span>, <span class=number>17</span>, <span class=number>22</span>, <span class=number>7</span>, <span class=number>12</span>, <span class=number>17</span>, <span class=number>22</span>, <span class=number>7</span>, <span class=number>12</span>, <span class=number>17</span>, <span class=number>22</span>,</span><br><span class=line>                       <span class=number>5</span>,  <span class=number>9</span>, <span class=number>14</span>, <span class=number>20</span>, <span class=number>5</span>,  <span class=number>9</span>, <span class=number>14</span>, <span class=number>20</span>, <span class=number>5</span>,  <span class=number>9</span>, <span class=number>14</span>, <span class=number>20</span>, <span class=number>5</span>,  <span class=number>9</span>, <span class=number>14</span>, <span class=number>20</span>,</span><br><span class=line>                       <span class=number>4</span>, <span class=number>11</span>, <span class=number>16</span>, <span class=number>23</span>, <span class=number>4</span>, <span class=number>11</span>, <span class=number>16</span>, <span class=number>23</span>, <span class=number>4</span>, <span class=number>11</span>, <span class=number>16</span>, <span class=number>23</span>, <span class=number>4</span>, <span class=number>11</span>, <span class=number>16</span>, <span class=number>23</span>,</span><br><span class=line>                       <span class=number>6</span>, <span class=number>10</span>, <span class=number>15</span>, <span class=number>21</span>, <span class=number>6</span>, <span class=number>10</span>, <span class=number>15</span>, <span class=number>21</span>, <span class=number>6</span>, <span class=number>10</span>, <span class=number>15</span>, <span class=number>21</span>, <span class=number>6</span>, <span class=number>10</span>, <span class=number>15</span>, <span class=number>21</span>};</span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>uint32_t</span> K[] = {<span class=number>0xd76aa478</span>, <span class=number>0xe8c7b756</span>, <span class=number>0x242070db</span>, <span class=number>0xc1bdceee</span>,</span><br><span class=line>                       <span class=number>0xf57c0faf</span>, <span class=number>0x4787c62a</span>, <span class=number>0xa8304613</span>, <span class=number>0xfd469501</span>,</span><br><span class=line>                       <span class=number>0x698098d8</span>, <span class=number>0x8b44f7af</span>, <span class=number>0xffff5bb1</span>, <span class=number>0x895cd7be</span>,</span><br><span class=line>                       <span class=number>0x6b901122</span>, <span class=number>0xfd987193</span>, <span class=number>0xa679438e</span>, <span class=number>0x49b40821</span>,</span><br><span class=line>                       <span class=number>0xf61e2562</span>, <span class=number>0xc040b340</span>, <span class=number>0x265e5a51</span>, <span class=number>0xe9b6c7aa</span>,</span><br><span class=line>                       <span class=number>0xd62f105d</span>, <span class=number>0x02441453</span>, <span class=number>0xd8a1e681</span>, <span class=number>0xe7d3fbc8</span>,</span><br><span class=line>                       <span class=number>0x21e1cde6</span>, <span class=number>0xc33707d6</span>, <span class=number>0xf4d50d87</span>, <span class=number>0x455a14ed</span>,</span><br><span class=line>                       <span class=number>0xa9e3e905</span>, <span class=number>0xfcefa3f8</span>, <span class=number>0x676f02d9</span>, <span class=number>0x8d2a4c8a</span>,</span><br><span class=line>                       <span class=number>0xfffa3942</span>, <span class=number>0x8771f681</span>, <span class=number>0x6d9d6122</span>, <span class=number>0xfde5380c</span>,</span><br><span class=line>                       <span class=number>0xa4beea44</span>, <span class=number>0x4bdecfa9</span>, <span class=number>0xf6bb4b60</span>, <span class=number>0xbebfbc70</span>,</span><br><span class=line>                       <span class=number>0x289b7ec6</span>, <span class=number>0xeaa127fa</span>, <span class=number>0xd4ef3085</span>, <span class=number>0x04881d05</span>,</span><br><span class=line>                       <span class=number>0xd9d4d039</span>, <span class=number>0xe6db99e5</span>, <span class=number>0x1fa27cf8</span>, <span class=number>0xc4ac5665</span>,</span><br><span class=line>                       <span class=number>0xf4292244</span>, <span class=number>0x432aff97</span>, <span class=number>0xab9423a7</span>, <span class=number>0xfc93a039</span>,</span><br><span class=line>                       <span class=number>0x655b59c3</span>, <span class=number>0x8f0ccc92</span>, <span class=number>0xffeff47d</span>, <span class=number>0x85845dd1</span>,</span><br><span class=line>                       <span class=number>0x6fa87e4f</span>, <span class=number>0xfe2ce6e0</span>, <span class=number>0xa3014314</span>, <span class=number>0x4e0811a1</span>,</span><br><span class=line>                       <span class=number>0xf7537e82</span>, <span class=number>0xbd3af235</span>, <span class=number>0x2ad7d2bb</span>, <span class=number>0xeb86d391</span>};</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Padding used to make the size (in bits) of the input congruent to 448 mod 512</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=type>static</span> <span class=type>uint8_t</span> PADDING[] = {<span class=number>0x80</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>,</span><br><span class=line>                            <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>,</span><br><span class=line>                            <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>,</span><br><span class=line>                            <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>,</span><br><span class=line>                            <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>,</span><br><span class=line>                            <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>,</span><br><span class=line>                            <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>,</span><br><span class=line>                            <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>, <span class=number>0x00</span>};</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Bit-manipulation functions defined by the MD5 algorithm</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> F(X, Y, Z) ((X &amp; Y) | (~X &amp; Z))</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> G(X, Y, Z) ((X &amp; Z) | (Y &amp; ~Z))</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> H(X, Y, Z) (X ^ Y ^ Z)</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> I(X, Y, Z) (Y ^ (X | ~Z))</span></span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Rotates a 32-bit word left by n bits</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>uint32_t</span> <span class=title>rotateLeft</span><span class=params>(<span class=type>uint32_t</span> x, <span class=type>uint32_t</span> n)</span></span>{</span><br><span class=line>    <span class=keyword>return</span> (x &lt;&lt; n) | (x &gt;&gt; (<span class=number>32</span> - n));</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Initialize a context</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>md5Init</span><span class=params>(MD5Context *ctx)</span></span>{</span><br><span class=line>    ctx-&gt;size = (<span class=type>uint64_t</span>)<span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    ctx-&gt;buffer[<span class=number>0</span>] = (<span class=type>uint32_t</span>)A;</span><br><span class=line>    ctx-&gt;buffer[<span class=number>1</span>] = (<span class=type>uint32_t</span>)B;</span><br><span class=line>    ctx-&gt;buffer[<span class=number>2</span>] = (<span class=type>uint32_t</span>)C;</span><br><span class=line>    ctx-&gt;buffer[<span class=number>3</span>] = (<span class=type>uint32_t</span>)D;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Add some amount of input to the context</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * If the input fills out a block of 512 bits, apply the algorithm (md5Step)</span></span><br><span class=line><span class=comment> * and save the result in the buffer. Also updates the overall size.</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>md5Update</span><span class=params>(MD5Context *ctx, <span class=type>uint8_t</span> *input_buffer, <span class=type>size_t</span> input_len)</span></span>{</span><br><span class=line>    <span class=type>uint32_t</span> input[<span class=number>16</span>];</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> offset = ctx-&gt;size % <span class=number>64</span>;</span><br><span class=line>    ctx-&gt;size += (<span class=type>uint64_t</span>)input_len;</span><br><span class=line></span><br><span class=line>    <span class=comment>// Copy each byte in input_buffer into the next space in our context input</span></span><br><span class=line>    <span class=keyword>for</span>(<span class=type>unsigned</span> <span class=type>int</span> i = <span class=number>0</span>; i &lt; input_len; ++i){</span><br><span class=line>        ctx-&gt;input[offset++] = (<span class=type>uint8_t</span>)*(input_buffer + i);</span><br><span class=line></span><br><span class=line>        <span class=comment>// If we've filled our context input, copy it into our local array input</span></span><br><span class=line>        <span class=comment>// then reset the offset to 0 and fill in a new buffer.</span></span><br><span class=line>        <span class=comment>// Every time we fill out a chunk, we run it through the algorithm</span></span><br><span class=line>        <span class=comment>// to enable some back and forth between cpu and i/o</span></span><br><span class=line>        <span class=keyword>if</span>(offset % <span class=number>64</span> == <span class=number>0</span>){</span><br><span class=line>            <span class=keyword>for</span>(<span class=type>unsigned</span> <span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>16</span>; ++j){</span><br><span class=line>                <span class=comment>// Convert to little-endian</span></span><br><span class=line>                <span class=comment>// The local variable `input` our 512-bit chunk separated into 32-bit words</span></span><br><span class=line>                <span class=comment>// we can use in calculations</span></span><br><span class=line>                input[j] = (<span class=type>uint32_t</span>)(ctx-&gt;input[(j * <span class=number>4</span>) + <span class=number>3</span>]) &lt;&lt; <span class=number>24</span> |</span><br><span class=line>                           (<span class=type>uint32_t</span>)(ctx-&gt;input[(j * <span class=number>4</span>) + <span class=number>2</span>]) &lt;&lt; <span class=number>16</span> |</span><br><span class=line>                           (<span class=type>uint32_t</span>)(ctx-&gt;input[(j * <span class=number>4</span>) + <span class=number>1</span>]) &lt;&lt;  <span class=number>8</span> |</span><br><span class=line>                           (<span class=type>uint32_t</span>)(ctx-&gt;input[(j * <span class=number>4</span>)]);</span><br><span class=line>            }</span><br><span class=line>            <span class=built_in>md5Step</span>(ctx-&gt;buffer, input);</span><br><span class=line>            offset = <span class=number>0</span>;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Pad the current input to get to 448 bytes, append the size in bits to the very end,</span></span><br><span class=line><span class=comment> * and save the result of the final iteration into digest.</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>md5Finalize</span><span class=params>(MD5Context *ctx)</span></span>{</span><br><span class=line>    <span class=type>uint32_t</span> input[<span class=number>16</span>];</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> offset = ctx-&gt;size % <span class=number>64</span>;</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> padding_length = offset &lt; <span class=number>56</span> ? <span class=number>56</span> - offset : (<span class=number>56</span> + <span class=number>64</span>) - offset;</span><br><span class=line></span><br><span class=line>    <span class=comment>// Fill in the padding and undo the changes to size that resulted from the update</span></span><br><span class=line>    <span class=built_in>md5Update</span>(ctx, PADDING, padding_length);</span><br><span class=line>    ctx-&gt;size -= (<span class=type>uint64_t</span>)padding_length;</span><br><span class=line></span><br><span class=line>    <span class=comment>// Do a final update (internal to this function)</span></span><br><span class=line>    <span class=comment>// Last two 32-bit words are the two halves of the size (converted from bytes to bits)</span></span><br><span class=line>    <span class=keyword>for</span>(<span class=type>unsigned</span> <span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>14</span>; ++j){</span><br><span class=line>        input[j] = (<span class=type>uint32_t</span>)(ctx-&gt;input[(j * <span class=number>4</span>) + <span class=number>3</span>]) &lt;&lt; <span class=number>24</span> |</span><br><span class=line>                   (<span class=type>uint32_t</span>)(ctx-&gt;input[(j * <span class=number>4</span>) + <span class=number>2</span>]) &lt;&lt; <span class=number>16</span> |</span><br><span class=line>                   (<span class=type>uint32_t</span>)(ctx-&gt;input[(j * <span class=number>4</span>) + <span class=number>1</span>]) &lt;&lt;  <span class=number>8</span> |</span><br><span class=line>                   (<span class=type>uint32_t</span>)(ctx-&gt;input[(j * <span class=number>4</span>)]);</span><br><span class=line>    }</span><br><span class=line>    input[<span class=number>14</span>] = (<span class=type>uint32_t</span>)(ctx-&gt;size * <span class=number>8</span>);</span><br><span class=line>    input[<span class=number>15</span>] = (<span class=type>uint32_t</span>)((ctx-&gt;size * <span class=number>8</span>) &gt;&gt; <span class=number>32</span>);</span><br><span class=line></span><br><span class=line>    <span class=built_in>md5Step</span>(ctx-&gt;buffer, input);</span><br><span class=line></span><br><span class=line>    <span class=comment>// Move the result into digest (convert from little-endian)</span></span><br><span class=line>    <span class=keyword>for</span>(<span class=type>unsigned</span> <span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>4</span>; ++i){</span><br><span class=line>        ctx-&gt;digest[(i * <span class=number>4</span>) + <span class=number>0</span>] = (<span class=type>uint8_t</span>)((ctx-&gt;buffer[i] &amp; <span class=number>0x000000FF</span>));</span><br><span class=line>        ctx-&gt;digest[(i * <span class=number>4</span>) + <span class=number>1</span>] = (<span class=type>uint8_t</span>)((ctx-&gt;buffer[i] &amp; <span class=number>0x0000FF00</span>) &gt;&gt;  <span class=number>8</span>);</span><br><span class=line>        ctx-&gt;digest[(i * <span class=number>4</span>) + <span class=number>2</span>] = (<span class=type>uint8_t</span>)((ctx-&gt;buffer[i] &amp; <span class=number>0x00FF0000</span>) &gt;&gt; <span class=number>16</span>);</span><br><span class=line>        ctx-&gt;digest[(i * <span class=number>4</span>) + <span class=number>3</span>] = (<span class=type>uint8_t</span>)((ctx-&gt;buffer[i] &amp; <span class=number>0xFF000000</span>) &gt;&gt; <span class=number>24</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Step on 512 bits of input with the main MD5 algorithm.</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>md5Step</span><span class=params>(<span class=type>uint32_t</span> *buffer, <span class=type>uint32_t</span> *input)</span></span>{</span><br><span class=line>    <span class=type>uint32_t</span> AA = buffer[<span class=number>0</span>];</span><br><span class=line>    <span class=type>uint32_t</span> BB = buffer[<span class=number>1</span>];</span><br><span class=line>    <span class=type>uint32_t</span> CC = buffer[<span class=number>2</span>];</span><br><span class=line>    <span class=type>uint32_t</span> DD = buffer[<span class=number>3</span>];</span><br><span class=line></span><br><span class=line>    <span class=type>uint32_t</span> E;</span><br><span class=line></span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> j;</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span>(<span class=type>unsigned</span> <span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>64</span>; ++i){</span><br><span class=line>        <span class=keyword>switch</span>(i / <span class=number>16</span>){</span><br><span class=line>            <span class=keyword>case</span> <span class=number>0</span>:</span><br><span class=line>                E = <span class=built_in>F</span>(BB, CC, DD);</span><br><span class=line>                j = i;</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            <span class=keyword>case</span> <span class=number>1</span>:</span><br><span class=line>                E = <span class=built_in>G</span>(BB, CC, DD);</span><br><span class=line>                j = ((i * <span class=number>5</span>) + <span class=number>1</span>) % <span class=number>16</span>;</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            <span class=keyword>case</span> <span class=number>2</span>:</span><br><span class=line>                E = <span class=built_in>H</span>(BB, CC, DD);</span><br><span class=line>                j = ((i * <span class=number>3</span>) + <span class=number>5</span>) % <span class=number>16</span>;</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            <span class=keyword>default</span>:</span><br><span class=line>                E = <span class=built_in>I</span>(BB, CC, DD);</span><br><span class=line>                j = (i * <span class=number>7</span>) % <span class=number>16</span>;</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=type>uint32_t</span> temp = DD;</span><br><span class=line>        DD = CC;</span><br><span class=line>        CC = BB;</span><br><span class=line>        BB = BB + <span class=built_in>rotateLeft</span>(AA + E + K[i] + input[j], S[i]);</span><br><span class=line>        AA = temp;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    buffer[<span class=number>0</span>] += AA;</span><br><span class=line>    buffer[<span class=number>1</span>] += BB;</span><br><span class=line>    buffer[<span class=number>2</span>] += CC;</span><br><span class=line>    buffer[<span class=number>3</span>] += DD;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * Functions that run the algorithm on the provided input and put the digest into result.</span></span><br><span class=line><span class=comment> * result should be able to store 16 bytes.</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>md5String</span><span class=params>(<span class=type>char</span> *input, <span class=type>uint8_t</span> *result)</span></span>{</span><br><span class=line>    MD5Context ctx;</span><br><span class=line>    <span class=built_in>md5Init</span>(&amp;ctx);</span><br><span class=line>    <span class=built_in>md5Update</span>(&amp;ctx, (<span class=type>uint8_t</span> *)input, <span class=built_in>strlen</span>(input));</span><br><span class=line>    <span class=built_in>md5Finalize</span>(&amp;ctx);</span><br><span class=line></span><br><span class=line>    <span class=built_in>memcpy</span>(result, ctx.digest, <span class=number>16</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>md5File</span><span class=params>(FILE *file, <span class=type>uint8_t</span> *result)</span></span>{</span><br><span class=line>    <span class=type>char</span> *input_buffer = <span class=built_in>malloc</span>(<span class=number>1024</span>);</span><br><span class=line>    <span class=type>size_t</span> input_size = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    MD5Context ctx;</span><br><span class=line>    <span class=built_in>md5Init</span>(&amp;ctx);</span><br><span class=line></span><br><span class=line>    <span class=keyword>while</span>((input_size = <span class=built_in>fread</span>(input_buffer, <span class=number>1</span>, <span class=number>1024</span>, file)) &gt; <span class=number>0</span>){</span><br><span class=line>        <span class=built_in>md5Update</span>(&amp;ctx, (<span class=type>uint8_t</span> *)input_buffer, input_size);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=built_in>md5Finalize</span>(&amp;ctx);</span><br><span class=line></span><br><span class=line>    <span class=built_in>free</span>(input_buffer);</span><br><span class=line></span><br><span class=line>    <span class=built_in>memcpy</span>(result, ctx.digest, <span class=number>16</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>print_hash</span><span class=params>(<span class=type>uint8_t</span> *p)</span></span>{</span><br><span class=line>    <span class=keyword>for</span>(<span class=type>unsigned</span> <span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>16</span>; ++i){</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%02x"</span>, p[i]);</span><br><span class=line>    }</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>(<span class=type>int</span> argc, <span class=type>char</span> *argv[])</span></span>{</span><br><span class=line>    <span class=type>uint8_t</span> result[<span class=number>16</span>];</span><br><span class=line>    <span class=keyword>if</span>(argc &gt; <span class=number>1</span>){</span><br><span class=line>        <span class=keyword>for</span>(<span class=type>int</span> i = <span class=number>1</span>; i &lt; argc; ++i){</span><br><span class=line>            <span class=built_in>md5String</span>(argv[i], result);</span><br><span class=line>            <span class=built_in>print_hash</span>(result);</span><br><span class=line>        }</span><br><span class=line>    } <span class=keyword>else</span>{</span><br><span class=line>        <span class=built_in>md5File</span>(stdin, result);</span><br><span class=line>        <span class=built_in>print_hash</span>(result);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></td></tr></table></figure><h2 id=RC4><a href=#RC4 class=headerlink title=RC4></a>RC4</h2><figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdlib.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;string.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=comment>//s表的长度取256</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> size 256</span></span><br><span class=line></span><br><span class=line><span class=type>unsigned</span> <span class=type>char</span> sbox[<span class=number>257</span>] = {<span class=number>0</span>};</span><br><span class=line></span><br><span class=line><span class=comment>//初始化s表</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>init_sbox</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *key)</span> </span>{</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> i, j, k;</span><br><span class=line>    <span class=type>int</span> tmp;</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; size; i++) {</span><br><span class=line>        sbox[i] = i;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    j = k = <span class=number>0</span>;</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; size; i++) {</span><br><span class=line>        tmp = sbox[i];</span><br><span class=line>        j = (j + tmp + key[k]) % size;</span><br><span class=line>        sbox[i] = sbox[j];</span><br><span class=line>        sbox[j] = tmp;</span><br><span class=line>        <span class=keyword>if</span> (++k &gt;= <span class=built_in>strlen</span>((<span class=type>char</span> *) key))k = <span class=number>0</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>//加解密函数</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>enc_dec</span><span class=params>(<span class=type>unsigned</span> <span class=type>char</span> *key, <span class=type>unsigned</span> <span class=type>char</span> *data)</span> </span>{</span><br><span class=line>    <span class=type>int</span> i, j, k, R, tmp;</span><br><span class=line></span><br><span class=line>    <span class=built_in>init_sbox</span>(key);</span><br><span class=line></span><br><span class=line>    j = k = <span class=number>0</span>;</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=built_in>strlen</span>((<span class=type>char</span> *) data); i++) {</span><br><span class=line>        j = (j + <span class=number>1</span>) % size;</span><br><span class=line>        k = (k + sbox[j]) % size;</span><br><span class=line></span><br><span class=line>        tmp = sbox[j];</span><br><span class=line>        sbox[j] = sbox[k];</span><br><span class=line>        sbox[k] = tmp;</span><br><span class=line></span><br><span class=line>        R = sbox[(sbox[j] + sbox[k]) % size];</span><br><span class=line></span><br><span class=line>        data[i] ^= R;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span> </span>{</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> key[<span class=number>100</span>] = {<span class=number>0</span>};</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> data[<span class=number>100</span>] = {<span class=number>0</span>};</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"输入你要加密的字符："</span>);</span><br><span class=line>    <span class=built_in>scanf</span>(<span class=string>"%100s"</span>, data);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"输入密钥："</span>);</span><br><span class=line>    <span class=built_in>scanf</span>(<span class=string>"%40s"</span>, key);</span><br><span class=line>    <span class=built_in>enc_dec</span>(key, data);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"enc: %s\n"</span>, data);</span><br><span class=line>    <span class=built_in>enc_dec</span>(key, data);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"dec: %s\n"</span>, data);</span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br></pre></td></tr></table></figure><h2 id=参考链接><a href=#参考链接 class=headerlink title=参考链接></a>参考链接</h2><p><a class=link target=_blank rel=noopener href=https://pangbai.work/CTF/Reverse/encode_decode/ >Pangbai.work [常见加密解密算法]<i class="fas fa-external-link-alt"></i></a></p><p><a class=link target=_blank rel=noopener href=https://www.cnblogs.com/mengsuenyan/p/12697694.html>mengsuenyan [AES加密算法]<i class="fas fa-external-link-alt"></i></a></p><p><a class=link target=_blank rel=noopener href=https://goodapple.top/archives/162>枫のBlog 密码学——AES/DES加密算法原理介绍<i class="fas fa-external-link-alt"></i></a></p><p><a class=link target=_blank rel=noopener href=https://github.com/gcc-mirror/gcc/blob/master/libiberty/crc32.c>gcc-mirror c3c<i class="fas fa-external-link-alt"></i></a></p><p><a class=link target=_blank rel=noopener href=https://github.com/Zunawe/md5-c/blob/main/md5.c>Zunawe MD5<i class="fas fa-external-link-alt"></i></a></p><p><a class=link target=_blank rel=noopener href=https://github.com/windard/sm4/blob/master/C/sm4.c#L404>windard SM4<i class="fas fa-external-link-alt"></i></a></p><p><a class=link target=_blank rel=noopener href=https://github.com/dhuertas/DES/blob/master/des.c>dhuertas DES<i class="fas fa-external-link-alt"></i></a></p><p><a class=link target=_blank rel=noopener href=https://github.com/lmshao/AES/blob/master/AES.c>lmshao AES<i class="fas fa-external-link-alt"></i></a></p><p>侵权请联系删除</p></div><div class="post-copyright-info-container border-box"><div class="copyright-info-content border-box"><div class="copyright-info-top border-box"><div class="copyright-post-title border-box text-ellipsis">常见加密解密编码算法</div><div class="copyright-post-link border-box text-ellipsis">2024/10/06/encode_decode/</div></div><div class="copyright-info-bottom border-box"><div class="copyright-post-author bottom-item"><div class=type>作者</div><div class=content>carbofish</div></div><div class="post-time bottom-item"><div class=type>发布于</div><div class=content>2024-10-06 15:12</div></div><div class="post-license bottom-item"><div class=type>许可</div><div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0"><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><i class="fa-brands fa-creative-commons"></i> <i class="fa-brands fa-creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc"></i> <i class="fa-brands fa-creative-commons-sa"></i></a></div></div></div><i class="copyright-bg fa-solid fa-copyright"></i></div><div class="copy-copyright-info flex-center tooltip" data-tooltip-content=复制版权信息 data-tooltip-offset-y=-2px><i class="fa-solid fa-copy"></i></div></div><div class="post-bottom-tags-and-share border-box"><div><ul class="post-tags-box border-box"><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/Reverse/ >Reverse</a></li><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/Encryption/ >Encryption</a></li></ul></div><div></div></div><div class="post-nav border-box"><div class=prev-post><a class=prev rel=prev href=/2024/10/06/np_obfuscation/ title=NP管理器DEX加固解混淆><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item text-ellipsis">NP管理器DEX加固解混淆</span> <span class=post-nav-item>上一篇</span></span></a></div></div><div class="comments-container border-box"><div id=comments-anchor class="comment-area-title border-box"><i class="fas fa-comments"></i>&nbsp;评论</div><div class="comment-plugin-fail border-box"><span class=fail-tip>评论插件加载失败</span> <button class="reload keep-button">点击重新加载</button></div><div class="comment-plugin-loading flex-center border-box"><i class="loading-icon fa-solid fa-spinner fa-spin"></i> <span class=load-tip>正在加载评论插件</span></div><script data-pjax>window.KeepCommentPlugin={},window.KeepCommentPlugin.hideLoading=()=>{document.querySelector(".comments-container .comment-plugin-loading").style.display="none"},window.KeepCommentPlugin.loadFailHandle=()=>{window.KeepCommentPlugin.hideLoading();var e=document.querySelector(".comments-container .comment-plugin-fail");e.style.display="flex",e.querySelector(".reload").addEventListener("click",()=>{window.location.reload()})}</script><div class=waline-comment-container><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@waline/client@v3.3.2/dist/waline.css><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@waline/client@v3.3.2/dist/waline-meta.css><div id=waline-comment></div><script data-pjax>window.KeepCommentPlugin.walineOptions=JSON.parse("{}".replace(/&#34;/g,'"')),window.KeepCommentPlugin.walineOptions.el="#waline-comment",window.KeepCommentPlugin.walineOptions.comment=".post-comments-count",window.KeepCommentPlugin.walineOptions.serverURL="https://comment.carbo.ink/",window.KeepCommentPlugin.walineOptions.lang="zh-CN",window.KeepCommentPlugin.walineOptions.reaction=!0</script><script data-pjax async type=module>import { init } from '//cdn.jsdelivr.net/npm/@waline/client@v3.3.2/dist/waline.js'
              window.KeepCommentPlugin.initWaline = () => {
                if (init) {
                  init(window.KeepCommentPlugin.walineOptions)
                  window.KeepCommentPlugin.hideLoading()
                } else {
                  setTimeout(() => {
                    window.KeepCommentPlugin.initWaline()
                  }, 1000)
                }
              }

              if ('true' === 'true') {
                setTimeout(() => {
                  window.KeepCommentPlugin.initWaline()
                }, 1200)
              } else {
                window.addEventListener('DOMContentLoaded', window.KeepCommentPlugin.initWaline)
              }</script></div></div></div></div><div class="pc-post-toc right-toc"><div class="post-toc-wrap border-box"><div class="post-toc border-box"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#HEX><span class=nav-text>HEX</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#BASE64><span class=nav-text>BASE64</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#XXTEA><span class=nav-text>XXTEA</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#XTea><span class=nav-text>XTea</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#Tea><span class=nav-text>Tea</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#AES><span class=nav-text>AES</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BC%AA%E4%BB%A3%E7%A0%81><span class=nav-text>伪代码</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%81-1><span class=nav-text>代码 1</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%81-2><span class=nav-text>代码 2</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%80%86%E7%9B%92%E8%84%9A%E6%9C%AC><span class=nav-text>逆盒脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#BlowFish><span class=nav-text>BlowFish</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#SM4><span class=nav-text>SM4</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%811><span class=nav-text>代码1</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%812><span class=nav-text>代码2</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%B8%80%E4%BB%BD%E5%88%A9%E7%94%A8-SBOX-TX-%E5%8A%A0%E9%80%9F%E8%BF%90%E7%AE%97%E7%9A%84-SM4-%E4%BB%A3%E7%A0%81><span class=nav-text>一份利用 SBOX_TX 加速运算的 SM4 代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#DES><span class=nav-text>DES</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%811-1><span class=nav-text>代码1</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%812-1><span class=nav-text>代码2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#BASE58><span class=nav-text>BASE58</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#SHA1><span class=nav-text>SHA1</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#CRC32><span class=nav-text>CRC32</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#MD5><span class=nav-text>MD5</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#RC4><span class=nav-text>RC4</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5><span class=nav-text>参考链接</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom border-box"><footer class="footer border-box"><div class="copyright-info info-item">&copy;&nbsp;<span>2024</span>&nbsp;-&nbsp;2025 &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href=/ >carbofish</a></div><div class="theme-info info-item">由&nbsp;<a target=_blank href=https://hexo.io>Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class=keep-version target=_blank href=https://github.com/XPoet/hexo-theme-keep>Keep</a></div><div class="count-info info-item"><span class="count-item border-box word"><span class="item-type border-box">总字数</span> <span class="item-value border-box word">55.5k</span> </span><span class="count-item border-box uv"><span class="item-type border-box">访客数</span> <span class="item-value border-box uv" id=vercount_value_site_uv></span> </span><span class="count-item border-box pv"><span class="item-type border-box">访问量</span> <span class="item-value border-box pv" id=vercount_value_site_pv></span></span></div></footer></div></div><div class="post-tools right-toc"><div class="post-tools-container border-box"><ul class="post-tools-list border-box"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class=post-comments-count></span></li><li class="tools-item flex-center full-screen"><i class="fa-solid fa-expand"></i></li></ul></div></div><div class=side-tools><div class="side-tools-container border-box"><ul class="side-tools-list side-tools-show-handle border-box"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-toggle-theme-mode flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list border-box"><li class="tools-item toggle-show-toc-tablet flex-center"><i class="fas fa-list"></i></li><li class="tools-item go-to-comments-tablet flex-center"><i class="fas fa-comment"></i></li><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center show-arrow"><i class="arrow fas fa-arrow-up"></i> <span class=percent></span></li></ul></div></div><div class=zoom-in-image-mask><img class=zoom-in-image></div><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-input-field-pre><i class="fas fa-keyboard"></i></span><div class=search-input-container><input autocomplete=off autocorrect=off autocapitalize=off placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=close-popup-btn><i class="fas fa-times"></i></span></div><div id=search-result><div id=no-result><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><div class=tablet-post-toc-mask><div class=tablet-post-toc><div class="post-toc-wrap border-box"><div class="post-toc border-box"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#HEX><span class=nav-text>HEX</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#BASE64><span class=nav-text>BASE64</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#XXTEA><span class=nav-text>XXTEA</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#XTea><span class=nav-text>XTea</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#Tea><span class=nav-text>Tea</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#AES><span class=nav-text>AES</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BC%AA%E4%BB%A3%E7%A0%81><span class=nav-text>伪代码</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%81-1><span class=nav-text>代码 1</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%81-2><span class=nav-text>代码 2</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%80%86%E7%9B%92%E8%84%9A%E6%9C%AC><span class=nav-text>逆盒脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#BlowFish><span class=nav-text>BlowFish</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#SM4><span class=nav-text>SM4</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%811><span class=nav-text>代码1</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%812><span class=nav-text>代码2</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%B8%80%E4%BB%BD%E5%88%A9%E7%94%A8-SBOX-TX-%E5%8A%A0%E9%80%9F%E8%BF%90%E7%AE%97%E7%9A%84-SM4-%E4%BB%A3%E7%A0%81><span class=nav-text>一份利用 SBOX_TX 加速运算的 SM4 代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#DES><span class=nav-text>DES</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%811-1><span class=nav-text>代码1</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%812-1><span class=nav-text>代码2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#BASE58><span class=nav-text>BASE58</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#SHA1><span class=nav-text>SHA1</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#CRC32><span class=nav-text>CRC32</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#MD5><span class=nav-text>MD5</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#RC4><span class=nav-text>RC4</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5><span class=nav-text>参考链接</span></a></li></ol></div></div></div></div></main><script src=/js/utils.js></script><script src=/js/header-shrink.js></script><script src=/js/back2top.js></script><script src=/js/toggle-theme.js></script><script src=/js/code-block.js></script><script src=/js/main.js></script><script src=/js/libs/anime.min.js></script><script src=/js/local-search.js></script><script src=/js/lazyload.js></script><div class=pjax><script src=/js/post/post-helper.js></script><script src=/js/post/toc.js></script><script src=/js/post/copyright-info.js></script></div><script src=/js/mermaid.min.js></script><script data-pjax>window.mermaid&&mermaid.init()</script><script src=/js/libs/pjax.min.js></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.initExecute()})})</script></body></html>