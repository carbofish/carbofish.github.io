<!DOCTYPE html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="Hexo Theme Keep"><meta name=description content="Hexo Theme Keep"><meta name=author content=carbofish><title>2024 古剑山网络安全大赛 Reverse 方向 | Carbo</title><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/logo.png><link rel=stylesheet href=/font/css/fontawesome.min.css><link rel=stylesheet href=/font/css/regular.min.css><link rel=stylesheet href=/font/css/solid.min.css><link rel=stylesheet href=/font/css/brands.min.css><script class=keep-theme-configurations>let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.json"},KEEP.theme_config={base_info:{primary_color:"#1abc9c",title:"Carbo",author:"carbofish",avatar:"/images/avatar.png",logo:"/images/logo.png",favicon:"/images/logo.png"},menu:{home:"/ || fa-solid fa-home",tags:"/tags || fa-solid fa-tags",links:"/links || fa-solid fa-link",about:"/about || fa-solid fa-user-graduate"},first_screen:{enable:!0,background_img:"https://s3.carbo.ink/img/wallpaper/115959359_p0_r.jpg",background_img_dark:"https://s3.carbo.ink/img/wallpaper/115959359_p0_r.jpg",description:"白雪却嫌春色晚，欲穿庭树作飞花。",hitokoto:!1},social_contact:{enable:!1,links:{github:null,weixin:null,qq:"https://github.com/XPoet",weibo:null,zhihu:null,twitter:null,x:null,facebook:null,email:null}},scroll:{progress_bar:!0,percent:!0,hide_header:!0},home:{announcement:null,category:!0,tag:!0,post_datetime:"updated"},post:{author_badge:{enable:!1,level_badge:!0,custom_badge:["One","Two","Three"]},word_count:{wordcount:!0,min2read:!0},datetime_format:"YYYY-MM-DD HH:mm:ss",copyright_info:!0,share:!1,reward:{enable:!1,img_link:null,text:null,icon:null}},code_block:{tools:{enable:!0,style:"default"},highlight_theme:"default"},toc:{enable:!0,number:!1,expand_all:!1,init_open:!0,layout:"right"},website_count:{busuanzi_count:{enable:!0,site_uv:!0,site_pv:!0,page_pv:!0}},local_search:{enable:!0,preload:!0},comment:{enable:!0,use:"waline",valine:{appid:null,appkey:null,server_urls:null,placeholder:null},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null,proxy:null},twikoo:{env_id:null,region:null,version:"1.6.36"},waline:{server_url:"https://comment.carbo.ink/",reaction:!0,version:"3.3.2",option:{dark:"auto"}},giscus:{repo:null,repo_id:null,category:"Announcements",category_id:null,reactions_enabled:!1},artalk:{server:null},disqus:{shortname:null}},rss:{enable:!1},lazyload:{enable:!0},cdn:{enable:!1,provider:"unpkg"},pjax:{enable:!0},footer:{since:2024,word_count:!0,site_deploy:{enable:!1,provider:"github",url:null},record:{enable:!1,list:[{code:null,link:null}]}},inject:{enable:!1,css:[null],js:[null]},root:"",source_data:{links:[{name:"5m10v3",link:"https://5m10v3.top",avatar:"https://5m10v3.top/images/1.jpg",description:"进击的二进制人"},{name:"PangBai",link:"https://pangbai.work/",avatar:"http://pangbai.work/images/avatar.jpg",description:"Bangbai | d180"},{name:"void2eye",link:"https://void2eye.fun/",avatar:"https://void2eye.fun/img/808.png",description:"政治家"},{name:"C3ngH",link:"https://c3ngh.top",avatar:"https://c3ngh-blog.oss-cn-hangzhou.aliyuncs.com/img/C3ngH.jpg",description:"包罗万象哥"},{name:"A1ic3",link:"https://a1ic3.cn/",avatar:"https://a1ic3.cn/images/avatar1.jpg",description:"小密码王"},{name:"enllus1on",link:"https://enllus1on.github.io/",description:"Pwn神",avatar:"https://enllus1on.github.io/images/kano.jpg"},{name:"AsaL1n",link:"https://asal1n.github.io/",avatar:"https://asal1n.github.io/img/head.jpg",description:"血怒哥"},{name:"Straw",link:"https://straw-233.github.io/",avatar:"https://straw-233.github.io/avatar/meinasi.png",description:"午门痴"},{name:"CHHHCHHOH",link:"http://www.chhhchhoh.cn/",avatar:"https://s2.loli.net/2024/10/20/9EXmLyYuU6b5tVh.png",description:"吃了乙酸的乙醇不会梦到乙酸乙酯"},{name:"Lunatic",link:"https://goodlunatic.github.io/",avatar:"https://www.nssctf.cn/files/2024/4/28/7f130a1387.png",description:"Mind and Hand :)"},{name:"Fup1p1",link:"https://www.fup1p1.cn/",avatar:"https://www.nssctf.cn/files/2024/4/29/524400904c.jpeg",description:"逆向寻真理"},{name:"X1ao",link:"https://www.x1aoblog.top/",avatar:"http://www.x1aoblog.top/upload/mmexport1681277516546.png",description:"大密码王"},{name:"Xux",link:"https://www.xuxblog.top",avatar:"https://avatars.githubusercontent.com/u/82816273?s=64&v=4",description:"神仙 Web 👴"},{name:"Woodwhale",avatar:"https://www.woodwhale.cn/woodwhale.png",link:"https://www.woodwhale.cn",description:"全栈神"},{name:"Xunflash",avatar:"https://www.xunflash.top/icon.png",link:"https://www.xunflash.top/",description:"澳爷"},{name:"bi0x",avatar:"https://blog.bi0x.com/img/avatar.png",link:"https://blog.bi0x.com/",description:"字节👴"},{name:"huanghunr",link:"https://blog.huanghunr.top",avatar:"https://pic.imgdb.cn/item/670b4202d29ded1a8c807e7e.jpg",description:"喵喵喵?!还没想好"},{name:"温婳霂",link:"https://somokel.github.io",avatar:"https://s2.loli.net/2024/10/21/GixfX61nsPMkN4r.jpg",description:"春祺夏安，秋绥冬宁。"}]},version:"4.2.2"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"},KEEP.language_copy_copyright={copy:"复制版权信息",copied:"已复制",title:"原文标题",author:"原文作者",link:"原文链接"}</script><meta name=generator content="Hexo 7.3.0"><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style></head><body><div class=progress-bar-container><span class=scroll-progress-bar></span> <span class=pjax-progress-bar></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container border-box"><div class="page-main-content border-box"><div class=page-main-content-top><header class=header-wrapper><div class="border-box header-content"><div class="left flex-start border-box"><a class="logo-image border-box" href=/ ><img src=/images/logo.png> </a><a class="site-name border-box" href=/ >Carbo</a></div><div class="right border-box"><div class="pc border-box"><ul class="menu-list border-box"><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/ ><i class="menu-text-color menu-icon fa-solid fa-home"></i> 首页</a></li><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/tags><i class="menu-text-color menu-icon fa-solid fa-tags"></i> 标签</a></li><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/links><i class="menu-text-color menu-icon fa-solid fa-link"></i> 友链</a></li><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/about><i class="menu-text-color menu-icon fa-solid fa-user-graduate"></i> 关于</a></li><li class="menu-item search search-popup-trigger"><i class="menu-text-color fas search fa-search"></i></li></ul></div><div class="mobile border-box flex-start"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class=menu-bar-middle></div></div></div></div></div><div class=header-drawer><ul class="drawer-menu-list border-box"><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/ ><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i> </span>首页</a></label></li><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/tags><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i> </span>标签</a></label></li><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/links><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-link"></i> </span>友链</a></label></li><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/about><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-user-graduate"></i> </span>关于</a></label></li></ul></div><div class=window-mask></div></header></div><div class="page-main-content-middle border-box"><div class="main-content border-box"><div class=fade-in-down-animation><div class="post-page-container border-box"><div class="post-content-container border-box"><div class="post-content-bottom border-box"><div class=post-title>2024 古剑山网络安全大赛 Reverse 方向</div><div class="post-header border-box"><div class="avatar-box border-box"><img src=/images/avatar.png></div><div class=info-box><div class="author border-box"><span class=name>carbofish</span></div><div class="meta-info border-box"><div class="post-meta-info-container border-box post"><div class="post-meta-info border-box"><span class="meta-info-item post-create-date"><i class="icon fa-solid fa-calendar-plus"></i>&nbsp; <span class=datetime>2024-12-03 15:12:45</span> </span><span class="meta-info-item post-update-date"><i class="icon fa-solid fa-file-pen"></i>&nbsp; <span class=datetime data-updated="Thu Dec 26 2024 17:56:04 GMT+0800">2024-12-26 17:56:04</span> </span><span class="post-tag meta-info-item border-box"><ul class=post-tag-ul><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/Reverse/ >Reverse</a></li></ul></span><span class="meta-info-item post-wordcount"><i class="icon fas fa-file-word"></i>&nbsp;<span>851 字</span> </span><span class="meta-info-item post-min2read"><i class="icon fas fa-clock"></i>&nbsp;<span>4 分钟</span> </span><span class="meta-info-item post-pv"><i class="icon fas fa-eye"></i>&nbsp;<span id=vercount_value_page_pv></span></span></div></div></div></div></div><div class="post-content keep-markdown-body"><p><code>台州市赛 Reverse 方向</code></p><span id=more></span><h4 id=ipa><a href=#ipa class=headerlink title=ipa></a>ipa</h4><p>一血嘻嘻</p><img lazyload="" alt=IMG_20241203_190222 data-src=https://s3.carbo.ink/img/2024/12/ba5d6e205bf7466b17863bc85d49141f.jpg><p>IOS 逆向，直接用 ida 打开分析 里面的 EasyIOS</p><p><img lazyload="" alt=img data-src=https://s3.carbo.ink/img/2024/11/0b6c5b2add65890a0ece35cb600402d8.png></p><p>在程序段下有三个初始化程序，里面把 密文、RC4 的 key、还有 base64 的表都给修改了</p><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br></pre></td><td class=code><pre><span class=line><span class=function><span class=type>double</span> <span class=title>InitFunc_0</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    __int64 v0; <span class=comment>// x8</span></span><br><span class=line>    <span class=type>unsigned</span> <span class=type>int</span> v1; <span class=comment>// w9</span></span><br><span class=line>    <span class=type>int</span> v2; <span class=comment>// w13</span></span><br><span class=line>    <span class=type>int</span> v3; <span class=comment>// w9</span></span><br><span class=line>    <span class=type>int</span> v4; <span class=comment>// w14</span></span><br><span class=line>    __int64 i; <span class=comment>// x9</span></span><br><span class=line>    <span class=type>double</span> result; <span class=comment>// d0</span></span><br><span class=line>    __int128 v7[<span class=number>2</span>]; <span class=comment>// [xsp+0h] [xbp-90h]</span></span><br><span class=line>    __int128 v8; <span class=comment>// [xsp+20h] [xbp-70h]</span></span><br><span class=line>    __int128 v9; <span class=comment>// [xsp+30h] [xbp-60h]</span></span><br><span class=line></span><br><span class=line>    v0 = <span class=number>0LL</span>;</span><br><span class=line>    v1 = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> v10[<span class=number>64</span>] = {</span><br><span class=line>            <span class=number>0x00</span>, <span class=number>0x01</span>, <span class=number>0x02</span>, <span class=number>0x03</span>, <span class=number>0x04</span>, <span class=number>0x05</span>, <span class=number>0x06</span>, <span class=number>0x07</span>, <span class=number>0x08</span>, <span class=number>0x09</span>, <span class=number>0x0A</span>, <span class=number>0x0B</span>, <span class=number>0x0C</span>, <span class=number>0x0D</span>, <span class=number>0x0E</span>, <span class=number>0x0F</span>,</span><br><span class=line>            <span class=number>0x10</span>, <span class=number>0x11</span>, <span class=number>0x12</span>, <span class=number>0x13</span>, <span class=number>0x14</span>, <span class=number>0x15</span>, <span class=number>0x16</span>, <span class=number>0x17</span>, <span class=number>0x18</span>, <span class=number>0x19</span>, <span class=number>0x1A</span>, <span class=number>0x1B</span>, <span class=number>0x1C</span>, <span class=number>0x1D</span>, <span class=number>0x1E</span>, <span class=number>0x1F</span>,</span><br><span class=line>            <span class=number>0x20</span>, <span class=number>0x21</span>, <span class=number>0x22</span>, <span class=number>0x23</span>, <span class=number>0x24</span>, <span class=number>0x25</span>, <span class=number>0x26</span>, <span class=number>0x27</span>, <span class=number>0x28</span>, <span class=number>0x29</span>, <span class=number>0x2A</span>, <span class=number>0x2B</span>, <span class=number>0x2C</span>, <span class=number>0x2D</span>, <span class=number>0x2E</span>, <span class=number>0x2F</span>,</span><br><span class=line>            <span class=number>0x30</span>, <span class=number>0x31</span>, <span class=number>0x32</span>, <span class=number>0x33</span>, <span class=number>0x34</span>, <span class=number>0x35</span>, <span class=number>0x36</span>, <span class=number>0x37</span>, <span class=number>0x38</span>, <span class=number>0x39</span>, <span class=number>0x3A</span>, <span class=number>0x3B</span>, <span class=number>0x3C</span>, <span class=number>0x3D</span>, <span class=number>0x3E</span>, <span class=number>0x3F</span></span><br><span class=line>    };</span><br><span class=line></span><br><span class=line>    <span class=keyword>do</span></span><br><span class=line>    {</span><br><span class=line>        v2 = v10[v0];</span><br><span class=line>        v3 = v1 + v2 + byte_100007F00[(<span class=type>unsigned</span> __int8)v0 % <span class=number>5u</span>];</span><br><span class=line>        v4 = v3 + <span class=number>63</span>;</span><br><span class=line>        <span class=keyword>if</span> ( v3 &gt;= <span class=number>0</span> )</span><br><span class=line>            v4 = v3;</span><br><span class=line>        v1 = v3 - (v4 &amp; <span class=number>0xFFFFFFC0</span>);</span><br><span class=line>        v10[v0] = v10[v1];</span><br><span class=line>        v10[v1] = v2;</span><br><span class=line>        ++v0;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>while</span> ( v0 != <span class=number>64</span> );</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> j = <span class=number>0</span>; j &lt; <span class=number>64</span>; ++j) {</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%c"</span>, aAbcdefghijklmn[v10[j]]);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> result;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><p>可以得到码表 <code>NF01ihUKST9q3lnjEBs47k2w5ad+AVHfPezg/CDyxrMLR6GvomIQJOXcpW8ZbutY</code></p><img lazyload="" alt=image-20241130131323764 data-src=https://s3.carbo.ink/img/2024/11/e1add7dcdee22eda0654e27d5a66d077.png style=zoom:50%> <img lazyload="" alt=image-20241130131330625 data-src=https://s3.carbo.ink/img/2024/11/3d153fc09427095bef9004c3fc10f9ef.png style=zoom:50%><p>得到 base 后的密文 <code>bExa9y+XlAbleJPlBJy5r0AFPeJQKEODCQ6D23jOpR+X</code><br>接下来写一下脚本就行了</p><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdlib.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;string.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"defs.h"</span></span></span><br><span class=line></span><br><span class=line></span><br><span class=line>uint8 sbox[<span class=number>250</span>] = {<span class=number>0</span>};</span><br><span class=line></span><br><span class=line><span class=comment>//初始化s表</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>init_sbox</span><span class=params>(<span class=type>char</span> *key, <span class=type>int</span> klen)</span> </span>{</span><br><span class=line>    uint64 i, k;</span><br><span class=line>    int64 tmp;</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>250</span>; i++) {</span><br><span class=line>        sbox[i] = i;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    uint64 j = <span class=number>0</span>;</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; <span class=number>250</span>; i++) {</span><br><span class=line>        tmp = (uint8) sbox[i];</span><br><span class=line>        int64 v13 = j + tmp;</span><br><span class=line>        <span class=type>char</span> keyVal = key[i % klen];</span><br><span class=line>        <span class=type>int</span> bitFlag = keyVal &amp; <span class=number>0x80</span>;</span><br><span class=line>        uint64 covertVal = <span class=number>0</span>;</span><br><span class=line>        <span class=keyword>if</span> (bitFlag) {</span><br><span class=line>            <span class=comment>// 负数</span></span><br><span class=line>            covertVal = <span class=number>0xFFFFFFFFFFFFFF00</span> | keyVal;</span><br><span class=line>        } <span class=keyword>else</span> {</span><br><span class=line>            covertVal = keyVal;</span><br><span class=line>        }</span><br><span class=line>        j = (v13 + covertVal) % <span class=number>250</span>;</span><br><span class=line>        sbox[i] = sbox[j];</span><br><span class=line>        sbox[j] = tmp;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>//加解密函数</span></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>enc_dec</span><span class=params>(<span class=type>char</span> *key, <span class=type>unsigned</span> <span class=type>char</span> *data, <span class=type>int</span> slen, <span class=type>int</span> klen)</span> </span>{</span><br><span class=line>    <span class=type>int</span> i, j, k, R, tmp;</span><br><span class=line></span><br><span class=line>    <span class=built_in>init_sbox</span>(key, klen);</span><br><span class=line></span><br><span class=line><span class=comment>//    for (int l = 0; l &lt; 250; ++l) {</span></span><br><span class=line><span class=comment>//        printf("0x%x, ", (uint8) sbox[l]);</span></span><br><span class=line><span class=comment>//    }</span></span><br><span class=line></span><br><span class=line>    j = k = <span class=number>0</span>;</span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; slen; i++) {</span><br><span class=line>        j = (j + <span class=number>1</span>) % <span class=number>250</span>;</span><br><span class=line>        k = (k + sbox[j]) % <span class=number>250</span>;</span><br><span class=line></span><br><span class=line>        tmp = sbox[j];</span><br><span class=line>        sbox[j] = sbox[k];</span><br><span class=line>        sbox[k] = tmp;</span><br><span class=line></span><br><span class=line>        R = sbox[(sbox[j] + sbox[k]) % <span class=number>250</span>];</span><br><span class=line></span><br><span class=line>        data[i] ^= R;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span> </span>{</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> key[<span class=number>13</span>] = {<span class=number>0xF6</span>, <span class=number>0xCC</span>, <span class=number>0xC8</span>, <span class=number>0xD5</span>, <span class=number>0xC9</span>, <span class=number>0xC0</span>, <span class=number>0xEE</span>, <span class=number>0xC0</span>, <span class=number>0xDC</span>, <span class=number>0xED</span>, <span class=number>0xC0</span>, <span class=number>0xD7</span>, <span class=number>0xC0</span>};</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> data[<span class=number>33</span>] = {<span class=number>0xf1</span>,<span class=number>0x0a</span>,<span class=number>0x19</span>,<span class=number>0x2a</span>,<span class=number>0x76</span>,<span class=number>0xf6</span>,<span class=number>0x35</span>,<span class=number>0xcf</span>,<span class=number>0x0d</span>,<span class=number>0x87</span>,<span class=number>0x48</span>,<span class=number>0x0d</span>,<span class=number>0x47</span>,<span class=number>0x49</span>,<span class=number>0xd8</span>,<span class=number>0xa4</span>,<span class=number>0x27</span>,<span class=number>0x01</span>,<span class=number>0x82</span>,<span class=number>0x1d</span>,<span class=number>0x33</span>,<span class=number>0x1d</span>,<span class=number>0x0d</span>,<span class=number>0x66</span>,<span class=number>0x97</span>,<span class=number>0x3b</span>,<span class=number>0x66</span>,<span class=number>0x58</span>,<span class=number>0xc3</span>,<span class=number>0xf5</span>,<span class=number>0xe2</span>,<span class=number>0xc6</span>,<span class=number>0xf6</span>};</span><br><span class=line></span><br><span class=line>    <span class=built_in>enc_dec</span>((<span class=type>char</span> *)key, data, <span class=number>33</span>, <span class=number>13</span>);</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (<span class=type>int</span> i = <span class=number>0</span>; i &lt; <span class=number>33</span>; ++i) {</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%c"</span>, data[i]);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line><span class=comment>// flag{45_4_105_r3v3r51n6_b361nn3r}</span></span><br></pre></td></tr></table></figure><p>这里有个问题就是这道题中的 RC4 在取 key 的时候用的是有符号字节拓展（LDRSB 指令），原本如果取模模的是 256 也就是 0xFF 那倒是不会出啥问题，但是这里模的是 250，就会导致出一点问题，得 key[i % klen] 取出来后强转成 int64 再加回去</p><p><img lazyload="" alt=585fe3f01e25c571a06e342f60dc7a03 data-src=https://s3.carbo.ink/img/2024/12/585fe3f01e25c571a06e342f60dc7a03.png></p><h4 id=ez-re><a href=#ez-re class=headerlink title=ez_re></a>ez_re</h4><p>发现有个壳，用 x32dbg 调试，下断点在 VirtualProtect 运行几次然后单步走两下断在程序段</p><p><img lazyload="" alt=image-20241130130834259 data-src=https://s3.carbo.ink/img/2024/11/cc0f258100fe135a54d273f5a340bfe0.png></p><p>然后用 Scylla dump fix，拉进 ida 分析<br>手动重命名一下函数后发现，就是一个替换</p><p><img lazyload="" alt=image-20241130130930855 data-src=https://s3.carbo.ink/img/2024/11/cef3e25d805be816c076432bc8cf8b10.png></p><p><img lazyload="" alt=image-20241130130954720 data-src=https://s3.carbo.ink/img/2024/11/0dd38a1f0f0b9e3356e9105f5d1efcac.png></p><p>直接把伪C拉下来，改一下判断，加上打印就可以得到 Flag</p><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdlib.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;string.h&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"defs.h"</span></span></span><br><span class=line></span><br><span class=line><span class=type>unsigned</span> <span class=type>char</span> key_table[<span class=number>10</span>] = {</span><br><span class=line>        <span class=number>0x7B</span>, <span class=number>0x64</span>, <span class=number>0x65</span>, <span class=number>0x32</span>, <span class=number>0x31</span>, <span class=number>0x63</span>, <span class=number>0x7A</span>, <span class=number>0x34</span>, <span class=number>0x79</span>, <span class=number>0x00</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=function>BOOL __fastcall <span class=title>sub_3B1150</span><span class=params>(<span class=type>char</span> *v5_cp, <span class=type>char</span> *v4_cp)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>char</span> *v2; <span class=comment>// edi</span></span><br><span class=line>    <span class=type>int</span> v4; <span class=comment>// esi</span></span><br><span class=line>    <span class=type>char</span> v5; <span class=comment>// al</span></span><br><span class=line>    <span class=type>int</span> v6; <span class=comment>// esi</span></span><br><span class=line>    <span class=type>int</span> v7; <span class=comment>// ecx</span></span><br><span class=line>    <span class=type>char</span> v8; <span class=comment>// dl</span></span><br><span class=line>    <span class=type>char</span> v9; <span class=comment>// al</span></span><br><span class=line>    <span class=type>int</span> v10; <span class=comment>// edx</span></span><br><span class=line>    <span class=type>char</span> v11; <span class=comment>// cl</span></span><br><span class=line>    <span class=type>char</span> v12; <span class=comment>// al</span></span><br><span class=line></span><br><span class=line>    v2 = v4_cp + <span class=number>24</span>;                              <span class=comment>// flag开头</span></span><br><span class=line>    v4 = <span class=number>0</span>;</span><br><span class=line>    <span class=keyword>while</span> ( <span class=number>1</span> )</span><br><span class=line>    {</span><br><span class=line>        v5 = *v2++;</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%c"</span>, v5);</span><br><span class=line>        <span class=keyword>if</span> ( ++v4 &gt;= <span class=number>4</span> )</span><br><span class=line>        {</span><br><span class=line>            v6 = <span class=number>4</span>;</span><br><span class=line>            v7 = <span class=number>0</span>;</span><br><span class=line>            <span class=keyword>while</span> ( <span class=number>1</span> )</span><br><span class=line>            {</span><br><span class=line>                v8 = key_table[v7];</span><br><span class=line>                <span class=keyword>if</span> ( v8 == <span class=number>121</span> )</span><br><span class=line>                {</span><br><span class=line>                    key_table[v7] = <span class=number>55</span>;</span><br><span class=line>                    v8 = <span class=number>55</span>;</span><br><span class=line>                }</span><br><span class=line>                <span class=keyword>if</span> ( v8 == <span class=number>122</span> )</span><br><span class=line>                {</span><br><span class=line>                    key_table[v7] = <span class=number>56</span>;</span><br><span class=line>                    v8 = <span class=number>56</span>;</span><br><span class=line>                }</span><br><span class=line>                v6++;</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"%c"</span>, v8);</span><br><span class=line>                <span class=keyword>if</span> ( ++v7 &gt;= <span class=number>9</span> )</span><br><span class=line>                {</span><br><span class=line>                    v10 = <span class=number>0</span>;</span><br><span class=line>                    <span class=keyword>while</span> ( <span class=number>1</span> )</span><br><span class=line>                    {</span><br><span class=line>                        v11 = v4_cp[v10];</span><br><span class=line>                        <span class=keyword>if</span> ( v11 == <span class=number>121</span> )</span><br><span class=line>                        {</span><br><span class=line>                            v4_cp[v10] = <span class=number>55</span>;</span><br><span class=line>                            v11 = <span class=number>55</span>;</span><br><span class=line>                        }</span><br><span class=line>                        <span class=keyword>if</span> ( v11 == <span class=number>122</span> )</span><br><span class=line>                        {</span><br><span class=line>                            v4_cp[v10] = <span class=number>56</span>;</span><br><span class=line>                            v11 = <span class=number>56</span>;</span><br><span class=line>                        }</span><br><span class=line>                        v6++;</span><br><span class=line>                        <span class=built_in>printf</span>(<span class=string>"%c"</span>, v11);</span><br><span class=line>                        <span class=keyword>if</span> ( ++v10 &gt;= <span class=number>24</span> ) {</span><br><span class=line>                            <span class=built_in>printf</span>(<span class=string>"}"</span>);</span><br><span class=line>                            <span class=keyword>return</span> <span class=number>1</span>;</span><br><span class=line>                        }</span><br><span class=line>                    }</span><br><span class=line>                }</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span> </span>{</span><br><span class=line>    <span class=type>char</span> pt[] = <span class=string>"cedfz16az31zd2dycy65ac41flag"</span>;</span><br><span class=line>    <span class=built_in>sub_3B1150</span>(pt, pt);</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>// flag{de21c847cedf816a8318d2d7c765ac41}</span></span><br></pre></td></tr></table></figure></div><div class="post-copyright-info-container border-box"><div class="copyright-info-content border-box"><div class="copyright-info-top border-box"><div class="copyright-post-title border-box text-ellipsis">2024 古剑山网络安全大赛 Reverse 方向</div><div class="copyright-post-link border-box text-ellipsis">2024/12/03/2024gujianshan/</div></div><div class="copyright-info-bottom border-box"><div class="copyright-post-author bottom-item"><div class=type>作者</div><div class=content>carbofish</div></div><div class="post-time bottom-item"><div class=type>发布于</div><div class=content>2024-12-03 15:12</div></div><div class="post-license bottom-item"><div class=type>许可</div><div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0"><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><i class="fa-brands fa-creative-commons"></i> <i class="fa-brands fa-creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc"></i> <i class="fa-brands fa-creative-commons-sa"></i></a></div></div></div><i class="copyright-bg fa-solid fa-copyright"></i></div><div class="copy-copyright-info flex-center tooltip" data-tooltip-content=复制版权信息 data-tooltip-offset-y=-2px><i class="fa-solid fa-copy"></i></div></div><div class="post-bottom-tags-and-share border-box"><div><ul class="post-tags-box border-box"><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/Reverse/ >Reverse</a></li></ul></div><div></div></div><div class="post-nav border-box"><div class=prev-post><a class=prev rel=prev href=/2024/12/03/2024ciscn/ title="2024 国赛 Reverse 方向"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item text-ellipsis">2024 国赛 Reverse 方向</span> <span class=post-nav-item>上一篇</span></span></a></div><div class=next-post><a class=next rel=next href=/2024/12/03/arm_study/ title="ARM64 汇编小记"><span class="title flex-center"><span class="post-nav-title-item text-ellipsis">ARM64 汇编小记</span> <span class=post-nav-item>下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comments-container border-box"><div id=comments-anchor class="comment-area-title border-box"><i class="fas fa-comments"></i>&nbsp;评论</div><div class="comment-plugin-fail border-box"><span class=fail-tip>评论插件加载失败</span> <button class="reload keep-button">点击重新加载</button></div><div class="comment-plugin-loading flex-center border-box"><i class="loading-icon fa-solid fa-spinner fa-spin"></i> <span class=load-tip>正在加载评论插件</span></div><script data-pjax>window.KeepCommentPlugin={},window.KeepCommentPlugin.hideLoading=()=>{document.querySelector(".comments-container .comment-plugin-loading").style.display="none"},window.KeepCommentPlugin.loadFailHandle=()=>{window.KeepCommentPlugin.hideLoading();var e=document.querySelector(".comments-container .comment-plugin-fail");e.style.display="flex",e.querySelector(".reload").addEventListener("click",()=>{window.location.reload()})}</script><div class=waline-comment-container><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@waline/client@v3.3.2/dist/waline.css><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@waline/client@v3.3.2/dist/waline-meta.css><div id=waline-comment></div><script data-pjax>window.KeepCommentPlugin.walineOptions=JSON.parse("{}".replace(/&#34;/g,'"')),window.KeepCommentPlugin.walineOptions.el="#waline-comment",window.KeepCommentPlugin.walineOptions.comment=".post-comments-count",window.KeepCommentPlugin.walineOptions.serverURL="https://comment.carbo.ink/",window.KeepCommentPlugin.walineOptions.lang="zh-CN",window.KeepCommentPlugin.walineOptions.reaction=!0</script><script data-pjax async type=module>import { init } from '//cdn.jsdelivr.net/npm/@waline/client@v3.3.2/dist/waline.js'
              window.KeepCommentPlugin.initWaline = () => {
                if (init) {
                  init(window.KeepCommentPlugin.walineOptions)
                  window.KeepCommentPlugin.hideLoading()
                } else {
                  setTimeout(() => {
                    window.KeepCommentPlugin.initWaline()
                  }, 1000)
                }
              }

              if ('true' === 'true') {
                setTimeout(() => {
                  window.KeepCommentPlugin.initWaline()
                }, 1200)
              } else {
                window.addEventListener('DOMContentLoaded', window.KeepCommentPlugin.initWaline)
              }</script></div></div></div></div><div class="pc-post-toc right-toc"><div class="post-toc-wrap border-box"><div class="post-toc border-box"><ol class=nav><li class="nav-item nav-level-4"><a class=nav-link href=#ipa><span class=nav-text>ipa</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#ez-re><span class=nav-text>ez_re</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom border-box"><footer class="footer border-box"><div class="copyright-info info-item">&copy;&nbsp;<span>2024</span>&nbsp;-&nbsp;2025 &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href=/ >carbofish</a></div><div class="theme-info info-item">由&nbsp;<a target=_blank href=https://hexo.io>Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class=keep-version target=_blank href=https://github.com/XPoet/hexo-theme-keep>Keep</a></div><div class="count-info info-item"><span class="count-item border-box word"><span class="item-type border-box">总字数</span> <span class="item-value border-box word">55.5k</span> </span><span class="count-item border-box uv"><span class="item-type border-box">访客数</span> <span class="item-value border-box uv" id=vercount_value_site_uv></span> </span><span class="count-item border-box pv"><span class="item-type border-box">访问量</span> <span class="item-value border-box pv" id=vercount_value_site_pv></span></span></div></footer></div></div><div class="post-tools right-toc"><div class="post-tools-container border-box"><ul class="post-tools-list border-box"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class=post-comments-count></span></li><li class="tools-item flex-center full-screen"><i class="fa-solid fa-expand"></i></li></ul></div></div><div class=side-tools><div class="side-tools-container border-box"><ul class="side-tools-list side-tools-show-handle border-box"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-toggle-theme-mode flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list border-box"><li class="tools-item toggle-show-toc-tablet flex-center"><i class="fas fa-list"></i></li><li class="tools-item go-to-comments-tablet flex-center"><i class="fas fa-comment"></i></li><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center show-arrow"><i class="arrow fas fa-arrow-up"></i> <span class=percent></span></li></ul></div></div><div class=zoom-in-image-mask><img class=zoom-in-image></div><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-input-field-pre><i class="fas fa-keyboard"></i></span><div class=search-input-container><input autocomplete=off autocorrect=off autocapitalize=off placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=close-popup-btn><i class="fas fa-times"></i></span></div><div id=search-result><div id=no-result><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><div class=tablet-post-toc-mask><div class=tablet-post-toc><div class="post-toc-wrap border-box"><div class="post-toc border-box"><ol class=nav><li class="nav-item nav-level-4"><a class=nav-link href=#ipa><span class=nav-text>ipa</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#ez-re><span class=nav-text>ez_re</span></a></li></ol></div></div></div></div></main><script src=/js/utils.js></script><script src=/js/header-shrink.js></script><script src=/js/back2top.js></script><script src=/js/toggle-theme.js></script><script src=/js/code-block.js></script><script src=/js/main.js></script><script src=/js/libs/anime.min.js></script><script src=/js/local-search.js></script><script src=/js/lazyload.js></script><div class=pjax><script src=/js/post/post-helper.js></script><script src=/js/post/toc.js></script><script src=/js/post/copyright-info.js></script></div><script src=/js/mermaid.min.js></script><script data-pjax>window.mermaid&&mermaid.init()</script><script src=/js/libs/pjax.min.js></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.initExecute()})})</script></body></html>