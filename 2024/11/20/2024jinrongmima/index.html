<!DOCTYPE html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="Hexo Theme Keep"><meta name=description content="Hexo Theme Keep"><meta name=author content=carbofish><title>金融密码杯 - Reverse 方向 | Carbo</title><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/logo.png><link rel=stylesheet href=/font/css/fontawesome.min.css><link rel=stylesheet href=/font/css/regular.min.css><link rel=stylesheet href=/font/css/solid.min.css><link rel=stylesheet href=/font/css/brands.min.css><script class=keep-theme-configurations>let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.json"},KEEP.theme_config={base_info:{primary_color:"#1abc9c",title:"Carbo",author:"carbofish",avatar:"/images/avatar.png",logo:"/images/logo.png",favicon:"/images/logo.png"},menu:{home:"/ || fa-solid fa-home",tags:"/tags || fa-solid fa-tags",links:"/links || fa-solid fa-link",about:"/about || fa-solid fa-user-graduate"},first_screen:{enable:!0,background_img:"https://s3.carbo.ink/img/wallpaper/115959359_p0_r.jpg",background_img_dark:"https://s3.carbo.ink/img/wallpaper/115959359_p0_r.jpg",description:"白雪却嫌春色晚，欲穿庭树作飞花。",hitokoto:!1},social_contact:{enable:!1,links:{github:null,weixin:null,qq:"https://github.com/XPoet",weibo:null,zhihu:null,twitter:null,x:null,facebook:null,email:null}},scroll:{progress_bar:!0,percent:!0,hide_header:!0},home:{announcement:null,category:!0,tag:!0,post_datetime:"updated"},post:{author_badge:{enable:!1,level_badge:!0,custom_badge:["One","Two","Three"]},word_count:{wordcount:!0,min2read:!0},datetime_format:"YYYY-MM-DD HH:mm:ss",copyright_info:!0,share:!1,reward:{enable:!1,img_link:null,text:null,icon:null}},code_block:{tools:{enable:!0,style:"default"},highlight_theme:"default"},toc:{enable:!0,number:!1,expand_all:!1,init_open:!0,layout:"right"},website_count:{busuanzi_count:{enable:!0,site_uv:!0,site_pv:!0,page_pv:!0}},local_search:{enable:!0,preload:!0},comment:{enable:!0,use:"waline",valine:{appid:null,appkey:null,server_urls:null,placeholder:null},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null,proxy:null},twikoo:{env_id:null,region:null,version:"1.6.36"},waline:{server_url:"https://comment.carbo.ink/",reaction:!0,version:"3.3.2",option:{dark:"auto"}},giscus:{repo:null,repo_id:null,category:"Announcements",category_id:null,reactions_enabled:!1},artalk:{server:null},disqus:{shortname:null}},rss:{enable:!1},lazyload:{enable:!0},cdn:{enable:!1,provider:"unpkg"},pjax:{enable:!0},footer:{since:2024,word_count:!0,site_deploy:{enable:!1,provider:"github",url:null},record:{enable:!1,list:[{code:null,link:null}]}},inject:{enable:!1,css:[null],js:[null]},root:"",source_data:{links:[{name:"5m10v3",link:"https://5m10v3.top",avatar:"https://5m10v3.top/images/1.jpg",description:"进击的二进制人"},{name:"PangBai",link:"https://pangbai.work/",avatar:"http://pangbai.work/images/avatar.jpg",description:"Bangbai | d180"},{name:"void2eye",link:"https://void2eye.fun/",avatar:"https://void2eye.fun/img/808.png",description:"政治家"},{name:"C3ngH",link:"https://c3ngh.top",avatar:"https://c3ngh-blog.oss-cn-hangzhou.aliyuncs.com/img/C3ngH.jpg",description:"包罗万象哥"},{name:"A1ic3",link:"https://a1ic3.cn/",avatar:"https://a1ic3.cn/images/avatar1.jpg",description:"小密码王"},{name:"enllus1on",link:"https://enllus1on.github.io/",description:"Pwn神",avatar:"https://enllus1on.github.io/images/kano.jpg"},{name:"AsaL1n",link:"https://asal1n.github.io/",avatar:"https://asal1n.github.io/img/head.jpg",description:"血怒哥"},{name:"Straw",link:"https://straw-233.github.io/",avatar:"https://straw-233.github.io/avatar/meinasi.png",description:"午门痴"},{name:"CHHHCHHOH",link:"http://www.chhhchhoh.cn/",avatar:"https://s2.loli.net/2024/10/20/9EXmLyYuU6b5tVh.png",description:"吃了乙酸的乙醇不会梦到乙酸乙酯"},{name:"Lunatic",link:"https://goodlunatic.github.io/",avatar:"https://www.nssctf.cn/files/2024/4/28/7f130a1387.png",description:"Mind and Hand :)"},{name:"Fup1p1",link:"https://www.fup1p1.cn/",avatar:"https://www.nssctf.cn/files/2024/4/29/524400904c.jpeg",description:"逆向寻真理"},{name:"X1ao",link:"https://www.x1aoblog.top/",avatar:"http://www.x1aoblog.top/upload/mmexport1681277516546.png",description:"大密码王"},{name:"Xux",link:"https://www.xuxblog.top",avatar:"https://avatars.githubusercontent.com/u/82816273?s=64&v=4",description:"神仙 Web 👴"},{name:"Woodwhale",avatar:"https://www.woodwhale.cn/woodwhale.png",link:"https://www.woodwhale.cn",description:"全栈神"},{name:"Xunflash",avatar:"https://www.xunflash.top/icon.png",link:"https://www.xunflash.top/",description:"澳爷"},{name:"bi0x",avatar:"https://blog.bi0x.com/img/avatar.png",link:"https://blog.bi0x.com/",description:"字节👴"},{name:"huanghunr",link:"https://blog.huanghunr.top",avatar:"https://pic.imgdb.cn/item/670b4202d29ded1a8c807e7e.jpg",description:"喵喵喵?!还没想好"},{name:"温婳霂",link:"https://somokel.github.io",avatar:"https://s2.loli.net/2024/10/21/GixfX61nsPMkN4r.jpg",description:"春祺夏安，秋绥冬宁。"}]},version:"4.2.2"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"},KEEP.language_copy_copyright={copy:"复制版权信息",copied:"已复制",title:"原文标题",author:"原文作者",link:"原文链接"}</script><meta name=generator content="Hexo 7.3.0"><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style></head><body><div class=progress-bar-container><span class=scroll-progress-bar></span> <span class=pjax-progress-bar></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container border-box"><div class="page-main-content border-box"><div class=page-main-content-top><header class=header-wrapper><div class="border-box header-content"><div class="left flex-start border-box"><a class="logo-image border-box" href=/ ><img src=/images/logo.png> </a><a class="site-name border-box" href=/ >Carbo</a></div><div class="right border-box"><div class="pc border-box"><ul class="menu-list border-box"><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/ ><i class="menu-text-color menu-icon fa-solid fa-home"></i> 首页</a></li><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/tags><i class="menu-text-color menu-icon fa-solid fa-tags"></i> 标签</a></li><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/links><i class="menu-text-color menu-icon fa-solid fa-link"></i> 友链</a></li><li class="menu-item flex-start border-box"><a class="menu-text-color border-box" href=/about><i class="menu-text-color menu-icon fa-solid fa-user-graduate"></i> 关于</a></li><li class="menu-item search search-popup-trigger"><i class="menu-text-color fas search fa-search"></i></li></ul></div><div class="mobile border-box flex-start"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class=menu-bar-middle></div></div></div></div></div><div class=header-drawer><ul class="drawer-menu-list border-box"><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/ ><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i> </span>首页</a></label></li><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/tags><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i> </span>标签</a></label></li><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/links><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-link"></i> </span>友链</a></label></li><li class="drawer-menu-item border-box not-sub-menu"><label class="drawer-menu-label border-box"><a class="drawer-menu-text-color left-side flex-start border-box" href=/about><span class="menu-icon-wrap border-box flex-center"><i class="drawer-menu-text-color menu-icon fa-solid fa-user-graduate"></i> </span>关于</a></label></li></ul></div><div class=window-mask></div></header></div><div class="page-main-content-middle border-box"><div class="main-content border-box"><div class=fade-in-down-animation><div class="post-page-container border-box"><div class="post-content-container border-box"><div class="post-content-bottom border-box"><div class=post-title>金融密码杯 - Reverse 方向</div><div class="post-header border-box"><div class="avatar-box border-box"><img src=/images/avatar.png></div><div class=info-box><div class="author border-box"><span class=name>carbofish</span></div><div class="meta-info border-box"><div class="post-meta-info-container border-box post"><div class="post-meta-info border-box"><span class="meta-info-item post-create-date"><i class="icon fa-solid fa-calendar-plus"></i>&nbsp; <span class=datetime>2024-11-20 19:00:00</span> </span><span class="meta-info-item post-update-date"><i class="icon fa-solid fa-file-pen"></i>&nbsp; <span class=datetime data-updated="Thu Nov 21 2024 18:04:50 GMT+0800">2024-11-21 18:04:50</span> </span><span class="post-tag meta-info-item border-box"><ul class=post-tag-ul><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/Reverse/ >Reverse</a></li></ul></span><span class="meta-info-item post-wordcount"><i class="icon fas fa-file-word"></i>&nbsp;<span>3.9k 字</span> </span><span class="meta-info-item post-min2read"><i class="icon fas fa-clock"></i>&nbsp;<span>22 分钟</span> </span><span class="meta-info-item post-pv"><i class="icon fas fa-eye"></i>&nbsp;<span id=vercount_value_page_pv></span></span></div></div></div></div></div><div class="post-content keep-markdown-body"><p><code>金融密码杯 Reverse 方向</code></p><span id=more></span><h3 id=appetizer><a href=#appetizer class=headerlink title=appetizer></a>appetizer</h3><h4 id=解法1><a href=#解法1 class=headerlink title=解法1></a>解法1</h4><p>有邦邦加固，先用 frida-dexdump 脱壳，然后发现有个 JNI</p><p><img lazyload="" alt=image-20241121175003215 data-src=https://s3.carbo.ink/img/2024/11/045ba7fb7a8bc2ba4c1bf78fd6a0c0d6.png></p><p>libnative-lib.so 有 SMC 所以选择用 frida 脱壳，修复 so 之后发现是一个魔改 SM4</p><p>轮密钥生成</p><p><img lazyload="" alt=image-20241121175508576 data-src=https://s3.carbo.ink/img/2024/11/f8b850b18cc93437eca38118b902c7f5.png></p><p>加密部分</p><p><img lazyload="" alt=image-20241121175526200 data-src=https://s3.carbo.ink/img/2024/11/c1e924232740a8f6b5f3ccd2cdb148ff.png></p><p><img lazyload="" alt=image-20241121175553386 data-src=https://s3.carbo.ink/img/2024/11/168f8cf4409d09982f57863f10d63dbd.png></p><p>这里长得那么奇怪是因为用了预先算出来的盒加速了，可以拉一份 openssl 的脚本</p><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br><span class=line>315</span><br><span class=line>316</span><br><span class=line>317</span><br><span class=line>318</span><br><span class=line>319</span><br><span class=line>320</span><br><span class=line>321</span><br><span class=line>322</span><br><span class=line>323</span><br><span class=line>324</span><br><span class=line>325</span><br><span class=line>326</span><br><span class=line>327</span><br><span class=line>328</span><br><span class=line>329</span><br><span class=line>330</span><br><span class=line>331</span><br><span class=line>332</span><br><span class=line>333</span><br><span class=line>334</span><br><span class=line>335</span><br><span class=line>336</span><br><span class=line>337</span><br><span class=line>338</span><br><span class=line>339</span><br><span class=line>340</span><br><span class=line>341</span><br><span class=line>342</span><br><span class=line>343</span><br><span class=line>344</span><br><span class=line>345</span><br><span class=line>346</span><br><span class=line>347</span><br><span class=line>348</span><br><span class=line>349</span><br><span class=line>350</span><br><span class=line>351</span><br><span class=line>352</span><br><span class=line>353</span><br><span class=line>354</span><br><span class=line>355</span><br><span class=line>356</span><br><span class=line>357</span><br><span class=line>358</span><br><span class=line>359</span><br><span class=line>360</span><br><span class=line>361</span><br><span class=line>362</span><br><span class=line>363</span><br><span class=line>364</span><br><span class=line>365</span><br><span class=line>366</span><br><span class=line>367</span><br><span class=line>368</span><br><span class=line>369</span><br><span class=line>370</span><br><span class=line>371</span><br><span class=line>372</span><br><span class=line>373</span><br><span class=line>374</span><br><span class=line>375</span><br><span class=line>376</span><br><span class=line>377</span><br><span class=line>378</span><br><span class=line>379</span><br><span class=line>380</span><br><span class=line>381</span><br><span class=line>382</span><br><span class=line>383</span><br><span class=line>384</span><br><span class=line>385</span><br><span class=line>386</span><br><span class=line>387</span><br><span class=line>388</span><br><span class=line>389</span><br><span class=line>390</span><br><span class=line>391</span><br><span class=line>392</span><br><span class=line>393</span><br><span class=line>394</span><br><span class=line>395</span><br><span class=line>396</span><br><span class=line>397</span><br><span class=line>398</span><br><span class=line>399</span><br><span class=line>400</span><br><span class=line>401</span><br><span class=line>402</span><br><span class=line>403</span><br><span class=line>404</span><br><span class=line>405</span><br><span class=line>406</span><br><span class=line>407</span><br><span class=line>408</span><br><span class=line>409</span><br><span class=line>410</span><br><span class=line>411</span><br><span class=line>412</span><br><span class=line>413</span><br><span class=line>414</span><br><span class=line>415</span><br><span class=line>416</span><br><span class=line>417</span><br><span class=line>418</span><br><span class=line>419</span><br><span class=line>420</span><br><span class=line>421</span><br><span class=line>422</span><br><span class=line>423</span><br><span class=line>424</span><br><span class=line>425</span><br><span class=line>426</span><br><span class=line>427</span><br><span class=line>428</span><br><span class=line>429</span><br><span class=line>430</span><br><span class=line>431</span><br><span class=line>432</span><br><span class=line>433</span><br><span class=line>434</span><br><span class=line>435</span><br><span class=line>436</span><br><span class=line>437</span><br><span class=line>438</span><br><span class=line>439</span><br><span class=line>440</span><br><span class=line>441</span><br><span class=line>442</span><br><span class=line>443</span><br><span class=line>444</span><br><span class=line>445</span><br><span class=line>446</span><br><span class=line>447</span><br><span class=line>448</span><br><span class=line>449</span><br><span class=line>450</span><br><span class=line>451</span><br><span class=line>452</span><br><span class=line>453</span><br><span class=line>454</span><br><span class=line>455</span><br><span class=line>456</span><br><span class=line>457</span><br><span class=line>458</span><br><span class=line>459</span><br><span class=line>460</span><br><span class=line>461</span><br><span class=line>462</span><br><span class=line>463</span><br><span class=line>464</span><br><span class=line>465</span><br><span class=line>466</span><br><span class=line>467</span><br><span class=line>468</span><br><span class=line>469</span><br><span class=line>470</span><br><span class=line>471</span><br><span class=line>472</span><br><span class=line>473</span><br><span class=line>474</span><br><span class=line>475</span><br><span class=line>476</span><br><span class=line>477</span><br><span class=line>478</span><br><span class=line>479</span><br><span class=line>480</span><br><span class=line>481</span><br><span class=line>482</span><br><span class=line>483</span><br><span class=line>484</span><br><span class=line>485</span><br><span class=line>486</span><br><span class=line>487</span><br><span class=line>488</span><br><span class=line>489</span><br><span class=line>490</span><br><span class=line>491</span><br><span class=line>492</span><br><span class=line>493</span><br><span class=line>494</span><br><span class=line>495</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"stdlib.h"</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"ctype.h"</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"stdio.h"</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>"string.h"</span></span></span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=type>unsigned</span> <span class=type>char</span> <span class=type>uint8_t</span>;</span><br><span class=line><span class=keyword>typedef</span> <span class=type>unsigned</span> <span class=type>int</span> <span class=type>uint32_t</span>;</span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_ENCRYPT 1</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_DECRYPT 0</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_BLOCK_SIZE 16</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_KEY_SCHEDULE 32</span></span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=keyword>struct</span> <span class="title class_">SM4_KEY_st</span></span><br><span class=line>{</span><br><span class=line>    <span class=type>uint32_t</span> rk[SM4_KEY_SCHEDULE];</span><br><span class=line>} SM4_KEY;</span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>const</span> <span class=type>uint8_t</span> SM4_S[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0xD6</span>, <span class=number>0x90</span>, <span class=number>0xE9</span>, <span class=number>0xFE</span>, <span class=number>0xCC</span>, <span class=number>0xE1</span>, <span class=number>0x3D</span>, <span class=number>0xB7</span>, <span class=number>0x16</span>, <span class=number>0xB6</span>, <span class=number>0x14</span>, <span class=number>0xC2</span>,</span><br><span class=line>    <span class=number>0x28</span>, <span class=number>0xFB</span>, <span class=number>0x2C</span>, <span class=number>0x05</span>, <span class=number>0x2B</span>, <span class=number>0x67</span>, <span class=number>0x9A</span>, <span class=number>0x76</span>, <span class=number>0x2A</span>, <span class=number>0xBE</span>, <span class=number>0x04</span>, <span class=number>0xC3</span>,</span><br><span class=line>    <span class=number>0xAA</span>, <span class=number>0x44</span>, <span class=number>0x13</span>, <span class=number>0x26</span>, <span class=number>0x49</span>, <span class=number>0x86</span>, <span class=number>0x06</span>, <span class=number>0x99</span>, <span class=number>0x9C</span>, <span class=number>0x42</span>, <span class=number>0x50</span>, <span class=number>0xF4</span>,</span><br><span class=line>    <span class=number>0x91</span>, <span class=number>0xEF</span>, <span class=number>0x98</span>, <span class=number>0x7A</span>, <span class=number>0x33</span>, <span class=number>0x54</span>, <span class=number>0x0B</span>, <span class=number>0x43</span>, <span class=number>0xED</span>, <span class=number>0xCF</span>, <span class=number>0xAC</span>, <span class=number>0x62</span>,</span><br><span class=line>    <span class=number>0xE4</span>, <span class=number>0xB3</span>, <span class=number>0x1C</span>, <span class=number>0xA9</span>, <span class=number>0xC9</span>, <span class=number>0x08</span>, <span class=number>0xE8</span>, <span class=number>0x95</span>, <span class=number>0x80</span>, <span class=number>0xDF</span>, <span class=number>0x94</span>, <span class=number>0xFA</span>,</span><br><span class=line>    <span class=number>0x75</span>, <span class=number>0x8F</span>, <span class=number>0x3F</span>, <span class=number>0xA6</span>, <span class=number>0x47</span>, <span class=number>0x07</span>, <span class=number>0xA7</span>, <span class=number>0xFC</span>, <span class=number>0xF3</span>, <span class=number>0x73</span>, <span class=number>0x17</span>, <span class=number>0xBA</span>,</span><br><span class=line>    <span class=number>0x83</span>, <span class=number>0x59</span>, <span class=number>0x3C</span>, <span class=number>0x19</span>, <span class=number>0xE6</span>, <span class=number>0x85</span>, <span class=number>0x4F</span>, <span class=number>0xA8</span>, <span class=number>0x68</span>, <span class=number>0x6B</span>, <span class=number>0x81</span>, <span class=number>0xB2</span>,</span><br><span class=line>    <span class=number>0x71</span>, <span class=number>0x64</span>, <span class=number>0xDA</span>, <span class=number>0x8B</span>, <span class=number>0xF8</span>, <span class=number>0xEB</span>, <span class=number>0x0F</span>, <span class=number>0x4B</span>, <span class=number>0x70</span>, <span class=number>0x56</span>, <span class=number>0x9D</span>, <span class=number>0x35</span>,</span><br><span class=line>    <span class=number>0x1E</span>, <span class=number>0x24</span>, <span class=number>0x0E</span>, <span class=number>0x5E</span>, <span class=number>0x63</span>, <span class=number>0x58</span>, <span class=number>0xD1</span>, <span class=number>0xA2</span>, <span class=number>0x25</span>, <span class=number>0x22</span>, <span class=number>0x7C</span>, <span class=number>0x3B</span>,</span><br><span class=line>    <span class=number>0x01</span>, <span class=number>0x21</span>, <span class=number>0x78</span>, <span class=number>0x87</span>, <span class=number>0xD4</span>, <span class=number>0x00</span>, <span class=number>0x46</span>, <span class=number>0x57</span>, <span class=number>0x9F</span>, <span class=number>0xD3</span>, <span class=number>0x27</span>, <span class=number>0x52</span>,</span><br><span class=line>    <span class=number>0x4C</span>, <span class=number>0x36</span>, <span class=number>0x02</span>, <span class=number>0xE7</span>, <span class=number>0xA0</span>, <span class=number>0xC4</span>, <span class=number>0xC8</span>, <span class=number>0x9E</span>, <span class=number>0xEA</span>, <span class=number>0xBF</span>, <span class=number>0x8A</span>, <span class=number>0xD2</span>,</span><br><span class=line>    <span class=number>0x40</span>, <span class=number>0xC7</span>, <span class=number>0x38</span>, <span class=number>0xB5</span>, <span class=number>0xA3</span>, <span class=number>0xF7</span>, <span class=number>0xF2</span>, <span class=number>0xCE</span>, <span class=number>0xF9</span>, <span class=number>0x61</span>, <span class=number>0x15</span>, <span class=number>0xA1</span>,</span><br><span class=line>    <span class=number>0xE0</span>, <span class=number>0xAE</span>, <span class=number>0x5D</span>, <span class=number>0xA4</span>, <span class=number>0x9B</span>, <span class=number>0x34</span>, <span class=number>0x1A</span>, <span class=number>0x55</span>, <span class=number>0xAD</span>, <span class=number>0x93</span>, <span class=number>0x32</span>, <span class=number>0x30</span>,</span><br><span class=line>    <span class=number>0xF5</span>, <span class=number>0x8C</span>, <span class=number>0xB1</span>, <span class=number>0xE3</span>, <span class=number>0x1D</span>, <span class=number>0xF6</span>, <span class=number>0xE2</span>, <span class=number>0x2E</span>, <span class=number>0x82</span>, <span class=number>0x66</span>, <span class=number>0xCA</span>, <span class=number>0x60</span>,</span><br><span class=line>    <span class=number>0xC0</span>, <span class=number>0x29</span>, <span class=number>0x23</span>, <span class=number>0xAB</span>, <span class=number>0x0D</span>, <span class=number>0x53</span>, <span class=number>0x4E</span>, <span class=number>0x6F</span>, <span class=number>0xD5</span>, <span class=number>0xDB</span>, <span class=number>0x37</span>, <span class=number>0x45</span>,</span><br><span class=line>    <span class=number>0xDE</span>, <span class=number>0xFD</span>, <span class=number>0x8E</span>, <span class=number>0x2F</span>, <span class=number>0x03</span>, <span class=number>0xFF</span>, <span class=number>0x6A</span>, <span class=number>0x72</span>, <span class=number>0x6D</span>, <span class=number>0x6C</span>, <span class=number>0x5B</span>, <span class=number>0x51</span>,</span><br><span class=line>    <span class=number>0x8D</span>, <span class=number>0x1B</span>, <span class=number>0xAF</span>, <span class=number>0x92</span>, <span class=number>0xBB</span>, <span class=number>0xDD</span>, <span class=number>0xBC</span>, <span class=number>0x7F</span>, <span class=number>0x11</span>, <span class=number>0xD9</span>, <span class=number>0x5C</span>, <span class=number>0x41</span>,</span><br><span class=line>    <span class=number>0x1F</span>, <span class=number>0x10</span>, <span class=number>0x5A</span>, <span class=number>0xD8</span>, <span class=number>0x0A</span>, <span class=number>0xC1</span>, <span class=number>0x31</span>, <span class=number>0x88</span>, <span class=number>0xA5</span>, <span class=number>0xCD</span>, <span class=number>0x7B</span>, <span class=number>0xBD</span>,</span><br><span class=line>    <span class=number>0x2D</span>, <span class=number>0x74</span>, <span class=number>0xD0</span>, <span class=number>0x12</span>, <span class=number>0xB8</span>, <span class=number>0xE5</span>, <span class=number>0xB4</span>, <span class=number>0xB0</span>, <span class=number>0x89</span>, <span class=number>0x69</span>, <span class=number>0x97</span>, <span class=number>0x4A</span>,</span><br><span class=line>    <span class=number>0x0C</span>, <span class=number>0x96</span>, <span class=number>0x77</span>, <span class=number>0x7E</span>, <span class=number>0x65</span>, <span class=number>0xB9</span>, <span class=number>0xF1</span>, <span class=number>0x09</span>, <span class=number>0xC5</span>, <span class=number>0x6E</span>, <span class=number>0xC6</span>, <span class=number>0x84</span>,</span><br><span class=line>    <span class=number>0x18</span>, <span class=number>0xF0</span>, <span class=number>0x7D</span>, <span class=number>0xEC</span>, <span class=number>0x3A</span>, <span class=number>0xDC</span>, <span class=number>0x4D</span>, <span class=number>0x20</span>, <span class=number>0x79</span>, <span class=number>0xEE</span>, <span class=number>0x5F</span>, <span class=number>0x3E</span>,</span><br><span class=line>    <span class=number>0xD7</span>, <span class=number>0xCB</span>, <span class=number>0x39</span>, <span class=number>0x48</span>};</span><br><span class=line></span><br><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment> * SM4_SBOX_T[j] == L(SM4_SBOX[j]).</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=type>static</span> <span class=type>const</span> <span class=type>uint32_t</span> SM4_SBOX_T0[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0x8ED55B5B</span>, <span class=number>0xD0924242</span>, <span class=number>0x4DEAA7A7</span>, <span class=number>0x06FDFBFB</span>, <span class=number>0xFCCF3333</span>, <span class=number>0x65E28787</span>,</span><br><span class=line>    <span class=number>0xC93DF4F4</span>, <span class=number>0x6BB5DEDE</span>, <span class=number>0x4E165858</span>, <span class=number>0x6EB4DADA</span>, <span class=number>0x44145050</span>, <span class=number>0xCAC10B0B</span>,</span><br><span class=line>    <span class=number>0x8828A0A0</span>, <span class=number>0x17F8EFEF</span>, <span class=number>0x9C2CB0B0</span>, <span class=number>0x11051414</span>, <span class=number>0x872BACAC</span>, <span class=number>0xFB669D9D</span>,</span><br><span class=line>    <span class=number>0xF2986A6A</span>, <span class=number>0xAE77D9D9</span>, <span class=number>0x822AA8A8</span>, <span class=number>0x46BCFAFA</span>, <span class=number>0x14041010</span>, <span class=number>0xCFC00F0F</span>,</span><br><span class=line>    <span class=number>0x02A8AAAA</span>, <span class=number>0x54451111</span>, <span class=number>0x5F134C4C</span>, <span class=number>0xBE269898</span>, <span class=number>0x6D482525</span>, <span class=number>0x9E841A1A</span>,</span><br><span class=line>    <span class=number>0x1E061818</span>, <span class=number>0xFD9B6666</span>, <span class=number>0xEC9E7272</span>, <span class=number>0x4A430909</span>, <span class=number>0x10514141</span>, <span class=number>0x24F7D3D3</span>,</span><br><span class=line>    <span class=number>0xD5934646</span>, <span class=number>0x53ECBFBF</span>, <span class=number>0xF89A6262</span>, <span class=number>0x927BE9E9</span>, <span class=number>0xFF33CCCC</span>, <span class=number>0x04555151</span>,</span><br><span class=line>    <span class=number>0x270B2C2C</span>, <span class=number>0x4F420D0D</span>, <span class=number>0x59EEB7B7</span>, <span class=number>0xF3CC3F3F</span>, <span class=number>0x1CAEB2B2</span>, <span class=number>0xEA638989</span>,</span><br><span class=line>    <span class=number>0x74E79393</span>, <span class=number>0x7FB1CECE</span>, <span class=number>0x6C1C7070</span>, <span class=number>0x0DABA6A6</span>, <span class=number>0xEDCA2727</span>, <span class=number>0x28082020</span>,</span><br><span class=line>    <span class=number>0x48EBA3A3</span>, <span class=number>0xC1975656</span>, <span class=number>0x80820202</span>, <span class=number>0xA3DC7F7F</span>, <span class=number>0xC4965252</span>, <span class=number>0x12F9EBEB</span>,</span><br><span class=line>    <span class=number>0xA174D5D5</span>, <span class=number>0xB38D3E3E</span>, <span class=number>0xC33FFCFC</span>, <span class=number>0x3EA49A9A</span>, <span class=number>0x5B461D1D</span>, <span class=number>0x1B071C1C</span>,</span><br><span class=line>    <span class=number>0x3BA59E9E</span>, <span class=number>0x0CFFF3F3</span>, <span class=number>0x3FF0CFCF</span>, <span class=number>0xBF72CDCD</span>, <span class=number>0x4B175C5C</span>, <span class=number>0x52B8EAEA</span>,</span><br><span class=line>    <span class=number>0x8F810E0E</span>, <span class=number>0x3D586565</span>, <span class=number>0xCC3CF0F0</span>, <span class=number>0x7D196464</span>, <span class=number>0x7EE59B9B</span>, <span class=number>0x91871616</span>,</span><br><span class=line>    <span class=number>0x734E3D3D</span>, <span class=number>0x08AAA2A2</span>, <span class=number>0xC869A1A1</span>, <span class=number>0xC76AADAD</span>, <span class=number>0x85830606</span>, <span class=number>0x7AB0CACA</span>,</span><br><span class=line>    <span class=number>0xB570C5C5</span>, <span class=number>0xF4659191</span>, <span class=number>0xB2D96B6B</span>, <span class=number>0xA7892E2E</span>, <span class=number>0x18FBE3E3</span>, <span class=number>0x47E8AFAF</span>,</span><br><span class=line>    <span class=number>0x330F3C3C</span>, <span class=number>0x674A2D2D</span>, <span class=number>0xB071C1C1</span>, <span class=number>0x0E575959</span>, <span class=number>0xE99F7676</span>, <span class=number>0xE135D4D4</span>,</span><br><span class=line>    <span class=number>0x661E7878</span>, <span class=number>0xB4249090</span>, <span class=number>0x360E3838</span>, <span class=number>0x265F7979</span>, <span class=number>0xEF628D8D</span>, <span class=number>0x38596161</span>,</span><br><span class=line>    <span class=number>0x95D24747</span>, <span class=number>0x2AA08A8A</span>, <span class=number>0xB1259494</span>, <span class=number>0xAA228888</span>, <span class=number>0x8C7DF1F1</span>, <span class=number>0xD73BECEC</span>,</span><br><span class=line>    <span class=number>0x05010404</span>, <span class=number>0xA5218484</span>, <span class=number>0x9879E1E1</span>, <span class=number>0x9B851E1E</span>, <span class=number>0x84D75353</span>, <span class=number>0x00000000</span>,</span><br><span class=line>    <span class=number>0x5E471919</span>, <span class=number>0x0B565D5D</span>, <span class=number>0xE39D7E7E</span>, <span class=number>0x9FD04F4F</span>, <span class=number>0xBB279C9C</span>, <span class=number>0x1A534949</span>,</span><br><span class=line>    <span class=number>0x7C4D3131</span>, <span class=number>0xEE36D8D8</span>, <span class=number>0x0A020808</span>, <span class=number>0x7BE49F9F</span>, <span class=number>0x20A28282</span>, <span class=number>0xD4C71313</span>,</span><br><span class=line>    <span class=number>0xE8CB2323</span>, <span class=number>0xE69C7A7A</span>, <span class=number>0x42E9ABAB</span>, <span class=number>0x43BDFEFE</span>, <span class=number>0xA2882A2A</span>, <span class=number>0x9AD14B4B</span>,</span><br><span class=line>    <span class=number>0x40410101</span>, <span class=number>0xDBC41F1F</span>, <span class=number>0xD838E0E0</span>, <span class=number>0x61B7D6D6</span>, <span class=number>0x2FA18E8E</span>, <span class=number>0x2BF4DFDF</span>,</span><br><span class=line>    <span class=number>0x3AF1CBCB</span>, <span class=number>0xF6CD3B3B</span>, <span class=number>0x1DFAE7E7</span>, <span class=number>0xE5608585</span>, <span class=number>0x41155454</span>, <span class=number>0x25A38686</span>,</span><br><span class=line>    <span class=number>0x60E38383</span>, <span class=number>0x16ACBABA</span>, <span class=number>0x295C7575</span>, <span class=number>0x34A69292</span>, <span class=number>0xF7996E6E</span>, <span class=number>0xE434D0D0</span>,</span><br><span class=line>    <span class=number>0x721A6868</span>, <span class=number>0x01545555</span>, <span class=number>0x19AFB6B6</span>, <span class=number>0xDF914E4E</span>, <span class=number>0xFA32C8C8</span>, <span class=number>0xF030C0C0</span>,</span><br><span class=line>    <span class=number>0x21F6D7D7</span>, <span class=number>0xBC8E3232</span>, <span class=number>0x75B3C6C6</span>, <span class=number>0x6FE08F8F</span>, <span class=number>0x691D7474</span>, <span class=number>0x2EF5DBDB</span>,</span><br><span class=line>    <span class=number>0x6AE18B8B</span>, <span class=number>0x962EB8B8</span>, <span class=number>0x8A800A0A</span>, <span class=number>0xFE679999</span>, <span class=number>0xE2C92B2B</span>, <span class=number>0xE0618181</span>,</span><br><span class=line>    <span class=number>0xC0C30303</span>, <span class=number>0x8D29A4A4</span>, <span class=number>0xAF238C8C</span>, <span class=number>0x07A9AEAE</span>, <span class=number>0x390D3434</span>, <span class=number>0x1F524D4D</span>,</span><br><span class=line>    <span class=number>0x764F3939</span>, <span class=number>0xD36EBDBD</span>, <span class=number>0x81D65757</span>, <span class=number>0xB7D86F6F</span>, <span class=number>0xEB37DCDC</span>, <span class=number>0x51441515</span>,</span><br><span class=line>    <span class=number>0xA6DD7B7B</span>, <span class=number>0x09FEF7F7</span>, <span class=number>0xB68C3A3A</span>, <span class=number>0x932FBCBC</span>, <span class=number>0x0F030C0C</span>, <span class=number>0x03FCFFFF</span>,</span><br><span class=line>    <span class=number>0xC26BA9A9</span>, <span class=number>0xBA73C9C9</span>, <span class=number>0xD96CB5B5</span>, <span class=number>0xDC6DB1B1</span>, <span class=number>0x375A6D6D</span>, <span class=number>0x15504545</span>,</span><br><span class=line>    <span class=number>0xB98F3636</span>, <span class=number>0x771B6C6C</span>, <span class=number>0x13ADBEBE</span>, <span class=number>0xDA904A4A</span>, <span class=number>0x57B9EEEE</span>, <span class=number>0xA9DE7777</span>,</span><br><span class=line>    <span class=number>0x4CBEF2F2</span>, <span class=number>0x837EFDFD</span>, <span class=number>0x55114444</span>, <span class=number>0xBDDA6767</span>, <span class=number>0x2C5D7171</span>, <span class=number>0x45400505</span>,</span><br><span class=line>    <span class=number>0x631F7C7C</span>, <span class=number>0x50104040</span>, <span class=number>0x325B6969</span>, <span class=number>0xB8DB6363</span>, <span class=number>0x220A2828</span>, <span class=number>0xC5C20707</span>,</span><br><span class=line>    <span class=number>0xF531C4C4</span>, <span class=number>0xA88A2222</span>, <span class=number>0x31A79696</span>, <span class=number>0xF9CE3737</span>, <span class=number>0x977AEDED</span>, <span class=number>0x49BFF6F6</span>,</span><br><span class=line>    <span class=number>0x992DB4B4</span>, <span class=number>0xA475D1D1</span>, <span class=number>0x90D34343</span>, <span class=number>0x5A124848</span>, <span class=number>0x58BAE2E2</span>, <span class=number>0x71E69797</span>,</span><br><span class=line>    <span class=number>0x64B6D2D2</span>, <span class=number>0x70B2C2C2</span>, <span class=number>0xAD8B2626</span>, <span class=number>0xCD68A5A5</span>, <span class=number>0xCB955E5E</span>, <span class=number>0x624B2929</span>,</span><br><span class=line>    <span class=number>0x3C0C3030</span>, <span class=number>0xCE945A5A</span>, <span class=number>0xAB76DDDD</span>, <span class=number>0x867FF9F9</span>, <span class=number>0xF1649595</span>, <span class=number>0x5DBBE6E6</span>,</span><br><span class=line>    <span class=number>0x35F2C7C7</span>, <span class=number>0x2D092424</span>, <span class=number>0xD1C61717</span>, <span class=number>0xD66FB9B9</span>, <span class=number>0xDEC51B1B</span>, <span class=number>0x94861212</span>,</span><br><span class=line>    <span class=number>0x78186060</span>, <span class=number>0x30F3C3C3</span>, <span class=number>0x897CF5F5</span>, <span class=number>0x5CEFB3B3</span>, <span class=number>0xD23AE8E8</span>, <span class=number>0xACDF7373</span>,</span><br><span class=line>    <span class=number>0x794C3535</span>, <span class=number>0xA0208080</span>, <span class=number>0x9D78E5E5</span>, <span class=number>0x56EDBBBB</span>, <span class=number>0x235E7D7D</span>, <span class=number>0xC63EF8F8</span>,</span><br><span class=line>    <span class=number>0x8BD45F5F</span>, <span class=number>0xE7C82F2F</span>, <span class=number>0xDD39E4E4</span>, <span class=number>0x68492121</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>uint32_t</span> SM4_SBOX_T1[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0x5B8ED55B</span>, <span class=number>0x42D09242</span>, <span class=number>0xA74DEAA7</span>, <span class=number>0xFB06FDFB</span>, <span class=number>0x33FCCF33</span>, <span class=number>0x8765E287</span>,</span><br><span class=line>    <span class=number>0xF4C93DF4</span>, <span class=number>0xDE6BB5DE</span>, <span class=number>0x584E1658</span>, <span class=number>0xDA6EB4DA</span>, <span class=number>0x50441450</span>, <span class=number>0x0BCAC10B</span>,</span><br><span class=line>    <span class=number>0xA08828A0</span>, <span class=number>0xEF17F8EF</span>, <span class=number>0xB09C2CB0</span>, <span class=number>0x14110514</span>, <span class=number>0xAC872BAC</span>, <span class=number>0x9DFB669D</span>,</span><br><span class=line>    <span class=number>0x6AF2986A</span>, <span class=number>0xD9AE77D9</span>, <span class=number>0xA8822AA8</span>, <span class=number>0xFA46BCFA</span>, <span class=number>0x10140410</span>, <span class=number>0x0FCFC00F</span>,</span><br><span class=line>    <span class=number>0xAA02A8AA</span>, <span class=number>0x11544511</span>, <span class=number>0x4C5F134C</span>, <span class=number>0x98BE2698</span>, <span class=number>0x256D4825</span>, <span class=number>0x1A9E841A</span>,</span><br><span class=line>    <span class=number>0x181E0618</span>, <span class=number>0x66FD9B66</span>, <span class=number>0x72EC9E72</span>, <span class=number>0x094A4309</span>, <span class=number>0x41105141</span>, <span class=number>0xD324F7D3</span>,</span><br><span class=line>    <span class=number>0x46D59346</span>, <span class=number>0xBF53ECBF</span>, <span class=number>0x62F89A62</span>, <span class=number>0xE9927BE9</span>, <span class=number>0xCCFF33CC</span>, <span class=number>0x51045551</span>,</span><br><span class=line>    <span class=number>0x2C270B2C</span>, <span class=number>0x0D4F420D</span>, <span class=number>0xB759EEB7</span>, <span class=number>0x3FF3CC3F</span>, <span class=number>0xB21CAEB2</span>, <span class=number>0x89EA6389</span>,</span><br><span class=line>    <span class=number>0x9374E793</span>, <span class=number>0xCE7FB1CE</span>, <span class=number>0x706C1C70</span>, <span class=number>0xA60DABA6</span>, <span class=number>0x27EDCA27</span>, <span class=number>0x20280820</span>,</span><br><span class=line>    <span class=number>0xA348EBA3</span>, <span class=number>0x56C19756</span>, <span class=number>0x02808202</span>, <span class=number>0x7FA3DC7F</span>, <span class=number>0x52C49652</span>, <span class=number>0xEB12F9EB</span>,</span><br><span class=line>    <span class=number>0xD5A174D5</span>, <span class=number>0x3EB38D3E</span>, <span class=number>0xFCC33FFC</span>, <span class=number>0x9A3EA49A</span>, <span class=number>0x1D5B461D</span>, <span class=number>0x1C1B071C</span>,</span><br><span class=line>    <span class=number>0x9E3BA59E</span>, <span class=number>0xF30CFFF3</span>, <span class=number>0xCF3FF0CF</span>, <span class=number>0xCDBF72CD</span>, <span class=number>0x5C4B175C</span>, <span class=number>0xEA52B8EA</span>,</span><br><span class=line>    <span class=number>0x0E8F810E</span>, <span class=number>0x653D5865</span>, <span class=number>0xF0CC3CF0</span>, <span class=number>0x647D1964</span>, <span class=number>0x9B7EE59B</span>, <span class=number>0x16918716</span>,</span><br><span class=line>    <span class=number>0x3D734E3D</span>, <span class=number>0xA208AAA2</span>, <span class=number>0xA1C869A1</span>, <span class=number>0xADC76AAD</span>, <span class=number>0x06858306</span>, <span class=number>0xCA7AB0CA</span>,</span><br><span class=line>    <span class=number>0xC5B570C5</span>, <span class=number>0x91F46591</span>, <span class=number>0x6BB2D96B</span>, <span class=number>0x2EA7892E</span>, <span class=number>0xE318FBE3</span>, <span class=number>0xAF47E8AF</span>,</span><br><span class=line>    <span class=number>0x3C330F3C</span>, <span class=number>0x2D674A2D</span>, <span class=number>0xC1B071C1</span>, <span class=number>0x590E5759</span>, <span class=number>0x76E99F76</span>, <span class=number>0xD4E135D4</span>,</span><br><span class=line>    <span class=number>0x78661E78</span>, <span class=number>0x90B42490</span>, <span class=number>0x38360E38</span>, <span class=number>0x79265F79</span>, <span class=number>0x8DEF628D</span>, <span class=number>0x61385961</span>,</span><br><span class=line>    <span class=number>0x4795D247</span>, <span class=number>0x8A2AA08A</span>, <span class=number>0x94B12594</span>, <span class=number>0x88AA2288</span>, <span class=number>0xF18C7DF1</span>, <span class=number>0xECD73BEC</span>,</span><br><span class=line>    <span class=number>0x04050104</span>, <span class=number>0x84A52184</span>, <span class=number>0xE19879E1</span>, <span class=number>0x1E9B851E</span>, <span class=number>0x5384D753</span>, <span class=number>0x00000000</span>,</span><br><span class=line>    <span class=number>0x195E4719</span>, <span class=number>0x5D0B565D</span>, <span class=number>0x7EE39D7E</span>, <span class=number>0x4F9FD04F</span>, <span class=number>0x9CBB279C</span>, <span class=number>0x491A5349</span>,</span><br><span class=line>    <span class=number>0x317C4D31</span>, <span class=number>0xD8EE36D8</span>, <span class=number>0x080A0208</span>, <span class=number>0x9F7BE49F</span>, <span class=number>0x8220A282</span>, <span class=number>0x13D4C713</span>,</span><br><span class=line>    <span class=number>0x23E8CB23</span>, <span class=number>0x7AE69C7A</span>, <span class=number>0xAB42E9AB</span>, <span class=number>0xFE43BDFE</span>, <span class=number>0x2AA2882A</span>, <span class=number>0x4B9AD14B</span>,</span><br><span class=line>    <span class=number>0x01404101</span>, <span class=number>0x1FDBC41F</span>, <span class=number>0xE0D838E0</span>, <span class=number>0xD661B7D6</span>, <span class=number>0x8E2FA18E</span>, <span class=number>0xDF2BF4DF</span>,</span><br><span class=line>    <span class=number>0xCB3AF1CB</span>, <span class=number>0x3BF6CD3B</span>, <span class=number>0xE71DFAE7</span>, <span class=number>0x85E56085</span>, <span class=number>0x54411554</span>, <span class=number>0x8625A386</span>,</span><br><span class=line>    <span class=number>0x8360E383</span>, <span class=number>0xBA16ACBA</span>, <span class=number>0x75295C75</span>, <span class=number>0x9234A692</span>, <span class=number>0x6EF7996E</span>, <span class=number>0xD0E434D0</span>,</span><br><span class=line>    <span class=number>0x68721A68</span>, <span class=number>0x55015455</span>, <span class=number>0xB619AFB6</span>, <span class=number>0x4EDF914E</span>, <span class=number>0xC8FA32C8</span>, <span class=number>0xC0F030C0</span>,</span><br><span class=line>    <span class=number>0xD721F6D7</span>, <span class=number>0x32BC8E32</span>, <span class=number>0xC675B3C6</span>, <span class=number>0x8F6FE08F</span>, <span class=number>0x74691D74</span>, <span class=number>0xDB2EF5DB</span>,</span><br><span class=line>    <span class=number>0x8B6AE18B</span>, <span class=number>0xB8962EB8</span>, <span class=number>0x0A8A800A</span>, <span class=number>0x99FE6799</span>, <span class=number>0x2BE2C92B</span>, <span class=number>0x81E06181</span>,</span><br><span class=line>    <span class=number>0x03C0C303</span>, <span class=number>0xA48D29A4</span>, <span class=number>0x8CAF238C</span>, <span class=number>0xAE07A9AE</span>, <span class=number>0x34390D34</span>, <span class=number>0x4D1F524D</span>,</span><br><span class=line>    <span class=number>0x39764F39</span>, <span class=number>0xBDD36EBD</span>, <span class=number>0x5781D657</span>, <span class=number>0x6FB7D86F</span>, <span class=number>0xDCEB37DC</span>, <span class=number>0x15514415</span>,</span><br><span class=line>    <span class=number>0x7BA6DD7B</span>, <span class=number>0xF709FEF7</span>, <span class=number>0x3AB68C3A</span>, <span class=number>0xBC932FBC</span>, <span class=number>0x0C0F030C</span>, <span class=number>0xFF03FCFF</span>,</span><br><span class=line>    <span class=number>0xA9C26BA9</span>, <span class=number>0xC9BA73C9</span>, <span class=number>0xB5D96CB5</span>, <span class=number>0xB1DC6DB1</span>, <span class=number>0x6D375A6D</span>, <span class=number>0x45155045</span>,</span><br><span class=line>    <span class=number>0x36B98F36</span>, <span class=number>0x6C771B6C</span>, <span class=number>0xBE13ADBE</span>, <span class=number>0x4ADA904A</span>, <span class=number>0xEE57B9EE</span>, <span class=number>0x77A9DE77</span>,</span><br><span class=line>    <span class=number>0xF24CBEF2</span>, <span class=number>0xFD837EFD</span>, <span class=number>0x44551144</span>, <span class=number>0x67BDDA67</span>, <span class=number>0x712C5D71</span>, <span class=number>0x05454005</span>,</span><br><span class=line>    <span class=number>0x7C631F7C</span>, <span class=number>0x40501040</span>, <span class=number>0x69325B69</span>, <span class=number>0x63B8DB63</span>, <span class=number>0x28220A28</span>, <span class=number>0x07C5C207</span>,</span><br><span class=line>    <span class=number>0xC4F531C4</span>, <span class=number>0x22A88A22</span>, <span class=number>0x9631A796</span>, <span class=number>0x37F9CE37</span>, <span class=number>0xED977AED</span>, <span class=number>0xF649BFF6</span>,</span><br><span class=line>    <span class=number>0xB4992DB4</span>, <span class=number>0xD1A475D1</span>, <span class=number>0x4390D343</span>, <span class=number>0x485A1248</span>, <span class=number>0xE258BAE2</span>, <span class=number>0x9771E697</span>,</span><br><span class=line>    <span class=number>0xD264B6D2</span>, <span class=number>0xC270B2C2</span>, <span class=number>0x26AD8B26</span>, <span class=number>0xA5CD68A5</span>, <span class=number>0x5ECB955E</span>, <span class=number>0x29624B29</span>,</span><br><span class=line>    <span class=number>0x303C0C30</span>, <span class=number>0x5ACE945A</span>, <span class=number>0xDDAB76DD</span>, <span class=number>0xF9867FF9</span>, <span class=number>0x95F16495</span>, <span class=number>0xE65DBBE6</span>,</span><br><span class=line>    <span class=number>0xC735F2C7</span>, <span class=number>0x242D0924</span>, <span class=number>0x17D1C617</span>, <span class=number>0xB9D66FB9</span>, <span class=number>0x1BDEC51B</span>, <span class=number>0x12948612</span>,</span><br><span class=line>    <span class=number>0x60781860</span>, <span class=number>0xC330F3C3</span>, <span class=number>0xF5897CF5</span>, <span class=number>0xB35CEFB3</span>, <span class=number>0xE8D23AE8</span>, <span class=number>0x73ACDF73</span>,</span><br><span class=line>    <span class=number>0x35794C35</span>, <span class=number>0x80A02080</span>, <span class=number>0xE59D78E5</span>, <span class=number>0xBB56EDBB</span>, <span class=number>0x7D235E7D</span>, <span class=number>0xF8C63EF8</span>,</span><br><span class=line>    <span class=number>0x5F8BD45F</span>, <span class=number>0x2FE7C82F</span>, <span class=number>0xE4DD39E4</span>, <span class=number>0x21684921</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>uint32_t</span> SM4_SBOX_T2[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0x5B5B8ED5</span>, <span class=number>0x4242D092</span>, <span class=number>0xA7A74DEA</span>, <span class=number>0xFBFB06FD</span>, <span class=number>0x3333FCCF</span>, <span class=number>0x878765E2</span>,</span><br><span class=line>    <span class=number>0xF4F4C93D</span>, <span class=number>0xDEDE6BB5</span>, <span class=number>0x58584E16</span>, <span class=number>0xDADA6EB4</span>, <span class=number>0x50504414</span>, <span class=number>0x0B0BCAC1</span>,</span><br><span class=line>    <span class=number>0xA0A08828</span>, <span class=number>0xEFEF17F8</span>, <span class=number>0xB0B09C2C</span>, <span class=number>0x14141105</span>, <span class=number>0xACAC872B</span>, <span class=number>0x9D9DFB66</span>,</span><br><span class=line>    <span class=number>0x6A6AF298</span>, <span class=number>0xD9D9AE77</span>, <span class=number>0xA8A8822A</span>, <span class=number>0xFAFA46BC</span>, <span class=number>0x10101404</span>, <span class=number>0x0F0FCFC0</span>,</span><br><span class=line>    <span class=number>0xAAAA02A8</span>, <span class=number>0x11115445</span>, <span class=number>0x4C4C5F13</span>, <span class=number>0x9898BE26</span>, <span class=number>0x25256D48</span>, <span class=number>0x1A1A9E84</span>,</span><br><span class=line>    <span class=number>0x18181E06</span>, <span class=number>0x6666FD9B</span>, <span class=number>0x7272EC9E</span>, <span class=number>0x09094A43</span>, <span class=number>0x41411051</span>, <span class=number>0xD3D324F7</span>,</span><br><span class=line>    <span class=number>0x4646D593</span>, <span class=number>0xBFBF53EC</span>, <span class=number>0x6262F89A</span>, <span class=number>0xE9E9927B</span>, <span class=number>0xCCCCFF33</span>, <span class=number>0x51510455</span>,</span><br><span class=line>    <span class=number>0x2C2C270B</span>, <span class=number>0x0D0D4F42</span>, <span class=number>0xB7B759EE</span>, <span class=number>0x3F3FF3CC</span>, <span class=number>0xB2B21CAE</span>, <span class=number>0x8989EA63</span>,</span><br><span class=line>    <span class=number>0x939374E7</span>, <span class=number>0xCECE7FB1</span>, <span class=number>0x70706C1C</span>, <span class=number>0xA6A60DAB</span>, <span class=number>0x2727EDCA</span>, <span class=number>0x20202808</span>,</span><br><span class=line>    <span class=number>0xA3A348EB</span>, <span class=number>0x5656C197</span>, <span class=number>0x02028082</span>, <span class=number>0x7F7FA3DC</span>, <span class=number>0x5252C496</span>, <span class=number>0xEBEB12F9</span>,</span><br><span class=line>    <span class=number>0xD5D5A174</span>, <span class=number>0x3E3EB38D</span>, <span class=number>0xFCFCC33F</span>, <span class=number>0x9A9A3EA4</span>, <span class=number>0x1D1D5B46</span>, <span class=number>0x1C1C1B07</span>,</span><br><span class=line>    <span class=number>0x9E9E3BA5</span>, <span class=number>0xF3F30CFF</span>, <span class=number>0xCFCF3FF0</span>, <span class=number>0xCDCDBF72</span>, <span class=number>0x5C5C4B17</span>, <span class=number>0xEAEA52B8</span>,</span><br><span class=line>    <span class=number>0x0E0E8F81</span>, <span class=number>0x65653D58</span>, <span class=number>0xF0F0CC3C</span>, <span class=number>0x64647D19</span>, <span class=number>0x9B9B7EE5</span>, <span class=number>0x16169187</span>,</span><br><span class=line>    <span class=number>0x3D3D734E</span>, <span class=number>0xA2A208AA</span>, <span class=number>0xA1A1C869</span>, <span class=number>0xADADC76A</span>, <span class=number>0x06068583</span>, <span class=number>0xCACA7AB0</span>,</span><br><span class=line>    <span class=number>0xC5C5B570</span>, <span class=number>0x9191F465</span>, <span class=number>0x6B6BB2D9</span>, <span class=number>0x2E2EA789</span>, <span class=number>0xE3E318FB</span>, <span class=number>0xAFAF47E8</span>,</span><br><span class=line>    <span class=number>0x3C3C330F</span>, <span class=number>0x2D2D674A</span>, <span class=number>0xC1C1B071</span>, <span class=number>0x59590E57</span>, <span class=number>0x7676E99F</span>, <span class=number>0xD4D4E135</span>,</span><br><span class=line>    <span class=number>0x7878661E</span>, <span class=number>0x9090B424</span>, <span class=number>0x3838360E</span>, <span class=number>0x7979265F</span>, <span class=number>0x8D8DEF62</span>, <span class=number>0x61613859</span>,</span><br><span class=line>    <span class=number>0x474795D2</span>, <span class=number>0x8A8A2AA0</span>, <span class=number>0x9494B125</span>, <span class=number>0x8888AA22</span>, <span class=number>0xF1F18C7D</span>, <span class=number>0xECECD73B</span>,</span><br><span class=line>    <span class=number>0x04040501</span>, <span class=number>0x8484A521</span>, <span class=number>0xE1E19879</span>, <span class=number>0x1E1E9B85</span>, <span class=number>0x535384D7</span>, <span class=number>0x00000000</span>,</span><br><span class=line>    <span class=number>0x19195E47</span>, <span class=number>0x5D5D0B56</span>, <span class=number>0x7E7EE39D</span>, <span class=number>0x4F4F9FD0</span>, <span class=number>0x9C9CBB27</span>, <span class=number>0x49491A53</span>,</span><br><span class=line>    <span class=number>0x31317C4D</span>, <span class=number>0xD8D8EE36</span>, <span class=number>0x08080A02</span>, <span class=number>0x9F9F7BE4</span>, <span class=number>0x828220A2</span>, <span class=number>0x1313D4C7</span>,</span><br><span class=line>    <span class=number>0x2323E8CB</span>, <span class=number>0x7A7AE69C</span>, <span class=number>0xABAB42E9</span>, <span class=number>0xFEFE43BD</span>, <span class=number>0x2A2AA288</span>, <span class=number>0x4B4B9AD1</span>,</span><br><span class=line>    <span class=number>0x01014041</span>, <span class=number>0x1F1FDBC4</span>, <span class=number>0xE0E0D838</span>, <span class=number>0xD6D661B7</span>, <span class=number>0x8E8E2FA1</span>, <span class=number>0xDFDF2BF4</span>,</span><br><span class=line>    <span class=number>0xCBCB3AF1</span>, <span class=number>0x3B3BF6CD</span>, <span class=number>0xE7E71DFA</span>, <span class=number>0x8585E560</span>, <span class=number>0x54544115</span>, <span class=number>0x868625A3</span>,</span><br><span class=line>    <span class=number>0x838360E3</span>, <span class=number>0xBABA16AC</span>, <span class=number>0x7575295C</span>, <span class=number>0x929234A6</span>, <span class=number>0x6E6EF799</span>, <span class=number>0xD0D0E434</span>,</span><br><span class=line>    <span class=number>0x6868721A</span>, <span class=number>0x55550154</span>, <span class=number>0xB6B619AF</span>, <span class=number>0x4E4EDF91</span>, <span class=number>0xC8C8FA32</span>, <span class=number>0xC0C0F030</span>,</span><br><span class=line>    <span class=number>0xD7D721F6</span>, <span class=number>0x3232BC8E</span>, <span class=number>0xC6C675B3</span>, <span class=number>0x8F8F6FE0</span>, <span class=number>0x7474691D</span>, <span class=number>0xDBDB2EF5</span>,</span><br><span class=line>    <span class=number>0x8B8B6AE1</span>, <span class=number>0xB8B8962E</span>, <span class=number>0x0A0A8A80</span>, <span class=number>0x9999FE67</span>, <span class=number>0x2B2BE2C9</span>, <span class=number>0x8181E061</span>,</span><br><span class=line>    <span class=number>0x0303C0C3</span>, <span class=number>0xA4A48D29</span>, <span class=number>0x8C8CAF23</span>, <span class=number>0xAEAE07A9</span>, <span class=number>0x3434390D</span>, <span class=number>0x4D4D1F52</span>,</span><br><span class=line>    <span class=number>0x3939764F</span>, <span class=number>0xBDBDD36E</span>, <span class=number>0x575781D6</span>, <span class=number>0x6F6FB7D8</span>, <span class=number>0xDCDCEB37</span>, <span class=number>0x15155144</span>,</span><br><span class=line>    <span class=number>0x7B7BA6DD</span>, <span class=number>0xF7F709FE</span>, <span class=number>0x3A3AB68C</span>, <span class=number>0xBCBC932F</span>, <span class=number>0x0C0C0F03</span>, <span class=number>0xFFFF03FC</span>,</span><br><span class=line>    <span class=number>0xA9A9C26B</span>, <span class=number>0xC9C9BA73</span>, <span class=number>0xB5B5D96C</span>, <span class=number>0xB1B1DC6D</span>, <span class=number>0x6D6D375A</span>, <span class=number>0x45451550</span>,</span><br><span class=line>    <span class=number>0x3636B98F</span>, <span class=number>0x6C6C771B</span>, <span class=number>0xBEBE13AD</span>, <span class=number>0x4A4ADA90</span>, <span class=number>0xEEEE57B9</span>, <span class=number>0x7777A9DE</span>,</span><br><span class=line>    <span class=number>0xF2F24CBE</span>, <span class=number>0xFDFD837E</span>, <span class=number>0x44445511</span>, <span class=number>0x6767BDDA</span>, <span class=number>0x71712C5D</span>, <span class=number>0x05054540</span>,</span><br><span class=line>    <span class=number>0x7C7C631F</span>, <span class=number>0x40405010</span>, <span class=number>0x6969325B</span>, <span class=number>0x6363B8DB</span>, <span class=number>0x2828220A</span>, <span class=number>0x0707C5C2</span>,</span><br><span class=line>    <span class=number>0xC4C4F531</span>, <span class=number>0x2222A88A</span>, <span class=number>0x969631A7</span>, <span class=number>0x3737F9CE</span>, <span class=number>0xEDED977A</span>, <span class=number>0xF6F649BF</span>,</span><br><span class=line>    <span class=number>0xB4B4992D</span>, <span class=number>0xD1D1A475</span>, <span class=number>0x434390D3</span>, <span class=number>0x48485A12</span>, <span class=number>0xE2E258BA</span>, <span class=number>0x979771E6</span>,</span><br><span class=line>    <span class=number>0xD2D264B6</span>, <span class=number>0xC2C270B2</span>, <span class=number>0x2626AD8B</span>, <span class=number>0xA5A5CD68</span>, <span class=number>0x5E5ECB95</span>, <span class=number>0x2929624B</span>,</span><br><span class=line>    <span class=number>0x30303C0C</span>, <span class=number>0x5A5ACE94</span>, <span class=number>0xDDDDAB76</span>, <span class=number>0xF9F9867F</span>, <span class=number>0x9595F164</span>, <span class=number>0xE6E65DBB</span>,</span><br><span class=line>    <span class=number>0xC7C735F2</span>, <span class=number>0x24242D09</span>, <span class=number>0x1717D1C6</span>, <span class=number>0xB9B9D66F</span>, <span class=number>0x1B1BDEC5</span>, <span class=number>0x12129486</span>,</span><br><span class=line>    <span class=number>0x60607818</span>, <span class=number>0xC3C330F3</span>, <span class=number>0xF5F5897C</span>, <span class=number>0xB3B35CEF</span>, <span class=number>0xE8E8D23A</span>, <span class=number>0x7373ACDF</span>,</span><br><span class=line>    <span class=number>0x3535794C</span>, <span class=number>0x8080A020</span>, <span class=number>0xE5E59D78</span>, <span class=number>0xBBBB56ED</span>, <span class=number>0x7D7D235E</span>, <span class=number>0xF8F8C63E</span>,</span><br><span class=line>    <span class=number>0x5F5F8BD4</span>, <span class=number>0x2F2FE7C8</span>, <span class=number>0xE4E4DD39</span>, <span class=number>0x21216849</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=type>static</span> <span class=type>uint32_t</span> SM4_SBOX_T3[<span class=number>256</span>] = {</span><br><span class=line>    <span class=number>0xD55B5B8E</span>, <span class=number>0x924242D0</span>, <span class=number>0xEAA7A74D</span>, <span class=number>0xFDFBFB06</span>, <span class=number>0xCF3333FC</span>, <span class=number>0xE2878765</span>,</span><br><span class=line>    <span class=number>0x3DF4F4C9</span>, <span class=number>0xB5DEDE6B</span>, <span class=number>0x1658584E</span>, <span class=number>0xB4DADA6E</span>, <span class=number>0x14505044</span>, <span class=number>0xC10B0BCA</span>,</span><br><span class=line>    <span class=number>0x28A0A088</span>, <span class=number>0xF8EFEF17</span>, <span class=number>0x2CB0B09C</span>, <span class=number>0x05141411</span>, <span class=number>0x2BACAC87</span>, <span class=number>0x669D9DFB</span>,</span><br><span class=line>    <span class=number>0x986A6AF2</span>, <span class=number>0x77D9D9AE</span>, <span class=number>0x2AA8A882</span>, <span class=number>0xBCFAFA46</span>, <span class=number>0x04101014</span>, <span class=number>0xC00F0FCF</span>,</span><br><span class=line>    <span class=number>0xA8AAAA02</span>, <span class=number>0x45111154</span>, <span class=number>0x134C4C5F</span>, <span class=number>0x269898BE</span>, <span class=number>0x4825256D</span>, <span class=number>0x841A1A9E</span>,</span><br><span class=line>    <span class=number>0x0618181E</span>, <span class=number>0x9B6666FD</span>, <span class=number>0x9E7272EC</span>, <span class=number>0x4309094A</span>, <span class=number>0x51414110</span>, <span class=number>0xF7D3D324</span>,</span><br><span class=line>    <span class=number>0x934646D5</span>, <span class=number>0xECBFBF53</span>, <span class=number>0x9A6262F8</span>, <span class=number>0x7BE9E992</span>, <span class=number>0x33CCCCFF</span>, <span class=number>0x55515104</span>,</span><br><span class=line>    <span class=number>0x0B2C2C27</span>, <span class=number>0x420D0D4F</span>, <span class=number>0xEEB7B759</span>, <span class=number>0xCC3F3FF3</span>, <span class=number>0xAEB2B21C</span>, <span class=number>0x638989EA</span>,</span><br><span class=line>    <span class=number>0xE7939374</span>, <span class=number>0xB1CECE7F</span>, <span class=number>0x1C70706C</span>, <span class=number>0xABA6A60D</span>, <span class=number>0xCA2727ED</span>, <span class=number>0x08202028</span>,</span><br><span class=line>    <span class=number>0xEBA3A348</span>, <span class=number>0x975656C1</span>, <span class=number>0x82020280</span>, <span class=number>0xDC7F7FA3</span>, <span class=number>0x965252C4</span>, <span class=number>0xF9EBEB12</span>,</span><br><span class=line>    <span class=number>0x74D5D5A1</span>, <span class=number>0x8D3E3EB3</span>, <span class=number>0x3FFCFCC3</span>, <span class=number>0xA49A9A3E</span>, <span class=number>0x461D1D5B</span>, <span class=number>0x071C1C1B</span>,</span><br><span class=line>    <span class=number>0xA59E9E3B</span>, <span class=number>0xFFF3F30C</span>, <span class=number>0xF0CFCF3F</span>, <span class=number>0x72CDCDBF</span>, <span class=number>0x175C5C4B</span>, <span class=number>0xB8EAEA52</span>,</span><br><span class=line>    <span class=number>0x810E0E8F</span>, <span class=number>0x5865653D</span>, <span class=number>0x3CF0F0CC</span>, <span class=number>0x1964647D</span>, <span class=number>0xE59B9B7E</span>, <span class=number>0x87161691</span>,</span><br><span class=line>    <span class=number>0x4E3D3D73</span>, <span class=number>0xAAA2A208</span>, <span class=number>0x69A1A1C8</span>, <span class=number>0x6AADADC7</span>, <span class=number>0x83060685</span>, <span class=number>0xB0CACA7A</span>,</span><br><span class=line>    <span class=number>0x70C5C5B5</span>, <span class=number>0x659191F4</span>, <span class=number>0xD96B6BB2</span>, <span class=number>0x892E2EA7</span>, <span class=number>0xFBE3E318</span>, <span class=number>0xE8AFAF47</span>,</span><br><span class=line>    <span class=number>0x0F3C3C33</span>, <span class=number>0x4A2D2D67</span>, <span class=number>0x71C1C1B0</span>, <span class=number>0x5759590E</span>, <span class=number>0x9F7676E9</span>, <span class=number>0x35D4D4E1</span>,</span><br><span class=line>    <span class=number>0x1E787866</span>, <span class=number>0x249090B4</span>, <span class=number>0x0E383836</span>, <span class=number>0x5F797926</span>, <span class=number>0x628D8DEF</span>, <span class=number>0x59616138</span>,</span><br><span class=line>    <span class=number>0xD2474795</span>, <span class=number>0xA08A8A2A</span>, <span class=number>0x259494B1</span>, <span class=number>0x228888AA</span>, <span class=number>0x7DF1F18C</span>, <span class=number>0x3BECECD7</span>,</span><br><span class=line>    <span class=number>0x01040405</span>, <span class=number>0x218484A5</span>, <span class=number>0x79E1E198</span>, <span class=number>0x851E1E9B</span>, <span class=number>0xD7535384</span>, <span class=number>0x00000000</span>,</span><br><span class=line>    <span class=number>0x4719195E</span>, <span class=number>0x565D5D0B</span>, <span class=number>0x9D7E7EE3</span>, <span class=number>0xD04F4F9F</span>, <span class=number>0x279C9CBB</span>, <span class=number>0x5349491A</span>,</span><br><span class=line>    <span class=number>0x4D31317C</span>, <span class=number>0x36D8D8EE</span>, <span class=number>0x0208080A</span>, <span class=number>0xE49F9F7B</span>, <span class=number>0xA2828220</span>, <span class=number>0xC71313D4</span>,</span><br><span class=line>    <span class=number>0xCB2323E8</span>, <span class=number>0x9C7A7AE6</span>, <span class=number>0xE9ABAB42</span>, <span class=number>0xBDFEFE43</span>, <span class=number>0x882A2AA2</span>, <span class=number>0xD14B4B9A</span>,</span><br><span class=line>    <span class=number>0x41010140</span>, <span class=number>0xC41F1FDB</span>, <span class=number>0x38E0E0D8</span>, <span class=number>0xB7D6D661</span>, <span class=number>0xA18E8E2F</span>, <span class=number>0xF4DFDF2B</span>,</span><br><span class=line>    <span class=number>0xF1CBCB3A</span>, <span class=number>0xCD3B3BF6</span>, <span class=number>0xFAE7E71D</span>, <span class=number>0x608585E5</span>, <span class=number>0x15545441</span>, <span class=number>0xA3868625</span>,</span><br><span class=line>    <span class=number>0xE3838360</span>, <span class=number>0xACBABA16</span>, <span class=number>0x5C757529</span>, <span class=number>0xA6929234</span>, <span class=number>0x996E6EF7</span>, <span class=number>0x34D0D0E4</span>,</span><br><span class=line>    <span class=number>0x1A686872</span>, <span class=number>0x54555501</span>, <span class=number>0xAFB6B619</span>, <span class=number>0x914E4EDF</span>, <span class=number>0x32C8C8FA</span>, <span class=number>0x30C0C0F0</span>,</span><br><span class=line>    <span class=number>0xF6D7D721</span>, <span class=number>0x8E3232BC</span>, <span class=number>0xB3C6C675</span>, <span class=number>0xE08F8F6F</span>, <span class=number>0x1D747469</span>, <span class=number>0xF5DBDB2E</span>,</span><br><span class=line>    <span class=number>0xE18B8B6A</span>, <span class=number>0x2EB8B896</span>, <span class=number>0x800A0A8A</span>, <span class=number>0x679999FE</span>, <span class=number>0xC92B2BE2</span>, <span class=number>0x618181E0</span>,</span><br><span class=line>    <span class=number>0xC30303C0</span>, <span class=number>0x29A4A48D</span>, <span class=number>0x238C8CAF</span>, <span class=number>0xA9AEAE07</span>, <span class=number>0x0D343439</span>, <span class=number>0x524D4D1F</span>,</span><br><span class=line>    <span class=number>0x4F393976</span>, <span class=number>0x6EBDBDD3</span>, <span class=number>0xD6575781</span>, <span class=number>0xD86F6FB7</span>, <span class=number>0x37DCDCEB</span>, <span class=number>0x44151551</span>,</span><br><span class=line>    <span class=number>0xDD7B7BA6</span>, <span class=number>0xFEF7F709</span>, <span class=number>0x8C3A3AB6</span>, <span class=number>0x2FBCBC93</span>, <span class=number>0x030C0C0F</span>, <span class=number>0xFCFFFF03</span>,</span><br><span class=line>    <span class=number>0x6BA9A9C2</span>, <span class=number>0x73C9C9BA</span>, <span class=number>0x6CB5B5D9</span>, <span class=number>0x6DB1B1DC</span>, <span class=number>0x5A6D6D37</span>, <span class=number>0x50454515</span>,</span><br><span class=line>    <span class=number>0x8F3636B9</span>, <span class=number>0x1B6C6C77</span>, <span class=number>0xADBEBE13</span>, <span class=number>0x904A4ADA</span>, <span class=number>0xB9EEEE57</span>, <span class=number>0xDE7777A9</span>,</span><br><span class=line>    <span class=number>0xBEF2F24C</span>, <span class=number>0x7EFDFD83</span>, <span class=number>0x11444455</span>, <span class=number>0xDA6767BD</span>, <span class=number>0x5D71712C</span>, <span class=number>0x40050545</span>,</span><br><span class=line>    <span class=number>0x1F7C7C63</span>, <span class=number>0x10404050</span>, <span class=number>0x5B696932</span>, <span class=number>0xDB6363B8</span>, <span class=number>0x0A282822</span>, <span class=number>0xC20707C5</span>,</span><br><span class=line>    <span class=number>0x31C4C4F5</span>, <span class=number>0x8A2222A8</span>, <span class=number>0xA7969631</span>, <span class=number>0xCE3737F9</span>, <span class=number>0x7AEDED97</span>, <span class=number>0xBFF6F649</span>,</span><br><span class=line>    <span class=number>0x2DB4B499</span>, <span class=number>0x75D1D1A4</span>, <span class=number>0xD3434390</span>, <span class=number>0x1248485A</span>, <span class=number>0xBAE2E258</span>, <span class=number>0xE6979771</span>,</span><br><span class=line>    <span class=number>0xB6D2D264</span>, <span class=number>0xB2C2C270</span>, <span class=number>0x8B2626AD</span>, <span class=number>0x68A5A5CD</span>, <span class=number>0x955E5ECB</span>, <span class=number>0x4B292962</span>,</span><br><span class=line>    <span class=number>0x0C30303C</span>, <span class=number>0x945A5ACE</span>, <span class=number>0x76DDDDAB</span>, <span class=number>0x7FF9F986</span>, <span class=number>0x649595F1</span>, <span class=number>0xBBE6E65D</span>,</span><br><span class=line>    <span class=number>0xF2C7C735</span>, <span class=number>0x0924242D</span>, <span class=number>0xC61717D1</span>, <span class=number>0x6FB9B9D6</span>, <span class=number>0xC51B1BDE</span>, <span class=number>0x86121294</span>,</span><br><span class=line>    <span class=number>0x18606078</span>, <span class=number>0xF3C3C330</span>, <span class=number>0x7CF5F589</span>, <span class=number>0xEFB3B35C</span>, <span class=number>0x3AE8E8D2</span>, <span class=number>0xDF7373AC</span>,</span><br><span class=line>    <span class=number>0x4C353579</span>, <span class=number>0x208080A0</span>, <span class=number>0x78E5E59D</span>, <span class=number>0xEDBBBB56</span>, <span class=number>0x5E7D7D23</span>, <span class=number>0x3EF8F8C6</span>,</span><br><span class=line>    <span class=number>0xD45F5F8B</span>, <span class=number>0xC82F2FE7</span>, <span class=number>0x39E4E4DD</span>, <span class=number>0x49212168</span></span><br><span class=line>};</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>rotl</span><span class=params>(<span class=type>uint32_t</span> a, <span class=type>uint8_t</span> n)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>return</span> (a &lt;&lt; n) | (a &gt;&gt; (<span class=number>32</span> - n));</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>rotr</span><span class=params>(<span class=type>uint32_t</span> a, <span class=type>uint8_t</span> n)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>return</span> (a &gt;&gt; n) | (a &lt;&lt; (<span class=number>32</span> - n));</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>load_u32_be</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *b, <span class=type>uint32_t</span> n)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>return</span> ((<span class=type>uint32_t</span>)b[<span class=number>4</span> * n] &lt;&lt; <span class=number>24</span>) |</span><br><span class=line>           ((<span class=type>uint32_t</span>)b[<span class=number>4</span> * n + <span class=number>1</span>] &lt;&lt; <span class=number>16</span>) |</span><br><span class=line>           ((<span class=type>uint32_t</span>)b[<span class=number>4</span> * n + <span class=number>2</span>] &lt;&lt; <span class=number>8</span>) |</span><br><span class=line>           ((<span class=type>uint32_t</span>)b[<span class=number>4</span> * n + <span class=number>3</span>]);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>void</span> <span class=title>store_u32_be</span><span class=params>(<span class=type>uint32_t</span> v, <span class=type>uint8_t</span> *b)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    b[<span class=number>0</span>] = (<span class=type>uint8_t</span>)(v &gt;&gt; <span class=number>24</span>);</span><br><span class=line>    b[<span class=number>1</span>] = (<span class=type>uint8_t</span>)(v &gt;&gt; <span class=number>16</span>);</span><br><span class=line>    b[<span class=number>2</span>] = (<span class=type>uint8_t</span>)(v &gt;&gt; <span class=number>8</span>);</span><br><span class=line>    b[<span class=number>3</span>] = (<span class=type>uint8_t</span>)(v);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>SM4_T_non_lin_sub</span><span class=params>(<span class=type>uint32_t</span> X)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> t = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    t |= ((<span class=type>uint32_t</span>)SM4_S[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>24</span>)]) &lt;&lt; <span class=number>24</span>;</span><br><span class=line>    t |= ((<span class=type>uint32_t</span>)SM4_S[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>16</span>)]) &lt;&lt; <span class=number>16</span>;</span><br><span class=line>    t |= ((<span class=type>uint32_t</span>)SM4_S[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>8</span>)]) &lt;&lt; <span class=number>8</span>;</span><br><span class=line>    t |= SM4_S[(<span class=type>uint8_t</span>)X];</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> t;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>SM4_T_slow</span><span class=params>(<span class=type>uint32_t</span> X)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> t = <span class=built_in>SM4_T_non_lin_sub</span>(X);</span><br><span class=line></span><br><span class=line>    <span class=comment>/*</span></span><br><span class=line><span class=comment>     * L linear transform</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=keyword>return</span> t ^ <span class=built_in>rotl</span>(t, <span class=number>2</span>) ^ <span class=built_in>rotl</span>(t, <span class=number>10</span>) ^ <span class=built_in>rotl</span>(t, <span class=number>18</span>) ^ <span class=built_in>rotl</span>(t, <span class=number>24</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>SM4_T</span><span class=params>(<span class=type>uint32_t</span> X)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>return</span> SM4_SBOX_T0[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>24</span>)] ^</span><br><span class=line>           <span class=built_in>rotr</span>(SM4_SBOX_T0[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>16</span>)], <span class=number>8</span>) ^</span><br><span class=line>           <span class=built_in>rotr</span>(SM4_SBOX_T0[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>8</span>)], <span class=number>16</span>) ^</span><br><span class=line>           <span class=built_in>rotr</span>(SM4_SBOX_T0[(<span class=type>uint8_t</span>)X], <span class=number>24</span>);</span><br><span class=line>    <span class=comment>// return SM4_SBOX_T0[(uint8_t)(X &gt;&gt; 24)] ^</span></span><br><span class=line>    <span class=comment>//        SM4_SBOX_T0[(uint8_t)(X &gt;&gt; 16)] ^</span></span><br><span class=line>    <span class=comment>//        SM4_SBOX_T0[(uint8_t)(X &gt;&gt; 8)] ^</span></span><br><span class=line>    <span class=comment>//        SM4_SBOX_T0[(uint8_t)X];</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>SM4_key_sub</span><span class=params>(<span class=type>uint32_t</span> X)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> t = <span class=built_in>SM4_T_non_lin_sub</span>(X);</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> t ^ <span class=built_in>rotl</span>(t, <span class=number>13</span>) ^ <span class=built_in>rotl</span>(t, <span class=number>23</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>ossl_sm4_set_key</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *key, SM4_KEY *ks)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=comment>/*</span></span><br><span class=line><span class=comment>     * Family Key</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=type>static</span> <span class=type>const</span> <span class=type>uint32_t</span> FK[<span class=number>4</span>] = {</span><br><span class=line>        <span class=number>0xa3b1bac6</span>, <span class=number>0x56aa3350</span>, <span class=number>0x677d9197</span>, <span class=number>0xb27022dc</span>};</span><br><span class=line></span><br><span class=line>    <span class=comment>/*</span></span><br><span class=line><span class=comment>     * Constant Key</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=type>static</span> <span class=type>const</span> <span class=type>uint32_t</span> CK[<span class=number>32</span>] = {</span><br><span class=line>        <span class=number>0x00070E15</span>, <span class=number>0x1C232A31</span>, <span class=number>0x383F464D</span>, <span class=number>0x545B6269</span>,</span><br><span class=line>        <span class=number>0x70777E85</span>, <span class=number>0x8C939AA1</span>, <span class=number>0xA8AFB6BD</span>, <span class=number>0xC4CBD2D9</span>,</span><br><span class=line>        <span class=number>0xE0E7EEF5</span>, <span class=number>0xFC030A11</span>, <span class=number>0x181F262D</span>, <span class=number>0x343B4249</span>,</span><br><span class=line>        <span class=number>0x50575E65</span>, <span class=number>0x6C737A81</span>, <span class=number>0x888F969D</span>, <span class=number>0xA4ABB2B9</span>,</span><br><span class=line>        <span class=number>0xC0C7CED5</span>, <span class=number>0xDCE3EAF1</span>, <span class=number>0xF8FF060D</span>, <span class=number>0x141B2229</span>,</span><br><span class=line>        <span class=number>0x30373E45</span>, <span class=number>0x4C535A61</span>, <span class=number>0x686F767D</span>, <span class=number>0x848B9299</span>,</span><br><span class=line>        <span class=number>0xA0A7AEB5</span>, <span class=number>0xBCC3CAD1</span>, <span class=number>0xD8DFE6ED</span>, <span class=number>0xF4FB0209</span>,</span><br><span class=line>        <span class=number>0x10171E25</span>, <span class=number>0x2C333A41</span>, <span class=number>0x484F565D</span>, <span class=number>0x646B7279</span></span><br><span class=line>    };</span><br><span class=line></span><br><span class=line>    <span class=type>uint32_t</span> K[<span class=number>4</span>];</span><br><span class=line>    <span class=type>int</span> i;</span><br><span class=line></span><br><span class=line>    K[<span class=number>0</span>] = <span class=built_in>load_u32_be</span>(key, <span class=number>0</span>) ^ FK[<span class=number>0</span>];</span><br><span class=line>    K[<span class=number>1</span>] = <span class=built_in>load_u32_be</span>(key, <span class=number>1</span>) ^ FK[<span class=number>1</span>];</span><br><span class=line>    K[<span class=number>2</span>] = <span class=built_in>load_u32_be</span>(key, <span class=number>2</span>) ^ FK[<span class=number>2</span>];</span><br><span class=line>    K[<span class=number>3</span>] = <span class=built_in>load_u32_be</span>(key, <span class=number>3</span>) ^ FK[<span class=number>3</span>];</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; SM4_KEY_SCHEDULE; i = i + <span class=number>4</span>)</span><br><span class=line>    {</span><br><span class=line>        K[<span class=number>0</span>] ^= <span class=built_in>SM4_key_sub</span>(K[<span class=number>1</span>] ^ K[<span class=number>2</span>] ^ K[<span class=number>3</span>] ^ CK[i]);</span><br><span class=line>        K[<span class=number>1</span>] ^= <span class=built_in>SM4_key_sub</span>(K[<span class=number>2</span>] ^ K[<span class=number>3</span>] ^ K[<span class=number>0</span>] ^ CK[i + <span class=number>1</span>]);</span><br><span class=line>        K[<span class=number>2</span>] ^= <span class=built_in>SM4_key_sub</span>(K[<span class=number>3</span>] ^ K[<span class=number>0</span>] ^ K[<span class=number>1</span>] ^ CK[i + <span class=number>2</span>]);</span><br><span class=line>        K[<span class=number>3</span>] ^= <span class=built_in>SM4_key_sub</span>(K[<span class=number>0</span>] ^ K[<span class=number>1</span>] ^ K[<span class=number>2</span>] ^ CK[i + <span class=number>3</span>]);</span><br><span class=line>        ks-&gt;rk[i] = K[<span class=number>0</span>];</span><br><span class=line>        ks-&gt;rk[i + <span class=number>1</span>] = K[<span class=number>1</span>];</span><br><span class=line>        ks-&gt;rk[i + <span class=number>2</span>] = K[<span class=number>2</span>];</span><br><span class=line>        ks-&gt;rk[i + <span class=number>3</span>] = K[<span class=number>3</span>];</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>1</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SM4_RNDS(k0, k1, k2, k3, F)         \</span></span><br><span class=line><span class=meta>    do                                      \</span></span><br><span class=line><span class=meta>    {                                       \</span></span><br><span class=line><span class=meta>        B0 ^= F(B1 ^ B2 ^ B3 ^ ks-&gt;rk[k0]); \</span></span><br><span class=line><span class=meta>        B1 ^= F(B0 ^ B2 ^ B3 ^ ks-&gt;rk[k1]); \</span></span><br><span class=line><span class=meta>        B2 ^= F(B0 ^ B1 ^ B3 ^ ks-&gt;rk[k2]); \</span></span><br><span class=line><span class=meta>        B3 ^= F(B0 ^ B1 ^ B2 ^ ks-&gt;rk[k3]); \</span></span><br><span class=line><span class=meta>    } while (0)</span></span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>ossl_sm4_encrypt</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *in, <span class=type>uint8_t</span> *out, <span class=type>const</span> SM4_KEY *ks)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> B0 = <span class=built_in>load_u32_be</span>(in, <span class=number>0</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B1 = <span class=built_in>load_u32_be</span>(in, <span class=number>1</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B2 = <span class=built_in>load_u32_be</span>(in, <span class=number>2</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B3 = <span class=built_in>load_u32_be</span>(in, <span class=number>3</span>);</span><br><span class=line></span><br><span class=line>    <span class=comment>/*</span></span><br><span class=line><span class=comment>     * Uses byte-wise sbox in the first and last rounds to provide some</span></span><br><span class=line><span class=comment>     * protection from cache based side channels.</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>0</span>, <span class=number>1</span>, <span class=number>2</span>, <span class=number>3</span>, SM4_T_slow);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>4</span>, <span class=number>5</span>, <span class=number>6</span>, <span class=number>7</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>8</span>, <span class=number>9</span>, <span class=number>10</span>, <span class=number>11</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>12</span>, <span class=number>13</span>, <span class=number>14</span>, <span class=number>15</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>16</span>, <span class=number>17</span>, <span class=number>18</span>, <span class=number>19</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>20</span>, <span class=number>21</span>, <span class=number>22</span>, <span class=number>23</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>24</span>, <span class=number>25</span>, <span class=number>26</span>, <span class=number>27</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>28</span>, <span class=number>29</span>, <span class=number>30</span>, <span class=number>31</span>, SM4_T_slow);</span><br><span class=line></span><br><span class=line>    <span class=comment>// 这个函数会导致小端 -&gt; 大端，直接内存 dump 密文的没有关系，如果是直接在这里比较密文的话要注意是大端，如果是写进内存比较直接默认比较就行</span></span><br><span class=line>    <span class=comment>// 0x666c6167 -&gt; 0x67616c66</span></span><br><span class=line>    <span class=built_in>store_u32_be</span>(B3, out);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B2, out + <span class=number>4</span>);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B1, out + <span class=number>8</span>);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B0, out + <span class=number>12</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>ossl_sm4_decrypt</span><span class=params>(<span class=type>const</span> <span class=type>uint8_t</span> *in, <span class=type>uint8_t</span> *out, <span class=type>const</span> SM4_KEY *ks)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=type>uint32_t</span> B0 = <span class=built_in>load_u32_be</span>(in, <span class=number>0</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B1 = <span class=built_in>load_u32_be</span>(in, <span class=number>1</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B2 = <span class=built_in>load_u32_be</span>(in, <span class=number>2</span>);</span><br><span class=line>    <span class=type>uint32_t</span> B3 = <span class=built_in>load_u32_be</span>(in, <span class=number>3</span>);</span><br><span class=line></span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>31</span>, <span class=number>30</span>, <span class=number>29</span>, <span class=number>28</span>, SM4_T_slow);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>27</span>, <span class=number>26</span>, <span class=number>25</span>, <span class=number>24</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>23</span>, <span class=number>22</span>, <span class=number>21</span>, <span class=number>20</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>19</span>, <span class=number>18</span>, <span class=number>17</span>, <span class=number>16</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>15</span>, <span class=number>14</span>, <span class=number>13</span>, <span class=number>12</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>11</span>, <span class=number>10</span>, <span class=number>9</span>, <span class=number>8</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>7</span>, <span class=number>6</span>, <span class=number>5</span>, <span class=number>4</span>, SM4_T);</span><br><span class=line>    <span class=built_in>SM4_RNDS</span>(<span class=number>3</span>, <span class=number>2</span>, <span class=number>1</span>, <span class=number>0</span>, SM4_T_slow);</span><br><span class=line></span><br><span class=line>    <span class=comment>// 这个函数会导致小端 -&gt; 大端，直接内存 dump 密文的没有关系，如果是直接在这里比较密文的话要注意是大端，如果是写进内存比较直接默认比较就行</span></span><br><span class=line>    <span class=comment>// 0x666c6167 -&gt; 0x67616c66</span></span><br><span class=line>    <span class=built_in>store_u32_be</span>(B3, out);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B2, out + <span class=number>4</span>);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B1, out + <span class=number>8</span>);</span><br><span class=line>    <span class=built_in>store_u32_be</span>(B0, out + <span class=number>12</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>printHex</span><span class=params>(<span class=type>char</span> *name, <span class=type>void</span> *ptr, <span class=type>int</span> len)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s"</span>, name);</span><br><span class=line>    <span class=keyword>for</span> (<span class=type>size_t</span> i = <span class=number>0</span>; i &lt; len; i++)</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%02x"</span>, ((<span class=type>uint8_t</span> *)ptr)[i]);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"\n"</span>);</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=type>void</span> <span class=title>hexdump</span><span class=params>(<span class=type>char</span> *name, <span class=type>const</span> <span class=type>void</span> *data, <span class=type>size_t</span> size)</span> </span>{</span><br><span class=line>    <span class=type>const</span> <span class=type>unsigned</span> <span class=type>char</span> *byte_data = (<span class=type>const</span> <span class=type>unsigned</span> <span class=type>char</span> *)data;</span><br><span class=line>    <span class=type>size_t</span> i, j;</span><br><span class=line></span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>"%s\n"</span>, name);</span><br><span class=line></span><br><span class=line>    <span class=keyword>for</span> (i = <span class=number>0</span>; i &lt; size; i += <span class=number>16</span>) {</span><br><span class=line>        <span class=comment>// 打印偏移地址</span></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"%08zx  "</span>, i);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 打印十六进制数据</span></span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; <span class=number>16</span>; ++j) {</span><br><span class=line>            <span class=keyword>if</span> (i + j &lt; size) {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"%02x "</span>, byte_data[i + j]);</span><br><span class=line>            } <span class=keyword>else</span> {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"   "</span>); <span class=comment>// 不足部分用空格填充</span></span><br><span class=line>            }</span><br><span class=line></span><br><span class=line>            <span class=comment>// 在每8字节后添加一个额外的空格</span></span><br><span class=line>            <span class=keyword>if</span> (j == <span class=number>7</span>) {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>" "</span>);</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>" |"</span>);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 打印ASCII字符</span></span><br><span class=line>        <span class=keyword>for</span> (j = <span class=number>0</span>; j &lt; <span class=number>16</span>; ++j) {</span><br><span class=line>            <span class=keyword>if</span> (i + j &lt; size) {</span><br><span class=line>                <span class=type>unsigned</span> <span class=type>char</span> ch = byte_data[i + j];</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>"%c"</span>, <span class=built_in>isprint</span>(ch) ? ch : <span class=string>'.'</span>);</span><br><span class=line>            } <span class=keyword>else</span> {</span><br><span class=line>                <span class=built_in>printf</span>(<span class=string>" "</span>);</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>"|\n"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=function><span class=type>int</span> <span class=title>main</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    SM4_KEY *ks = (SM4_KEY *) <span class=built_in>malloc</span>(<span class=built_in>sizeof</span>(SM4_KEY));</span><br><span class=line></span><br><span class=line>    <span class=comment>// uint8_t key[16] = {0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef, 0xfe, 0xdc, 0xba, 0x98, 0x76, 0x54, 0x32, 0x10};</span></span><br><span class=line></span><br><span class=line>    <span class=type>uint32_t</span> encrypted[<span class=number>4</span>] = {<span class=number>0x9edc0fb</span>, <span class=number>0xe0e9cd2f</span>, <span class=number>0xe1f9332</span>, <span class=number>0x23932149</span>};</span><br><span class=line></span><br><span class=line>    <span class=type>uint8_t</span> input[<span class=number>16</span>] = {<span class=number>0x09</span>,<span class=number>0xed</span>,<span class=number>0xc0</span>,<span class=number>0xfb</span>,<span class=number>0xe0</span>,<span class=number>0xe9</span>,<span class=number>0xcd</span>,<span class=number>0x2f</span>,<span class=number>0x0e</span>,<span class=number>0x1f</span>,<span class=number>0x93</span>,<span class=number>0x32</span>,<span class=number>0x23</span>,<span class=number>0x93</span>,<span class=number>0x21</span>,<span class=number>0x49</span>};</span><br><span class=line>    </span><br><span class=line>    <span class=type>uint8_t</span> output[<span class=number>16</span>];</span><br><span class=line></span><br><span class=line>    <span class=comment>// ossl_sm4_set_key(key, ks);</span></span><br><span class=line></span><br><span class=line>    <span class=type>uint8_t</span> RK_tmp[<span class=number>128</span>] = {</span><br><span class=line>		<span class=number>0xec</span>,<span class=number>0x2d</span>,<span class=number>0x4d</span>,<span class=number>0x4c</span>,<span class=number>0xa1</span>,<span class=number>0xb4</span>,<span class=number>0x66</span>,<span class=number>0x8a</span>,<span class=number>0x26</span>,<span class=number>0x99</span>,<span class=number>0x82</span>,<span class=number>0x5f</span>,<span class=number>0xf6</span>,<span class=number>0x49</span>,<span class=number>0x30</span>,<span class=number>0x07</span>,<span class=number>0x9a</span>,<span class=number>0x75</span>,<span class=number>0x75</span>,<span class=number>0xf1</span>,<span class=number>0x95</span>,<span class=number>0x97</span>,<span class=number>0x21</span>,<span class=number>0x55</span>,<span class=number>0x5e</span>,<span class=number>0x47</span>,<span class=number>0xfc</span>,<span class=number>0xd4</span>,<span class=number>0xb7</span>,<span class=number>0x4f</span>,<span class=number>0xd5</span>,<span class=number>0x42</span>,<span class=number>0xfd</span>,<span class=number>0xc9</span>,<span class=number>0x15</span>,<span class=number>0xfe</span>,<span class=number>0x20</span>,<span class=number>0x36</span>,<span class=number>0x76</span>,<span class=number>0xf6</span>,<span class=number>0x4c</span>,<span class=number>0x99</span>,<span class=number>0xc2</span>,<span class=number>0x2b</span>,<span class=number>0xb4</span>,<span class=number>0xff</span>,<span class=number>0x23</span>,<span class=number>0x45</span>,<span class=number>0x36</span>,<span class=number>0xa1</span>,<span class=number>0x1d</span>,<span class=number>0x7c</span>,<span class=number>0x2a</span>,<span class=number>0x13</span>,<span class=number>0x26</span>,<span class=number>0x47</span>,<span class=number>0x67</span>,<span class=number>0x28</span>,<span class=number>0xf0</span>,<span class=number>0xc0</span>,<span class=number>0xa1</span>,<span class=number>0xa5</span>,<span class=number>0xd2</span>,<span class=number>0x61</span>,<span class=number>0xcf</span>,<span class=number>0x73</span>,<span class=number>0x58</span>,<span class=number>0xc6</span>,<span class=number>0x94</span>,<span class=number>0x5e</span>,<span class=number>0x43</span>,<span class=number>0x6c</span>,<span class=number>0x70</span>,<span class=number>0xdc</span>,<span class=number>0xe8</span>,<span class=number>0xfb</span>,<span class=number>0xe0</span>,<span class=number>0xb1</span>,<span class=number>0x13</span>,<span class=number>0xd7</span>,<span class=number>0xa1</span>,<span class=number>0x22</span>,<span class=number>0x73</span>,<span class=number>0xae</span>,<span class=number>0xe1</span>,<span class=number>0xe2</span>,<span class=number>0xb1</span>,<span class=number>0x55</span>,<span class=number>0x25</span>,<span class=number>0x78</span>,<span class=number>0xb6</span>,<span class=number>0x8c</span>,<span class=number>0xbb</span>,<span class=number>0x63</span>,<span class=number>0xd7</span>,<span class=number>0xd1</span>,<span class=number>0xb2</span>,<span class=number>0x18</span>,<span class=number>0x2a</span>,<span class=number>0x91</span>,<span class=number>0x52</span>,<span class=number>0x10</span>,<span class=number>0xc1</span>,<span class=number>0x1f</span>,<span class=number>0x32</span>,<span class=number>0x6a</span>,<span class=number>0x97</span>,<span class=number>0xb2</span>,<span class=number>0x10</span>,<span class=number>0xe5</span>,<span class=number>0xa8</span>,<span class=number>0x6a</span>,<span class=number>0xbe</span>,<span class=number>0xec</span>,<span class=number>0x21</span>,<span class=number>0xa9</span>,<span class=number>0x9b</span>,<span class=number>0x36</span>,<span class=number>0xd9</span>,<span class=number>0x46</span>,<span class=number>0x95</span>,<span class=number>0xa6</span>,<span class=number>0xc2</span>,<span class=number>0x94</span>,<span class=number>0x72</span>,<span class=number>0x4f</span>,<span class=number>0x94</span>,<span class=number>0xfa</span></span><br><span class=line>	};</span><br><span class=line>    </span><br><span class=line>    <span class=built_in>memcpy</span>(ks-&gt;rk, RK_tmp, <span class=number>128</span>);</span><br><span class=line></span><br><span class=line></span><br><span class=line>    <span class=built_in>ossl_sm4_decrypt</span>(input, output, ks);</span><br><span class=line></span><br><span class=line>    <span class=comment>// printHex("Output: ", output, 16);</span></span><br><span class=line></span><br><span class=line>    <span class=built_in>hexdump</span>(<span class=string>"Output"</span>, output, <span class=number>16</span>);</span><br><span class=line></span><br><span class=line>    <span class=comment>// for (size_t i = 0; i &lt; 16; i++)</span></span><br><span class=line>    <span class=comment>// {</span></span><br><span class=line>    <span class=comment>//     uint32_t a = ks-&gt;rk[i];</span></span><br><span class=line>    <span class=comment>//     ks-&gt;rk[i] = ks-&gt;rk[31 - i];</span></span><br><span class=line>    <span class=comment>//     ks-&gt;rk[31 - i] = a;</span></span><br><span class=line>    <span class=comment>// }</span></span><br><span class=line></span><br><span class=line>    <span class=comment>// hexdump("", ks-&gt;rk, 32 * 4);</span></span><br><span class=line></span><br><span class=line>    <span class=comment>// ossl_sm4_encrypt(output, input, ks);</span></span><br><span class=line>    <span class=comment>// hexdump("Output", input, 16);</span></span><br><span class=line>    </span><br><span class=line></span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br></pre></td></tr></table></figure><p>主要的魔改点就是 T 函数</p><figure class="highlight c++"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre></td><td class=code><pre><span class=line><span class=function><span class=type>static</span> <span class=type>uint32_t</span> <span class=title>SM4_T</span><span class=params>(<span class=type>uint32_t</span> X)</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>    <span class=keyword>return</span> SM4_SBOX_T0[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>24</span>)] ^</span><br><span class=line>           <span class=built_in>rotr</span>(SM4_SBOX_T0[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>16</span>)], <span class=number>8</span>) ^</span><br><span class=line>           <span class=built_in>rotr</span>(SM4_SBOX_T0[(<span class=type>uint8_t</span>)(X &gt;&gt; <span class=number>8</span>)], <span class=number>16</span>) ^</span><br><span class=line>           <span class=built_in>rotr</span>(SM4_SBOX_T0[(<span class=type>uint8_t</span>)X], <span class=number>24</span>);</span><br><span class=line>    <span class=comment>// return SM4_SBOX_T0[(uint8_t)(X &gt;&gt; 24)] ^</span></span><br><span class=line>    <span class=comment>//        SM4_SBOX_T0[(uint8_t)(X &gt;&gt; 16)] ^</span></span><br><span class=line>    <span class=comment>//        SM4_SBOX_T0[(uint8_t)(X &gt;&gt; 8)] ^</span></span><br><span class=line>    <span class=comment>//        SM4_SBOX_T0[(uint8_t)X];</span></span><br><span class=line>}</span><br></pre></td></tr></table></figure><p>原版是用 SM4_SBOX_T0 SM4_SBOX_T1 SM4_SBOX_T2 SM4_SBOX_T3 四张表查找，这里只用了一张表，还有低三个字节加上了循环右移<br>最后得到了 flag <code>flag{fincrptf83}</code></p><h4 id=解法2><a href=#解法2 class=headerlink title=解法2></a>解法2</h4><p>其实因为 SM4 有个特性，就是加解密函数是同一个，区别就是解密的时候要把 RK 倒过来，所以其实还有一种解题方法就是 hook，然后修改输入数据和 RK<br>这里我用的是 unidbg</p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>package</span> com.bytedance.frameworks.core.encrypt;</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> com.alibaba.fastjson.util.IOUtils;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.AndroidEmulator;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.Emulator;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.Module;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.Symbol;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.arm.HookStatus;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.arm.backend.*;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.arm.context.Arm32RegisterContext;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.arm.context.Arm64RegisterContext;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.arm.context.RegisterContext;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.debugger.DebuggerType;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.hook.HookContext;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.hook.ReplaceCallback;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.hook.hookzz.Dobby;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.hook.hookzz.HookEntryInfo;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.hook.hookzz.HookZz;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.hook.hookzz.IHookZz;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.hook.hookzz.InstrumentCallback;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.hook.hookzz.WrapCallback;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.hook.xhook.IxHook;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.linux.android.XHookImpl;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.linux.android.dvm.array.ByteArray;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.linux.android.dvm.jni.ProxyDvmObject;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.memory.Memory;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.memory.MemoryMap;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.pointer.UnidbgPointer;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.utils.Inspector;</span><br><span class=line><span class=keyword>import</span> com.github.unidbg.utils.ResourceUtils;</span><br><span class=line><span class=keyword>import</span> com.sun.jna.Pointer;</span><br><span class=line><span class=keyword>import</span> unicorn.Arm64Const;</span><br><span class=line><span class=keyword>import</span> unicorn.ArmConst;</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> java.io.File;</span><br><span class=line><span class=keyword>import</span> java.io.FileOutputStream;</span><br><span class=line><span class=keyword>import</span> java.nio.ByteBuffer;</span><br><span class=line><span class=keyword>import</span> java.nio.LongBuffer;</span><br><span class=line><span class=keyword>import</span> java.util.Arrays;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">TTEncrypt</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> AndroidEmulator emulator;</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> VM vm;</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> Module <span class=keyword>module</span>;</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> DvmClass TTEncryptUtils;</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> <span class=type>boolean</span> logging;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> String <span class="title function_">padding2hex</span><span class=params>(<span class=type>long</span> i)</span> {</span><br><span class=line>        <span class=keyword>return</span> String.format(<span class=string>"0x%08x"</span>, i);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    TTEncrypt(<span class=type>boolean</span> logging) {</span><br><span class=line>        <span class=built_in>this</span>.logging = logging;</span><br><span class=line></span><br><span class=line>        emulator = AndroidEmulatorBuilder.for64Bit()</span><br><span class=line>                .setProcessName(<span class=string>"cn.pbcdci.fincryptography.appetizer"</span>)</span><br><span class=line><span class=comment>//                .addBackendFactory(new DynarmicFactory(true))</span></span><br><span class=line>                .addBackendFactory(<span class=keyword>new</span> <span class="title class_">Unicorn2Factory</span>(<span class=literal>true</span>))</span><br><span class=line>                .build(); <span class=comment>// 创建模拟器实例，要模拟32位或者64位，在这里区分</span></span><br><span class=line></span><br><span class=line>        <span class=keyword>final</span> <span class=type>Memory</span> <span class=variable>memory</span> <span class=operator>=</span> emulator.getMemory(); <span class=comment>// 模拟器的内存操作接口</span></span><br><span class=line>        memory.setLibraryResolver(<span class=keyword>new</span> <span class="title class_">AndroidResolver</span>(<span class=number>23</span>)); <span class=comment>// 设置系统类库解析</span></span><br><span class=line></span><br><span class=line>        vm = emulator.createDalvikVM(); <span class=comment>// 创建Android虚拟机</span></span><br><span class=line>        vm.setVerbose(logging); <span class=comment>// 设置是否打印Jni调用细节</span></span><br><span class=line>        <span class=type>DalvikModule</span> <span class=variable>dm</span> <span class=operator>=</span> vm.loadLibrary(<span class=keyword>new</span> <span class="title class_">File</span>(<span class=string>"libs/libnative-lib.so"</span>), <span class=literal>false</span>); <span class=comment>// 加载libttEncrypt.so到unicorn虚拟内存，加载成功以后会默认调用init_array等函数</span></span><br><span class=line>        <span class=keyword>module</span> = dm.getModule(); <span class=comment>// 加载好的libttEncrypt.so对应为一个模块</span></span><br><span class=line>        <span class=type>long</span> <span class=variable>base</span> <span class=operator>=</span> <span class=keyword>module</span>.base;</span><br><span class=line></span><br><span class=line>        System.out.println(String.format(<span class=string>"base: 0x%x"</span>, base));</span><br><span class=line></span><br><span class=line><span class=comment>//        IHookZz hookZz = HookZz.getInstance(emulator);</span></span><br><span class=line><span class=comment>//        hookZz.instrument(module.base + 0xC80, new InstrumentCallback&lt;Arm64RegisterContext&gt;() {</span></span><br><span class=line><span class=comment>//            @Override</span></span><br><span class=line><span class=comment>//            public void dbiCall(Emulator&lt;?&gt; emulator, Arm64RegisterContext ctx, HookEntryInfo info) { // 通过base+offset inline wrap内部函数，在IDA看到为sub_xxx那些</span></span><br><span class=line><span class=comment>//                long pt = ctx.getXLong(0);</span></span><br><span class=line><span class=comment>//                System.out.println("X0=" + Long.toHexString(pt));</span></span><br><span class=line><span class=comment>//                byte[] data = memory.pointer(pt).getByteArray(0, 16);</span></span><br><span class=line><span class=comment>//                byte[] w_data = new byte[]{0x49, 0x21, (byte) 0x93, 0x23, 0x32, (byte) 0x93, 0x1f, 0xe, 0x2f, (byte) 0xcd, (byte)0xe9, (byte)0xe0, (byte)0xfb, (byte)0xc0, (byte)0xed, 0x9};</span></span><br><span class=line><span class=comment>//</span></span><br><span class=line><span class=comment>//                UnidbgPointer.pointer(emulator, pt).write(0, w_data, 0, 16);</span></span><br><span class=line><span class=comment>//                Inspector.inspect(data, "Data");</span></span><br><span class=line><span class=comment>//                data = memory.pointer(pt).getByteArray(0, 16);</span></span><br><span class=line><span class=comment>//                Inspector.inspect(data, "Data");</span></span><br><span class=line><span class=comment>//            }</span></span><br><span class=line><span class=comment>//        });</span></span><br><span class=line></span><br><span class=line>        emulator.getBackend().hook_add_new(<span class=keyword>new</span> <span class="title class_">CodeHook</span>() {</span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">hook</span><span class=params>(Backend backend, <span class=type>long</span> address, <span class=type>int</span> size, Object user)</span> {</span><br><span class=line>                <span class=type>long</span> <span class=variable>pt</span> <span class=operator>=</span> backend.reg_read(Arm64Const.UC_ARM64_REG_X0).longValue();</span><br><span class=line>                System.out.println(<span class=string>"X0="</span> + Long.toHexString(pt));</span><br><span class=line>                <span class=type>byte</span>[] data = memory.pointer(pt).getByteArray(<span class=number>0</span>, <span class=number>16</span>);</span><br><span class=line></span><br><span class=line>                <span class=type>byte</span>[] w_data = <span class=keyword>new</span> <span class="title class_">byte</span>[<span class=number>16</span>];</span><br><span class=line></span><br><span class=line>                <span class=type>int</span>[] it = <span class=keyword>new</span> <span class="title class_">int</span>[] {<span class=number>0x09</span>,<span class=number>0xed</span>,<span class=number>0xc0</span>,<span class=number>0xfb</span>,<span class=number>0xe0</span>,<span class=number>0xe9</span>,<span class=number>0xcd</span>,<span class=number>0x2f</span>,<span class=number>0x0e</span>,<span class=number>0x1f</span>,<span class=number>0x93</span>,<span class=number>0x32</span>,<span class=number>0x23</span>,<span class=number>0x93</span>,<span class=number>0x21</span>,<span class=number>0x49</span>};</span><br><span class=line></span><br><span class=line>                <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>0</span>; i &lt; <span class=number>16</span>; i++) {</span><br><span class=line>                    w_data[i] = (<span class=type>byte</span>) it[i];</span><br><span class=line>                }</span><br><span class=line></span><br><span class=line>                UnidbgPointer.pointer(emulator, pt).write(<span class=number>0</span>, w_data, <span class=number>0</span>, <span class=number>16</span>);</span><br><span class=line>                Inspector.inspect(data, <span class=string>"Data"</span>);</span><br><span class=line>                data = memory.pointer(pt).getByteArray(<span class=number>0</span>, <span class=number>16</span>);</span><br><span class=line>                Inspector.inspect(data, <span class=string>"Data"</span>);</span><br><span class=line>            }</span><br><span class=line></span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">onAttach</span><span class=params>(UnHook unHook)</span> {</span><br><span class=line></span><br><span class=line>            }</span><br><span class=line></span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">detach</span><span class=params>()</span> {</span><br><span class=line></span><br><span class=line>            }</span><br><span class=line>        }, <span class=keyword>module</span>.base + <span class=number>0xC80</span>, <span class=keyword>module</span>.base + <span class=number>0xC80</span>, <span class=literal>null</span>);</span><br><span class=line></span><br><span class=line>        emulator.getBackend().hook_add_new(<span class=keyword>new</span> <span class="title class_">CodeHook</span>() {</span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">hook</span><span class=params>(Backend backend, <span class=type>long</span> address, <span class=type>int</span> size, Object user)</span> {</span><br><span class=line>                <span class=type>long</span> <span class=variable>pt</span> <span class=operator>=</span> backend.reg_read(Arm64Const.UC_ARM64_REG_SP).longValue() + <span class=number>0x18</span>;</span><br><span class=line>                <span class=type>byte</span>[] rc = backend.mem_read(pt, <span class=number>32</span> * <span class=number>4</span>);</span><br><span class=line>                <span class=type>byte</span>[] rc2 = <span class=keyword>new</span> <span class="title class_">byte</span>[rc.length];</span><br><span class=line></span><br><span class=line>                <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>0</span>; i &lt; rc.length; i += <span class=number>4</span>) {</span><br><span class=line>                    <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>j</span> <span class=operator>=</span> <span class=number>0</span>; j &lt; <span class=number>4</span>; j++) {</span><br><span class=line>                        rc2[rc.length - <span class=number>4</span> - i + j] = rc[i + j];</span><br><span class=line>                    }</span><br><span class=line>                }</span><br><span class=line>                Inspector.inspect(rc, <span class=string>"RC"</span>);</span><br><span class=line>                Inspector.inspect(rc2, <span class=string>"RC2"</span>);</span><br><span class=line></span><br><span class=line>                backend.mem_write(pt, rc2);</span><br><span class=line>            }</span><br><span class=line></span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">onAttach</span><span class=params>(UnHook unHook)</span> {</span><br><span class=line></span><br><span class=line>            }</span><br><span class=line></span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">detach</span><span class=params>()</span> {</span><br><span class=line></span><br><span class=line>            }</span><br><span class=line>        }, <span class=keyword>module</span>.base + <span class=number>0xD5C</span>, <span class=keyword>module</span>.base + <span class=number>0xD5C</span>, <span class=literal>null</span>);</span><br><span class=line></span><br><span class=line>        emulator.getBackend().hook_add_new(<span class=keyword>new</span> <span class="title class_">CodeHook</span>() {</span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">hook</span><span class=params>(Backend backend, <span class=type>long</span> address, <span class=type>int</span> size, Object user)</span> {</span><br><span class=line></span><br><span class=line>                <span class=type>long</span> <span class=variable>pt1</span> <span class=operator>=</span> backend.reg_read(Arm64Const.UC_ARM64_REG_X8).longValue();</span><br><span class=line>                <span class=type>long</span> <span class=variable>pt2</span> <span class=operator>=</span> backend.reg_read(Arm64Const.UC_ARM64_REG_X11).longValue();</span><br><span class=line>                <span class=type>long</span> <span class=variable>pt3</span> <span class=operator>=</span> backend.reg_read(Arm64Const.UC_ARM64_REG_X10).longValue();</span><br><span class=line>                <span class=type>long</span> <span class=variable>pt4</span> <span class=operator>=</span> backend.reg_read(Arm64Const.UC_ARM64_REG_X13).longValue();</span><br><span class=line></span><br><span class=line></span><br><span class=line>                <span class=type>String</span> <span class=variable>sb</span> <span class=operator>=</span> Inspector.long2Str(pt1) +</span><br><span class=line>                        Inspector.long2Str(pt2) +</span><br><span class=line>                        Inspector.long2Str(pt3) +</span><br><span class=line>                        Inspector.long2Str(pt4);</span><br><span class=line></span><br><span class=line>                System.out.println(sb);</span><br><span class=line>            }</span><br><span class=line></span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">onAttach</span><span class=params>(UnHook unHook)</span> {</span><br><span class=line></span><br><span class=line>            }</span><br><span class=line></span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">detach</span><span class=params>()</span> {</span><br><span class=line></span><br><span class=line>            }</span><br><span class=line>        }, <span class=keyword>module</span>.base + <span class=number>0x1674</span>, <span class=keyword>module</span>.base + <span class=number>0x1674</span>, <span class=literal>null</span>);</span><br><span class=line></span><br><span class=line>        dm.callJNI_OnLoad(emulator); <span class=comment>// 手动执行JNI_OnLoad函数</span></span><br><span class=line></span><br><span class=line>        TTEncryptUtils = vm.resolveClass(<span class=string>"cn/pbcdci/fincryptography/appetizer/MainActivity"</span>);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>void</span> <span class="title function_">destroy</span><span class=params>()</span> {</span><br><span class=line>        IOUtils.close(emulator);</span><br><span class=line>        <span class=keyword>if</span> (logging) {</span><br><span class=line>            System.out.println(<span class=string>"destroy"</span>);</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> <span class=keyword>throws</span> Exception {</span><br><span class=line>        <span class=type>TTEncrypt</span> <span class=variable>test</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">TTEncrypt</span>(<span class=literal>true</span>);</span><br><span class=line>        <span class=type>StringObject</span> <span class=variable>st</span> <span class=operator>=</span> test.TTEncryptUtils.callStaticJniMethodObject(test.emulator, <span class=string>"checkFlag(Ljava/lang/String;)Ljava/lang/String;"</span>, <span class=keyword>new</span> <span class="title class_">StringObject</span>(test.vm, <span class=string>"1111111111111111"</span>));</span><br><span class=line>        System.out.println(st);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line></span><br><span class=line>}</span><br></pre></td></tr></table></figure><p><img lazyload="" alt=image-20241121180206487 data-src=https://s3.carbo.ink/img/2024/11/681a2bb00bbff3a1151219023734c86b.png></p><p>也可以得出正确的结果</p><p>这道题还有一个需要注意的就是 SM4 的源码中，数据是大端读取，大端存的，所以反映到正常流程中就是不会变端序的，但是这道题是在最后一步大端存之前直接比较密文的，就会导致小端-&gt;大端，解密的时候你就需要把比较的密文转换成大端序再填写回去，无论是 Hook 还是解密脚本都需要这么做</p><p><img lazyload="" alt=image-20241121180422321 data-src=https://s3.carbo.ink/img/2024/11/f5cdcbe68b3b9db331dae8cf7fa43b2c.png></p></div><div class="post-copyright-info-container border-box"><div class="copyright-info-content border-box"><div class="copyright-info-top border-box"><div class="copyright-post-title border-box text-ellipsis">金融密码杯 - Reverse 方向</div><div class="copyright-post-link border-box text-ellipsis">2024/11/20/2024jinrongmima/</div></div><div class="copyright-info-bottom border-box"><div class="copyright-post-author bottom-item"><div class=type>作者</div><div class=content>carbofish</div></div><div class="post-time bottom-item"><div class=type>发布于</div><div class=content>2024-11-20 19:00</div></div><div class="post-license bottom-item"><div class=type>许可</div><div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0"><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><i class="fa-brands fa-creative-commons"></i> <i class="fa-brands fa-creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc"></i> <i class="fa-brands fa-creative-commons-sa"></i></a></div></div></div><i class="copyright-bg fa-solid fa-copyright"></i></div><div class="copy-copyright-info flex-center tooltip" data-tooltip-content=复制版权信息 data-tooltip-offset-y=-2px><i class="fa-solid fa-copy"></i></div></div><div class="post-bottom-tags-and-share border-box"><div><ul class="post-tags-box border-box"><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/Reverse/ >Reverse</a></li></ul></div><div></div></div><div class="post-nav border-box"><div class=prev-post><a class=prev rel=prev href=/2024/12/03/arm_study/ title="ARM64 汇编小记"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item text-ellipsis">ARM64 汇编小记</span> <span class=post-nav-item>上一篇</span></span></a></div><div class=next-post><a class=next rel=next href=/2024/11/11/2024n1ctf/ title="2024 N1CTF - Reverse"><span class="title flex-center"><span class="post-nav-title-item text-ellipsis">2024 N1CTF - Reverse</span> <span class=post-nav-item>下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comments-container border-box"><div id=comments-anchor class="comment-area-title border-box"><i class="fas fa-comments"></i>&nbsp;评论</div><div class="comment-plugin-fail border-box"><span class=fail-tip>评论插件加载失败</span> <button class="reload keep-button">点击重新加载</button></div><div class="comment-plugin-loading flex-center border-box"><i class="loading-icon fa-solid fa-spinner fa-spin"></i> <span class=load-tip>正在加载评论插件</span></div><script data-pjax>window.KeepCommentPlugin={},window.KeepCommentPlugin.hideLoading=()=>{document.querySelector(".comments-container .comment-plugin-loading").style.display="none"},window.KeepCommentPlugin.loadFailHandle=()=>{window.KeepCommentPlugin.hideLoading();var e=document.querySelector(".comments-container .comment-plugin-fail");e.style.display="flex",e.querySelector(".reload").addEventListener("click",()=>{window.location.reload()})}</script><div class=waline-comment-container><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@waline/client@v3.3.2/dist/waline.css><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@waline/client@v3.3.2/dist/waline-meta.css><div id=waline-comment></div><script data-pjax>window.KeepCommentPlugin.walineOptions=JSON.parse("{}".replace(/&#34;/g,'"')),window.KeepCommentPlugin.walineOptions.el="#waline-comment",window.KeepCommentPlugin.walineOptions.comment=".post-comments-count",window.KeepCommentPlugin.walineOptions.serverURL="https://comment.carbo.ink/",window.KeepCommentPlugin.walineOptions.lang="zh-CN",window.KeepCommentPlugin.walineOptions.reaction=!0</script><script data-pjax async type=module>import { init } from '//cdn.jsdelivr.net/npm/@waline/client@v3.3.2/dist/waline.js'
              window.KeepCommentPlugin.initWaline = () => {
                if (init) {
                  init(window.KeepCommentPlugin.walineOptions)
                  window.KeepCommentPlugin.hideLoading()
                } else {
                  setTimeout(() => {
                    window.KeepCommentPlugin.initWaline()
                  }, 1000)
                }
              }

              if ('true' === 'true') {
                setTimeout(() => {
                  window.KeepCommentPlugin.initWaline()
                }, 1200)
              } else {
                window.addEventListener('DOMContentLoaded', window.KeepCommentPlugin.initWaline)
              }</script></div></div></div></div><div class="pc-post-toc right-toc"><div class="post-toc-wrap border-box"><div class="post-toc border-box"><ol class=nav><li class="nav-item nav-level-3"><a class=nav-link href=#appetizer><span class=nav-text>appetizer</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E8%A7%A3%E6%B3%951><span class=nav-text>解法1</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E8%A7%A3%E6%B3%952><span class=nav-text>解法2</span></a></li></ol></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom border-box"><footer class="footer border-box"><div class="copyright-info info-item">&copy;&nbsp;<span>2024</span>&nbsp;-&nbsp;2025 &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href=/ >carbofish</a></div><div class="theme-info info-item">由&nbsp;<a target=_blank href=https://hexo.io>Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class=keep-version target=_blank href=https://github.com/XPoet/hexo-theme-keep>Keep</a></div><div class="count-info info-item"><span class="count-item border-box word"><span class="item-type border-box">总字数</span> <span class="item-value border-box word">55.5k</span> </span><span class="count-item border-box uv"><span class="item-type border-box">访客数</span> <span class="item-value border-box uv" id=vercount_value_site_uv></span> </span><span class="count-item border-box pv"><span class="item-type border-box">访问量</span> <span class="item-value border-box pv" id=vercount_value_site_pv></span></span></div></footer></div></div><div class="post-tools right-toc"><div class="post-tools-container border-box"><ul class="post-tools-list border-box"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class=post-comments-count></span></li><li class="tools-item flex-center full-screen"><i class="fa-solid fa-expand"></i></li></ul></div></div><div class=side-tools><div class="side-tools-container border-box"><ul class="side-tools-list side-tools-show-handle border-box"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-toggle-theme-mode flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list border-box"><li class="tools-item toggle-show-toc-tablet flex-center"><i class="fas fa-list"></i></li><li class="tools-item go-to-comments-tablet flex-center"><i class="fas fa-comment"></i></li><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center show-arrow"><i class="arrow fas fa-arrow-up"></i> <span class=percent></span></li></ul></div></div><div class=zoom-in-image-mask><img class=zoom-in-image></div><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-input-field-pre><i class="fas fa-keyboard"></i></span><div class=search-input-container><input autocomplete=off autocorrect=off autocapitalize=off placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=close-popup-btn><i class="fas fa-times"></i></span></div><div id=search-result><div id=no-result><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><div class=tablet-post-toc-mask><div class=tablet-post-toc><div class="post-toc-wrap border-box"><div class="post-toc border-box"><ol class=nav><li class="nav-item nav-level-3"><a class=nav-link href=#appetizer><span class=nav-text>appetizer</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E8%A7%A3%E6%B3%951><span class=nav-text>解法1</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E8%A7%A3%E6%B3%952><span class=nav-text>解法2</span></a></li></ol></li></ol></div></div></div></div></main><script src=/js/utils.js></script><script src=/js/header-shrink.js></script><script src=/js/back2top.js></script><script src=/js/toggle-theme.js></script><script src=/js/code-block.js></script><script src=/js/main.js></script><script src=/js/libs/anime.min.js></script><script src=/js/local-search.js></script><script src=/js/lazyload.js></script><div class=pjax><script src=/js/post/post-helper.js></script><script src=/js/post/toc.js></script><script src=/js/post/copyright-info.js></script></div><script src=/js/mermaid.min.js></script><script data-pjax>window.mermaid&&mermaid.init()</script><script src=/js/libs/pjax.min.js></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.initExecute()})})</script></body></html>